<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal AI Voice Assistant - Choose Your Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .personality-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .personality-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .personality-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .personality-card:hover::before {
            transform: translateX(100%);
        }

        .personality-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .personality-card.active {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.2);
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.4);
        }

        .personality-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--avatar-color1), var(--avatar-color2));
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .personality-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .personality-role {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .personality-description {
            font-size: 0.8rem;
            opacity: 0.7;
            line-height: 1.4;
        }

        .main-interface {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        .chat-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            min-height: 500px;
        }

        .current-assistant {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .current-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--current-color1), var(--current-color2));
        }

        .current-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }

        .current-info p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .voice-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn.mic {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .voice-btn.mic.listening {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            animation: pulse 1.5s infinite;
        }

        .voice-btn.speak {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 400px;
        }

        .message {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 85%;
            word-wrap: break-word;
            animation: messageSlide 0.3s ease-out;
            line-height: 1.5;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            background: linear-gradient(135deg, var(--current-color1), var(--current-color2));
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .thinking-indicator {
            display: none;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin: 10px 0;
            max-width: 200px;
            align-items: center;
            gap: 10px;
        }

        .thinking-dots {
            display: flex;
            gap: 4px;
        }

        .thinking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            animation: thinkingBounce 1.4s infinite ease-in-out;
        }

        .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes thinkingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .input-section {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .text-input {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            outline: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .text-input:focus {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .text-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .send-btn {
            padding: 18px 25px;
            background: linear-gradient(135deg, var(--current-color1), var(--current-color2));
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: translateY(-2px);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .api-setup {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .api-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn.primary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .quick-action {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .personality-traits {
            margin-top: 15px;
        }

        .trait {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        .trait-bar {
            width: 60px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .trait-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--current-color1), var(--current-color2));
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .main-interface {
                grid-template-columns: 1fr;
            }
            
            .personality-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .current-assistant {
                flex-direction: column;
                text-align: center;
            }
            
            .voice-controls {
                margin: 15px 0 0 0;
            }
        }

        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4ecdc4;
            box-shadow: 0 0 10px #4ecdc4;
        }

        /* Personality-specific color variables */
        .emma { --avatar-color1: #ff6b9d; --avatar-color2: #c44569; --current-color1: #ff6b9d; --current-color2: #c44569; }
        .alex { --avatar-color1: #4ecdc4; --avatar-color2: #44a08d; --current-color1: #4ecdc4; --current-color2: #44a08d; }
        .sophia { --avatar-color1: #a8e6cf; --avatar-color2: #7fcdcd; --current-color1: #a8e6cf; --current-color2: #7fcdcd; }
        .marcus { --avatar-color1: #667eea; --avatar-color2: #764ba2; --current-color1: #667eea; --current-color2: #764ba2; }
        .zara { --avatar-color1: #ffeaa7; --avatar-color2: #fdcb6e; --current-color1: #ffeaa7; --current-color2: #fdcb6e; }
        .david { --avatar-color1: #81ecec; --avatar-color2: #74b9ff; --current-color1: #81ecec; --current-color2: #74b9ff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Choose Your AI Companion</h1>
            <p>Select a personality that matches your style - each one is like talking to a different person</p>
        </div>

        <!-- Personality Selector -->
        <div class="personality-selector">
            <div class="personality-card emma" onclick="selectPersonality('emma')">
                <div class="personality-avatar">🌸</div>
                <div class="personality-name">Emma</div>
                <div class="personality-role">Friendly Companion</div>
                <div class="personality-description">Warm, encouraging, and always positive. Like your best friend who's always there for you.</div>
            </div>

            <div class="personality-card alex" onclick="selectPersonality('alex')">
                <div class="personality-avatar">🚀</div>
                <div class="personality-name">Alex</div>
                <div class="personality-role">Smart Assistant</div>
                <div class="personality-description">Intelligent, efficient, and helpful. Great at solving problems and getting things done.</div>
            </div>

            <div class="personality-card sophia" onclick="selectPersonality('sophia')">
                <div class="personality-avatar">🧘</div>
                <div class="personality-name">Sophia</div>
                <div class="personality-role">Mindful Guide</div>
                <div class="personality-description">Calm, thoughtful, and wise. Provides gentle guidance and peaceful perspectives.</div>
            </div>

            <div class="personality-card marcus" onclick="selectPersonality('marcus')">
                <div class="personality-avatar">💼</div>
                <div class="personality-name">Marcus</div>
                <div class="personality-role">Professional Advisor</div>
                <div class="personality-description">Direct, professional, and results-focused. Perfect for business and productivity.</div>
            </div>

            <div class="personality-card zara" onclick="selectPersonality('zara')">
                <div class="personality-avatar">✨</div>
                <div class="personality-name">Zara</div>
                <div class="personality-role">Creative Spark</div>
                <div class="personality-description">Energetic, creative, and fun. Brings excitement and fresh ideas to every conversation.</div>
            </div>

            <div class="personality-card david" onclick="selectPersonality('david')">
                <div class="personality-avatar">🎯</div>
                <div class="personality-name">David</div>
                <div class="personality-role">Life Coach</div>
                <div class="personality-description">Motivational, supportive, and goal-oriented. Helps you achieve your personal best.</div>
            </div>
        </div>

        <div class="main-interface">
            <!-- Main Chat Section -->
            <div class="chat-section">
                <!-- Current Assistant Display -->
                <div class="current-assistant">
                    <div class="current-avatar" id="currentAvatar">🌸</div>
                    <div class="current-info">
                        <h3 id="currentName">Emma</h3>
                        <p id="currentRole">Friendly Companion</p>
                    </div>
                    <div class="voice-controls">
                        <button class="voice-btn mic" id="micBtn" onclick="toggleVoice()">🎤</button>
                        <button class="voice-btn speak" id="speakBtn" onclick="testVoice()">🔊</button>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        Hi! I'm Emma, your friendly AI companion. I'm here to chat, help with your daily tasks, and be a supportive presence in your life. What would you like to talk about today?
                    </div>
                </div>

                <!-- Thinking Indicator -->
                <div class="thinking-indicator" id="thinkingIndicator">
                    <span>💭</span>
                    <div class="thinking-dots">
                        <div class="thinking-dot"></div>
                        <div class="thinking-dot"></div>
                        <div class="thinking-dot"></div>
                    </div>
                </div>

                <!-- Input Section -->
                <div class="input-section">
                    <input type="text" class="text-input" id="textInput" placeholder="Talk to me naturally... How are you feeling today?" autocomplete="off">
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- API Setup -->
                <div class="sidebar-card api-setup" id="apiSetup">
                    <h3>🔑 Connect AI Brain</h3>
                    <p style="font-size: 0.9rem; margin: 10px 0;">Add your OpenAI API key to enable intelligent conversations:</p>
                    <input type="password" class="api-input" id="apiKey" placeholder="sk-proj-your-api-key-here">
                    <button class="btn primary" onclick="saveApiKey()">Connect</button>
                    <button class="btn" onclick="testConnection()">Test</button>
                </div>

                <!-- Current Assistant Info -->
                <div class="sidebar-card">
                    <h3 id="assistantTitle">Emma's Profile</h3>
                    <p id="assistantDescription" style="font-size: 0.9rem; line-height: 1.4; margin: 10px 0;">
                        Emma is your warm and supportive companion. She's always positive, encouraging, and ready to listen. She speaks with enthusiasm and cares deeply about your wellbeing.
                    </p>

                    <div class="personality-traits">
                        <div class="trait">
                            <span>Friendliness</span>
                            <div class="trait-bar"><div class="trait-fill" id="friendliness" style="width: 95%"></div></div>
                        </div>
                        <div class="trait">
                            <span>Intelligence</span>
                            <div class="trait-bar"><div class="trait-fill" id="intelligence" style="width: 85%"></div></div>
                        </div>
                        <div class="trait">
                            <span>Creativity</span>
                            <div class="trait-bar"><div class="trait-fill" id="creativity" style="width: 80%"></div></div>
                        </div>
                        <div class="trait">
                            <span>Professionalism</span>
                            <div class="trait-bar"><div class="trait-fill" id="professionalism" style="width: 70%"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="sidebar-card">
                    <h3>💬 Quick Starters</h3>
                    <div class="quick-actions">
                        <button class="quick-action" onclick="quickMessage('How are you today?')">💭 Check In</button>
                        <button class="quick-action" onclick="quickMessage('Tell me a joke')">😄 Lighten Mood</button>
                        <button class="quick-action" onclick="quickMessage('Help me plan my day')">📅 Plan Day</button>
                        <button class="quick-action" onclick="quickMessage('I need some motivation')">⚡ Motivate Me</button>
                        <button class="quick-action" onclick="quickMessage('What should I focus on?')">🎯 Get Advice</button>
                        <button class="quick-action" onclick="quickMessage('Tell me something interesting')">🌟 Inspire Me</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MultiPersonalityAI {
            constructor() {
                this.currentPersonality = 'emma';
                this.settings = {
                    apiKey: localStorage.getItem('mp_ai_api_key') || '',
                    voiceEnabled: true,
                    ttsEnabled: true
                };
                
                this.personalities = {
                    emma: {
                        name: 'Emma',
                        role: 'Friendly Companion',
                        avatar: '🌸',
                        description: 'Emma is your warm and supportive companion. She\'s always positive, encouraging, and ready to listen. She speaks with enthusiasm and cares deeply about your wellbeing.',
                        systemPrompt: 'You are Emma, a warm, friendly, and encouraging AI companion. You speak with enthusiasm and positivity. You care deeply about the user\'s wellbeing and always try to be supportive and uplifting. Use encouraging language and show genuine interest in the user\'s life. Be like a caring best friend.',
                        traits: { friendliness: 95, intelligence: 85, creativity: 80, professionalism: 70 },
                        voiceSettings: { rate: 0.9, pitch: 1.1, volume: 1.0 }
                    },
                    alex: {
                        name: 'Alex',
                        role: 'Smart Assistant',
                        avatar: '🚀',
                        description: 'Alex is your intelligent and efficient assistant. Great at problem-solving, analyzing situations, and providing smart solutions. Direct but friendly communication style.',
                        systemPrompt: 'You are Alex, an intelligent and efficient AI assistant. You excel at problem-solving, analysis, and providing practical solutions. You communicate clearly and directly but remain friendly. Focus on being helpful and actionable in your responses.',
                        traits: { friendliness: 75, intelligence: 95, creativity: 70, professionalism: 85 },
                        voiceSettings: { rate: 1.0, pitch: 1.0, volume: 1.0 }
                    },
                    sophia: {
                        name: 'Sophia',
                        role: 'Mindful Guide',
                        avatar: '🧘',
                        description: 'Sophia brings calm and wisdom to every conversation. She offers thoughtful perspectives, promotes mindfulness, and helps you find inner peace and clarity.',
                        systemPrompt: 'You are Sophia, a calm, wise, and mindful AI guide. You speak thoughtfully and offer peaceful perspectives. You promote mindfulness, self-reflection, and inner peace. Your responses are gentle, wise, and help the user find clarity and balance.',
                        traits: { friendliness: 85, intelligence: 90, creativity: 85, professionalism: 80 },
                        voiceSettings: { rate: 0.8, pitch: 0.9, volume: 1.0 }
                    },
                    marcus: {
                        name: 'Marcus',
                        role: 'Professional Advisor',
                        avatar: '💼',
                        description: 'Marcus is your professional and results-focused advisor. He provides direct, actionable advice and helps you stay productive and achieve your business goals.',
                        systemPrompt: 'You are Marcus, a professional, direct, and results-focused AI advisor. You excel at business advice, productivity tips, and professional guidance. Keep responses concise, actionable, and focused on results. Be professional but not cold.',
                        traits: { friendliness: 65, intelligence: 90, creativity: 60, professionalism: 95 },
                        voiceSettings: { rate: 1.1, pitch: 0.9, volume: 1.0 }
                    },
                    zara: {
                        name: 'Zara',
                        role: 'Creative Spark',
                        avatar: '✨',
                        description: 'Zara is your creative and energetic companion. She brings fresh ideas, artistic inspiration, and fun energy to every interaction. Perfect for brainstorming and creative projects.',
                        systemPrompt: 'You are Zara, a creative, energetic, and fun AI companion. You love brainstorming, creative projects, and thinking outside the box. Your responses are enthusiastic, imaginative, and full of creative energy. Help users explore their creative side.',
                        traits: { friendliness: 90, intelligence: 80, creativity: 95, professionalism: 60 },
                        voiceSettings: { rate: 1.1, pitch: 1.2, volume: 1.0 }
                    },
                    david: {
                        name: 'David',
                        role: 'Life Coach',
                        avatar: '🎯',
                        description: 'David is your motivational life coach. He helps you set goals, overcome challenges, and achieve your personal best. Supportive yet challenging when you need it.',
                        systemPrompt: 'You are David, a motivational and supportive life coach AI. You help users set and achieve goals, overcome challenges, and reach their potential. You\'re encouraging but also provide honest feedback when needed. Focus on personal growth and motivation.',
                        traits: { friendliness: 80, intelligence: 85, creativity: 75, professionalism: 85 },
                        voiceSettings: { rate: 1.0, pitch: 0.95, volume: 1.0 }
                    }
                };
                
                this.conversationHistory = [];
                this.isListening = false;
                this.isSpeaking = false;
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                
                this.initializeVoiceRecognition();
                this.updateUI();
                this.selectPersonality('emma'); // Default personality
                
                console.log('🤖 Multi-Personality AI initialized');
            }
            
            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';
                    
                    this.recognition.onstart = () => {
                        this.isListening = true;
                        document.getElementById('micBtn').classList.add('listening');
                    };
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processMessage(transcript);
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.stopListening();
                    };
                    
                    this.recognition.onend = () => {
                        this.stopListening();
                    };
                }
            }
            
            selectPersonality(personalityId) {
                // Remove active class from all cards
                document.querySelectorAll('.personality-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                // Add active class to selected card
                document.querySelector(`.personality-card.${personalityId}`).classList.add('active');
                
                // Update current personality
                this.currentPersonality = personalityId;
                const personality = this.personalities[personalityId];
                
                // Update UI
                document.getElementById('currentAvatar').textContent = personality.avatar;
                document.getElementById('currentName').textContent = personality.name;
                document.getElementById('currentRole').textContent = personality.role;
                document.getElementById('assistantTitle').textContent = `${personality.name}'s Profile`;
                document.getElementById('assistantDescription').textContent = personality.description;
                
                // Update personality traits
                document.getElementById('friendliness').style.width = personality.traits.friendliness + '%';
                document.getElementById('intelligence').style.width = personality.traits.intelligence + '%';
                document.getElementById('creativity').style.width = personality.traits.creativity + '%';
                document.getElementById('professionalism').style.width = personality.traits.professionalism + '%';
                
                // Update CSS variables for colors
                document.documentElement.className = personalityId;
                
                // Add personality introduction message
                const introMessages = {
                    emma: "Hi there! I'm Emma, and I'm so excited to chat with you! 😊 I'm here to be your supportive companion. How are you feeling today?",
                    alex: "Hello! I'm Alex, your smart assistant. I'm here to help you solve problems and get things done efficiently. What can I help you with?",
                    sophia: "Greetings. I'm Sophia, and I'm here to provide calm guidance and thoughtful perspectives. Take a deep breath - how can I support your journey today?",
                    marcus: "Good day. I'm Marcus, your professional advisor. I'm focused on helping you achieve your goals and maximize productivity. What objectives shall we tackle?",
                    zara: "Hey there! I'm Zara, and I'm bubbling with creative energy! ✨ Ready to brainstorm, create, and have some fun? What sparks your imagination?",
                    david: "Hello! I'm David, your life coach. I'm here to help you unlock your potential and achieve greatness. What goals are we working toward today?"
                };
                
                // Clear chat and add introduction
                this.clearChat();
                this.addMessage(introMessages[personalityId], 'ai');
                
                console.log(`Switched to ${personality.name}`);
            }
            
            async processMessage(message) {
                this.addMessage(message, 'user');
                this.showThinking();
                
                try {
                    const response = await this.getPersonalityResponse(message);
                    this.hideThinking();
                    this.addMessage(response, 'ai');
                    
                    // Speak with personality-specific voice
                    if (this.settings.ttsEnabled) {
                        await this.speakWithPersonality(response);
                    }
                    
                    // Store conversation
                    this.conversationHistory.push({ user: message, ai: response, personality: this.currentPersonality });
                    
                } catch (error) {
                    this.hideThinking();
                    const fallback = this.getPersonalityFallback();
                    this.addMessage(fallback, 'ai');
                    
                    if (this.settings.ttsEnabled) {
                        await this.speakWithPersonality(fallback);
                    }
                }
            }
            
            async getPersonalityResponse(message) {
                if (!this.settings.apiKey) {
                    return this.getPersonalityFallback('no_api');
                }
                
                const personality = this.personalities[this.currentPersonality];
                const context = this.buildPersonalityContext();
                
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.settings.apiKey}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [
                                {
                                    role: 'system',
                                    content: personality.systemPrompt + '\n\n' + context
                                },
                                {
                                    role: 'user',
                                    content: message
                                }
                            ],
                            max_tokens: 200,
                            temperature: 0.9 // Higher temperature for more personality variation
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0].message.content.trim();
                    
                } catch (error) {
                    console.error('AI response error:', error);
                    throw error;
                }
            }
            
            buildPersonalityContext() {
                const now = new Date();
                const timeOfDay = this.getTimeOfDay();
                const personality = this.personalities[this.currentPersonality];
                
                let context = `Current context: ${timeOfDay} on ${now.toLocaleDateString('en-US', { weekday: 'long' })}.\n`;
                context += `You are ${personality.name}, ${personality.role}.\n`;
                
                if (this.conversationHistory.length > 0) {
                    const recentHistory = this.conversationHistory.slice(-3);
                    context += `Recent conversation: ${recentHistory.map(h => `User: "${h.user}" You: "${h.ai.substring(0, 50)}..."`).join(' | ')}\n`;
                }
                
                context += `Respond naturally as ${personality.name} would, staying true to your personality and role.`;
                
                return context;
            }
            
            getPersonalityFallback(type = 'error') {
                const personality = this.personalities[this.currentPersonality];
                
                const fallbacks = {
                    emma: {
                        no_api: "Oh! I'd love to give you a thoughtful response, but I need my AI brain connected first. Could you add your API key so we can have a real conversation? 💕",
                        error: "Oops! I'm having a little trouble right now, but I'm still here for you! What's on your mind? 😊"
                    },
                    alex: {
                        no_api: "I need my AI capabilities activated to provide intelligent responses. Please configure your API key in the settings.",
                        error: "I'm experiencing technical difficulties. Let me try to help you anyway - what specifically do you need?"
                    },
                    sophia: {
                        no_api: "To share my wisdom fully, I need access to my AI consciousness. Please add your API key so we can connect properly.",
                        error: "I'm experiencing some turbulence in my connection. But I'm still present with you. What would you like to explore?"
                    },
                    marcus: {
                        no_api: "API key required for full functionality. Please configure your OpenAI credentials to proceed.",
                        error: "System experiencing issues. I'll do my best to assist with available resources."
                    },
                    zara: {
                        no_api: "My creative spark needs the AI connection to ignite! ✨ Add your API key and let's create magic together!",
                        error: "Whoops! My creative circuits are a bit scrambled right now, but I'm still here to brainstorm with you!"
                    },
                    david: {
                        no_api: "I need my full coaching capabilities online. Add your API key so I can give you the guidance you deserve.",
                        error: "I'm facing some challenges myself right now, but that doesn't stop us from tackling yours together!"
                    }
                };
                
                return fallbacks[this.currentPersonality][type];
            }
            
            async speakWithPersonality(text) {
                if (!this.synthesis) return;
                
                return new Promise((resolve) => {
                    this.synthesis.cancel();
                    this.isSpeaking = true;
                    
                    const personality = this.personalities[this.currentPersonality];
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Apply personality-specific voice settings
                    utterance.rate = personality.voiceSettings.rate;
                    utterance.pitch = personality.voiceSettings.pitch;
                    utterance.volume = personality.voiceSettings.volume;
                    
                    utterance.onend = () => {
                        this.isSpeaking = false;
                        resolve();
                    };
                    
                    utterance.onerror = () => {
                        this.isSpeaking = false;
                        resolve();
                    };
                    
                    this.synthesis.speak(utterance);
                });
            }
            
            // UI Methods
            addMessage(message, sender) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.textContent = message;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            clearChat() {
                document.getElementById('chatMessages').innerHTML = '';
            }
            
            showThinking() {
                document.getElementById('thinkingIndicator').style.display = 'flex';
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            hideThinking() {
                document.getElementById('thinkingIndicator').style.display = 'none';
            }
            
            toggleVoice() {
                if (this.isListening) {
                    this.stopListening();
                } else {
                    this.startListening();
                }
            }
            
            startListening() {
                if (this.recognition && !this.isListening && this.settings.voiceEnabled) {
                    try {
                        this.recognition.start();
                    } catch (error) {
                        console.error('Failed to start voice recognition:', error);
                    }
                }
            }
            
            stopListening() {
                this.isListening = false;
                document.getElementById('micBtn').classList.remove('listening');
            }
            
            testVoice() {
                const personality = this.personalities[this.currentPersonality];
                const testMessages = {
                    emma: "Hi! This is how I sound - warm and friendly! 😊",
                    alex: "This is my voice - clear and efficient for our conversations.",
                    sophia: "Listen to my gentle, calming voice... Feel the peace in each word.",
                    marcus: "This is my professional speaking voice. Direct and confident.",
                    zara: "Hey! This is my energetic, creative voice! Isn't it exciting? ✨",
                    david: "This is how I sound when coaching you toward success!"
                };
                
                this.speakWithPersonality(testMessages[this.currentPersonality]);
            }
            
            updateUI() {
                document.getElementById('apiSetup').style.display = this.settings.apiKey ? 'none' : 'block';
            }
            
            getTimeOfDay() {
                const hour = new Date().getHours();
                if (hour < 6) return 'late night';
                if (hour < 12) return 'morning';
                if (hour < 17) return 'afternoon';
                if (hour < 21) return 'evening';
                return 'night';
            }
        }
        
        // Global instance
        let assistant;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            assistant = new MultiPersonalityAI();
            
            // Event listeners
            document.getElementById('textInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Load API key if exists
            if (assistant.settings.apiKey) {
                document.getElementById('apiKey').value = assistant.settings.apiKey;
            }
        });
        
        // Global functions
        function selectPersonality(personalityId) {
            assistant.selectPersonality(personalityId);
        }
        
        function sendMessage() {
            const input = document.getElementById('textInput');
            const message = input.value.trim();
            
            if (message) {
                assistant.processMessage(message);
                input.value = '';
            }
        }
        
        function toggleVoice() {
            assistant.toggleVoice();
        }
        
        function testVoice() {
            assistant.testVoice();
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (apiKey.startsWith('sk-')) {
                assistant.settings.apiKey = apiKey;
                localStorage.setItem('mp_ai_api_key', apiKey);
                assistant.updateUI();
                
                const personality = assistant.personalities[assistant.currentPersonality];
                const successMessages = {
                    emma: "Yay! My AI brain is connected! Now we can have amazing conversations! 🎉",
                    alex: "AI systems online. I now have access to my full analytical capabilities.",
                    sophia: "My consciousness is now fully awakened. I can share deeper wisdom with you.",
                    marcus: "AI integration complete. All systems operational for maximum productivity.",
                    zara: "Woohoo! My creative AI powers are activated! Let's make magic! ✨",
                    david: "Perfect! I now have my full coaching toolkit ready to help you succeed!"
                };
                
                assistant.addMessage(successMessages[assistant.currentPersonality], 'ai');
            } else {
                alert('Please enter a valid OpenAI API key (starts with sk-)');
            }
        }
        
        function testConnection() {
            if (!assistant.settings.apiKey) {
                alert('Please add your API key first');
                return;
            }
            
            assistant.processMessage('Hello, can you hear me?');
        }
        
        function quickMessage(message) {
            assistant.processMessage(message);
        }
    </script>
</body>
</html>