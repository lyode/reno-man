<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="REFIT MAINTENANCE SERVICES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FFB07A">
    <meta name="msapplication-navbutton-color" content="#FFB07A">
    
    <title>REFIT MAINTENANCE SERVICES - AI Enhanced Quote Builder</title>
    
    <!-- Enhanced PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, select, textarea, button {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        :root {
            /* Pastel Orange Theme - Light Mode */
            --bg-primary: #fef9f6;
            --bg-secondary: #fff1ea;
            --bg-card: #ffffff;
            --bg-card-hover: #fef7f2;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            
            /* Pastel Orange Button Colors */
            --accent-primary: #FFB07A;
            --accent-secondary: #FFA366;
            --accent-warm: #FF8C42;
            --accent-soft: #FFD4B3;
            --accent-light: #FFF2E6;
            --accent-dark: #E69660;
            
            --border-color: #e2e8f0;
            --shadow-light: rgba(255, 176, 122, 0.15);
            --shadow-medium: rgba(255, 176, 122, 0.25);
            --shadow-strong: rgba(255, 176, 122, 0.35);
            --overlay: rgba(45, 55, 72, 0.8);
            
            /* Status Colors with Orange Tints */
            --success: #FFB07A;
            --warning: #FF8C42;
            --error: #FF6B42;
            --info: #FFA366;
            
            /* AI Assistant Colors */
            --ai-primary: #FF69B4;
            --ai-secondary: #FFB6C1;
            --ai-accent: #FF1493;
        }
        
        [data-theme="dark"] {
            /* Pastel Orange Theme - Dark Mode */
            --bg-primary: #1a1411;
            --bg-secondary: #2d241f;
            --bg-card: #3a2f29;
            --bg-card-hover: #453a33;
            --text-primary: #f7e6d7;
            --text-secondary: #e0c4a8;
            --text-muted: #c4a285;
            
            /* Pastel Orange Button Colors - Dark Mode */
            --accent-primary: #FFB07A;
            --accent-secondary: #FFA366;
            --accent-warm: #FF8C42;
            --accent-soft: #CC8A61;
            --accent-light: #B87A56;
            --accent-dark: #E69660;
            
            --border-color: #4a3a2f;
            --shadow-light: rgba(255, 176, 122, 0.1);
            --shadow-medium: rgba(255, 176, 122, 0.2);
            --shadow-strong: rgba(255, 176, 122, 0.3);
            --overlay: rgba(0, 0, 0, 0.9);
            
            /* AI Assistant Colors - Dark Mode */
            --ai-primary: #FF69B4;
            --ai-secondary: #CC5B8F;
            --ai-accent: #FF1493;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        /* Mobile Layout Container */
        .mobile-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 2px 10px var(--shadow-medium);
            border-bottom: 1px solid var(--border-color);
        }
        
        .status-bar .time {
            color: var(--text-primary);
        }
        
        .status-bar .indicators {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }
        
        .theme-toggle {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .theme-toggle:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 4px 20px var(--shadow-medium);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            width: 54px;
            height: 54px;
            background: var(--accent-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 6px 16px var(--shadow-medium);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--accent-secondary);
        }
        
        .app-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--shadow-strong);
            background: var(--accent-secondary);
        }
        
        .app-logo:active {
            transform: scale(0.95);
        }
        
        .logo-svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 4px var(--shadow-light));
        }
        
        .app-title h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        
        .app-title p {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.2;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-right .stats {
            text-align: right;
        }
        
        .header-right p {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            box-shadow: 0 2px 8px var(--shadow-light);
            margin-left: 8px;
            position: relative;
        }
        
        .header-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .header-btn:active {
            transform: scale(0.9);
        }
        
        .header-btn.ai-btn {
            background: var(--ai-primary);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 2px 8px var(--shadow-light); }
            to { box-shadow: 0 4px 16px rgba(255, 105, 180, 0.4); }
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-warm);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-secondary);
        }
        
        /* AI Assistant Floating Button */
        .ai-assistant-float {
            position: fixed;
            bottom: 160px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--ai-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.3);
            transition: all 0.3s ease;
            z-index: 80;
            animation: float 3s ease-in-out infinite;
        }
        
        .ai-assistant-float:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(255, 105, 180, 0.4);
        }
        
        .ai-assistant-float.speaking {
            animation: pulse 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        /* AI Assistant Panel */
        .ai-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--ai-primary), var(--ai-secondary));
            color: white;
            padding: 24px 20px 40px;
            border-radius: 24px 24px 0 0;
            transform: translateY(100%);
            transition: all 0.3s ease;
            z-index: 150;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .ai-panel.show {
            transform: translateY(0);
        }
        
        .ai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .ai-avatar {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 12px;
        }
        
        .ai-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .ai-info p {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .ai-controls {
            display: flex;
            gap: 8px;
        }
        
        .ai-control-btn {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ai-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .ai-control-btn.active {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .ai-chat {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .ai-message {
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .ai-suggestions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 16px;
        }
        
        .ai-suggestion {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 12px;
            padding: 12px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .ai-suggestion:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 130px 20px 140px;
            -webkit-overflow-scrolling: touch;
            position: relative;
            height: calc(100vh - 44px);
            scroll-behavior: smooth;
        }
        
        .main-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        /* Enhanced Category Management */
        .category-manager {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .category-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow-medium);
            border-color: var(--accent-primary);
        }
        
        .category-card.selected {
            border-color: var(--accent-primary);
            background: var(--accent-light);
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .category-info {
            flex: 1;
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .category-actions {
            display: flex;
            gap: 8px;
        }
        
        .mini-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .mini-btn:hover {
            background: var(--accent-secondary);
            transform: scale(1.1);
        }
        
        .mini-btn.edit { background: var(--accent-primary); }
        .mini-btn.add { background: var(--accent-warm); }
        .mini-btn.select { background: var(--success); }
        
        /* Item List */
        .items-list {
            margin-top: 16px;
        }
        
        .item-row {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .item-row:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .item-row.selected {
            border-color: var(--accent-primary);
            background: var(--accent-light);
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .item-details {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .item-price {
            font-weight: 700;
            color: var(--accent-primary);
            margin: 0 16px;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .select-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-primary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 12px;
        }
        
        .select-checkbox.checked {
            background: var(--accent-primary);
            color: white;
        }
        
        /* Quote Cart */
        .quote-cart {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: var(--accent-primary);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 25px var(--shadow-strong);
            transition: all 0.2s ease;
            z-index: 80;
        }
        
        .quote-cart:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px var(--shadow-strong);
        }
        
        .quote-cart.hidden {
            display: none;
        }
        
        /* Buttons - All Pastel Orange */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 52px;
            text-decoration: none;
            box-shadow: 0 4px 12px var(--shadow-light);
            background: var(--accent-primary);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            background: var(--accent-secondary);
        }
        
        .btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary { background: var(--accent-primary); }
        .btn-success { background: var(--accent-primary); }
        .btn-danger { background: var(--accent-warm); }
        .btn-warning { background: var(--accent-secondary); }
        .btn-info { background: var(--accent-soft); color: var(--text-primary); }
        .btn-soft { background: var(--accent-soft); color: var(--text-primary); }
        .btn-warm { background: var(--accent-warm); }
        .btn-secondary { background: var(--accent-dark); }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-medium);
            transform: translateY(-2px);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: var(--accent-primary);
        }
        
        /* Action Buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .action-btn {
            padding: 24px 20px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-height: 120px;
            box-shadow: 0 6px 20px var(--shadow-light);
        }
        
        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px var(--shadow-medium);
        }
        
        .action-btn:active {
            transform: scale(0.96);
        }
        
        .action-btn.primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        .action-btn.success { background: linear-gradient(135deg, var(--accent-primary), var(--accent-warm)); }
        .action-btn.warm { background: linear-gradient(135deg, var(--accent-warm), var(--accent-secondary)); }
        .action-btn.soft { background: linear-gradient(135deg, var(--accent-soft), var(--accent-primary)); }
        .action-btn.info { background: linear-gradient(135deg, var(--accent-secondary), var(--accent-dark)); }
        .action-btn.secondary { background: linear-gradient(135deg, var(--accent-dark), var(--accent-primary)); }
        .action-btn.ai { background: linear-gradient(135deg, var(--ai-primary), var(--ai-secondary)); }
        
        .action-btn .icon {
            font-size: 32px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        /* Form Elements */
        .input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .input::placeholder {
            color: var(--text-muted);
        }
        
        .input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 176, 122, 0.2);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px 32px;
            z-index: 100;
            box-shadow: 0 -4px 20px var(--shadow-medium);
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border-radius: 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 60px;
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: var(--accent-light);
            box-shadow: 0 2px 8px var(--shadow-light);
            transform: scale(1.05);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item .icon {
            font-size: 24px;
        }
        
        .home-indicator {
            height: 4px;
            background: var(--accent-primary);
            border-radius: 2px;
            width: 140px;
            margin: 12px auto 0;
            opacity: 0.6;
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: flex-end;
            z-index: 200;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            color: var(--text-primary);
            animation: slideUp 0.3s ease;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            border: 1px solid var(--border-color);
            box-shadow: 0 -8px 40px var(--shadow-strong);
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
        }
        
        .close-btn:hover {
            background: var(--accent-warm);
            color: white;
            transform: scale(1.1);
        }
        
        .close-btn:active {
            transform: scale(0.9);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Form Elements in Modals */
        .form-input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .form-input::placeholder {
            color: var(--text-muted);
        }
        
        .form-input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 176, 122, 0.2);
        }
        
        .form-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .form-btn {
            padding: 18px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 56px;
            box-shadow: 0 4px 12px var(--shadow-light);
            background: var(--accent-primary);
        }
        
        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            background: var(--accent-secondary);
        }
        
        .form-btn:active {
            transform: scale(0.96);
        }
        
        .form-btn.btn-primary { background: var(--accent-primary); }
        .form-btn.btn-secondary { background: var(--accent-dark); }
        .form-btn.btn-danger { background: var(--accent-warm); }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-primary);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 8px 32px var(--shadow-medium);
            z-index: 250;
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        .success-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Quote Review */
        .quote-review {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .quote-summary {
            background: var(--accent-primary);
            color: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .quote-total {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
        }
        
        .share-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .share-btn {
            padding: 16px 12px;
            border-radius: 12px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
        }
        
        .share-btn.whatsapp { background: #25D366; }
        .share-btn.email { background: #EA4335; }
        .share-btn.telegram { background: #0088CC; }
        .share-btn.copy { background: var(--accent-warm); }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .view {
            padding-top: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .add-btn {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
            box-shadow: 0 8px 24px var(--shadow-medium);
        }
        
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px var(--shadow-strong);
            background: var(--accent-secondary);
        }
        
        .add-btn:active {
            transform: scale(0.9);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        /* Mobile Optimizations */
        @media screen and (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .form-actions {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .share-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .ai-suggestions {
                grid-template-columns: 1fr;
            }
        }
        
        /* Safe area adjustments */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }
        
        /* Print styles */
        @media print {
            .status-bar,
            .bottom-nav,
            .modal,
            .ai-assistant-float,
            .ai-panel {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body class="comfort-mode" data-theme="light">
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="status-time">9:41</div>
            <div class="indicators">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙 Dark</button>
                <span>📶</span>
                <span>📱</span>
                <span>🔋</span>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="app-logo" onclick="openLogoSelector()" id="main-logo">
                        <!-- Default Professional Maintenance Tool Icon -->
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="50" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="app-title">
                        <h1 id="company-name">REFIT MAINTENANCE SERVICES</h1>
                        <p id="company-registration">Registration No: 201803348973<br>(002894203-V)</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="stats">
                    <p id="current-date">Today</p>
                    <p id="daily-revenue">RM 0.00</p>
                </div>
                <button class="header-btn ai-btn" onclick="toggleAIAssistant()" title="AI Assistant">
                    🤖
                </button>
                <button class="header-btn" onclick="openQuoteCart()" title="Quote Cart">
                    🛒
                    <span class="cart-badge" id="cart-badge">0</span>
                </button>
                <button class="header-btn" onclick="exportData()" title="Export Data">
                    📤
                </button>
            </div>
        </div>

        <!-- AI Assistant Floating Button -->
        <div class="ai-assistant-float" id="ai-float" onclick="toggleAIAssistant()">
            💎
        </div>

        <!-- AI Assistant Panel -->
        <div class="ai-panel" id="ai-panel">
            <div class="ai-header">
                <div style="display: flex; align-items: center;">
                    <div class="ai-avatar" id="ai-avatar">💎</div>
                    <div class="ai-info">
                        <h3 id="ai-name">Ela</h3>
                        <p id="ai-status">Professional Assistant • Ready to help</p>
                    </div>
                </div>
                <div class="ai-controls">
                    <button class="ai-control-btn" id="voice-btn" onclick="toggleVoice()" title="Toggle Voice">
                        🔊
                    </button>
                    <button class="ai-control-btn" onclick="openAISettings()" title="AI Settings">
                        ⚙️
                    </button>
                    <button class="ai-control-btn" onclick="toggleAIAssistant()" title="Close">
                        ✕
                    </button>
                </div>
            </div>
            
            <div class="ai-chat" id="ai-chat">
                <div class="ai-message" id="welcome-message">
                    👋 Hi there! I'm Ela, your professional maintenance assistant. I'm here to help you with quotes, categories, and business insights. How can I assist you today?
                </div>
            </div>
            
            <div class="ai-suggestions">
                <button class="ai-suggestion" onclick="aiSuggestion('help')">
                    🤝 Show me around the app
                </button>
                <button class="ai-suggestion" onclick="aiSuggestion('quote')">
                    💰 Help me create a quote
                </button>
                <button class="ai-suggestion" onclick="aiSuggestion('tips')">
                    💡 Give me business tips
                </button>
                <button class="ai-suggestion" onclick="aiSuggestion('analysis')">
                    📊 Analyze my data
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="total-quotes-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Quote Items</div>
                        <div class="stat-value" id="total-items-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-value" id="today-revenue">RM 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="total-revenue">RM 0</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">🍑 AI Enhanced Quote Builder</h3>
                    <div class="actions-grid">
                        <button class="action-btn primary" onclick="showView('categories')">
                            <span class="icon">🏗️</span>
                            <span style="font-weight: 700;">Category Builder</span>
                        </button>
                        <button class="action-btn success" onclick="showView('quotes')">
                            <span class="icon">💰</span>
                            <span style="font-weight: 700;">Saved Quotes</span>
                        </button>
                        <button class="action-btn ai" onclick="toggleAIAssistant()">
                            <span class="icon">💎</span>
                            <span style="font-weight: 700;">AI Assistant</span>
                        </button>
                        <button class="action-btn info" onclick="exportData()">
                            <span class="icon">📤</span>
                            <span style="font-weight: 700;">Export Data</span>
                        </button>
                    </div>
                </div>

                <!-- AI Insights Card -->
                <div class="card" style="border: 2px solid var(--ai-primary);">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--ai-primary);">💎 AI Insights</h3>
                    <div id="ai-insights">
                        <!-- AI insights will be populated here -->
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">Recent Activity</h3>
                    <div id="recent-activity"></div>
                </div>
            </div>

            <!-- Categories View -->
            <div id="categories-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Category Builder</h2>
                    <button class="add-btn" onclick="openCategoryForm()">
                        <span>➕</span>
                    </button>
                </div>

                <div class="category-manager">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="font-weight: 700; color: var(--text-primary);">🏗️ Manage Categories & Items</h3>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-soft" onclick="selectAllCategories()">Select All</button>
                            <button class="btn btn-secondary" onclick="clearAllSelections()">Clear All</button>
                        </div>
                    </div>
                    
                    <div class="category-grid" id="categories-grid">
                        <!-- Categories will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Quotes View -->
            <div id="quotes-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Saved Quotes</h2>
                    <button class="add-btn" onclick="showView('categories')">
                        <span>🏗️</span>
                    </button>
                </div>

                <div id="quotes-list"></div>
            </div>
        </div>

        <!-- Quote Cart Floating Button -->
        <div class="quote-cart" id="quote-cart-btn" onclick="openQuoteCart()">
            🛒
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="icon">🏠</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="showView('categories')">
                    <span class="icon">🏗️</span>
                    <span>Builder</span>
                </div>
                <div class="nav-item" onclick="showView('quotes')">
                    <span class="icon">💰</span>
                    <span>Quotes</span>
                </div>
                <div class="nav-item" onclick="toggleAIAssistant()">
                    <span class="icon">💎</span>
                    <span>AI</span>
                </div>
            </div>
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- AI Settings Modal -->
    <div id="ai-settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💎 AI Assistant Settings</h3>
                <button class="close-btn" onclick="closeAISettings()">✕</button>
            </div>
            <div class="modal-body">
                <div class="card" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">🤖 Choose Your Assistant</h4>
                    
                    <div style="display: grid; gap: 12px;">
                        <div class="ai-option" onclick="selectAI('ela')" data-ai="ela">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: 12px; border: 2px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;">
                                <div style="font-size: 24px;">💎</div>
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary);">Ela</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">Sweet & Professional • Age 24 • Intelligent & Caring</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-option" onclick="selectAI('isla')" data-ai="isla">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: 12px; border: 2px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;">
                                <div style="font-size: 24px;">🌺</div>
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary);">Isla</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">Soft & Lovely • Age 23 • Creative & Thoughtful</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-option" onclick="selectAI('maiya')" data-ai="maiya">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: 12px; border: 2px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;">
                                <div style="font-size: 24px;">🌸</div>
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary);">Maiya</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">Clever & Pretty • Age 25 • Analytical & Supportive</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-option" onclick="selectAI('violet')" data-ai="violet">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: 12px; border: 2px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;">
                                <div style="font-size: 24px;">💜</div>
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary);">Violet</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">Concerned & Wise • Age 26 • Strategic & Empathetic</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-option" onclick="selectAI('luna')" data-ai="luna">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: 12px; border: 2px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;">
                                <div style="font-size: 24px;">🌙</div>
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary);">Luna</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">Gentle & Intuitive • Age 22 • Understanding & Calm</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-option" onclick="selectAI('aria')" data-ai="aria">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: 12px; border: 2px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;">
                                <div style="font-size: 24px;">✨</div>
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary);">Aria</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">Bright & Cheerful • Age 21 • Energetic & Helpful</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">🔊 Voice Settings</h4>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <span style="font-weight: 600;">Voice Assistant</span>
                        <button class="btn" style="padding: 8px 16px; font-size: 14px;" onclick="toggleVoice()" id="voice-toggle-btn">
                            🔊 Enable Voice
                        </button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600;">Smart Suggestions</span>
                        <button class="btn" style="padding: 8px 16px; font-size: 14px;" onclick="toggleSmartSuggestions()" id="suggestions-toggle-btn">
                            💡 Enable
                        </button>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="form-btn btn-primary" onclick="closeAISettings()">
                        ✅ Save Settings
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="resetAISettings()">
                        🔄 Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Form Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="category-modal-title">➕ Add Category</h3>
                <button class="close-btn" onclick="closeCategoryForm()">✕</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <input type="text" class="form-input" placeholder="Category Name *" id="category-name" required>
                    <textarea class="form-input" placeholder="Description" id="category-description" rows="2" style="resize: none;"></textarea>
                    <input type="text" class="form-input" placeholder="Icon (emoji or text)" id="category-icon" value="🏷️">
                    <input type="color" class="form-input" id="category-color" value="#FFB07A">
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn btn-primary">Save Category</button>
                        <button type="button" class="form-btn btn-secondary" onclick="closeCategoryForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Item Form Modal -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="item-modal-title">➕ Add Item</h3>
                <button class="close-btn" onclick="closeItemForm()">✕</button>
            </div>
            <div class="modal-body">
                <form id="item-form">
                    <input type="text" class="form-input" placeholder="Item Name *" id="item-name" required>
                    <textarea class="form-input" placeholder="Description" id="item-description" rows="2" style="resize: none;"></textarea>
                    <input type="number" class="form-input" placeholder="Price (RM) *" id="item-price" step="0.01" required>
                    <select class="form-input" id="item-unit">
                        <option value="pcs">Pieces (pcs)</option>
                        <option value="hours">Hours</option>
                        <option value="sqft">Square Feet</option>
                        <option value="sqm">Square Meters</option>
                        <option value="meters">Meters</option>
                        <option value="kg">Kilograms</option>
                        <option value="liters">Liters</option>
                        <option value="set">Set</option>
                        <option value="lot">Lot</option>
                        <option value="service">Service</option>
                    </select>
                    <input type="hidden" id="item-category-id">
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn btn-primary">Save Item</button>
                        <button type="button" class="form-btn btn-secondary" onclick="closeItemForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quote Cart Modal -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🛒 Quote Cart</h3>
                <button class="close-btn" onclick="closeQuoteCart()">✕</button>
            </div>
            <div class="modal-body">
                <div id="cart-items"></div>
                
                <div class="quote-summary" id="cart-summary">
                    <div class="quote-total" id="cart-total">RM 0.00</div>
                    <div>Total Quote Amount</div>
                </div>
                
                <div style="margin: 20px 0;">
                    <input type="text" class="form-input" placeholder="Quote Title/Project Name" id="quote-title">
                    <textarea class="form-input" placeholder="Additional Notes" id="quote-notes" rows="3" style="resize: none;"></textarea>
                </div>
                
                <div class="form-actions">
                    <button class="form-btn btn-primary" onclick="reviewQuote()">📋 Review Quote</button>
                    <button class="form-btn btn-danger" onclick="clearCart()">🗑️ Clear Cart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quote Review Modal -->
    <div id="review-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📋 Quote Review</h3>
                <button class="close-btn" onclick="closeQuoteReview()">✕</button>
            </div>
            <div class="modal-body">
                <div class="quote-review" id="quote-review-content">
                    <!-- Review content will be populated here -->
                </div>
                
                <div class="form-actions">
                    <button class="form-btn btn-primary" onclick="generatePDF()">📄 Generate PDF</button>
                    <button class="form-btn btn-success" onclick="saveQuote()">💾 Save Quote</button>
                </div>
                
                <div class="share-buttons">
                    <button class="share-btn whatsapp" onclick="shareWhatsApp()">
                        <span style="font-size: 20px;">📱</span>
                        <span>WhatsApp</span>
                    </button>
                    <button class="share-btn email" onclick="shareEmail()">
                        <span style="font-size: 20px;">📧</span>
                        <span>Email</span>
                    </button>
                    <button class="share-btn telegram" onclick="shareTelegram()">
                        <span style="font-size: 20px;">✈️</span>
                        <span>Telegram</span>
                    </button>
                    <button class="share-btn copy" onclick="copyQuote()">
                        <span style="font-size: 20px;">📋</span>
                        <span>Copy Text</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        ✅ Data saved successfully!
    </div>

    <script>
        // ========================================
        // REFIT MAINTENANCE SERVICES - AI ENHANCED QUOTE BUILDER
        // Registration No: 201803348973 (002894203-V)
        // Complete AI Assistant Integration
        // ========================================
        
        // App State Variables
        var currentView = 'dashboard';
        var categories = [];
        var savedQuotes = [];
        var selectedItems = [];
        var editingCategory = null;
        var editingItem = null;
        var currentTheme = 'light';
        
        // AI Assistant State
        var aiAssistants = {
            ela: {
                name: 'Ela',
                avatar: '💎',
                age: 24,
                personality: 'Sweet & Professional',
                traits: ['Intelligent', 'Caring', 'Helpful'],
                greeting: 'Hi! I\'m Ela, your sweet and professional maintenance assistant. I love helping with quotes and making your work easier! 💎',
                voice: 'female'
            },
            isla: {
                name: 'Isla',
                avatar: '🌺',
                age: 23,
                personality: 'Soft & Lovely',
                traits: ['Creative', 'Thoughtful', 'Gentle'],
                greeting: 'Hello there! I\'m Isla, and I\'m here to support your business with creativity and care. Let\'s build something beautiful together! 🌺',
                voice: 'female'
            },
            maiya: {
                name: 'Maiya',
                avatar: '🌸',
                age: 25,
                personality: 'Clever & Pretty',
                traits: ['Analytical', 'Supportive', 'Smart'],
                greeting: 'Welcome! I\'m Maiya, your clever assistant ready to analyze data and provide smart insights for your maintenance business! 🌸',
                voice: 'female'
            },
            violet: {
                name: 'Violet',
                avatar: '💜',
                age: 26,
                personality: 'Concerned & Wise',
                traits: ['Strategic', 'Empathetic', 'Experienced'],
                greeting: 'Greetings! I\'m Violet, here to provide wise guidance and strategic support for your business growth. 💜',
                voice: 'female'
            },
            luna: {
                name: 'Luna',
                avatar: '🌙',
                age: 22,
                personality: 'Gentle & Intuitive',
                traits: ['Understanding', 'Calm', 'Peaceful'],
                greeting: 'Hello! I\'m Luna, your gentle guide through the world of maintenance services. I\'m here to bring calm to your busy day! 🌙',
                voice: 'female'
            },
            aria: {
                name: 'Aria',
                avatar: '✨',
                age: 21,
                personality: 'Bright & Cheerful',
                traits: ['Energetic', 'Helpful', 'Optimistic'],
                greeting: 'Hey! I\'m Aria, your bright and cheerful assistant! Ready to make your maintenance work sparkle with efficiency! ✨',
                voice: 'female'
            }
        };
        
        var currentAI = 'ela';
        var voiceEnabled = false;
        var smartSuggestions = true;
        var aiPanelOpen = false;
        var speechSynthesis = window.speechSynthesis;

        // Default Categories with Enhanced Structure
        var defaultCategories = [
            {
                id: 'preliminary',
                name: 'Preliminary Work',
                description: 'Site preparation and preliminary construction work',
                icon: '🏗️',
                color: '#FF7F50',
                items: [
                    { id: 'p1', name: 'Site Survey & Assessment', description: 'Initial site evaluation and condition assessment', price: 250.00, unit: 'service' },
                    { id: 'p2', name: 'Protective Covering', description: 'Floor and furniture protection during work', price: 120.00, unit: 'service' },
                    { id: 'p3', name: 'Selective Demolition', description: 'Careful removal of existing structures', price: 85.00, unit: 'sqm' },
                    { id: 'p4', name: 'Site Cleanup', description: 'Construction debris removal and cleaning', price: 45.00, unit: 'hours' }
                ]
            },
            {
                id: 'wall',
                name: 'Wall Work',
                description: 'Wall construction, renovation and finishing',
                icon: '🧱',
                color: '#FFB366',
                items: [
                    { id: 'w1', name: 'Drywall Installation', description: 'Standard drywall installation with finishing', price: 35.00, unit: 'sqm' },
                    { id: 'w2', name: 'Partition Wall Construction', description: 'Metal stud partition wall with drywall', price: 65.00, unit: 'sqm' },
                    { id: 'w3', name: 'Wall Patching & Repair', description: 'Minor wall damage repair and patching', price: 25.00, unit: 'sqm' },
                    { id: 'w4', name: 'Wall Texture Finishing', description: 'Decorative wall texture application', price: 18.00, unit: 'sqm' }
                ]
            },
            {
                id: 'electrical',
                name: 'Electrical Work',
                description: 'Electrical systems and installations',
                icon: '⚡',
                color: '#FFB07A',
                items: [
                    { id: 'e1', name: 'Power Outlet Installation', description: 'Standard 13A power outlet', price: 45.00, unit: 'pcs' },
                    { id: 'e2', name: 'Light Switch Installation', description: 'Standard wall light switch', price: 35.00, unit: 'pcs' },
                    { id: 'e3', name: 'LED Panel Light', description: '40W LED panel light with driver', price: 85.00, unit: 'pcs' },
                    { id: 'e4', name: 'Electrical Safety Inspection', description: 'Complete electrical system safety check', price: 150.00, unit: 'service' }
                ]
            },
            {
                id: 'plumbing',
                name: 'Plumbing Work',
                description: 'Water systems and pipe installations',
                icon: '🔧',
                color: '#FFA366',
                items: [
                    { id: 'pl1', name: 'Pipe Repair Service', description: 'Water pipe leak repair', price: 65.00, unit: 'service' },
                    { id: 'pl2', name: 'Faucet Installation', description: 'Kitchen or bathroom faucet installation', price: 85.00, unit: 'pcs' },
                    { id: 'pl3', name: 'Toilet Installation', description: 'Complete toilet installation', price: 150.00, unit: 'pcs' },
                    { id: 'pl4', name: 'Water Heater Installation', description: 'Electric water heater installation', price: 280.00, unit: 'pcs' }
                ]
            }
        ];

        // Storage Keys
        var STORAGE_KEYS = {
            CATEGORIES: 'refit_enhanced_categories',
            SAVED_QUOTES: 'refit_enhanced_saved_quotes',
            SELECTED_ITEMS: 'refit_enhanced_selected_items',
            THEME_PREFERENCE: 'refit_theme_preference',
            AI_SETTINGS: 'refit_ai_settings'
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadThemePreference();
            loadDataFromStorage();
            loadAISettings();
            setupEventListeners();
            setupMobileOptimizations();
            updateStatusBar();
            updateCurrentDate();
            updateStats();
            renderViews();
            updateCartBadge();
            updateAIDisplay();
            generateAIInsights();
            
            showSuccessMessage('💎 REFIT AI Enhanced Quote Builder Ready!');
            console.log('🏗️ REFIT MAINTENANCE SERVICES - AI Enhanced Quote Builder');
            console.log('💎 Professional AI Assistant Integration');
            console.log('🍑 Beautiful Pastel Orange Theme');
            console.log('📋 Complete Category & Item Management');
            console.log('🛒 Advanced Quote Cart System');
            console.log('📄 PDF Generation & Sharing');
        }

        // AI Assistant Functions
        function toggleAIAssistant() {
            aiPanelOpen = !aiPanelOpen;
            var panel = document.getElementById('ai-panel');
            var floatBtn = document.getElementById('ai-float');
            
            if (aiPanelOpen) {
                panel.classList.add('show');
                floatBtn.style.display = 'none';
                addAIMessage(aiAssistants[currentAI].greeting);
                if (voiceEnabled) {
                    speakText(aiAssistants[currentAI].greeting);
                }
            } else {
                panel.classList.remove('show');
                floatBtn.style.display = 'flex';
            }
        }

        function selectAI(aiKey) {
            currentAI = aiKey;
            updateAIDisplay();
            saveAISettings();
            
            // Update all AI options
            var options = document.querySelectorAll('.ai-option div');
            options.forEach(option => {
                option.style.borderColor = 'var(--border-color)';
            });
            
            // Highlight selected option
            var selectedOption = document.querySelector(`.ai-option[data-ai="${aiKey}"] div`);
            if (selectedOption) {
                selectedOption.style.borderColor = 'var(--ai-primary)';
            }
            
            // Clear chat and show new greeting
            clearAIChat();
            addAIMessage(aiAssistants[currentAI].greeting);
            
            if (voiceEnabled) {
                speakText(`Hi! I'm ${aiAssistants[currentAI].name}, your new assistant!`);
            }
            
            showSuccessMessage(`💎 ${aiAssistants[currentAI].name} is now your assistant!`);
        }

        function updateAIDisplay() {
            var ai = aiAssistants[currentAI];
            document.getElementById('ai-name').textContent = ai.name;
            document.getElementById('ai-avatar').textContent = ai.avatar;
            document.getElementById('ai-status').textContent = `${ai.personality} • Age ${ai.age} • Ready to help`;
            document.getElementById('ai-float').textContent = ai.avatar;
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            updateVoiceButton();
            saveAISettings();
            
            var message = voiceEnabled ? 'Voice assistant enabled! I can now speak to you!' : 'Voice assistant disabled.';
            addAIMessage(message);
            
            if (voiceEnabled) {
                speakText(message);
            }
            
            showSuccessMessage(voiceEnabled ? '🔊 Voice enabled' : '🔇 Voice disabled');
        }

        function updateVoiceButton() {
            var btn = document.getElementById('voice-btn');
            var toggleBtn = document.getElementById('voice-toggle-btn');
            
            if (btn) {
                btn.innerHTML = voiceEnabled ? '🔊' : '🔇';
                btn.classList.toggle('active', voiceEnabled);
            }
            
            if (toggleBtn) {
                toggleBtn.innerHTML = voiceEnabled ? '🔇 Disable Voice' : '🔊 Enable Voice';
            }
        }

        function toggleSmartSuggestions() {
            smartSuggestions = !smartSuggestions;
            updateSuggestionsButton();
            saveAISettings();
            
            var message = smartSuggestions ? 'Smart suggestions enabled! I\'ll provide helpful tips.' : 'Smart suggestions disabled.';
            addAIMessage(message);
            
            showSuccessMessage(smartSuggestions ? '💡 Smart suggestions enabled' : '💡 Smart suggestions disabled');
        }

        function updateSuggestionsButton() {
            var btn = document.getElementById('suggestions-toggle-btn');
            if (btn) {
                btn.innerHTML = smartSuggestions ? '💡 Disable' : '💡 Enable';
            }
        }

        function speakText(text) {
            if (!voiceEnabled || !speechSynthesis) return;
            
            speechSynthesis.cancel(); // Stop any current speech
            
            var utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1.1;
            utterance.volume = 0.8;
            
            // Try to use a female voice
            var voices = speechSynthesis.getVoices();
            var femaleVoice = voices.find(voice => 
                voice.name.toLowerCase().includes('female') ||
                voice.name.toLowerCase().includes('woman') ||
                voice.name.toLowerCase().includes('zira') ||
                voice.name.toLowerCase().includes('susan') ||
                voice.name.toLowerCase().includes('samantha')
            );
            
            if (femaleVoice) {
                utterance.voice = femaleVoice;
            }
            
            // Add visual feedback
            var floatBtn = document.getElementById('ai-float');
            floatBtn.classList.add('speaking');
            
            utterance.onend = function() {
                floatBtn.classList.remove('speaking');
            };
            
            speechSynthesis.speak(utterance);
        }

        function addAIMessage(message) {
            var chat = document.getElementById('ai-chat');
            var messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message';
            messageDiv.textContent = message;
            chat.appendChild(messageDiv);
            chat.scrollTop = chat.scrollHeight;
        }

        function clearAIChat() {
            var chat = document.getElementById('ai-chat');
            chat.innerHTML = '';
        }

        function aiSuggestion(type) {
            var ai = aiAssistants[currentAI];
            var response = '';
            
            switch(type) {
                case 'help':
                    response = `Welcome to REFIT! 🏗️ I'm ${ai.name}, and I'm excited to show you around! 

You can:
• Build quotes in the "Builder" tab by selecting categories and items
• View your saved quotes in the "Quotes" tab  
• Use the cart (🛒) to manage selected items
• Generate professional PDFs and share quotes

I'm here whenever you need assistance! Just tap my button anytime! 💎`;
                    break;
                    
                case 'quote':
                    response = `Let me help you create a professional quote! 💰

Here's the smart way to do it:
1. Go to "Builder" tab
2. Browse categories like Electrical ⚡, Plumbing 🔧, etc.
3. Select items by tapping the checkboxes ✓
4. Review in your cart 🛒
5. Add project details and generate PDF 📄

Pro tip: Select multiple categories for comprehensive quotes! I'll guide you through each step! 🌟`;
                    break;
                    
                case 'tips':
                    response = `Here are some business tips from my experience! 💡

💰 Pricing Strategy:
• Bundle related services for better margins
• Offer package deals for repeat customers
• Review prices quarterly based on costs

📊 Efficiency Tips:
• Use templates for common jobs
• Keep detailed records for future quotes
• Follow up on quotes within 48 hours

🤝 Customer Relations:
• Always provide detailed breakdowns
• Be transparent about timelines
• Maintain professional communication

Want specific advice for your situation? Just ask! 😊`;
                    break;
                    
                case 'analysis':
                    var totalQuotes = savedQuotes.length;
                    var totalRevenue = savedQuotes.reduce((sum, quote) => sum + quote.total, 0);
                    var avgQuote = totalQuotes > 0 ? totalRevenue / totalQuotes : 0;
                    
                    response = `📊 Here's your business analysis:

📈 Performance Metrics:
• Total Quotes: ${totalQuotes}
• Total Revenue: RM ${totalRevenue.toFixed(2)}
• Average Quote: RM ${avgQuote.toFixed(2)}
• Categories Used: ${categories.length}

💡 Smart Insights:
${totalQuotes < 5 ? '• Focus on creating more quotes to build momentum' : '• Great quote activity! Keep it up!'}
${avgQuote < 500 ? '• Consider bundling services to increase quote values' : '• Excellent average quote value!'}
${selectedItems.length > 0 ? '• You have items in cart - don\'t forget to complete that quote!' : '• Ready to build your next quote!'}

Want deeper insights? I can analyze specific trends! 📊`;
                    break;
            }
            
            addAIMessage(response);
            
            if (voiceEnabled) {
                // Speak a shorter version for voice
                var shortResponse = response.split('\n')[0] + ' Check the chat for full details!';
                speakText(shortResponse);
            }
        }

        function generateAIInsights() {
            var insights = document.getElementById('ai-insights');
            if (!insights) return;
            
            var ai = aiAssistants[currentAI];
            var totalQuotes = savedQuotes.length;
            var totalRevenue = savedQuotes.reduce((sum, quote) => sum + quote.total, 0);
            
            var insightHTML = '';
            
            if (totalQuotes === 0) {
                insightHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="font-size: 24px;">${ai.avatar}</div>
                        <div>
                            <div style="font-weight: 700; color: var(--ai-primary);">Getting Started</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">Create your first quote to unlock AI insights!</div>
                        </div>
                    </div>
                    <div style="background: var(--ai-secondary); color: white; padding: 12px; border-radius: 12px; font-size: 14px;">
                        💡 <strong>Pro Tip:</strong> Start with the Category Builder to create professional quotes quickly!
                    </div>
                `;
            } else {
                var avgQuote = totalRevenue / totalQuotes;
                var insights = [];
                
                if (totalQuotes >= 5) {
                    insights.push('🎯 You\'re building great momentum with your quotes!');
                }
                
                if (avgQuote > 500) {
                    insights.push('💰 Excellent average quote value!');
                } else {
                    insights.push('📈 Consider bundling services to increase quote values');
                }
                
                if (selectedItems.length > 0) {
                    insights.push('🛒 Don\'t forget to complete your current cart!');
                }
                
                insightHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="font-size: 24px;">${ai.avatar}</div>
                        <div>
                            <div style="font-weight: 700; color: var(--ai-primary);">${ai.name}'s Analysis</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">Based on your ${totalQuotes} quotes</div>
                        </div>
                    </div>
                    <div style="background: var(--ai-secondary); color: white; padding: 12px; border-radius: 12px; font-size: 14px;">
                        ${insights.join('<br>')}
                    </div>
                `;
            }
            
            insights.innerHTML = insightHTML;
        }

        function openAISettings() {
            // Update current selections
            var currentOption = document.querySelector(`.ai-option[data-ai="${currentAI}"] div`);
            if (currentOption) {
                // Reset all
                var options = document.querySelectorAll('.ai-option div');
                options.forEach(option => {
                    option.style.borderColor = 'var(--border-color)';
                });
                
                // Highlight current
                currentOption.style.borderColor = 'var(--ai-primary)';
            }
            
            updateVoiceButton();
            updateSuggestionsButton();
            document.getElementById('ai-settings-modal').classList.add('show');
        }

        function closeAISettings() {
            document.getElementById('ai-settings-modal').classList.remove('show');
        }

        function resetAISettings() {
            if (confirm('Reset AI settings to default?\nThis will change back to Ela with voice disabled.')) {
                currentAI = 'ela';
                voiceEnabled = false;
                smartSuggestions = true;
                
                updateAIDisplay();
                updateVoiceButton();
                updateSuggestionsButton();
                saveAISettings();
                
                clearAIChat();
                addAIMessage(aiAssistants[currentAI].greeting);
                
                showSuccessMessage('🔄 AI settings reset to default');
            }
        }

        function saveAISettings() {
            var settings = {
                currentAI: currentAI,
                voiceEnabled: voiceEnabled,
                smartSuggestions: smartSuggestions
            };
            
            localStorage.setItem(STORAGE_KEYS.AI_SETTINGS, JSON.stringify(settings));
        }

        function loadAISettings() {
            try {
                var saved = localStorage.getItem(STORAGE_KEYS.AI_SETTINGS);
                if (saved) {
                    var settings = JSON.parse(saved);
                    currentAI = settings.currentAI || 'ela';
                    voiceEnabled = settings.voiceEnabled || false;
                    smartSuggestions = settings.smartSuggestions !== false; // Default to true
                }
            } catch (e) {
                console.warn('AI settings load error:', e);
            }
        }

        // Theme Management
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#FFB07A' : '#1a1411';
            }
            
            saveDataToStorage();
            
            // AI feedback for theme change
            if (aiPanelOpen) {
                var ai = aiAssistants[currentAI];
                var message = currentTheme === 'light' ? 
                    `☀️ Light mode looks fresh and bright! Perfect for daytime work!` :
                    `🌙 Dark mode is easier on the eyes! Great for evening work sessions!`;
                addAIMessage(message);
            }
            
            showSuccessMessage(currentTheme === 'light' ? '☀️ Light mode activated' : '🌙 Dark mode activated');
        }

        function loadThemePreference() {
            var savedTheme = localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE) || 'light';
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#FFB07A' : '#1a1411';
            }
        }

        // Data Management
        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(categories));
                localStorage.setItem(STORAGE_KEYS.SAVED_QUOTES, JSON.stringify(savedQuotes));
                localStorage.setItem(STORAGE_KEYS.SELECTED_ITEMS, JSON.stringify(selectedItems));
                localStorage.setItem(STORAGE_KEYS.THEME_PREFERENCE, currentTheme);
                saveAISettings();
            } catch (e) {
                console.warn('Storage error:', e);
                showSuccessMessage('⚠️ Storage full! Please export data.');
            }
        }

        function loadDataFromStorage() {
            try {
                var savedCategories = localStorage.getItem(STORAGE_KEYS.CATEGORIES);
                if (savedCategories) {
                    categories = JSON.parse(savedCategories);
                } else {
                    categories = [...defaultCategories];
                    saveDataToStorage();
                }

                var savedQuotesData = localStorage.getItem(STORAGE_KEYS.SAVED_QUOTES);
                if (savedQuotesData) {
                    savedQuotes = JSON.parse(savedQuotesData);
                }

                var savedSelectedItems = localStorage.getItem(STORAGE_KEYS.SELECTED_ITEMS);
                if (savedSelectedItems) {
                    selectedItems = JSON.parse(savedSelectedItems);
                }
            } catch (e) {
                console.warn('Load error:', e);
                categories = [...defaultCategories];
                saveDataToStorage();
            }
        }

        // Category Management
        function openCategoryForm(categoryId = null) {
            editingCategory = categoryId;
            
            if (categoryId) {
                var category = categories.find(c => c.id === categoryId);
                if (category) {
                    document.getElementById('category-modal-title').textContent = '✏️ Edit Category';
                    document.getElementById('category-name').value = category.name;
                    document.getElementById('category-description').value = category.description || '';
                    document.getElementById('category-icon').value = category.icon;
                    document.getElementById('category-color').value = category.color;
                }
            } else {
                document.getElementById('category-modal-title').textContent = '➕ Add Category';
                document.getElementById('category-form').reset();
                document.getElementById('category-color').value = '#FFB07A';
                document.getElementById('category-icon').value = '🏷️';
            }
            
            document.getElementById('category-modal').classList.add('show');
            
            // AI suggestion
            if (smartSuggestions && aiPanelOpen) {
                var ai = aiAssistants[currentAI];
                var message = categoryId ? 
                    'Great! Editing categories helps keep your quotes organized! 📝' :
                    'Excellent! Adding new categories will expand your service offerings! 🚀';
                addAIMessage(message);
            }
        }

        function closeCategoryForm() {
            document.getElementById('category-modal').classList.remove('show');
            editingCategory = null;
        }

        function handleCategorySubmit(e) {
            e.preventDefault();
            
            var name = document.getElementById('category-name').value.trim();
            var description = document.getElementById('category-description').value.trim();
            var icon = document.getElementById('category-icon').value.trim();
            var color = document.getElementById('category-color').value;
            
            if (!name) {
                showSuccessMessage('⚠️ Please enter a category name!');
                return;
            }
            
            var categoryData = {
                id: editingCategory || generateId(),
                name: name,
                description: description,
                icon: icon || '🏷️',
                color: color,
                items: editingCategory ? categories.find(c => c.id === editingCategory).items : []
            };
            
            if (editingCategory) {
                var index = categories.findIndex(c => c.id === editingCategory);
                if (index !== -1) {
                    categories[index] = categoryData;
                }
                showSuccessMessage('🍑 Category updated successfully!');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage(`Perfect! ${name} category has been updated! Your quotes will look even more professional! ✨`);
                }
            } else {
                categories.push(categoryData);
                showSuccessMessage('🍑 Category added successfully!');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage(`Wonderful! ${name} category added! Don't forget to add some items to it for complete quotes! 🎯`);
                }
            }
            
            closeCategoryForm();
            saveDataToStorage();
            renderViews();
            generateAIInsights();
        }

        function deleteCategory(categoryId) {
            var category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            if (confirm('Delete category "' + category.name + '" and all its items?\nThis action cannot be undone.')) {
                // Remove selected items from this category
                selectedItems = selectedItems.filter(item => item.categoryId !== categoryId);
                
                // Remove category
                categories = categories.filter(c => c.id !== categoryId);
                
                saveDataToStorage();
                renderViews();
                updateCartBadge();
                generateAIInsights();
                
                showSuccessMessage('🗑️ Category deleted successfully');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage(`Category removed! Don't worry, you can always create new categories as your business grows! 🌱`);
                }
            }
        }

        // Item Management
        function openItemForm(categoryId, itemId = null) {
            editingItem = itemId;
            document.getElementById('item-category-id').value = categoryId;
            
            if (itemId) {
                var category = categories.find(c => c.id === categoryId);
                var item = category ? category.items.find(i => i.id === itemId) : null;
                
                if (item) {
                    document.getElementById('item-modal-title').textContent = '✏️ Edit Item';
                    document.getElementById('item-name').value = item.name;
                    document.getElementById('item-description').value = item.description || '';
                    document.getElementById('item-price').value = item.price;
                    document.getElementById('item-unit').value = item.unit;
                }
            } else {
                document.getElementById('item-modal-title').textContent = '➕ Add Item';
                document.getElementById('item-form').reset();
                document.getElementById('item-category-id').value = categoryId;
            }
            
            document.getElementById('item-modal').classList.add('show');
            
            // AI suggestion
            if (smartSuggestions && aiPanelOpen) {
                var categoryName = categories.find(c => c.id === categoryId)?.name || 'this category';
                var message = itemId ? 
                    'Smart move! Keeping item details accurate ensures professional quotes! 💼' :
                    `Great choice! Adding items to ${categoryName} will give you more quoting options! 🛠️`;
                addAIMessage(message);
            }
        }

        function closeItemForm() {
            document.getElementById('item-modal').classList.remove('show');
            editingItem = null;
        }

        function handleItemSubmit(e) {
            e.preventDefault();
            
            var categoryId = document.getElementById('item-category-id').value;
            var name = document.getElementById('item-name').value.trim();
            var description = document.getElementById('item-description').value.trim();
            var price = parseFloat(document.getElementById('item-price').value);
            var unit = document.getElementById('item-unit').value;
            
            if (!name || !price) {
                showSuccessMessage('⚠️ Please fill in all required fields!');
                return;
            }
            
            var category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            var itemData = {
                id: editingItem || generateId(),
                name: name,
                description: description,
                price: price,
                unit: unit
            };
            
            if (editingItem) {
                var index = category.items.findIndex(i => i.id === editingItem);
                if (index !== -1) {
                    category.items[index] = itemData;
                }
                showSuccessMessage('🍑 Item updated successfully!');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage(`Excellent! ${name} has been updated in ${category.name}! Your pricing is always up-to-date! 💯`);
                }
            } else {
                category.items.push(itemData);
                showSuccessMessage('🍑 Item added successfully!');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage(`Perfect! ${name} added to ${category.name}! RM ${price.toFixed(2)} per ${unit} looks competitive! 💰`);
                }
            }
            
            closeItemForm();
            saveDataToStorage();
            renderViews();
            generateAIInsights();
        }

        function deleteItem(categoryId, itemId) {
            var category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            var item = category.items.find(i => i.id === itemId);
            if (!item) return;
            
            if (confirm('Delete item "' + item.name + '"?\nThis action cannot be undone.')) {
                // Remove from selected items
                selectedItems = selectedItems.filter(si => !(si.categoryId === categoryId && si.itemId === itemId));
                
                // Remove from category
                category.items = category.items.filter(i => i.id !== itemId);
                
                saveDataToStorage();
                renderViews();
                updateCartBadge();
                generateAIInsights();
                
                showSuccessMessage('🗑️ Item deleted successfully');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage(`Item removed! Keep your catalog fresh by removing outdated services! 🔄`);
                }
            }
        }

        // Selection Management
        function toggleItemSelection(categoryId, itemId) {
            var existingIndex = selectedItems.findIndex(si => si.categoryId === categoryId && si.itemId === itemId);
            
            if (existingIndex !== -1) {
                selectedItems.splice(existingIndex, 1);
                showSuccessMessage('🍑 Item removed from cart');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage('Item removed from cart! Take your time to build the perfect quote! 🎯');
                }
            } else {
                var category = categories.find(c => c.id === categoryId);
                var item = category ? category.items.find(i => i.id === itemId) : null;
                
                if (item) {
                    selectedItems.push({
                        categoryId: categoryId,
                        itemId: itemId,
                        quantity: 1,
                        categoryName: category.name,
                        categoryIcon: category.icon,
                        itemName: item.name,
                        itemDescription: item.description,
                        itemPrice: item.price,
                        itemUnit: item.unit
                    });
                    showSuccessMessage('🍑 Item added to cart');
                    
                    // AI feedback
                    if (aiPanelOpen && smartSuggestions) {
                        var ai = aiAssistants[currentAI];
                        addAIMessage(`Great choice! ${item.name} added to your cart! Building a comprehensive quote! 🌟`);
                    }
                }
            }
            
            saveDataToStorage();
            renderViews();
            updateCartBadge();
            generateAIInsights();
        }

        function selectAllCategories() {
            for (var category of categories) {
                for (var item of category.items) {
                    var existingIndex = selectedItems.findIndex(si => si.categoryId === category.id && si.itemId === item.id);
                    if (existingIndex === -1) {
                        selectedItems.push({
                            categoryId: category.id,
                            itemId: item.id,
                            quantity: 1,
                            categoryName: category.name,
                            categoryIcon: category.icon,
                            itemName: item.name,
                            itemDescription: item.description,
                            itemPrice: item.price,
                            itemUnit: item.unit
                        });
                    }
                }
            }
            
            saveDataToStorage();
            renderViews();
            updateCartBadge();
            generateAIInsights();
            
            showSuccessMessage('🍑 All items selected!');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                addAIMessage('Wow! All items selected! This will be a comprehensive quote covering all your services! 🚀');
            }
        }

        function clearAllSelections() {
            selectedItems = [];
            saveDataToStorage();
            renderViews();
            updateCartBadge();
            generateAIInsights();
            
            showSuccessMessage('🗑️ All selections cleared');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                addAIMessage('Cart cleared! Ready to start fresh with your next quote! 🌟');
            }
        }

        // Quote Cart Management
        function openQuoteCart() {
            renderCartItems();
            document.getElementById('cart-modal').classList.add('show');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions && selectedItems.length > 0) {
                var total = selectedItems.reduce((sum, item) => sum + (item.quantity * item.itemPrice), 0);
                addAIMessage(`Your cart looks great! RM ${total.toFixed(2)} total. Ready to create a professional quote? 💼`);
            }
        }

        function closeQuoteCart() {
            document.getElementById('cart-modal').classList.remove('show');
        }

        function renderCartItems() {
            var container = document.getElementById('cart-items');
            var totalElement = document.getElementById('cart-total');
            
            if (selectedItems.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">🛒</div>' +
                    '<p style="font-weight: 600;">Cart is empty</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Select items from categories to build your quote</p>' +
                    '</div>';
                totalElement.textContent = 'RM 0.00';
                return;
            }
            
            var total = 0;
            var html = '';
            
            for (var i = 0; i < selectedItems.length; i++) {
                var item = selectedItems[i];
                var itemTotal = item.quantity * item.itemPrice;
                total += itemTotal;
                
                html += '<div class="item-row">' +
                    '<div class="item-info">' +
                    '<div class="item-name">' + item.categoryIcon + ' ' + item.itemName + '</div>' +
                    '<div class="item-details">' + item.categoryName + ' • ' + item.itemDescription + '</div>' +
                    '</div>' +
                    '<div style="display: flex; align-items: center; gap: 12px;">' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<button class="mini-btn" onclick="updateItemQuantity(' + i + ', -1)">-</button>' +
                    '<span style="font-weight: 700; min-width: 30px; text-align: center;">' + item.quantity + '</span>' +
                    '<button class="mini-btn" onclick="updateItemQuantity(' + i + ', 1)">+</button>' +
                    '</div>' +
                    '<div class="item-price">RM ' + itemTotal.toFixed(2) + '</div>' +
                    '<button class="mini-btn" style="background: var(--accent-warm);" onclick="removeFromCart(' + i + ')">🗑️</button>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
            totalElement.textContent = 'RM ' + total.toFixed(2);
        }

        function updateItemQuantity(index, change) {
            if (index >= 0 && index < selectedItems.length) {
                selectedItems[index].quantity = Math.max(1, selectedItems[index].quantity + change);
                saveDataToStorage();
                renderCartItems();
                updateCartBadge();
                generateAIInsights();
            }
        }

        function removeFromCart(index) {
            if (index >= 0 && index < selectedItems.length) {
                selectedItems.splice(index, 1);
                saveDataToStorage();
                renderCartItems();
                renderViews();
                updateCartBadge();
                generateAIInsights();
                
                showSuccessMessage('🗑️ Item removed from cart');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage('Item removed! Keep refining your quote until it\'s perfect! 🎯');
                }
            }
        }

        function clearCart() {
            if (selectedItems.length === 0) return;
            
            if (confirm('Clear all items from cart?')) {
                selectedItems = [];
                saveDataToStorage();
                renderCartItems();
                renderViews();
                updateCartBadge();
                generateAIInsights();
                
                showSuccessMessage('🗑️ Cart cleared');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage('Cart cleared! Ready for a fresh start on your next quote! 🌟');
                }
            }
        }

        function updateCartBadge() {
            var badge = document.getElementById('cart-badge');
            var cartBtn = document.getElementById('quote-cart-btn');
            
            if (badge) {
                badge.textContent = selectedItems.length;
                badge.style.display = selectedItems.length > 0 ? 'flex' : 'none';
            }
            
            if (cartBtn) {
                cartBtn.classList.toggle('hidden', selectedItems.length === 0);
            }
        }

        // Quote Review and Generation
        function reviewQuote() {
            if (selectedItems.length === 0) {
                showSuccessMessage('⚠️ Please add items to cart first!');
                
                // AI feedback
                if (aiPanelOpen && smartSuggestions) {
                    addAIMessage('Your cart is empty! Head to the Builder tab to select items for your quote! 🏗️');
                }
                return;
            }
            
            closeQuoteCart();
            renderQuoteReview();
            document.getElementById('review-modal').classList.add('show');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                var total = selectedItems.reduce((sum, item) => sum + (item.quantity * item.itemPrice), 0);
                addAIMessage(`Excellent! Your quote review shows RM ${total.toFixed(2)} total. Everything looks professional! 📋✨`);
            }
        }

        function closeQuoteReview() {
            document.getElementById('review-modal').classList.remove('show');
        }

        function renderQuoteReview() {
            var container = document.getElementById('quote-review-content');
            var total = 0;
            
            // Group items by category
            var groupedItems = {};
            for (var item of selectedItems) {
                if (!groupedItems[item.categoryId]) {
                    groupedItems[item.categoryId] = {
                        name: item.categoryName,
                        icon: item.categoryIcon,
                        items: []
                    };
                }
                groupedItems[item.categoryId].items.push(item);
                total += item.quantity * item.itemPrice;
            }
            
            var html = '<div style="background: var(--bg-secondary); border-radius: 16px; padding: 20px; margin-bottom: 20px;">' +
                '<h3 style="color: var(--text-primary); margin-bottom: 16px;">📋 Quote Summary</h3>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;">' +
                '<div><strong>Total Items:</strong> ' + selectedItems.length + '</div>' +
                '<div><strong>Categories:</strong> ' + Object.keys(groupedItems).length + '</div>' +
                '<div><strong>Quote Date:</strong> ' + new Date().toLocaleDateString() + '</div>' +
                '<div><strong>Total Amount:</strong> <span style="color: var(--accent-primary); font-weight: 700;">RM ' + total.toFixed(2) + '</span></div>' +
                '</div>' +
                '</div>';
            
            // Render items by category
            for (var categoryId in groupedItems) {
                var categoryGroup = groupedItems[categoryId];
                var categoryTotal = 0;
                
                for (var item of categoryGroup.items) {
                    categoryTotal += item.quantity * item.itemPrice;
                }
                
                html += '<div style="margin-bottom: 20px; border-radius: 12px; border: 2px solid var(--accent-primary); overflow: hidden;">' +
                    '<div style="background: var(--accent-primary); color: white; padding: 16px; display: flex; justify-content: space-between; align-items: center;">' +
                    '<div style="display: flex; align-items: center; gap: 12px; font-weight: 700;">' +
                    '<span style="font-size: 20px;">' + categoryGroup.icon + '</span>' +
                    '<span>' + categoryGroup.name + '</span>' +
                    '</div>' +
                    '<span style="font-weight: 700;">RM ' + categoryTotal.toFixed(2) + '</span>' +
                    '</div>' +
                    '<div style="background: var(--bg-card); padding: 16px;">';
                
                for (var item of categoryGroup.items) {
                    var itemTotal = item.quantity * item.itemPrice;
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color);">' +
                        '<div>' +
                        '<div style="font-weight: 700; color: var(--text-primary);">' + item.itemName + '</div>' +
                        '<div style="font-size: 12px; color: var(--text-muted);">' + item.itemDescription + '</div>' +
                        '</div>' +
                        '<div style="text-align: right;">' +
                        '<div style="font-size: 12px; color: var(--text-muted);">' + item.quantity + ' ' + item.itemUnit + ' × RM ' + item.itemPrice.toFixed(2) + '</div>' +
                        '<div style="font-weight: 700; color: var(--accent-primary);">RM ' + itemTotal.toFixed(2) + '</div>' +
                        '</div>' +
                        '</div>';
                }
                
                html += '</div></div>';
            }
            
            container.innerHTML = html;
        }

        function generatePDF() {
            showSuccessMessage('🍑 Generating professional PDF quote...');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                addAIMessage('Creating your professional PDF! This will look amazing for your clients! 📄✨');
            }
            
            // Create PDF content
            var { jsPDF } = window.jspdf;
            var doc = new jsPDF();
            
            // Company Header
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text('REFIT MAINTENANCE SERVICES', 20, 25);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Registration No: 201803348973 (002894203-V)', 20, 35);
            doc.text('Professional Maintenance Solutions', 20, 42);
            doc.text('AI Enhanced Quote Builder', 20, 49);
            
            // Quote Details
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('QUOTATION', 20, 67);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Date: ' + new Date().toLocaleDateString(), 20, 77);
            doc.text('Quote #: QT-' + Date.now(), 20, 85);
            
            var title = document.getElementById('quote-title').value.trim();
            if (title) {
                doc.text('Project: ' + title, 20, 93);
            }
            
            // Items
            var yPos = 107;
            var total = 0;
            
            doc.setFont(undefined, 'bold');
            doc.text('No.', 20, yPos);
            doc.text('Description', 35, yPos);
            doc.text('Qty', 120, yPos);
            doc.text('Unit', 140, yPos);
            doc.text('Price (RM)', 160, yPos);
            doc.text('Total (RM)', 185, yPos);
            
            yPos += 8;
            doc.line(20, yPos, 200, yPos);
            yPos += 5;
            
            doc.setFont(undefined, 'normal');
            
            for (var i = 0; i < selectedItems.length; i++) {
                var item = selectedItems[i];
                var itemTotal = item.quantity * item.itemPrice;
                total += itemTotal;
                
                doc.text((i + 1).toString(), 20, yPos);
                doc.text(item.itemName, 35, yPos);
                doc.text(item.quantity.toString(), 120, yPos);
                doc.text(item.itemUnit, 140, yPos);
                doc.text(item.itemPrice.toFixed(2), 160, yPos);
                doc.text(itemTotal.toFixed(2), 185, yPos);
                
                yPos += 6;
                
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
            }
            
            // Total
            yPos += 5;
            doc.line(20, yPos, 200, yPos);
            yPos += 8;
            
            doc.setFont(undefined, 'bold');
            doc.text('TOTAL: RM ' + total.toFixed(2), 160, yPos);
            
            // Footer
            yPos += 20;
            doc.setFontSize(8);
            doc.setFont(undefined, 'normal');
            doc.text('Terms & Conditions:', 20, yPos);
            doc.text('1. Prices are valid for 30 days from quote date', 20, yPos + 6);
            doc.text('2. Payment terms: 50% deposit, balance upon completion', 20, yPos + 12);
            doc.text('3. All work comes with 12 months warranty', 20, yPos + 18);
            doc.text('Generated by AI Enhanced Quote Builder', 20, yPos + 24);
            
            // Save PDF
            var filename = 'REFIT_Quote_' + new Date().toISOString().split('T')[0] + '.pdf';
            doc.save(filename);
            
            showSuccessMessage('🍑 PDF generated successfully!');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                addAIMessage('PDF generated successfully! Your professional quote is ready to impress clients! 🎯💼');
            }
        }

        function saveQuote() {
            var title = document.getElementById('quote-title').value.trim() || 'Quote #' + Date.now();
            var notes = document.getElementById('quote-notes').value.trim();
            
            var total = 0;
            for (var item of selectedItems) {
                total += item.quantity * item.itemPrice;
            }
            
            var quote = {
                id: Date.now(),
                title: title,
                notes: notes,
                items: [...selectedItems],
                total: total,
                createdAt: new Date().toISOString()
            };
            
            savedQuotes.push(quote);
            saveDataToStorage();
            
            // Clear cart and close modals
            selectedItems = [];
            saveDataToStorage();
            updateCartBadge();
            
            closeQuoteReview();
            renderViews();
            generateAIInsights();
            
            showSuccessMessage('💾 Quote saved successfully!');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                var ai = aiAssistants[currentAI];
                addAIMessage(`Fantastic! "${title}" has been saved! You're building a great collection of professional quotes! 📚✨`);
            }
        }

        // Share Functions
        function shareWhatsApp() {
            var quoteText = generateQuoteText();
            var url = 'https://wa.me/?text=' + encodeURIComponent(quoteText);
            window.open(url, '_blank');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                addAIMessage('Great choice! WhatsApp sharing makes it easy for clients to receive and respond to quotes! 📱');
            }
        }

        function shareEmail() {
            var quoteText = generateQuoteText();
            var subject = 'Professional Quotation from REFIT MAINTENANCE SERVICES';
            var url = 'mailto:?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(quoteText);
            window.open(url);
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                addAIMessage('Perfect! Email sharing provides a professional touch for formal business communications! 📧');
            }
        }

        function shareTelegram() {
            var quoteText = generateQuoteText();
            var url = 'https://t.me/share/url?text=' + encodeURIComponent(quoteText);
            window.open(url, '_blank');
            
            // AI feedback
            if (aiPanelOpen && smartSuggestions) {
                addAIMessage('Smart! Telegram is great for quick business communications with international clients! ✈️');
            }
        }

        function copyQuote() {
            var quoteText = generateQuoteText();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(quoteText).then(function() {
                    showSuccessMessage('📋 Quote copied to clipboard!');
                    
                    // AI feedback
                    if (aiPanelOpen && smartSuggestions) {
                        addAIMessage('Quote copied! Now you can paste it anywhere you need - social media, documents, or any platform! 📋✨');
                    }
                });
            } else {
                // Fallback for older browsers
