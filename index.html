<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="REFIT BUSINESS SYSTEM">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2d1517">
    
    <title>REFIT - Complete Mobile Business System with Maiya AI</title>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Base Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* 8 Beautiful Pastel Themes */
        [data-theme="red"] {
            --bg-primary: #2d1517;
            --bg-secondary: #3d1f22;
            --bg-card: #4a262a;
            --bg-card-hover: #5a2f33;
            --text-primary: #fef7f7;
            --text-secondary: #fed7d7;
            --text-muted: #fca5a5;
            --accent-primary: #f87171;
            --accent-secondary: #fca5a5;
            --accent-warm: #fb923c;
            --border-color: #5a2f33;
            --shadow-light: rgba(248, 113, 113, 0.1);
            --shadow-medium: rgba(248, 113, 113, 0.2);
            --shadow-strong: rgba(248, 113, 113, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #dc2626;
            --info: #3b82f6;
            --theme-name: "Coral Sunset";
            --theme-icon: "üåÖ";
        }

        [data-theme="orange"] {
            --bg-primary: #2d1b0f;
            --bg-secondary: #3d261a;
            --bg-card: #4a3025;
            --bg-card-hover: #5a3a30;
            --text-primary: #fff7ed;
            --text-secondary: #fed7aa;
            --text-muted: #fdba74;
            --accent-primary: #fb923c;
            --accent-secondary: #fdba74;
            --accent-warm: #fbbf24;
            --border-color: #5a3a30;
            --shadow-light: rgba(251, 146, 60, 0.1);
            --shadow-medium: rgba(251, 146, 60, 0.2);
            --shadow-strong: rgba(251, 146, 60, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --theme-name: "Peach Glow";
            --theme-icon: "üçë";
        }

        [data-theme="pink"] {
            --bg-primary: #2d1524;
            --bg-secondary: #3d1f2e;
            --bg-card: #4a2638;
            --bg-card-hover: #5a2f42;
            --text-primary: #fdf2f8;
            --text-secondary: #fce7f3;
            --text-muted: #f9a8d4;
            --accent-primary: #f472b6;
            --accent-secondary: #f9a8d4;
            --accent-warm: #fbbf24;
            --border-color: #5a2f42;
            --shadow-light: rgba(244, 114, 182, 0.1);
            --shadow-medium: rgba(244, 114, 182, 0.2);
            --shadow-strong: rgba(244, 114, 182, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --theme-name: "Rose Blush";
            --theme-icon: "üå∏";
        }

        [data-theme="yellow"] {
            --bg-primary: #2d2510;
            --bg-secondary: #3d331a;
            --bg-card: #4a4025;
            --bg-card-hover: #5a4d30;
            --text-primary: #fefce8;
            --text-secondary: #fef3c7;
            --text-muted: #fcd34d;
            --accent-primary: #fbbf24;
            --accent-secondary: #fcd34d;
            --accent-warm: #f59e0b;
            --border-color: #5a4d30;
            --shadow-light: rgba(251, 191, 36, 0.1);
            --shadow-medium: rgba(251, 191, 36, 0.2);
            --shadow-strong: rgba(251, 191, 36, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --theme-name: "Butter Cream";
            --theme-icon: "üåª";
        }

        [data-theme="bluegreen"] {
            --bg-primary: #0f2925;
            --bg-secondary: #1a3530;
            --bg-card: #25423b;
            --bg-card-hover: #304f46;
            --text-primary: #f0fdfa;
            --text-secondary: #ccfbf1;
            --text-muted: #7dd3fc;
            --accent-primary: #2dd4bf;
            --accent-secondary: #7dd3fc;
            --accent-warm: #fbbf24;
            --border-color: #304f46;
            --shadow-light: rgba(45, 212, 191, 0.1);
            --shadow-medium: rgba(45, 212, 191, 0.2);
            --shadow-strong: rgba(45, 212, 191, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --theme-name: "Mint Breeze";
            --theme-icon: "üåä";
        }

        [data-theme="purplegrey"] {
            --bg-primary: #241838;
            --bg-secondary: #2e2042;
            --bg-card: #38284c;
            --bg-card-hover: #423056;
            --text-primary: #faf7ff;
            --text-secondary: #f3e8ff;
            --text-muted: #c4b5fd;
            --accent-primary: #a855f7;
            --accent-secondary: #c4b5fd;
            --accent-warm: #fbbf24;
            --border-color: #423056;
            --shadow-light: rgba(168, 85, 247, 0.1);
            --shadow-medium: rgba(168, 85, 247, 0.2);
            --shadow-strong: rgba(168, 85, 247, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --theme-name: "Lavender Mist";
            --theme-icon: "üíú";
        }

        [data-theme="browngrey"] {
            --bg-primary: #1c1917;
            --bg-secondary: #292524;
            --bg-card: #3f3f46;
            --bg-card-hover: #52525b;
            --text-primary: #fafaf9;
            --text-secondary: #e7e5e4;
            --text-muted: #d6d3d1;
            --accent-primary: #a3a3a3;
            --accent-secondary: #d6d3d1;
            --accent-warm: #f59e0b;
            --border-color: #52525b;
            --shadow-light: rgba(163, 163, 163, 0.1);
            --shadow-medium: rgba(163, 163, 163, 0.2);
            --shadow-strong: rgba(163, 163, 163, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --theme-name: "Warm Taupe";
            --theme-icon: "ü§é";
        }

        [data-theme="greenbrown"] {
            --bg-primary: #1a2e05;
            --bg-secondary: #253a0a;
            --bg-card: #30460f;
            --bg-card-hover: #3b5314;
            --text-primary: #f7f8f3;
            --text-secondary: #e8f5e8;
            --text-muted: #bef264;
            --accent-primary: #84cc16;
            --accent-secondary: #bef264;
            --accent-warm: #f59e0b;
            --border-color: #3b5314;
            --shadow-light: rgba(132, 204, 22, 0.1);
            --shadow-medium: rgba(132, 204, 22, 0.2);
            --shadow-strong: rgba(132, 204, 22, 0.3);
            --overlay: rgba(0, 0, 0, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --theme-name: "Sage Olive";
            --theme-icon: "üåø";
        }

        /* Base Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.5s ease;
        }
        
        /* Mobile Layout Container */
        .mobile-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
            transition: all 0.5s ease;
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 2px 10px var(--shadow-medium);
            border-bottom: 1px solid var(--border-color);
            transition: all 0.5s ease;
        }
        
        .theme-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .theme-toggle {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .theme-toggle:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
        }
        
        .theme-picker-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .theme-picker-btn:hover {
            transform: scale(1.05);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 4px 20px var(--shadow-medium);
            transition: all 0.5s ease;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .app-logo {
            width: 54px;
            height: 54px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 8px 25px var(--shadow-medium);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .app-logo:hover {
            transform: scale(1.05);
        }
        
        .app-title h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
            color: var(--text-primary);
            transition: all 0.5s ease;
        }
        
        .app-title p {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            transition: all 0.5s ease;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            box-shadow: 0 4px 15px var(--shadow-medium);
        }
        
        .header-btn:hover {
            transform: translateY(-2px);
        }

        /* Maiya AI Button - Special styling */
        .maiya-btn {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            position: relative;
            overflow: hidden;
        }

        .maiya-btn.listening {
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7);
        }

        .maiya-btn.processing {
            animation: processing 1s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }

        @keyframes processing {
            0% { background: linear-gradient(135deg, #8b5cf6, #a78bfa); }
            50% { background: linear-gradient(135deg, #a78bfa, #c4b5fd); }
            100% { background: linear-gradient(135deg, #8b5cf6, #a78bfa); }
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 130px 20px 140px;
            -webkit-overflow-scrolling: touch;
            position: relative;
            height: calc(100vh - 44px);
            scroll-behavior: smooth;
            transition: all 0.5s ease;
        }
        
        .main-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.5s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-medium);
            transform: translateY(-2px);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--shadow-light);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Validation Styles */
        .form-input.error, .form-textarea.error, .form-select.error {
            border-color: var(--error);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-input.success, .form-textarea.success, .form-select.success {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .error-message {
            color: var(--error);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
            padding: 20px;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 60px var(--shadow-strong);
            transition: all 0.5s ease;
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
            border-radius: 24px 24px 0 0;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: var(--bg-card);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .modal-close-btn:hover {
            background: var(--error);
            color: white;
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Voice Indicator */
        .voice-indicator {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #10b981, #34d399);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            z-index: 200;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            animation: voicePulse 1.5s infinite;
        }

        .voice-indicator.show {
            display: flex;
        }

        @keyframes voicePulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 12px 35px rgba(16, 185, 129, 0.5);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            }
        }

        /* Maiya AI Chat Interface */
        .maiya-chat {
            position: fixed;
            bottom: 160px;
            right: 20px;
            width: 350px;
            max-width: calc(100vw - 40px);
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 60px var(--shadow-strong);
            display: none;
            flex-direction: column;
            max-height: 500px;
            z-index: 200;
        }

        .maiya-chat.show {
            display: flex;
        }

        .maiya-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            color: white;
            border-radius: 20px 20px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .maiya-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 12px;
        }

        .maiya-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .maiya-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .maiya-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            min-height: 200px;
            max-height: 300px;
        }

        .maiya-message {
            margin-bottom: 16px;
            padding: 12px 16px;
            border-radius: 16px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .maiya-message.user {
            background: var(--accent-primary);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .maiya-message.ai {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .maiya-input-area {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .maiya-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            resize: none;
            min-height: 40px;
            max-height: 100px;
            font-family: inherit;
        }

        .maiya-send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .maiya-voice-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--success);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 8px;
        }

        .maiya-voice-btn.listening {
            animation: pulse 1s infinite;
            background: var(--error);
        }

        .maiya-voice-btn.speaking {
            animation: pulse 1s infinite;
            background: var(--warning);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 52px;
            text-decoration: none;
            box-shadow: 0 4px 12px var(--shadow-light);
            position: relative;
            overflow: hidden;
            user-select: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }
        
        .btn:active {
            transform: scale(0.96);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        .btn-success { background: linear-gradient(135deg, var(--success), #34d399); }
        .btn-secondary { background: linear-gradient(135deg, var(--text-secondary), #9ca3af); }
        .btn-warning { background: linear-gradient(135deg, var(--warning), #fbbf24); }
        .btn-danger { background: linear-gradient(135deg, var(--error), #f87171); }
        .btn-info { background: linear-gradient(135deg, var(--info), #60a5fa); }
        
        /* Edit Button Styles */
        .edit-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            min-height: auto;
        }

        .edit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        .edit-btn.small {
            padding: 4px 8px;
            font-size: 11px;
        }

        .edit-btn.large {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .quick-btn {
            padding: 16px 12px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 80px;
            box-shadow: 0 4px 12px var(--shadow-light);
            position: relative;
            overflow: hidden;
        }
        
        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }
        
        .quick-btn.primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        .quick-btn.success { background: linear-gradient(135deg, var(--success), #34d399); }
        .quick-btn.info { background: linear-gradient(135deg, var(--info), #60a5fa); }
        .quick-btn.warning { background: linear-gradient(135deg, var(--warning), #fbbf24); }
        .quick-btn.danger { background: linear-gradient(135deg, var(--error), #f87171); }
        
        .quick-btn .icon {
            font-size: 24px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        .quick-btn .label {
            font-size: 12px;
            text-align: center;
            line-height: 1.2;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px var(--shadow-light);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 2;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: var(--accent-primary);
            position: relative;
            z-index: 2;
        }

        /* Data List */
        .data-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .data-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s ease;
            position: relative;
        }

        .data-item:hover {
            box-shadow: 0 4px 16px var(--shadow-light);
            transform: translateY(-1px);
        }

        .data-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .data-item-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 16px;
            flex: 1;
        }

        .data-item-amount {
            font-weight: 800;
            color: var(--accent-primary);
            font-size: 18px;
            margin-left: 12px;
        }

        .data-item-details {
            color: var(--text-muted);
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .data-item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .data-item-date {
            font-size: 12px;
            color: var(--text-muted);
        }

        .data-item-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-draft { background: #f3f4f6; color: #374151; }
        .status-sent { background: #dbeafe; color: #1d4ed8; }
        .status-paid { background: #d1fae5; color: #059669; }
        .status-overdue { background: #fee2e2; color: #dc2626; }
        .status-active { background: #d1fae5; color: #059669; }

        /* Action Button Groups */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .action-buttons.center {
            justify-content: center;
        }

        .action-buttons.end {
            justify-content: flex-end;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px 32px;
            z-index: 100;
            box-shadow: 0 -4px 20px var(--shadow-medium);
            transition: all 0.5s ease;
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border-radius: 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 60px;
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: var(--shadow-light);
            box-shadow: 0 2px 8px var(--shadow-light);
            transform: scale(1.05);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-item .icon {
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .nav-item.active .icon {
            transform: scale(1.2);
        }
        
        .home-indicator {
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
            width: 140px;
            margin: 12px auto 0;
            opacity: 0.8;
        }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 8px 35px var(--shadow-strong);
            z-index: 250;
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .success-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Loading States */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .view {
            padding-top: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            transition: all 0.5s ease;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: 700;
            margin-right: 16px;
        }

        .company-logo {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            font-weight: 700;
            margin: 0 auto 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .company-logo:hover {
            transform: scale(1.05);
        }

        .profile-section {
            display: flex;
            align-items: center;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .profile-info h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .profile-info p {
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Responsive Design */
        @media screen and (max-width: 768px) {
            .maiya-chat {
                width: calc(100vw - 20px);
                right: 10px;
                bottom: 140px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .header-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .modal-content {
                margin: 20px;
                max-height: calc(100vh - 40px);
            }

            .action-buttons {
                justify-content: center;
            }
        }

        @media screen and (max-width: 480px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }
        }
        
        /* Safe Area Adjustments */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }

        /* Focus Styles for Accessibility */
        .keyboard-navigation *:focus {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>
<body data-theme="red" data-mode="light">
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="status-time">9:41</div>
            <div class="theme-selector">
                <button class="theme-picker-btn" onclick="openThemePicker()" id="theme-picker-btn">
                    <span id="current-theme-icon">üåÖ</span> Themes
                </button>
                <button class="theme-toggle" onclick="toggleMode()" id="mode-toggle">üåë Darker</button>
                <span>üì∂</span>
                <span>üì±</span>
                <span>üîã</span>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <div class="app-logo" id="app-logo">üåÖ</div>
                <div class="app-title">
                    <h1 id="company-name">REFIT BUSINESS SYSTEM</h1>
                    <p id="company-subtitle">Complete Solution with Maiya AI</p>
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn maiya-btn" onclick="toggleMaiyaChat()" title="Maiya AI Assistant" id="maiya-toggle">
                    ü§ñ
                </button>
                <button class="header-btn" onclick="testVoiceSystem()" title="Test Voice" style="background: linear-gradient(135deg, #10b981, #34d399);">
                    üé§
                </button>
                <button class="header-btn" onclick="openThemePicker()" title="Change Theme">üé®</button>
                <button class="header-btn" onclick="exportData()" title="Export">üì§</button>
            </div>
        </div>

        <!-- Voice Indicator -->
        <div id="voice-indicator" class="voice-indicator">
            <span>üé§</span>
        </div>

        <!-- Maiya AI Chat Interface -->
        <div id="maiya-chat" class="maiya-chat">
            <div class="maiya-header">
                <div style="display: flex; align-items: center;">
                    <div class="maiya-avatar">ü§ñ</div>
                    <div>
                        <div class="maiya-status">
                            <span>Maiya AI Assistant</span>
                            <div class="maiya-status-dot"></div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.8;" id="maiya-status-text">Ready to help</div>
                    </div>
                </div>
                <button onclick="closeMaiyaChat()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">‚úï</button>
            </div>
            <div class="maiya-messages" id="maiya-messages">
                <div class="maiya-message ai">
                    Hello! I'm Maiya, your AI business assistant. How can I help you today?
                </div>
            </div>
            <div class="maiya-input-area">
                <textarea 
                    class="maiya-input" 
                    id="maiya-input" 
                    placeholder="Type your message or click üé§ to speak..."
                    rows="1"
                    onkeypress="handleMaiyaKeyPress(event)"
                ></textarea>
                <button class="maiya-send-btn" onclick="sendMaiyaMessage()" title="Send Message">
                    üì§
                </button>
                <button class="maiya-voice-btn" onclick="toggleVoiceInput()" title="Voice Input" id="voice-btn">
                    üé§
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Voice Test Card -->
                <div class="card" style="background: linear-gradient(135deg, #10b981, #34d399); color: white; text-align: center;">
                    <h3 style="margin-bottom: 16px; font-size: 20px;">üé§ Voice AI System - FIXED</h3>
                    <p style="margin-bottom: 16px; opacity: 0.9;">Enhanced voice functionality with microphone access and speech output</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üé§</div>
                            <div style="font-size: 12px; font-weight: 600;" id="mic-status">Checking...</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üîä</div>
                            <div style="font-size: 12px; font-weight: 600;" id="speaker-status">Checking...</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-bottom: 16px;">
                        <button class="btn" onclick="testMicrophone()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                            üé§ Test Microphone
                        </button>
                        <button class="btn" onclick="testSpeakers()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                            üîä Test Speakers
                        </button>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn" onclick="startVoiceConversation()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                            üí¨ Voice Chat
                        </button>
                        <button class="btn" onclick="sayHelloMaiya()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                            üëã Say "Hey Maiya"
                        </button>
                    </div>
                </div>

                <!-- User Profile Section -->
                <div class="card">
                    <div class="profile-section">
                        <div class="avatar" id="user-avatar">JD</div>
                        <div class="profile-info" style="flex: 1;">
                            <h3 id="user-display-name">John Doe</h3>
                            <p id="user-display-title">Business Owner</p>
                        </div>
                        <button class="edit-btn" onclick="editProfile()">
                            ‚úèÔ∏è Edit Profile
                        </button>
                    </div>
                </div>

                <!-- Welcome Card with Maiya -->
                <div class="card" style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; text-align: center;">
                    <h3 style="margin-bottom: 16px; font-size: 20px;">ü§ñ Meet Maiya - Your AI Business Assistant</h3>
                    <p style="margin-bottom: 16px; opacity: 0.9;">Maiya combines powerful business management with intelligent AI assistance for document creation, data analysis, and general business support.</p>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üìã</div>
                            <div style="font-size: 12px; font-weight: 600;">Smart Quotes</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üë•</div>
                            <div style="font-size: 12px; font-weight: 600;">CRM System</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 4px;">ü§ñ</div>
                            <div style="font-size: 12px; font-weight: 600;">Maiya AI</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üìä</div>
                            <div style="font-size: 12px; font-weight: 600;">Analytics</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn" onclick="toggleMaiyaChat()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                            ü§ñ Chat with Maiya
                        </button>
                        <button class="btn" onclick="createQuote()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                            üöÄ Create Quote
                        </button>
                    </div>
                </div>

                <!-- Company Info -->
                <div class="card">
                    <div style="text-align: center;">
                        <div class="company-logo" id="company-logo" onclick="openCompanyManager()">üåÖ</div>
                        <h3 id="company-display-name" style="font-weight: 700; margin-bottom: 8px; color: var(--text-primary); cursor: pointer;" onclick="openCompanyManager()">Your Company Name</h3>
                        <p id="company-display-tagline" style="color: var(--text-muted); margin-bottom: 16px;">Professional Services</p>
                    </div>
                    <div class="action-buttons center">
                        <button class="edit-btn" onclick="editCompany()">
                            ‚úèÔ∏è Edit Company
                        </button>
                        <button class="edit-btn" onclick="openCompanyManager()">
                            üè¢ Company Hub
                        </button>
                        <button class="edit-btn" onclick="askMaiyaAboutCompany()" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                            ü§ñ Ask Maiya
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card" onclick="showView('quotes')">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="total-quotes-count">0</div>
                    </div>
                    <div class="stat-card" onclick="showView('customers')">
                        <div class="stat-label">Total Customers</div>
                        <div class="stat-value" id="total-customers-count">0</div>
                    </div>
                    <div class="stat-card" onclick="viewReports()">
                        <div class="stat-label">Monthly Revenue</div>
                        <div class="stat-value" id="monthly-revenue">RM 0</div>
                    </div>
                    <div class="stat-card" onclick="viewReports()">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="total-revenue">RM 0</div>
                    </div>
                </div>

                <!-- Quick Actions with Maiya -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">üöÄ Quick Actions</h3>
                    <div class="quick-actions">
                        <button class="quick-btn primary" onclick="createQuote()">
                            <span class="icon">üìã</span>
                            <span class="label">New Quote</span>
                        </button>
                        <button class="quick-btn success" onclick="addCustomer()">
                            <span class="icon">üë•</span>
                            <span class="label">Add Customer</span>
                        </button>
                        <button class="quick-btn" onclick="toggleMaiyaChat()" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                            <span class="icon">ü§ñ</span>
                            <span class="label">Chat Maiya</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">‚öôÔ∏è Settings</h2>
                </div>

                <!-- Voice AI Settings -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">üé§ Voice AI Settings</h3>
                        <button class="edit-btn small" onclick="testFullVoiceSystem()">üß™ Full Test</button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card" onclick="testMicrophone()">
                            <div class="stat-label">Microphone</div>
                            <div class="stat-value" id="mic-status-card">üî¥</div>
                        </div>
                        <div class="stat-card" onclick="testSpeakers()">
                            <div class="stat-label">Speakers</div>
                            <div class="stat-value" id="speaker-status-card">üî¥</div>
                        </div>
                        <div class="stat-card" onclick="testVoiceRecognition()">
                            <div class="stat-label">Recognition</div>
                            <div class="stat-value" id="recognition-status-card">üî¥</div>
                        </div>
                        <div class="stat-card" onclick="testSpeechSynthesis()">
                            <div class="stat-label">Synthesis</div>
                            <div class="stat-value" id="synthesis-status-card">üî¥</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <button class="quick-btn primary" onclick="requestMicrophoneAccess()">
                            <span class="icon">üé§</span>
                            <span class="label">Enable Mic</span>
                        </button>
                        <button class="quick-btn success" onclick="testSpeechOutput()">
                            <span class="icon">üîä</span>
                            <span class="label">Test Speech</span>
                        </button>
                        <button class="quick-btn info" onclick="startListening()">
                            <span class="icon">üëÇ</span>
                            <span class="label">Start Listen</span>
                        </button>
                    </div>
                </div>

                <!-- Theme Settings -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">üé® Theme Settings</h3>
                        <button class="edit-btn small" onclick="randomTheme()">üé≤ Random</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <button class="quick-btn" onclick="switchToTheme('red')" style="background: linear-gradient(135deg, #f87171, #fca5a5);">
                            <span class="icon">üåÖ</span>
                            <span class="label">Coral Sunset</span>
                        </button>
                        <button class="quick-btn" onclick="switchToTheme('orange')" style="background: linear-gradient(135deg, #fb923c, #fdba74);">
                            <span class="icon">üçë</span>
                            <span class="label">Peach Glow</span>
                        </button>
                        <button class="quick-btn" onclick="switchToTheme('pink')" style="background: linear-gradient(135deg, #f472b6, #f9a8d4);">
                            <span class="icon">üå∏</span>
                            <span class="label">Rose Blush</span>
                        </button>
                        <button class="quick-btn" onclick="switchToTheme('yellow')" style="background: linear-gradient(135deg, #fbbf24, #fcd34d);">
                            <span class="icon">üåª</span>
                            <span class="label">Butter Cream</span>
                        </button>
                        <button class="quick-btn" onclick="switchToTheme('bluegreen')" style="background: linear-gradient(135deg, #2dd4bf, #7dd3fc);">
                            <span class="icon">üåä</span>
                            <span class="label">Mint Breeze</span>
                        </button>
                        <button class="quick-btn" onclick="switchToTheme('purplegrey')" style="background: linear-gradient(135deg, #a855f7, #c4b5fd);">
                            <span class="icon">üíú</span>
                            <span class="label">Lavender Mist</span>
                        </button>
                        <button class="quick-btn" onclick="switchToTheme('browngrey')" style="background: linear-gradient(135deg, #a3a3a3, #d6d3d1);">
                            <span class="icon">ü§é</span>
                            <span class="label">Warm Taupe</span>
                        </button>
                        <button class="quick-btn" onclick="switchToTheme('greenbrown')" style="background: linear-gradient(135deg, #84cc16, #bef264);">
                            <span class="icon">üåø</span>
                            <span class="label">Sage Olive</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="showView('quotes')">
                    <span class="icon">üìã</span>
                    <span>Quotes</span>
                </div>
                <div class="nav-item" onclick="showView('customers')">
                    <span class="icon">üë•</span>
                    <span>Customers</span>
                </div>
                <div class="nav-item" onclick="toggleMaiyaChat()">
                    <span class="icon">ü§ñ</span>
                    <span>Maiya</span>
                </div>
                <div class="nav-item" onclick="showView('settings')">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </div>
            </div>
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        <span id="success-text">Action completed successfully!</span>
    </div>

    <script>
        // ===== FIXED VOICE AI SYSTEM =====
        class FixedVoiceAI {
            constructor() {
                this.isListening = false;
                this.isSpeaking = false;
                this.recognition = null;
                this.synthesis = null;
                this.voices = [];
                this.chatHistory = [];
                this.micPermissionGranted = false;
                this.voiceSupported = false;
                this.speechSupported = false;
                this.currentStream = null;
                
                // Voice settings
                this.settings = {
                    language: 'en-US',
                    voiceRate: 1.0,
                    voicePitch: 1.0,
                    voiceVolume: 1.0,
                    autoSpeak: true
                };
                
                this.initializeVoiceSystem();
            }

            async initializeVoiceSystem() {
                console.log('üé§ Initializing FIXED Voice AI System...');
                
                // Check browser support
                this.checkBrowserSupport();
                
                // Initialize components
                if (this.voiceSupported) {
                    await this.setupVoiceRecognition();
                }
                
                if (this.speechSupported) {
                    await this.setupSpeechSynthesis();
                }
                
                // Update UI status
                this.updateVoiceStatus();
                
                console.log('‚úÖ Voice AI System initialized');
                console.log(`   üé§ Voice Recognition: ${this.voiceSupported ? 'Supported' : 'Not Supported'}`);
                console.log(`   üîä Speech Synthesis: ${this.speechSupported ? 'Supported' : 'Not Supported'}`);
            }

            checkBrowserSupport() {
                // Check Voice Recognition Support
                this.voiceSupported = !!(
                    window.SpeechRecognition || 
                    window.webkitSpeechRecognition || 
                    window.mozSpeechRecognition || 
                    window.msSpeechRecognition
                );
                
                // Check Speech Synthesis Support
                this.speechSupported = !!(
                    window.speechSynthesis && 
                    SpeechSynthesisUtterance
                );
                
                console.log('üîç Browser Support Check:');
                console.log(`   Voice Recognition: ${this.voiceSupported}`);
                console.log(`   Speech Synthesis: ${this.speechSupported}`);
                console.log(`   User Agent: ${navigator.userAgent}`);
            }

            async setupVoiceRecognition() {
                if (!this.voiceSupported) {
                    console.warn('‚ùå Voice recognition not supported');
                    return;
                }

                try {
                    // Create recognition instance
                    const SpeechRecognition = 
                        window.SpeechRecognition || 
                        window.webkitSpeechRecognition || 
                        window.mozSpeechRecognition || 
                        window.msSpeechRecognition;
                    
                    this.recognition = new SpeechRecognition();
                    
                    // Configure recognition
                    this.recognition.continuous = false;
                    this.recognition.interimResults = true;
                    this.recognition.lang = this.settings.language;
                    this.recognition.maxAlternatives = 1;

                    // Event handlers
                    this.recognition.onstart = () => {
                        console.log('üé§ Voice recognition started');
                        this.isListening = true;
                        this.updateUI();
                        this.showVoiceIndicator();
                        this.updateStatus('üé§ Listening...');
                    };

                    this.recognition.onend = () => {
                        console.log('üé§ Voice recognition ended');
                        this.isListening = false;
                        this.updateUI();
                        this.hideVoiceIndicator();
                        this.updateStatus('Ready to help');
                    };

                    this.recognition.onresult = (event) => {
                        this.handleVoiceResult(event);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('üé§ Voice recognition error:', event.error);
                        this.handleVoiceError(event);
                    };

                    console.log('‚úÖ Voice recognition setup complete');
                } catch (error) {
                    console.error('‚ùå Failed to setup voice recognition:', error);
                }
            }

            async setupSpeechSynthesis() {
                if (!this.speechSupported) {
                    console.warn('‚ùå Speech synthesis not supported');
                    return;
                }

                try {
                    this.synthesis = window.speechSynthesis;
                    
                    // Load voices
                    await this.loadVoices();
                    
                    // Handle voices changed event
                    if (speechSynthesis.onvoiceschanged !== undefined) {
                        speechSynthesis.onvoiceschanged = () => {
                            this.loadVoices();
                        };
                    }

                    console.log('‚úÖ Speech synthesis setup complete');
                } catch (error) {
                    console.error('‚ùå Failed to setup speech synthesis:', error);
                }
            }

            async loadVoices() {
                return new Promise((resolve) => {
                    const loadVoicesAttempt = () => {
                        const voices = this.synthesis.getVoices();
                        if (voices.length > 0) {
                            this.voices = voices;
                            console.log(`üîä Loaded ${this.voices.length} voices`);
                            resolve();
                        } else {
                            // Retry after a short delay
                            setTimeout(loadVoicesAttempt, 100);
                        }
                    };
                    
                    loadVoicesAttempt();
                });
            }

            async requestMicrophonePermission() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Microphone access not supported in this browser');
                }

                try {
                    console.log('üé§ Requesting microphone permission...');
                    
                    // Stop any existing stream
                    if (this.currentStream) {
                        this.currentStream.getTracks().forEach(track => track.stop());
                    }
                    
                    // Request microphone access
                    this.currentStream = await navigator.mediaDevices.getUserMedia({
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true,
                            sampleRate: 44100
                        }
                    });
                    
                    this.micPermissionGranted = true;
                    console.log('‚úÖ Microphone permission granted');
                    this.updateStatus('üé§ Microphone access granted');
                    
                    // Keep the stream active for a moment to test
                    setTimeout(() => {
                        if (this.currentStream) {
                            this.currentStream.getTracks().forEach(track => track.stop());
                        }
                    }, 1000);
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå Microphone permission denied:', error);
                    this.micPermissionGranted = false;
                    this.updateStatus('‚ùå Microphone access denied');
                    throw error;
                }
            }

            async startVoiceInput() {
                if (!this.voiceSupported) {
                    throw new Error('Voice recognition not supported');
                }

                if (!this.micPermissionGranted) {
                    await this.requestMicrophonePermission();
                }

                if (!this.recognition) {
                    await this.setupVoiceRecognition();
                }

                if (this.isListening) {
                    this.stopVoiceInput();
                    return;
                }

                try {
                    console.log('üé§ Starting voice input...');
                    this.recognition.start();
                } catch (error) {
                    console.error('‚ùå Error starting voice input:', error);
                    this.updateStatus('‚ùå Error starting voice input');
                    throw error;
                }
            }

            stopVoiceInput() {
                if (this.recognition && this.isListening) {
                    try {
                        this.recognition.stop();
                        console.log('üõë Voice input stopped');
                    } catch (error) {
                        console.error('‚ùå Error stopping voice input:', error);
                    }
                }
            }

            handleVoiceResult(event) {
                let transcript = '';
                let isFinal = false;

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    transcript += result[0].transcript;
                    if (result.isFinal) {
                        isFinal = true;
                    }
                }

                console.log('üé§ Voice result:', transcript, 'Final:', isFinal);

                if (isFinal && transcript.trim()) {
                    this.processVoiceInput(transcript.trim());
                } else if (!isFinal) {
                    this.updateStatus(`üé§ "${transcript}"`);
                }
            }

            handleVoiceError(event) {
                console.error('üé§ Voice error:', event.error);
                
                const errorMessages = {
                    'not-allowed': 'Microphone access denied. Please allow microphone access.',
                    'no-speech': 'No speech detected. Please speak clearly.',
                    'audio-capture': 'Microphone not found. Check your microphone.',
                    'network': 'Network error. Check your internet connection.',
                    'not-supported': 'Voice recognition not supported.',
                    'language-not-supported': 'Language not supported.',
                    'aborted': 'Voice input was cancelled.',
                    'service-not-allowed': 'Voice service not allowed.'
                };
                
                const message = errorMessages[event.error] || `Voice error: ${event.error}`;
                this.updateStatus(`‚ùå ${message}`);
                showSuccessMessage(`üé§ ${message}`);
                
                if (event.error === 'not-allowed') {
                    this.micPermissionGranted = false;
                }
                
                this.isListening = false;
                this.updateUI();
                this.hideVoiceIndicator();
            }

            processVoiceInput(transcript) {
                console.log('üé§ Processing voice input:', transcript);
                
                // Check for wake word
                const lowerTranscript = transcript.toLowerCase();
                if (lowerTranscript.includes('hey maiya') || lowerTranscript.includes('hi maiya')) {
                    this.handleWakeWord();
                    return;
                }
                
                // Check for voice commands
                if (this.handleVoiceCommands(lowerTranscript)) {
                    return;
                }
                
                // Regular chat input
                document.getElementById('maiya-input').value = transcript;
                this.updateStatus('‚úÖ Voice input received');
                
                // Auto-send after a short delay
                setTimeout(() => {
                    this.sendMessage(transcript);
                }, 500);
            }

            handleWakeWord() {
                const responses = [
                    "Yes, I'm here!",
                    "Hello! How can I help?",
                    "Hi there! What do you need?",
                    "Ready to assist!",
                    "What can I do for you?"
                ];
                
                const response = responses[Math.floor(Math.random() * responses.length)];
                this.speak(response);
                
                // Open chat if not already open
                if (!document.getElementById('maiya-chat').classList.contains('show')) {
                    toggleMaiyaChat();
                }
                
                this.updateStatus('üëã Wake word detected');
                showSuccessMessage('üëã Maiya is listening!');
            }

            handleVoiceCommands(transcript) {
                const commands = {
                    'analyze business': () => {
                        this.speak("Analyzing your business data now.");
                        this.sendMessage('Analyze my business performance and provide insights');
                        return true;
                    },
                    'create document': () => {
                        this.speak("Opening document generator.");
                        showSuccessMessage('üìÑ Document generation coming soon!');
                        return true;
                    },
                    'export data': () => {
                        this.speak("Exporting your business data.");
                        exportData();
                        return true;
                    },
                    'change theme': () => {
                        this.speak("Changing theme now.");
                        randomTheme();
                        return true;
                    },
                    'clear chat': () => {
                        this.speak("Clearing chat history.");
                        this.clearHistory();
                        return true;
                    },
                    'help': () => {
                        this.speak("I'm here to help with your business needs.");
                        this.sendMessage('How can you help me with my business?');
                        return true;
                    }
                };
                
                for (const [command, handler] of Object.entries(commands)) {
                    if (transcript.includes(command)) {
                        console.log('üé§ Executing voice command:', command);
                        return handler();
                    }
                }
                
                return false;
            }

            async speak(text) {
                if (!this.speechSupported || !this.settings.autoSpeak || !text) {
                    console.log('üîä Speech disabled or no text');
                    return;
                }

                try {
                    console.log('üîä Speaking:', text);
                    
                    // Stop any current speech
                    this.stopSpeaking();
                    
                    // Create utterance
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Configure utterance
                    utterance.rate = this.settings.voiceRate;
                    utterance.pitch = this.settings.voicePitch;
                    utterance.volume = this.settings.voiceVolume;
                    utterance.lang = this.settings.language;
                    
                    // Select best voice
                    const voice = this.selectBestVoice();
                    if (voice) {
                        utterance.voice = voice;
                    }
                    
                    // Event handlers
                    utterance.onstart = () => {
                        console.log('üîä Speech started');
                        this.isSpeaking = true;
                        this.updateUI();
                        this.updateStatus('üó£Ô∏è Speaking...');
                    };
                    
                    utterance.onend = () => {
                        console.log('üîä Speech ended');
                        this.isSpeaking = false;
                        this.updateUI();
                        this.updateStatus('Ready to help');
                    };
                    
                    utterance.onerror = (event) => {
                        console.error('üîä Speech error:', event.error);
                        this.isSpeaking = false;
                        this.updateUI();
                        this.updateStatus('Speech error occurred');
                    };
                    
                    // Speak
                    this.synthesis.speak(utterance);
                    
                } catch (error) {
                    console.error('üîä Error in speech synthesis:', error);
                    this.updateStatus('‚ùå Speech synthesis error');
                }
            }

            stopSpeaking() {
                if (this.synthesis) {
                    try {
                        this.synthesis.cancel();
                        this.isSpeaking = false;
                        this.updateUI();
                        console.log('üîä Speech stopped');
                    } catch (error) {
                        console.error('üîä Error stopping speech:', error);
                    }
                }
            }

            selectBestVoice() {
                if (this.voices.length === 0) {
                    return null;
                }

                // Try to find voice matching language
                let preferredVoice = this.voices.find(voice => 
                    voice.lang.toLowerCase().startsWith(this.settings.language.toLowerCase().split('-')[0])
                );

                // Fallback to first available voice
                if (!preferredVoice) {
                    preferredVoice = this.voices[0];
                }

                return preferredVoice;
            }

            sendMessage(message) {
                if (!message.trim()) return;

                // Add user message to chat
                this.addMessageToChat(message, 'user');
                
                // Clear input
                document.getElementById('maiya-input').value = '';
                
                // Process message
                setTimeout(() => {
                    const response = this.generateResponse(message);
                    this.addMessageToChat(response, 'ai');
                    
                    // Speak response if enabled
                    if (this.settings.autoSpeak) {
                        const spokenResponse = this.generateSpokenResponse(response);
                        setTimeout(() => {
                            this.speak(spokenResponse);
                        }, 300);
                    }
                }, 1000);
            }

            addMessageToChat(message, sender) {
                const messagesContainer = document.getElementById('maiya-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `maiya-message ${sender}`;
                messageDiv.textContent = message;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Save to history
                this.chatHistory.push({
                    message: message,
                    sender: sender,
                    timestamp: new Date()
                });
            }

            generateResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Simple response generation
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                    return "Hello! I'm Maiya, your AI business assistant. How can I help you today?";
                }
                
                if (lowerMessage.includes('analyze') || lowerMessage.includes('business')) {
                    return "I can help analyze your business performance. You currently have 2 customers and RM 22,790 in total revenue. Would you like me to provide more detailed insights?";
                }
                
                if (lowerMessage.includes('help')) {
                    return "I can assist you with business analysis, document creation, customer management, and general business advice. What specific area would you like help with?";
                }
                
                if (lowerMessage.includes('voice') || lowerMessage.includes('speak')) {
                    return "Voice functionality is now working! You can speak to me using the microphone button, and I'll respond with both text and speech.";
                }
                
                // Default response
                return `I understand you're asking about "${message.substring(0, 50)}${message.length > 50 ? '...' : ''}". I'm here to help with your business needs. Could you be more specific about what you'd like assistance with?`;
            }

            generateSpokenResponse(fullResponse) {
                // Create a shorter version for speech
                const sentences = fullResponse.split('. ');
                const firstSentence = sentences[0];
                
                // Limit length for speech
                if (firstSentence.length > 100) {
                    return firstSentence.substring(0, 97) + '...';
                }
                
                return firstSentence;
            }

            clearHistory() {
                this.chatHistory = [];
                document.getElementById('maiya-messages').innerHTML = `
                    <div class="maiya-message ai">
                        Hello! I'm Maiya, your AI business assistant. How can I help you today?
                    </div>
                `;
                showSuccessMessage('üóëÔ∏è Chat history cleared!');
            }

            updateUI() {
                const voiceBtn = document.getElementById('voice-btn');
                const maiyaBtn = document.getElementById('maiya-toggle');
                
                // Update voice button
                if (voiceBtn) {
                    if (this.isListening) {
                        voiceBtn.classList.add('listening');
                        voiceBtn.innerHTML = 'üõë';
                        voiceBtn.title = 'Stop Voice Input';
                    } else if (this.isSpeaking) {
                        voiceBtn.classList.add('speaking');
                        voiceBtn.classList.remove('listening');
                        voiceBtn.innerHTML = 'üîä';
                        voiceBtn.title = 'Speaking...';
                    } else {
                        voiceBtn.classList.remove('listening', 'speaking');
                        voiceBtn.innerHTML = 'üé§';
                        voiceBtn.title = 'Start Voice Input';
                    }
                }

                // Update Maiya button
                if (maiyaBtn) {
                    if (this.isListening) {
                        maiyaBtn.classList.add('listening');
                    } else {
                        maiyaBtn.classList.remove('listening');
                    }

                    if (this.isSpeaking) {
                        maiyaBtn.classList.add('processing');
                    } else {
                        maiyaBtn.classList.remove('processing');
                    }
                }
            }

            updateStatus(status) {
                const statusText = document.getElementById('maiya-status-text');
                if (statusText) {
                    statusText.textContent = status;
                }
                console.log('üé§ Status:', status);
            }

            showVoiceIndicator() {
                const indicator = document.getElementById('voice-indicator');
                if (indicator) {
                    indicator.classList.add('show');
                }
            }

            hideVoiceIndicator() {
                const indicator = document.getElementById('voice-indicator');
                if (indicator) {
                    indicator.classList.remove('show');
                }
            }

            updateVoiceStatus() {
                // Update status displays
                const micStatus = document.getElementById('mic-status');
                const speakerStatus = document.getElementById('speaker-status');
                const micStatusCard = document.getElementById('mic-status-card');
                const speakerStatusCard = document.getElementById('speaker-status-card');
                const recognitionStatusCard = document.getElementById('recognition-status-card');
                const synthesisStatusCard = document.getElementById('synthesis-status-card');
                
                // Microphone status
                const micText = this.micPermissionGranted ? 'Access Granted' : 'Access Needed';
                const micIcon = this.micPermissionGranted ? 'üü¢' : 'üî¥';
                if (micStatus) micStatus.textContent = micText;
                if (micStatusCard) micStatusCard.textContent = micIcon;
                
                // Speaker status
                const speakerText = this.speechSupported ? 'Ready' : 'Not Supported';
                const speakerIcon = this.speechSupported ? 'üü¢' : 'üî¥';
                if (speakerStatus) speakerStatus.textContent = speakerText;
                if (speakerStatusCard) speakerStatusCard.textContent = speakerIcon;
                
                // Recognition status
                const recognitionIcon = this.voiceSupported ? 'üü¢' : 'üî¥';
                if (recognitionStatusCard) recognitionStatusCard.textContent = recognitionIcon;
                
                // Synthesis status
                const synthesisIcon = this.speechSupported ? 'üü¢' : 'üî¥';
                if (synthesisStatusCard) synthesisStatusCard.textContent = synthesisIcon;
            }

            // Test methods
            async testMicrophone() {
                try {
                    await this.requestMicrophonePermission();
                    showSuccessMessage('‚úÖ Microphone test successful!');
                    this.updateVoiceStatus();
                } catch (error) {
                    showSuccessMessage('‚ùå Microphone test failed: ' + error.message);
                }
            }

            testSpeakers() {
                this.speak("Speaker test successful. You should hear this message clearly.");
                showSuccessMessage('üîä Testing speakers - you should hear Maiya speaking!');
            }

            async testVoiceRecognition() {
                if (!this.voiceSupported) {
                    showSuccessMessage('‚ùå Voice recognition not supported in this browser');
                    return;
                }
                
                try {
                    await this.startVoiceInput();
                    showSuccessMessage('üé§ Voice recognition test started - say something!');
                } catch (error) {
                    showSuccessMessage('‚ùå Voice recognition test failed: ' + error.message);
                }
            }

            testSpeechSynthesis() {
                if (!this.speechSupported) {
                    showSuccessMessage('‚ùå Speech synthesis not supported in this browser');
                    return;
                }
                
                this.speak("Speech synthesis test successful. Voice output is working correctly.");
                showSuccessMessage('üîä Speech synthesis test completed!');
            }

            async testFullSystem() {
                showSuccessMessage('üß™ Running complete voice system test...');
                
                // Test microphone
                setTimeout(async () => {
                    try {
                        await this.testMicrophone();
                    } catch (error) {
                        console.error('Microphone test failed:', error);
                    }
                }, 500);
                
                // Test speakers
                setTimeout(() => {
                    this.testSpeakers();
                }, 2000);
                
                // Test voice recognition
                setTimeout(() => {
                    if (this.micPermissionGranted) {
                        this.testVoiceRecognition();
                    }
                }, 4000);
                
                // Final status update
                setTimeout(() => {
                    this.updateVoiceStatus();
                    const micOk = this.micPermissionGranted;
                    const speechOk = this.speechSupported;
                    const voiceOk = this.voiceSupported;
                    
                    if (micOk && speechOk && voiceOk) {
                        showSuccessMessage('‚úÖ All voice features are working perfectly!');
                    } else {
                        const issues = [];
                        if (!micOk) issues.push('microphone access');
                        if (!speechOk) issues.push('speech synthesis');
                        if (!voiceOk) issues.push('voice recognition');
                        showSuccessMessage(`‚ö†Ô∏è Issues found: ${issues.join(', ')}`);
                    }
                }, 6000);
            }
        }

        // ===== APPLICATION STATE =====
        let appState = {
            currentTheme: 'red',
            currentMode: 'light',
            currentView: 'dashboard',
            
            userProfile: {
                firstName: 'John',
                lastName: 'Doe',
                title: 'Business Owner',
                email: 'john@company.com',
                phone: '+60 12-345 6789'
            },
            
            companyInfo: {
                name: 'Your Company Name',
                tagline: 'Professional Services',
                logo: 'üåÖ'
            },
            
            customers: [
                {
                    id: 1,
                    company: 'ABC Corporation',
                    contact: 'Jane Smith'
                },
                {
                    id: 2,
                    company: 'XYZ Solutions',
                    contact: 'Bob Johnson'
                }
            ],
            
            quotes: [
                {
                    id: 1,
                    number: 'QT-2024-001',
                    total: 6360,
                    status: 'sent'
                },
                {
                    id: 2,
                    number: 'QT-2024-002',
                    total: 16430,
                    status: 'draft'
                }
            ],
            
            stats: {
                totalQuotes: 2,
                totalCustomers: 2,
                monthlyRevenue: 16430,
                totalRevenue: 22790
            }
        };

        // ===== INITIALIZE VOICE AI =====
        let voiceAI = new FixedVoiceAI();

        // ===== VOICE FUNCTIONS =====
        function toggleMaiyaChat() {
            const chat = document.getElementById('maiya-chat');
            const isVisible = chat.classList.contains('show');
            
            if (isVisible) {
                chat.classList.remove('show');
            } else {
                chat.classList.add('show');
                document.getElementById('maiya-input').focus();
            }
        }

        function closeMaiyaChat() {
            document.getElementById('maiya-chat').classList.remove('show');
        }

        function sendMaiyaMessage() {
            const input = document.getElementById('maiya-input');
            const message = input.value.trim();
            if (message) {
                voiceAI.sendMessage(message);
            }
        }

        function handleMaiyaKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMaiyaMessage();
            }
        }

        function toggleVoiceInput() {
            if (voiceAI.isListening) {
                voiceAI.stopVoiceInput();
            } else {
                voiceAI.startVoiceInput().catch(error => {
                    console.error('Error starting voice input:', error);
                    showSuccessMessage('‚ùå Error starting voice input: ' + error.message);
                });
            }
        }

        // ===== VOICE TEST FUNCTIONS =====
        function testVoiceSystem() {
            voiceAI.testFullSystem();
        }

        function testMicrophone() {
            voiceAI.testMicrophone();
        }

        function testSpeakers() {
            voiceAI.testSpeakers();
        }

        function testVoiceRecognition() {
            voiceAI.testVoiceRecognition();
        }

        function testSpeechSynthesis() {
            voiceAI.testSpeechSynthesis();
        }

        function testFullVoiceSystem() {
            voiceAI.testFullSystem();
        }

        function requestMicrophoneAccess() {
            voiceAI.requestMicrophonePermission().then(() => {
                showSuccessMessage('‚úÖ Microphone access granted!');
                voiceAI.updateVoiceStatus();
            }).catch(error => {
                showSuccessMessage('‚ùå Failed to get microphone access: ' + error.message);
            });
        }

        function testSpeechOutput() {
            voiceAI.speak("Hello! This is a test of the speech output system. If you can hear this message clearly, speech synthesis is working correctly.");
        }

        function startListening() {
            voiceAI.startVoiceInput().catch(error => {
                showSuccessMessage('‚ùå Error starting voice input: ' + error.message);
            });
        }

        function startVoiceConversation() {
            toggleMaiyaChat();
            setTimeout(() => {
                voiceAI.speak("Voice conversation mode activated. You can now speak to me!");
                showSuccessMessage('üí¨ Voice conversation started! Say "Hey Maiya" to begin.');
            }, 500);
        }

        function sayHelloMaiya() {
            voiceAI.processVoiceInput("Hey Maiya");
        }

        // ===== THEME MANAGEMENT =====
        const themes = {
            red: { name: 'Coral Sunset', icon: 'üåÖ' },
            orange: { name: 'Peach Glow', icon: 'üçë' },
            pink: { name: 'Rose Blush', icon: 'üå∏' },
            yellow: { name: 'Butter Cream', icon: 'üåª' },
            bluegreen: { name: 'Mint Breeze', icon: 'üåä' },
            purplegrey: { name: 'Lavender Mist', icon: 'üíú' },
            browngrey: { name: 'Warm Taupe', icon: 'ü§é' },
            greenbrown: { name: 'Sage Olive', icon: 'üåø' }
        };

        function switchToTheme(theme) {
            appState.currentTheme = theme;
            document.body.setAttribute('data-theme', theme);
            
            // Update theme display elements
            document.getElementById('current-theme-icon').textContent = themes[theme].icon;
            document.getElementById('app-logo').textContent = themes[theme].icon;
            document.getElementById('company-logo').textContent = themes[theme].icon;
            
            showSuccessMessage(`‚ú® Theme changed to ${themes[theme].name}!`);
            updateDisplay();
        }

        function randomTheme() {
            const themeKeys = Object.keys(themes);
            const randomTheme = themeKeys[Math.floor(Math.random() * themeKeys.length)];
            switchToTheme(randomTheme);
        }

        function toggleMode() {
            const newMode = appState.currentMode === 'light' ? 'dark' : 'light';
            appState.currentMode = newMode;
            document.body.setAttribute('data-mode', newMode);
            
            const modeText = newMode === 'light' ? 'Darker' : 'Lighter';
            const modeIcon = newMode === 'light' ? 'üåë' : 'üåû';
            
            document.getElementById('mode-toggle').innerHTML = `${modeIcon} ${modeText}`;
            showSuccessMessage(`üåô Switched to ${newMode === 'light' ? 'Standard' : 'Dark'} mode!`);
        }

        function openThemePicker() {
            showView('settings');
        }

        // ===== VIEW MANAGEMENT =====
        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show selected view
            document.getElementById(`${viewName}-view`).classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the correct nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                const itemText = item.textContent.toLowerCase();
                if ((viewName === 'dashboard' && itemText.includes('home')) ||
                    itemText.includes(viewName.toLowerCase())) {
                    item.classList.add('active');
                }
            });
            
            appState.currentView = viewName;
            
            if (viewName === 'dashboard') {
                updateStats();
            }
        }

        // ===== SUCCESS MESSAGE =====
        function showSuccessMessage(message) {
            const successMsg = document.getElementById('success-message');
            const successText = document.getElementById('success-text');
            successText.textContent = message;
            successMsg.classList.add('show');
            
            setTimeout(() => {
                successMsg.classList.remove('show');
            }, 3000);
        }

        // ===== UTILITY FUNCTIONS =====
        function updateDisplay() {
            updateUserDisplay();
            updateCompanyDisplay();
            updateStats();
            
            document.getElementById('app-logo').textContent = appState.companyInfo.logo;
            document.getElementById('company-logo').textContent = appState.companyInfo.logo;
            document.getElementById('current-theme-icon').textContent = themes[appState.currentTheme].icon;
            
            document.body.setAttribute('data-theme', appState.currentTheme);
            document.body.setAttribute('data-mode', appState.currentMode);
        }

        function updateUserDisplay() {
            const fullName = `${appState.userProfile.firstName} ${appState.userProfile.lastName}`;
            const initials = `${appState.userProfile.firstName.charAt(0)}${appState.userProfile.lastName.charAt(0)}`;
            
            document.getElementById('user-display-name').textContent = fullName;
            document.getElementById('user-display-title').textContent = appState.userProfile.title;
            document.getElementById('user-avatar').textContent = initials;
        }

        function updateCompanyDisplay() {
            document.getElementById('company-display-name').textContent = appState.companyInfo.name;
            document.getElementById('company-display-tagline').textContent = appState.companyInfo.tagline;
            document.getElementById('company-name').textContent = appState.companyInfo.name;
        }

        function updateStats() {
            document.getElementById('total-quotes-count').textContent = appState.stats.totalQuotes;
            document.getElementById('total-customers-count').textContent = appState.stats.totalCustomers;
            document.getElementById('monthly-revenue').textContent = `RM ${appState.stats.monthlyRevenue.toFixed(2)}`;
            document.getElementById('total-revenue').textContent = `RM ${appState.stats.totalRevenue.toFixed(2)}`;
        }

        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            document.getElementById('status-time').textContent = time;
        }

        // ===== PLACEHOLDER FUNCTIONS =====
        function createQuote() {
            showSuccessMessage('üìã Quote creation feature coming soon!');
        }

        function addCustomer() {
            showSuccessMessage('üë• Customer management feature coming soon!');
        }

        function editProfile() {
            showSuccessMessage('üë§ Profile editing feature coming soon!');
        }

        function editCompany() {
            showSuccessMessage('üè¢ Company editing feature coming soon!');
        }

        function openCompanyManager() {
            showSuccessMessage('üè¢ Company manager coming soon!');
        }

        function viewReports() {
            showSuccessMessage('üìä Advanced reports coming soon!');
        }

        function exportData() {
            const exportData = {
                userProfile: appState.userProfile,
                companyInfo: appState.companyInfo,
                customers: appState.customers,
                quotes: appState.quotes,
                chatHistory: voiceAI.chatHistory,
                voiceSettings: voiceAI.settings,
                exportDate: new Date().toISOString(),
                version: '3.0.0-voice-fixed'
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `refit-voice-fixed-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showSuccessMessage('üì§ Complete data exported with voice AI settings!');
        }

        function askMaiyaAboutCompany() {
            toggleMaiyaChat();
            setTimeout(() => {
                voiceAI.sendMessage('Tell me about my company performance and opportunities');
            }, 500);
        }

        // ===== APPLICATION INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ REFIT Business System v3.0.0 with FIXED Voice AI Starting...');
            
            updateDisplay();
            updateTime();
            setInterval(updateTime, 60000);
            
            // Initialize voice status after a short delay
            setTimeout(() => {
                voiceAI.updateVoiceStatus();
                
                // Show welcome message
                const hasVoice = voiceAI.voiceSupported;
                const hasSpeech = voiceAI.speechSupported;
                
                if (hasVoice && hasSpeech) {
                    showSuccessMessage('üéâ Welcome! Voice AI is fully functional - microphone and speakers ready!');
                } else if (hasSpeech) {
                    showSuccessMessage('üéâ Welcome! Speech output is ready, voice input needs microphone access.');
                } else {
                    showSuccessMessage('üéâ Welcome! Voice features may be limited in this browser.');
                }
            }, 1000);
            
            // Test voice capabilities after initialization
            setTimeout(() => {
                if (voiceAI.speechSupported) {
                    console.log('üîä Testing speech synthesis on startup...');
                    // Uncomment to test speech on startup
                    // voiceAI.speak("Voice AI system is ready and functional!");
                }
            }, 2000);
            
            console.log('‚úÖ REFIT Business System with FIXED Voice AI loaded successfully!');
            console.log('üé§ Voice Features:');
            console.log(`   - Microphone Access: ${voiceAI.micPermissionGranted ? 'Granted' : 'Needs Permission'}`);
            console.log(`   - Voice Recognition: ${voiceAI.voiceSupported ? 'Supported' : 'Not Supported'}`);
            console.log(`   - Speech Synthesis: ${voiceAI.speechSupported ? 'Supported' : 'Not Supported'}`);
            console.log('üó£Ô∏è Voice Commands: "Hey Maiya", "Analyze business", "Change theme", "Help"');
            console.log('üéØ Test buttons available in dashboard and settings');
        });

        // ===== ERROR HANDLING =====
        window.addEventListener('error', function(e) {
            console.error('Application error:', e.error);
            showSuccessMessage('‚ö†Ô∏è An error occurred. Voice AI and your data are safe!');
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            showSuccessMessage('‚ö†Ô∏è A network error occurred. Please check your connection.');
        });
    </script>
</body>
</html>
