<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="REFIT MAINTENANCE SERVICES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f472b6">
    <meta name="msapplication-navbutton-color" content="#f472b6">
    
    <title>REFIT MAINTENANCE SERVICES - Enhanced Branding System</title>
    
    <!-- Enhanced PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, select, textarea, button {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        :root {
            /* Light Theme - Warm & Eye-Friendly with Beautiful Pastel Pink */
            --bg-primary: #fdf2f8;
            --bg-secondary: #fce7f3;
            --bg-card: #ffffff;
            --bg-card-hover: #fdf2f8;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --accent-primary: #f472b6;
            --accent-secondary: #f9a8d4;
            --accent-warm: #fbbf24;
            --accent-soft: #d8b4fe;
            --border-color: #f3e8ff;
            --shadow-light: rgba(244, 114, 182, 0.1);
            --shadow-medium: rgba(244, 114, 182, 0.2);
            --shadow-strong: rgba(244, 114, 182, 0.3);
            --overlay: rgba(45, 55, 72, 0.8);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            
            /* Enhanced Category Colors with Pink Harmony */
            --cat-electrical: #6366f1;
            --cat-plumbing: #06b6d4;
            --cat-hvac: #8b5cf6;
            --cat-cleaning: #10b981;
            --cat-parts: #f59e0b;
            --cat-labor: #ef4444;
            --cat-equipment: #6b7280;
            --cat-common: #a855f7;
            --cat-preliminary: #ec4899;
            --cat-wall: #f97316;
            --cat-floor: #a78bfa;
            --cat-ceiling: #60a5fa;
            --cat-roofing: #4f46e5;
            --cat-wetwork: #0891b2;
            --cat-me-work: #f87171;
            --cat-exhaust: #52525b;
            --cat-lights-fan: #eab308;
            --cat-ac: #14b8a6;
            --cat-paint: #ea580c;
            --cat-curtain: #c084fc;
            --cat-builtin: #818cf8;
            --cat-loose: #4ade80;
            --cat-sanitary: #3b82f6;
            --cat-appliances: #fb7185;
        }
        
        [data-theme="dark"] {
            /* Dark Theme - Reduced Blue Light with Pastel Pink */
            --bg-primary: #1f1726;
            --bg-secondary: #2d1b39;
            --bg-card: #3a2a4a;
            --bg-card-hover: #473659;
            --text-primary: #f0e7f3;
            --text-secondary: #d1bcd8;
            --text-muted: #a688b5;
            --accent-primary: #f472b6;
            --accent-secondary: #f9a8d4;
            --accent-warm: #fbbf24;
            --accent-soft: #d8b4fe;
            --border-color: #553c69;
            --shadow-light: rgba(244, 114, 182, 0.1);
            --shadow-medium: rgba(244, 114, 182, 0.2);
            --shadow-strong: rgba(244, 114, 182, 0.3);
            --overlay: rgba(0, 0, 0, 0.9);
            --success: #10b981;
            --warning: #fbbf24;
            --error: #f87171;
            --info: #60a5fa;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        /* Mobile Layout Container */
        .mobile-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 2px 10px var(--shadow-medium);
            border-bottom: 1px solid var(--border-color);
        }
        
        .status-bar .time {
            color: var(--text-primary);
        }
        
        .status-bar .indicators {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }
        
        .theme-toggle {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .theme-toggle:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 4px 20px var(--shadow-medium);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            width: 54px;
            height: 54px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 8px 25px var(--shadow-medium);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .app-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--shadow-strong);
        }
        
        .app-logo:active {
            transform: scale(0.95);
        }
        
        .logo-svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 4px var(--shadow-light));
        }
        
        .app-title h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        
        .app-title p {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.2;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            box-shadow: 0 4px 15px var(--shadow-medium);
            position: relative;
        }
        
        .header-btn:active {
            transform: scale(0.9);
        }
        
        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        /* Enhanced Branding Insert Button */
        .branding-insert-btn {
            background: linear-gradient(135deg, #ff6b9d, #c44569) !important;
            position: relative;
            overflow: hidden;
        }
        
        .branding-insert-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .branding-insert-btn:hover::before {
            left: 100%;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 130px 20px 140px;
            -webkit-overflow-scrolling: touch;
            position: relative;
            height: calc(100vh - 44px);
            scroll-behavior: smooth;
        }
        
        .main-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        /* Category System */
        .category-badge {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            display: inline-block;
            margin-right: 6px;
        }
        
        /* Enhanced Category Classes */
        .category-electrical { background: var(--cat-electrical); }
        .category-plumbing { background: var(--cat-plumbing); }
        .category-hvac { background: var(--cat-hvac); }
        .category-cleaning { background: var(--cat-cleaning); }
        .category-parts { background: var(--cat-parts); }
        .category-labor { background: var(--cat-labor); }
        .category-equipment { background: var(--cat-equipment); }
        .category-common { background: var(--cat-common); }
        .category-preliminary { background: var(--cat-preliminary); }
        .category-wall { background: var(--cat-wall); }
        .category-floor { background: var(--cat-floor); }
        .category-ceiling { background: var(--cat-ceiling); }
        .category-roofing { background: var(--cat-roofing); }
        .category-wetwork { background: var(--cat-wetwork); }
        .category-me-work { background: var(--cat-me-work); }
        .category-exhaust { background: var(--cat-exhaust); }
        .category-lights-fan { background: var(--cat-lights-fan); }
        .category-ac { background: var(--cat-ac); }
        .category-paint { background: var(--cat-paint); }
        .category-curtain { background: var(--cat-curtain); }
        .category-builtin { background: var(--cat-builtin); }
        .category-loose { background: var(--cat-loose); }
        .category-sanitary { background: var(--cat-sanitary); }
        .category-appliances { background: var(--cat-appliances); }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-medium);
            transform: translateY(-2px);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: var(--accent-primary);
            text-shadow: 0 2px 4px var(--shadow-light);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 52px;
            text-decoration: none;
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }
        
        .btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); 
            box-shadow: 0 4px 15px var(--shadow-medium);
        }
        .btn-success { 
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); 
            box-shadow: 0 4px 15px var(--shadow-medium);
        }
        .btn-danger { 
            background: linear-gradient(135deg, var(--error), #f87171); 
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        .btn-warning { 
            background: linear-gradient(135deg, var(--warning), #fed7aa); 
            box-shadow: 0 4px 15px rgba(251, 146, 60, 0.3);
        }
        .btn-info { 
            background: linear-gradient(135deg, var(--info), #f9a8d4); 
            box-shadow: 0 4px 15px rgba(244, 114, 182, 0.3);
        }
        .btn-soft { 
            background: linear-gradient(135deg, var(--accent-soft), #fecaca); 
            box-shadow: 0 4px 15px rgba(248, 180, 180, 0.3);
        }
        .btn-warm { 
            background: linear-gradient(135deg, var(--accent-warm), #fed7aa); 
            box-shadow: 0 4px 15px rgba(251, 146, 60, 0.3);
        }
        .btn-secondary { 
            background: linear-gradient(135deg, var(--text-secondary), #9ca3af); 
            box-shadow: 0 4px 15px rgba(75, 85, 99, 0.3);
        }
        
        /* Action Buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .action-btn {
            padding: 24px 20px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-height: 120px;
            box-shadow: 0 6px 20px var(--shadow-light);
        }
        
        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px var(--shadow-medium);
        }
        
        .action-btn:active {
            transform: scale(0.96);
        }
        
        .action-btn.primary { 
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); 
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        .action-btn.success { 
            background: linear-gradient(135deg, var(--success), #34d399); 
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        .action-btn.warm { 
            background: linear-gradient(135deg, var(--accent-warm), #fed7aa); 
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3);
        }
        .action-btn.soft { 
            background: linear-gradient(135deg, var(--accent-soft), #e9d5ff); 
            box-shadow: 0 8px 25px rgba(216, 180, 254, 0.3);
        }
        .action-btn.info { 
            background: linear-gradient(135deg, var(--info), #60a5fa); 
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        .action-btn.secondary { 
            background: linear-gradient(135deg, var(--text-secondary), #9ca3af); 
            box-shadow: 0 8px 25px rgba(75, 85, 99, 0.3);
        }
        .action-btn.branding {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        }
        
        .action-btn .icon {
            font-size: 32px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        /* Form Elements */
        .input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .input::placeholder {
            color: var(--text-muted);
        }
        
        .input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.15);
        }
        
        /* Search Input */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-muted);
            pointer-events: none;
        }
        
        .search-container input {
            padding-left: 56px;
        }
        
        /* Item Cards */
        .item-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px var(--shadow-medium);
            background: var(--bg-card-hover);
        }
        
        .item-card:active {
            transform: scale(0.98);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .item-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
            color: var(--text-primary);
        }
        
        /* Icon Buttons */
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .icon-btn:active {
            transform: scale(0.9);
        }
        
        .icon-btn.edit-btn { 
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); 
            color: white; 
            box-shadow: 0 4px 15px var(--shadow-medium);
        }
        .icon-btn.delete-btn { 
            background: linear-gradient(135deg, var(--error), #f87171); 
            color: white; 
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        .icon-btn.pdf-btn { 
            background: linear-gradient(135deg, var(--info), #60a5fa); 
            color: white; 
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .icon-btn.quote-btn { 
            background: linear-gradient(135deg, var(--accent-warm), #fcd34d); 
            color: white; 
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        }
        .icon-btn.share-btn { 
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); 
            color: white; 
            box-shadow: 0 4px 15px var(--shadow-medium);
        }
        .icon-btn.back-btn { 
            background: linear-gradient(135deg, var(--text-secondary), #9ca3af); 
            color: white; 
            box-shadow: 0 4px 15px rgba(75, 85, 99, 0.3);
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px 32px;
            z-index: 100;
            box-shadow: 0 -4px 20px var(--shadow-medium);
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border-radius: 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 60px;
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: rgba(248, 113, 113, 0.15);
            box-shadow: 0 2px 8px var(--shadow-light);
            transform: scale(1.05);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item .icon {
            font-size: 24px;
        }
        
        .home-indicator {
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
            width: 140px;
            margin: 12px auto 0;
            opacity: 0.8;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: flex-end;
            z-index: 200;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            color: var(--text-primary);
            animation: slideUp 0.3s ease;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            border: 1px solid var(--border-color);
            box-shadow: 0 -8px 40px var(--shadow-strong);
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
        }
        
        .close-btn:hover {
            background: var(--error);
            color: white;
            transform: scale(1.1);
        }
        
        .close-btn:active {
            transform: scale(0.9);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Form Elements in Modals */
        .form-input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .form-input::placeholder {
            color: var(--text-muted);
        }
        
        .form-input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.15);
        }
        
        .form-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .form-actions.three-col {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .form-btn {
            padding: 18px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 56px;
            box-shadow: 0 4px 15px var(--shadow-light);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }
        
        .form-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .form-btn:active {
            transform: scale(0.97);
        }
        
        .form-btn.btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }
        
        .form-btn.btn-success {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }
        
        .form-btn.btn-danger {
            background: linear-gradient(135deg, var(--error), #f87171);
        }
        
        .form-btn.btn-info {
            background: linear-gradient(135deg, var(--info), #60a5fa);
        }
        
        .form-btn.btn-warning {
            background: linear-gradient(135deg, var(--warning), #fcd34d);
        }
        
        .form-btn.btn-secondary {
            background: linear-gradient(135deg, var(--text-secondary), #9ca3af);
        }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 8px 35px var(--shadow-strong);
            z-index: 250;
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .success-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Category Selection */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .category-item {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .category-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .category-item.selected {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
            transform: scale(1.05);
        }
        
        .category-item .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .category-item .name {
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
        }
        
        /* Preset Item Selection */
        .preset-item {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .preset-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow-light);
        }
        
        .preset-item.selected {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
        }
        
        .preset-item .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .preset-item .name {
            font-weight: 700;
            font-size: 16px;
        }
        
        .preset-item .price {
            font-weight: 700;
            font-size: 16px;
            color: var(--accent-primary);
        }
        
        .preset-item.selected .price {
            color: white;
        }
        
        .preset-item .description {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        
        .preset-item.selected .description {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .preset-item .unit {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .preset-item.selected .unit {
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Enhanced Branding Styles */
        .branding-section {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            color: white;
            box-shadow: 0 8px 32px rgba(255, 107, 157, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .branding-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        
        .branding-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }
        
        .branding-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .branding-item .icon {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }
        
        .branding-item .name {
            font-size: 14px;
            font-weight: 600;
            color: white;
        }
        
        .color-picker-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 16px 0;
        }
        
        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .color-option.selected {
            border-color: white;
            transform: scale(1.15);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }
        
        .color-option::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .color-option.selected::after {
            opacity: 1;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            color: var(--text-primary);
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .file-upload:hover .file-upload-label {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .brand-preview {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            text-align: center;
            border: 2px solid var(--border-color);
        }
        
        .brand-preview .logo-preview {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
            border-radius: 16px;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .brand-preview .company-preview {
            font-weight: 700;
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .brand-preview .tagline-preview {
            font-size: 14px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Quote Detail Page */
        .quote-detail-header {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .quote-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .quote-meta {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }
        
        .quote-total {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 6px 20px var(--shadow-medium);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .quote-total .label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 4px;
        }
        
        .quote-total .amount {
            font-size: 32px;
            font-weight: 800;
        }
        
        .quote-items {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .items-header {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quote-item {
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--accent-primary);
        }
        
        .quote-item:last-child {
            margin-bottom: 0;
        }
        
        .quote-item .item-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quote-item .item-details {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .quote-item .item-pricing {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        
        .quote-item .quantity {
            color: var(--text-secondary);
        }
        
        .quote-item .price {
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        /* PDF Actions */
        .pdf-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .pdf-actions.three-col {
            grid-template-columns: repeat(3, 1fr);
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .view {
            padding-top: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .add-btn {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .add-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px var(--shadow-strong);
        }
        
        .add-btn:active {
            transform: scale(0.9);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        /* Mobile Optimizations */
        @media screen and (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .branding-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .form-actions {
                grid-template-columns: 1fr;
            }
            
            .item-actions {
                position: static;
                margin-top: 12px;
                justify-content: flex-end;
            }
            
            .item-card {
                padding-right: 20px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .header-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .pdf-actions {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .pdf-actions.three-col {
                grid-template-columns: 1fr;
            }
            
            .color-picker-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Safe area adjustments */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }
        
        /* Print styles for PDF */
        @media print {
            .status-bar,
            .header,
            .bottom-nav,
            .modal,
            .item-actions {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
                position: static !important;
                height: auto !important;
            }
            
            .main-content {
                padding: 20px !important;
                overflow: visible !important;
                height: auto !important;
            }
        }
    </style>
</head>
<body class="comfort-mode" data-theme="light">
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="status-time">9:41</div>
            <div class="indicators">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙 Dark</button>
                <span>📶</span>
                <span>📱</span>
                <span>🔋</span>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="app-logo">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="50" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="app-title">
                        <h1 id="company-name">REFIT MAINTENANCE SERVICES</h1>
                        <p id="company-registration">Registration No: 201803348973<br>(002894203-V)</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn branding-insert-btn" onclick="openBrandingInsert()" title="🎨 Branding Insert">🎨</button>
                <button class="header-btn" onclick="openCompanyInfo()" title="Company Info">👤</button>
                <button class="header-btn" onclick="exportData()" title="Export">📤</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Enhanced Branding Section -->
                <div class="branding-section">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <span style="font-size: 32px;">🎨</span>
                        <div>
                            <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 4px;">Professional Branding</h3>
                            <p style="font-size: 14px; opacity: 0.9;">Complete branding customization for your quotes</p>
                        </div>
                    </div>
                    
                    <div class="branding-grid">
                        <div class="branding-item" onclick="openBrandingInsert()">
                            <span class="icon">🎨</span>
                            <div class="name">Full Branding Suite</div>
                        </div>
                        <div class="branding-item" onclick="openLogoUpload()">
                            <span class="icon">📷</span>
                            <div class="name">Logo Upload</div>
                        </div>
                        <div class="branding-item" onclick="openColorTheme()">
                            <span class="icon">🎭</span>
                            <div class="name">Color Themes</div>
                        </div>
                        <div class="branding-item" onclick="openCompanyBranding()">
                            <span class="icon">🏢</span>
                            <div class="name">Company Info</div>
                        </div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="total-quotes-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Quote Items</div>
                        <div class="stat-value" id="total-items-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-value" id="today-revenue">RM 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="total-revenue">RM 0</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">Quick Actions</h3>
                    <div class="actions-grid">
                        <button class="action-btn primary" onclick="openCreateQuote()">
                            <span class="icon">➕</span>
                            <span style="font-weight: 700;">Create New Quote</span>
                        </button>
                        <button class="action-btn success" onclick="showView('quotes')">
                            <span class="icon">💰</span>
                            <span style="font-weight: 700;">View All Quotes</span>
                        </button>
                        <button class="action-btn branding" onclick="openBrandingInsert()">
                            <span class="icon">🎨</span>
                            <span style="font-weight: 700;">Branding Suite</span>
                        </button>
                        <button class="action-btn info" onclick="previewBranding()">
                            <span class="icon">👁️</span>
                            <span style="font-weight: 700;">Preview Branding</span>
                        </button>
                    </div>
                </div>

                <!-- Recent Quotes -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">Recent Job Quotes</h3>
                        <button style="background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; font-weight: 600;" onclick="showView('quotes')">View All</button>
                    </div>
                    <div id="recent-quotes"></div>
                </div>
            </div>

            <!-- Quotes View -->
            <div id="quotes-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Job Quotes</h2>
                    <button class="add-btn" onclick="openCreateQuote()">
                        <span>➕</span>
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="input" placeholder="Search quotes..." id="quote-search">
                </div>

                <div id="quotes-list"></div>
            </div>

            <!-- Quote Detail View -->
            <div id="quote-detail-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Quote Details</h2>
                    <button class="icon-btn back-btn" onclick="showView('quotes')">
                        ← Back
                    </button>
                </div>

                <div id="quote-detail-content"></div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="icon">🏠</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="showView('quotes')">
                    <span class="icon">💰</span>
                    <span>Quotes</span>
                </div>
                <div class="nav-item" onclick="openCreateQuote()">
                    <span class="icon">➕</span>
                    <span>Create</span>
                </div>
                <div class="nav-item" onclick="openBrandingInsert()">
                    <span class="icon">🎨</span>
                    <span>Branding</span>
                </div>
            </div>
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- Step 1: Job Title Modal -->
    <div id="job-title-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📝 Step 1: Enter Job Title</h3>
                <button class="close-btn" onclick="closeCreateQuote()">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">💼</div>
                    <p style="color: var(--text-muted); font-size: 16px;">What type of maintenance work is this quote for?</p>
                </div>
                
                <input type="text" 
                       class="form-input" 
                       placeholder="e.g., Office Renovation, AC Installation, Plumbing Repair..." 
                       id="job-title-input" 
                       style="font-size: 18px; padding: 20px 24px; text-align: center; font-weight: 600; margin-bottom: 24px;">
                
                <button type="button" 
                        class="btn btn-primary" 
                        onclick="proceedToCategory()" 
                        id="proceed-to-category-btn"
                        style="font-size: 18px; padding: 20px 32px; width: 100%;">
                    Next: Select Category ➡️
                </button>
            </div>
        </div>
    </div>

    <!-- Step 2: Category Selection Modal -->
    <div id="category-selection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🏷️ Step 2: Select Categories & Items</h3>
                <button class="close-btn" onclick="backToJobTitle()">←</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">🎯</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Choose categories and add items:</p>
                    <p style="font-weight: 700; color: var(--text-primary); margin-top: 8px;" id="selected-job-title"></p>
                </div>

                <!-- Current Quote Summary -->
                <div id="current-quote-summary" style="display: none; background: var(--bg-secondary); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 2px solid var(--accent-primary);">
                    <h4 style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>🛒</span> Current Quote (<span id="total-items-count">0</span> items)
                    </h4>
                    <div id="quote-items-preview" style="margin-bottom: 12px;"></div>
                    <div style="background: var(--accent-primary); border-radius: 12px; padding: 16px; text-align: center;">
                        <div style="font-size: 14px; font-weight: 600; color: rgba(255, 255, 255, 0.9);">Total Amount</div>
                        <div style="font-size: 24px; font-weight: 800; color: white;" id="running-total">RM 0.00</div>
                    </div>
                </div>

                <div class="category-grid" id="category-grid"></div>

                <div class="form-actions" style="margin-top: 24px;">
                    <button type="button" class="form-btn btn-primary" onclick="finalizeQuote()" id="finalize-quote-btn" disabled style="opacity: 0.5;">
                        ✅ Create Quote
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="closeCreateQuote()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 3: Item Selection Modal -->
    <div id="item-selection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📋 Step 3: Select Items</h3>
                <button class="close-btn" onclick="backToCategories()">←</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">✅</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Select work items for:</p>
                    <p style="font-weight: 700; color: var(--text-primary); margin-top: 4px;" id="category-job-title"></p>
                    <p style="color: var(--accent-primary); font-weight: 600; margin-top: 4px;" id="selected-category-display"></p>
                </div>

                <!-- Add Custom Item Button -->
                <div style="margin-bottom: 16px;">
                    <button type="button" class="btn btn-warm" onclick="openCustomItemForm()" style="width: 100%; font-size: 16px; padding: 16px;">
                        ➕ Create Custom Item
                    </button>
                </div>

                <div style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                    <div id="preset-items-list"></div>
                </div>

                <!-- Selected Items Summary -->
                <div id="selected-items-summary" style="display: none;">
                    <div style="background: var(--bg-secondary); border-radius: 16px; padding: 20px; margin: 20px 0; border: 2px solid var(--accent-primary);">
                        <h4 style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px;">Selected Items (<span id="selected-count">0</span>)</h4>
                        <div id="selected-items-list" style="margin-bottom: 16px;"></div>
                        <div style="background: var(--accent-primary); border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 14px; font-weight: 600; color: rgba(255, 255, 255, 0.9);">Category Total</div>
                            <div style="font-size: 28px; font-weight: 800; color: white;" id="category-total-amount">RM 0.00</div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Navigation Controls -->
                <div class="form-actions">
                    <button type="button" class="form-btn btn-secondary" onclick="backToCategories()">
                        ← Back
                    </button>
                    <button type="button" class="form-btn btn-primary" onclick="finishItemSelection()" id="finish-items-btn">
                        ✅ Done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Branding Insert Modal -->
    <div id="branding-insert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🎨 Complete Branding Suite</h3>
                <button class="close-btn" onclick="closeBrandingInsert()">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">🎨</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Professional branding customization for your quotes</p>
                </div>

                <!-- Branding Preview -->
                <div class="brand-preview" id="brand-preview">
                    <div class="logo-preview" id="logo-preview">
                        <!-- Logo preview will be shown here -->
                    </div>
                    <div class="company-preview" id="company-preview">REFIT MAINTENANCE SERVICES</div>
                    <div class="tagline-preview" id="tagline-preview">Professional Assistant • Ready to help</div>
                </div>

                <!-- Logo Upload Section -->
                <div style="margin-bottom: 24px;">
                    <h4 style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>📷</span> Company Logo
                    </h4>
                    <div class="file-upload" style="width: 100%;">
                        <input type="file" id="branding-logo-input" accept="image/*" onchange="handleBrandingLogoUpload(event)">
                        <label for="branding-logo-input" class="file-upload-label" style="width: 100%; justify-content: center;">
                            <span>📁</span>
                            <span>Upload Company Logo</span>
                        </label>
                    </div>
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">Recommended: Square format, Max 2MB</p>
                </div>

                <!-- Color Theme Selection -->
                <div style="margin-bottom: 24px;">
                    <h4 style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>🎭</span> Brand Colors
                    </h4>
                    <div class="color-picker-container" id="color-picker">
                        <!-- Color options will be generated here -->
                    </div>
                </div>

                <!-- Company Tagline -->
                <div style="margin-bottom: 24px;">
                    <h4 style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>✨</span> Company Tagline
                    </h4>
                    <input type="text" class="form-input" placeholder="e.g., Professional Assistant • Ready to help" id="company-tagline-input">
                </div>

                <!-- Quick Insert Buttons -->
                <div style="margin-bottom: 24px;">
                    <h4 style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>⚡</span> Quick Insert
                    </h4>
                    <div class="branding-grid">
                        <div class="branding-item" onclick="insertBrandingToQuote()">
                            <span class="icon">📄</span>
                            <div class="name">Insert to Current Quote</div>
                        </div>
                        <div class="branding-item" onclick="saveBrandingTemplate()">
                            <span class="icon">💾</span>
                            <div class="name">Save as Template</div>
                        </div>
                        <div class="branding-item" onclick="previewBrandedQuote()">
                            <span class="icon">👁️</span>
                            <div class="name">Preview Quote</div>
                        </div>
                        <div class="branding-item" onclick="exportBrandingPackage()">
                            <span class="icon">📦</span>
                            <div class="name">Export Package</div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="form-btn btn-primary" onclick="applyBranding()">
                        ✅ Apply Branding
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="closeBrandingInsert()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Company Info Modal -->
    <div id="company-info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🏢 Company Information</h3>
                <button class="close-btn" onclick="closeCompanyInfo()">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">🏢</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Update your company details for quotes</p>
                </div>

                <input type="text" class="form-input" placeholder="Company Name" id="company-name-input">
                <input type="text" class="form-input" placeholder="Registration Number" id="company-reg-input">
                <input type="text" class="form-input" placeholder="Phone Number" id="company-phone-input">
                <input type="text" class="form-input" placeholder="Email Address" id="company-email-input">
                <textarea class="form-input" placeholder="Company Address" id="company-address-input" rows="3" style="resize: none;"></textarea>

                <div class="form-actions">
                    <button type="button" class="form-btn btn-primary" onclick="saveCompanyInfo()">
                        ✅ Save Details
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="closeCompanyInfo()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Custom Item Creation Modal -->
    <div id="custom-item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>➕ Create Custom Item</h3>
                <button class="close-btn" onclick="closeCustomItemForm()">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">🛠️</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Add a custom item with pricing details</p>
                    <p style="font-weight: 700; color: var(--accent-primary); margin-top: 8px;" id="custom-item-category-display"></p>
                </div>

                <form id="custom-item-form">
                    <input type="text" 
                           class="form-input" 
                           placeholder="Item name (e.g., Custom Electrical Work)" 
                           id="custom-item-name" 
                           required
                           style="margin-bottom: 16px;">
                    
                    <textarea class="form-input" 
                              placeholder="Item description (optional)" 
                              id="custom-item-description" 
                              rows="2" 
                              style="resize: none; margin-bottom: 16px;"></textarea>
                    
                    <!-- Enhanced Pricing Section -->
                    <div style="background: var(--bg-secondary); border-radius: 16px; padding: 20px; margin-bottom: 16px;">
                        <h4 style="font-weight: 700; color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            <span>💰</span> Pricing Details
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <input type="number" 
                                   class="form-input" 
                                   placeholder="Unit Price (RM)" 
                                   id="custom-item-unit-price" 
                                   step="0.01" 
                                   min="0"
                                   required
                                   oninput="calculateCustomItemTotal()"
                                   style="margin-bottom: 0;">
                            
                            <select class="form-input" id="custom-item-unit" style="margin-bottom: 0;">
                                <option value="pcs">Pieces (pcs)</option>
                                <option value="hours">Hours</option>
                                <option value="sqft">Square Feet</option>
                                <option value="sqm">Square Meters</option>
                                <option value="meters">Meters</option>
                                <option value="kg">Kilograms</option>
                                <option value="liters">Liters</option>
                                <option value="set">Set</option>
                                <option value="lot">Lot</option>
                                <option value="service">Service</option>
                            </select>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div>
                                <label style="font-size: 14px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; display: block;">Quantity</label>
                                <input type="number" 
                                       class="form-input" 
                                       placeholder="Quantity" 
                                       id="custom-item-quantity" 
                                       min="1"
                                       value="1"
                                       required
                                       oninput="calculateCustomItemTotal()"
                                       style="margin-bottom: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 14px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; display: block;">Total Price</label>
                                <div style="background: var(--accent-primary); color: white; border-radius: 12px; padding: 18px 20px; font-weight: 700; font-size: 18px; text-align: center;" id="custom-item-total-display">
                                    RM 0.00
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="form-btn btn-secondary" onclick="closeCustomItemForm()">
                            ← Cancel
                        </button>
                        <button type="submit" class="form-btn btn-primary" id="add-custom-item-btn" disabled>
                            ➕ Add Item
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Final Review Modal -->
    <div id="final-review-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📋 Final Review</h3>
                <button class="close-btn" onclick="closeFinalReview()">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">📋</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Review your complete quote before generating PDF</p>
                </div>

                <!-- Quote Summary -->
                <div id="final-review-content">
                    <!-- Content will be populated by JavaScript -->
                </div>

                <!-- Navigation Actions -->
                <div class="form-actions three-col">
                    <button type="button" class="form-btn btn-secondary" onclick="editQuoteFromReview()">
                        ✏️ Edit
                    </button>
                    <button type="button" class="form-btn btn-warning" onclick="closeFinalReview()">
                        ← Back
                    </button>
                    <button type="button" class="form-btn btn-success" onclick="confirmAndCreateQuote()">
                        ✅ Create Quote
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Share Modal -->
    <div id="pdf-share-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📄 Share Quote</h3>
                <button class="close-btn" onclick="closePdfShare()">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">📤</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Generate and share your professional quote</p>
                </div>

                <div class="pdf-actions three-col">
                    <button type="button" class="form-btn btn-success" onclick="generateAndSharePDF()">
                        📱 Share PDF
                    </button>
                    <button type="button" class="form-btn btn-info" onclick="downloadPDF()">
                        💾 Download PDF
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="closePdfShare()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Branding Preview Modal -->
    <div id="branding-preview-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>👁️ Branding Preview</h3>
                <button class="close-btn" onclick="closeBrandingPreview()">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">📄</div>
                    <p style="color: var(--text-muted); font-size: 16px;">Preview how your branding will appear on quotes</p>
                </div>

                <div id="branding-preview-content">
                    <!-- Preview content will be generated here -->
                </div>

                <div class="form-actions">
                    <button type="button" class="form-btn btn-primary" onclick="generatePreviewPDF()">
                        📄 Generate PDF Preview
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="closeBrandingPreview()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        ✅ Action completed successfully!
    </div>

    <script>
        // ========================================
        // REFIT MAINTENANCE SERVICES - ENHANCED BRANDING SYSTEM
        // Registration No: 201803348973 (002894203-V)
        // Complete Branding Insert Suite with Professional Features
        // ========================================
        
        // App State Variables
        var currentView = 'dashboard';
        var jobQuotes = [];
        var currentQuoteData = {
            title: '',
            categories: [],
            items: [],
            totalAmount: 0
        };
        var currentQuoteId = null;
        var currentTheme = 'light';
        var currentCategory = '';
        var customLogo = null;

        // Enhanced Branding System
        var brandingData = {
            logo: null,
            primaryColor: '#f472b6',
            secondaryColor: '#f9a8d4',
            accentColor: '#fbbf24',
            tagline: 'Professional Assistant • Ready to help',
            template: 'default'
        };

        // Brand Color Themes
        var colorThemes = [
            { name: 'Pink Professional', primary: '#f472b6', secondary: '#f9a8d4', accent: '#fbbf24' },
            { name: 'Blue Corporate', primary: '#3b82f6', secondary: '#60a5fa', accent: '#fbbf24' },
            { name: 'Green Energy', primary: '#10b981', secondary: '#34d399', accent: '#f59e0b' },
            { name: 'Purple Luxury', primary: '#8b5cf6', secondary: '#a78bfa', accent: '#f59e0b' },
            { name: 'Orange Dynamic', primary: '#f97316', secondary: '#fb923c', accent: '#06b6d4' },
            { name: 'Red Bold', primary: '#ef4444', secondary: '#f87171', accent: '#10b981' },
            { name: 'Teal Modern', primary: '#14b8a6', secondary: '#5eead4', accent: '#f59e0b' },
            { name: 'Indigo Tech', primary: '#6366f1', secondary: '#818cf8', accent: '#fbbf24' }
        ];

        // Enhanced Category Configuration
        var categories = {
            // Construction Categories
            preliminary: {
                name: 'Preliminary Work',
                icon: '🏗️',
                color: 'var(--cat-preliminary)',
                description: 'Site preparation and preliminary construction work'
            },
            wall: {
                name: 'Wall Work',
                icon: '🧱',
                color: 'var(--cat-wall)',
                description: 'Wall construction, renovation and finishing'
            },
            floor: {
                name: 'Floor Work',
                icon: '🏢',
                color: 'var(--cat-floor)',
                description: 'Flooring installation and finishing'
            },
            ceiling: {
                name: 'Ceiling Work',
                icon: '🏠',
                color: 'var(--cat-ceiling)',
                description: 'Ceiling installation and finishing'
            },
            roofing: {
                name: 'Roofing',
                icon: '🏘️',
                color: 'var(--cat-roofing)',
                description: 'Roof installation and maintenance'
            },
            wetwork: {
                name: 'Wet Work',
                icon: '💧',
                color: 'var(--cat-wetwork)',
                description: 'Bathroom, kitchen and wet area work'
            },
            // M&E Categories
            'me-work': {
                name: 'M&E Work',
                icon: '⚙️',
                color: 'var(--cat-me-work)',
                description: 'Mechanical and electrical systems'
            },
            exhaust: {
                name: 'Exhaust Systems',
                icon: '🌪️',
                color: 'var(--cat-exhaust)',
                description: 'Ventilation and exhaust systems'
            },
            'lights-fan': {
                name: 'Lights & Fan',
                icon: '💡',
                color: 'var(--cat-lights-fan)',
                description: 'Lighting and fan installations'
            },
            ac: {
                name: 'AC Systems',
                icon: '❄️',
                color: 'var(--cat-ac)',
                description: 'Air conditioning systems'
            },
            // Finishing Categories
            paint: {
                name: 'Paint Works',
                icon: '🎨',
                color: 'var(--cat-paint)',
                description: 'Painting and finishing work'
            },
            curtain: {
                name: 'Curtain & Blind',
                icon: '🪟',
                color: 'var(--cat-curtain)',
                description: 'Window treatments and coverings'
            },
            // Furniture Categories
            builtin: {
                name: 'Built-in Furniture',
                icon: '🔨',
                color: 'var(--cat-builtin)',
                description: 'Custom built-in furniture and storage'
            },
            loose: {
                name: 'Loose Furniture',
                icon: '🪑',
                color: 'var(--cat-loose)',
                description: 'Movable furniture and furnishings'
            },
            // Service Categories
            sanitary: {
                name: 'Sanitary & Water Pump',
                icon: '🚿',
                color: 'var(--cat-sanitary)',
                description: 'Sanitary installations and water pump systems'
            },
            appliances: {
                name: 'Electrical Appliances',
                icon: '📺',
                color: 'var(--cat-appliances)',
                description: 'Electrical appliances and equipment'
            },
            // Legacy Categories
            electrical: {
                name: 'Electrical',
                icon: '⚡',
                color: 'var(--cat-electrical)',
                description: 'Electrical systems, wiring, and components'
            },
            plumbing: {
                name: 'Plumbing',
                icon: '🔧',
                color: 'var(--cat-plumbing)',
                description: 'Water systems, pipes, and fixtures'
            },
            hvac: {
                name: 'HVAC',
                icon: '🌡️',
                color: 'var(--cat-hvac)',
                description: 'Heating, ventilation, and air conditioning'
            },
            cleaning: {
                name: 'Cleaning',
                icon: '🧽',
                color: 'var(--cat-cleaning)',
                description: 'Cleaning services and maintenance'
            },
            parts: {
                name: 'Parts & Materials',
                icon: '🔩',
                color: 'var(--cat-parts)',
                description: 'Replacement parts and materials'
            },
            labor: {
                name: 'Labor',
                icon: '👷',
                color: 'var(--cat-labor)',
                description: 'Labor charges and work hours'
            },
            equipment: {
                name: 'Equipment',
                icon: '🛠️',
                color: 'var(--cat-equipment)',
                description: 'Tools and equipment'
            },
            common: {
                name: 'Common Items',
                icon: '🏷️',
                color: 'var(--cat-common)',
                description: 'Frequently used items'
            }
        };

        // Preset Work Items by Category
        var presetWorkItems = {
            preliminary: [
                { id: 'prelim-1', name: 'Insurance Coverage (Min 1Mil Public Liability)', description: 'Public liability insurance minimum RM1,000,000 coverage', price: 500.00, unit: 'service' },
                { id: 'prelim-2', name: 'ID Drawing Submission to Management', description: 'Interior design drawing submission to building management', price: 300.00, unit: 'service' },
                { id: 'prelim-3', name: 'Architect Professional Endorsement', description: 'Professional architect appointment with endorsed drawings', price: 2500.00, unit: 'service' },
                { id: 'prelim-4', name: 'Local Authority Submission', description: 'Submission to local council authorities for approval', price: 800.00, unit: 'service' },
                { id: 'prelim-5', name: 'Signage License Application', description: 'Application for signage license and approval', price: 400.00, unit: 'service' }
            ],
            wall: [
                { id: 'wall-1', name: 'Drywall Installation', description: 'Standard drywall installation with finishing', price: 35.00, unit: 'sqm' },
                { id: 'wall-2', name: 'Partition Wall Construction', description: 'Metal stud partition wall with drywall', price: 65.00, unit: 'sqm' },
                { id: 'wall-3', name: 'Wall Patching & Repair', description: 'Minor wall damage repair and patching', price: 25.00, unit: 'sqm' },
                { id: 'wall-4', name: 'Wall Insulation', description: 'Thermal and sound insulation installation', price: 45.00, unit: 'sqm' }
            ],
            floor: [
                { id: 'floor-1', name: 'Vinyl Flooring Installation', description: 'Commercial grade vinyl flooring', price: 45.00, unit: 'sqm' },
                { id: 'floor-2', name: 'Carpet Installation', description: 'Commercial carpet with padding', price: 55.00, unit: 'sqm' },
                { id: 'floor-3', name: 'Ceramic Tile Installation', description: 'Floor tile installation with grouting', price: 68.00, unit: 'sqm' },
                { id: 'floor-4', name: 'Laminate Flooring', description: 'High-quality laminate flooring installation', price: 52.00, unit: 'sqm' }
            ],
            ceiling: [
                { id: 'ceiling-1', name: 'Suspended Ceiling Installation', description: 'Mineral fiber suspended ceiling system', price: 42.00, unit: 'sqm' },
                { id: 'ceiling-2', name: 'Drywall Ceiling', description: 'Drywall ceiling installation and finishing', price: 38.00, unit: 'sqm' },
                { id: 'ceiling-3', name: 'Acoustic Ceiling Tiles', description: 'Sound-absorbing ceiling tile installation', price: 48.00, unit: 'sqm' }
            ],
            roofing: [
                { id: 'roofing-1', name: 'Shingle Roof Repair', description: 'Asphalt shingle replacement and repair', price: 85.00, unit: 'sqm' },
                { id: 'roofing-2', name: 'Roof Membrane Installation', description: 'Waterproof membrane application', price: 125.00, unit: 'sqm' },
                { id: 'roofing-3', name: 'Gutter Installation', description: 'Aluminum gutter system installation', price: 55.00, unit: 'meters' }
            ],
            wetwork: [
                { id: 'wetwork-1', name: 'Waterproofing Application', description: 'Bathroom and wet area waterproofing', price: 75.00, unit: 'sqm' },
                { id: 'wetwork-2', name: 'Wall Tile Installation', description: 'Ceramic wall tiles with waterproof backing', price: 85.00, unit: 'sqm' },
                { id: 'wetwork-3', name: 'Shower Cubicle Installation', description: 'Glass shower enclosure with hardware', price: 850.00, unit: 'set' }
            ],
            'me-work': [
                { id: 'me-1', name: 'Electrical Panel Installation', description: 'Main electrical distribution panel', price: 450.00, unit: 'pcs' },
                { id: 'me-2', name: 'Conduit Installation', description: 'Electrical conduit and cable management', price: 15.00, unit: 'meters' },
                { id: 'me-3', name: 'Cable Tray System', description: 'Heavy-duty cable tray installation', price: 85.00, unit: 'meters' }
            ],
            exhaust: [
                { id: 'exhaust-1', name: 'Kitchen Exhaust Installation', description: 'Commercial kitchen exhaust system', price: 850.00, unit: 'set' },
                { id: 'exhaust-2', name: 'Bathroom Exhaust Fan', description: 'Silent bathroom exhaust fan with timer', price: 165.00, unit: 'pcs' },
                { id: 'exhaust-3', name: 'Industrial Exhaust System', description: 'Heavy-duty industrial ventilation', price: 1200.00, unit: 'set' }
            ],
            'lights-fan': [
                { id: 'lights-1', name: 'LED Panel Light', description: '40W LED panel light with driver', price: 85.00, unit: 'pcs' },
                { id: 'lights-2', name: 'LED Downlight', description: '12W recessed LED downlight', price: 45.00, unit: 'pcs' },
                { id: 'lights-3', name: 'Ceiling Fan', description: '52" ceiling fan with remote control', price: 220.00, unit: 'pcs' },
                { id: 'lights-4', name: 'Track Lighting', description: 'Adjustable track lighting system', price: 180.00, unit: 'set' }
            ],
            ac: [
                { id: 'ac-1', name: 'Split AC Installation', description: '1.5HP split unit air conditioner', price: 1200.00, unit: 'set' },
                { id: 'ac-2', name: 'AC Maintenance Service', description: 'Quarterly AC cleaning and maintenance', price: 120.00, unit: 'service' },
                { id: 'ac-3', name: 'Ducted AC System', description: 'Central ducted air conditioning', price: 3500.00, unit: 'set' }
            ],
            paint: [
                { id: 'paint-1', name: 'Interior Wall Painting', description: 'Two coats premium interior paint', price: 12.00, unit: 'sqm' },
                { id: 'paint-2', name: 'Exterior Wall Painting', description: 'Weather-resistant exterior paint', price: 18.00, unit: 'sqm' },
                { id: 'paint-3', name: 'Ceiling Painting', description: 'Specialized ceiling paint application', price: 14.00, unit: 'sqm' }
            ],
            curtain: [
                { id: 'curtain-1', name: 'Fabric Curtain Installation', description: 'Custom fabric curtains with hardware', price: 85.00, unit: 'sqm' },
                { id: 'curtain-2', name: 'Vertical Blind Installation', description: 'PVC vertical blinds for offices', price: 65.00, unit: 'sqm' },
                { id: 'curtain-3', name: 'Roller Blind System', description: 'Motorized roller blind installation', price: 120.00, unit: 'sqm' }
            ],
            builtin: [
                { id: 'builtin-1', name: 'Built-in Wardrobe', description: 'Custom melamine wardrobe with drawers', price: 450.00, unit: 'sqm' },
                { id: 'builtin-2', name: 'Kitchen Cabinet', description: 'Modular kitchen cabinet system', price: 650.00, unit: 'sqm' },
                { id: 'builtin-3', name: 'Office Storage Unit', description: 'Built-in office storage solution', price: 380.00, unit: 'sqm' }
            ],
            loose: [
                { id: 'loose-1', name: 'Office Chair', description: 'Ergonomic mesh office chair', price: 250.00, unit: 'pcs' },
                { id: 'loose-2', name: 'Office Desk', description: 'Modern office desk with drawers', price: 450.00, unit: 'pcs' },
                { id: 'loose-3', name: 'Meeting Table', description: 'Conference table for 8 people', price: 850.00, unit: 'pcs' }
            ],
            sanitary: [
                { id: 'sanitary-1', name: 'Toilet Suite Installation', description: 'Complete toilet suite with accessories', price: 350.00, unit: 'set' },
                { id: 'sanitary-2', name: 'Wash Basin Installation', description: 'Wall-hung basin with mixer tap', price: 280.00, unit: 'set' },
                { id: 'sanitary-3', name: 'Water Pump System', description: 'Automatic water pump installation', price: 680.00, unit: 'set' }
            ],
            appliances: [
                { id: 'appliances-1', name: 'Electric Water Heater', description: '30L instant electric water heater', price: 380.00, unit: 'pcs' },
                { id: 'appliances-2', name: 'Range Hood Installation', description: 'Kitchen range hood with ducting', price: 450.00, unit: 'pcs' },
                { id: 'appliances-3', name: 'Dishwasher Installation', description: 'Built-in dishwasher setup', price: 320.00, unit: 'pcs' }
            ],
            electrical: [
                { id: 'electrical-1', name: 'Power Outlet Installation', description: 'Standard 13A power outlet', price: 45.00, unit: 'pcs' },
                { id: 'electrical-2', name: 'Light Switch Installation', description: 'Standard wall switch installation', price: 35.00, unit: 'pcs' },
                { id: 'electrical-3', name: 'Electrical Safety Inspection', description: 'Complete electrical system safety check', price: 150.00, unit: 'service' }
            ],
            plumbing: [
                { id: 'plumbing-1', name: 'Pipe Repair Service', description: 'Water pipe leak repair', price: 65.00, unit: 'service' },
                { id: 'plumbing-2', name: 'Faucet Installation', description: 'Kitchen or bathroom faucet setup', price: 85.00, unit: 'pcs' },
                { id: 'plumbing-3', name: 'Drain Cleaning', description: 'Professional drain cleaning service', price: 95.00, unit: 'service' }
            ],
            hvac: [
                { id: 'hvac-1', name: 'HVAC Filter Replacement', description: 'Air filter replacement service', price: 35.00, unit: 'pcs' },
                { id: 'hvac-2', name: 'Duct Cleaning', description: 'Professional ductwork cleaning', price: 180.00, unit: 'service' },
                { id: 'hvac-3', name: 'Thermostat Installation', description: 'Digital thermostat setup', price: 125.00, unit: 'pcs' }
            ],
            cleaning: [
                { id: 'cleaning-1', name: 'Office Cleaning Service', description: 'Standard office cleaning', price: 25.00, unit: 'sqm' },
                { id: 'cleaning-2', name: 'Deep Cleaning Service', description: 'Comprehensive deep cleaning', price: 35.00, unit: 'sqm' },
                { id: 'cleaning-3', name: 'Window Cleaning', description: 'Professional window cleaning', price: 8.00, unit: 'sqm' }
            ],
            parts: [
                { id: 'parts-1', name: 'Electrical Wire', description: 'Standard electrical wiring cable', price: 8.50, unit: 'meters' },
                { id: 'parts-2', name: 'PVC Pipe', description: 'Standard PVC water pipe', price: 12.00, unit: 'meters' },
                { id: 'parts-3', name: 'Hardware Kit', description: 'Assorted screws and fasteners', price: 25.00, unit: 'set' }
            ],
            labor: [
                { id: 'labor-1', name: 'Skilled Technician', description: 'Certified technician work hour', price: 45.00, unit: 'hours' },
                { id: 'labor-2', name: 'Helper Labor', description: 'General helper work hour', price: 25.00, unit: 'hours' },
                { id: 'labor-3', name: 'Specialist Labor', description: 'Specialized technician work hour', price: 65.00, unit: 'hours' }
            ],
            equipment: [
                { id: 'equipment-1', name: 'Power Drill Rental', description: 'Professional power drill rental', price: 35.00, unit: 'hours' },
                { id: 'equipment-2', name: 'Scaffolding Rental', description: 'Mobile scaffolding system rental', price: 85.00, unit: 'days' },
                { id: 'equipment-3', name: 'Generator Rental', description: 'Portable generator rental', price: 120.00, unit: 'days' }
            ],
            common: [
                { id: 'common-1', name: 'Service Call Fee', description: 'Basic service call charge', price: 75.00, unit: 'service' },
                { id: 'common-2', name: 'Material Transport', description: 'Material delivery and transport', price: 50.00, unit: 'trip' },
                { id: 'common-3', name: 'Site Survey', description: 'Professional site assessment', price: 150.00, unit: 'service' }
            ]
        };

        // Company Settings (simplified)
        var companyInfo = {
            name: 'REFIT MAINTENANCE SERVICES',
            registration: '201803348973 (002894203-V)',
            phone: '+60 3-7967 8888',
            email: 'info@refitmaintenance.my',
            address: 'No. 15, Jalan Teknologi 3/6, Kota Damansara, 47810 Petaling Jaya, Selangor, Malaysia'
        };

        // Storage Keys
        var STORAGE_KEYS = {
            JOB_QUOTES: 'refit_enhanced_quotes',
            THEME_PREFERENCE: 'refit_theme_preference',
            COMPANY_INFO: 'refit_company_info',
            CUSTOM_LOGO: 'refit_custom_logo',
            BRANDING_DATA: 'refit_branding_data'
        };

        // Theme Management Functions
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '🌸 Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#f472b6' : '#1f1726';
            }
            
            saveDataToStorage();
            showSuccessMessage(currentTheme === 'light' ? '🌸 Beautiful Pink Light Mode!' : '🌙 Dark Pink Mode Activated!');
        }

        function loadThemePreference() {
            var savedTheme = JSON.parse(localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) || 'light';
            
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) {
                savedTheme = 'dark';
            }
            
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '🌸 Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#f472b6' : '#1f1726';
            }
        }

        // Data Management Functions
        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.JOB_QUOTES, JSON.stringify(jobQuotes));
                localStorage.setItem(STORAGE_KEYS.THEME_PREFERENCE, JSON.stringify(currentTheme));
                localStorage.setItem(STORAGE_KEYS.COMPANY_INFO, JSON.stringify(companyInfo));
                localStorage.setItem(STORAGE_KEYS.BRANDING_DATA, JSON.stringify(brandingData));
                if (customLogo) {
                    localStorage.setItem(STORAGE_KEYS.CUSTOM_LOGO, customLogo);
                } else {
                    localStorage.removeItem(STORAGE_KEYS.CUSTOM_LOGO);
                }
            } catch (e) {
                console.warn('Storage error:', e);
                showSuccessMessage('⚠️ Storage full! Please export data.');
            }
        }

        function loadDataFromStorage() {
            try {
                var savedQuotes = localStorage.getItem(STORAGE_KEYS.JOB_QUOTES);
                if (savedQuotes) {
                    jobQuotes = JSON.parse(savedQuotes);
                }
                
                var savedCompanyInfo = localStorage.getItem(STORAGE_KEYS.COMPANY_INFO);
                if (savedCompanyInfo) {
                    companyInfo = Object.assign(companyInfo, JSON.parse(savedCompanyInfo));
                    updateHeaderDisplay();
                }
                
                var savedBrandingData = localStorage.getItem(STORAGE_KEYS.BRANDING_DATA);
                if (savedBrandingData) {
                    brandingData = Object.assign(brandingData, JSON.parse(savedBrandingData));
                    updateBrandingDisplay();
                }
                
                var savedLogo = localStorage.getItem(STORAGE_KEYS.CUSTOM_LOGO);
                if (savedLogo) {
                    customLogo = savedLogo;
                    brandingData.logo = savedLogo;
                    updateHeaderLogo();
                }
            } catch (e) {
                console.warn('Load error:', e);
                jobQuotes = [];
            }
        }

        function updateHeaderDisplay() {
            document.getElementById('company-name').textContent = companyInfo.name;
            document.getElementById('company-registration').innerHTML = 
                'Registration No: ' + companyInfo.registration.split('(')[0].trim() + '<br>(' + 
                (companyInfo.registration.includes('(') ? companyInfo.registration.split('(')[1] : ')');
        }

        function updateBrandingDisplay() {
            // Update brand preview if modal is open
            if (document.getElementById('branding-insert-modal').classList.contains('show')) {
                updateBrandPreview();
            }
        }

        // Enhanced Branding Insert Functions
        function openBrandingInsert() {
            renderColorPicker();
            updateBrandPreview();
            
            // Load current values
            document.getElementById('company-tagline-input').value = brandingData.tagline;
            
            document.getElementById('branding-insert-modal').classList.add('show');
            showSuccessMessage('🎨 Professional branding suite opened');
        }

        function closeBrandingInsert() {
            document.getElementById('branding-insert-modal').classList.remove('show');
        }

        function renderColorPicker() {
            var container = document.getElementById('color-picker');
            if (!container) return;
            
            var html = '';
            for (var i = 0; i < colorThemes.length; i++) {
                var theme = colorThemes[i];
                var isSelected = brandingData.primaryColor === theme.primary;
                
                html += '<div class="color-option' + (isSelected ? ' selected' : '') + '" ' +
                    'onclick="selectColorTheme(\'' + theme.primary + '\', \'' + theme.secondary + '\', \'' + theme.accent + '\')" ' +
                    'style="background: linear-gradient(135deg, ' + theme.primary + ', ' + theme.secondary + ');" ' +
                    'title="' + theme.name + '">' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function selectColorTheme(primary, secondary, accent) {
            brandingData.primaryColor = primary;
            brandingData.secondaryColor = secondary;
            brandingData.accentColor = accent;
            
            renderColorPicker();
            updateBrandPreview();
            saveDataToStorage();
            
            showSuccessMessage('🎭 Color theme applied: ' + getThemeName(primary));
        }

        function getThemeName(primaryColor) {
            for (var i = 0; i < colorThemes.length; i++) {
                if (colorThemes[i].primary === primaryColor) {
                    return colorThemes[i].name;
                }
            }
            return 'Custom';
        }

        function updateBrandPreview() {
            var logoPreview = document.getElementById('logo-preview');
            var companyPreview = document.getElementById('company-preview');
            var taglinePreview = document.getElementById('tagline-preview');
            
            if (!logoPreview || !companyPreview || !taglinePreview) return;
            
            // Update logo
            if (brandingData.logo) {
                logoPreview.innerHTML = '<img src="' + brandingData.logo + '" style="width: 100%; height: 100%; object-fit: cover; border-radius: 16px;" alt="Company Logo">';
            } else {
                logoPreview.innerHTML = '<svg style="width: 40px; height: 40px; color: white;" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">' +
                    '<path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor"/>' +
                    '<path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor"/>' +
                    '</svg>';
            }
            
            // Update colors
            logoPreview.style.background = 'linear-gradient(135deg, ' + brandingData.primaryColor + ', ' + brandingData.secondaryColor + ')';
            companyPreview.textContent = companyInfo.name;
            taglinePreview.textContent = brandingData.tagline;
        }

        function handleBrandingLogoUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showSuccessMessage('⚠️ File too large! Please choose an image under 2MB');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('⚠️ Please select a valid image file');
                return;
            }
            
            var reader = new FileReader();
            reader.onload = function(e) {
                brandingData.logo = e.target.result;
                customLogo = e.target.result;
                updateBrandPreview();
                updateHeaderLogo();
                saveDataToStorage();
                showSuccessMessage('✅ Logo uploaded and applied to branding!');
            };
            reader.readAsDataURL(file);
        }

        function updateHeaderLogo() {
            var logoContainer = document.querySelector('.app-logo');
            if (!logoContainer) return;
            
            if (customLogo) {
                logoContainer.innerHTML = '<img src="' + customLogo + '" style="width: 100%; height: 100%; object-fit: cover; border-radius: 14px;" alt="Company Logo">';
            } else {
                logoContainer.innerHTML = '<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">' +
                    '<path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>' +
                    '<path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>' +
                    '<circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>' +
                    '<circle cx="50" cy="50" r="3" fill="currentColor"/>' +
                    '</svg>';
            }
        }

        function applyBranding() {
            // Update tagline
            brandingData.tagline = document.getElementById('company-tagline-input').value.trim() || brandingData.tagline;
            
            // Save branding data
            saveDataToStorage();
            
            // Update brand preview
            updateBrandPreview();
            
            closeBrandingInsert();
            showSuccessMessage('✅ Professional branding applied successfully!');
        }

        // Quick Branding Action Functions
        function openLogoUpload() {
            document.getElementById('branding-logo-input').click();
        }

        function openColorTheme() {
            openBrandingInsert();
            // Auto-scroll to color section
            setTimeout(function() {
                var colorSection = document.getElementById('color-picker');
                if (colorSection) {
                    colorSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 300);
        }

        function openCompanyBranding() {
            openCompanyInfo();
        }

        function insertBrandingToQuote() {
            if (!currentQuoteId) {
                showSuccessMessage('⚠️ Please create or select a quote first');
                return;
            }
            
            var quote = jobQuotes.find(function(q) { return q.id === currentQuoteId; });
            if (!quote) {
                showSuccessMessage('⚠️ Quote not found');
                return;
            }
            
            // Apply branding to current quote
            quote.branding = Object.assign({}, brandingData);
            saveDataToStorage();
            
            showSuccessMessage('✅ Branding inserted to current quote');
        }

        function saveBrandingTemplate() {
            brandingData.template = 'custom_' + Date.now();
            saveDataToStorage();
            showSuccessMessage('💾 Branding template saved');
        }

        function previewBrandedQuote() {
            closeBrandingInsert();
            setTimeout(function() {
                previewBranding();
            }, 300);
        }

        function exportBrandingPackage() {
            var brandingPackage = {
                branding: brandingData,
                company: companyInfo,
                logo: customLogo,
                timestamp: new Date().toISOString(),
                version: 'Enhanced Branding Suite 1.0'
            };
            
            var dataStr = JSON.stringify(brandingPackage, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            var link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'REFIT_Branding_Package_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showSuccessMessage('📦 Branding package exported successfully!');
        }

        function previewBranding() {
            document.getElementById('branding-preview-modal').classList.add('show');
            
            var content = document.getElementById('branding-preview-content');
            if (!content) return;
            
            var html = '<div style="background: white; border-radius: 16px; padding: 24px; border: 1px solid #e5e7eb; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">' +
                // Header with branding
                '<div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid ' + brandingData.primaryColor + ';">' +
                '<div style="width: 60px; height: 60px; border-radius: 12px; background: linear-gradient(135deg, ' + brandingData.primaryColor + ', ' + brandingData.secondaryColor + '); display: flex; align-items: center; justify-content: center; color: white;">';
            
            if (brandingData.logo) {
                html += '<img src="' + brandingData.logo + '" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;" alt="Logo">';
            } else {
                html += '<svg style="width: 30px; height: 30px;" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">' +
                    '<path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor"/>' +
                    '<path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor"/>' +
                    '</svg>';
            }
            
            html += '</div>' +
                '<div>' +
                '<h2 style="font-size: 20px; font-weight: 800; color: #1f2937; margin: 0;">' + companyInfo.name + '</h2>' +
                '<p style="font-size: 14px; color: #6b7280; margin: 4px 0 0 0;">' + companyInfo.registration + '</p>' +
                '<p style="font-size: 12px; color: ' + brandingData.primaryColor + '; font-weight: 600; margin: 4px 0 0 0;">' + brandingData.tagline + '</p>' +
                '</div>' +
                '</div>' +
                
                // Sample quote content
                '<div style="margin-bottom: 20px;">' +
                '<h3 style="font-size: 18px; font-weight: 700; color: #1f2937; margin-bottom: 8px;">JOB QUOTE PREVIEW</h3>' +
                '<p style="font-size: 14px; color: #6b7280;">Quote #12345 • Date: ' + new Date().toLocaleDateString() + '</p>' +
                '<p style="font-size: 16px; font-weight: 600; color: #1f2937; margin-top: 8px;">Office Renovation Project</p>' +
                '</div>' +
                
                // Sample items
                '<div style="background: #f9fafb; border-radius: 12px; padding: 16px; margin-bottom: 20px;">' +
                '<h4 style="font-size: 16px; font-weight: 700; color: #1f2937; margin-bottom: 12px;">Quote Items</h4>' +
                '<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">' +
                '<span style="font-size: 14px; color: #374151;">Wall Painting (Interior)</span>' +
                '<span style="font-size: 14px; font-weight: 600; color: ' + brandingData.primaryColor + ';">RM 1,200.00</span>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">' +
                '<span style="font-size: 14px; color: #374151;">Electrical Installation</span>' +
                '<span style="font-size: 14px; font-weight: 600; color: ' + brandingData.primaryColor + ';">RM 850.00</span>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0;">' +
                '<span style="font-size: 14px; color: #374151;">AC System Installation</span>' +
                '<span style="font-size: 14px; font-weight: 600; color: ' + brandingData.primaryColor + ';">RM 3,500.00</span>' +
                '</div>' +
                '</div>' +
                
                // Total section
                '<div style="background: linear-gradient(135deg, ' + brandingData.primaryColor + ', ' + brandingData.secondaryColor + '); color: white; border-radius: 12px; padding: 20px; text-align: center;">' +
                '<p style="font-size: 14px; margin: 0; opacity: 0.9;">Total Quote Amount</p>' +
                '<p style="font-size: 28px; font-weight: 800; margin: 8px 0 0 0;">RM 5,550.00</p>' +
                '</div>' +
                
                // Footer
                '<div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e5e7eb; text-align: center;">' +
                '<p style="font-size: 12px; color: #6b7280; margin: 0;">Thank you for choosing ' + companyInfo.name + '</p>' +
                '<p style="font-size: 12px; color: #6b7280; margin: 4px 0 0 0;">Contact: ' + companyInfo.phone + ' • ' + companyInfo.email + '</p>' +
                '</div>' +
                '</div>';
            
            content.innerHTML = html;
            showSuccessMessage('👁️ Branding preview generated');
        }

        function closeBrandingPreview() {
            document.getElementById('branding-preview-modal').classList.remove('show');
        }

        function generatePreviewPDF() {
            showSuccessMessage('📄 Generating branded PDF preview...');
            
            var { jsPDF } = window.jspdf;
            var doc = new jsPDF();
            
            try {
                // Header with custom branding
                doc.setFillColor(hexToRgb(brandingData.primaryColor).r, hexToRgb(brandingData.primaryColor).g, hexToRgb(brandingData.primaryColor).b);
                doc.rect(0, 0, 210, 35, 'F');
                
                // Logo
                if (brandingData.logo) {
                    try {
                        doc.addImage(brandingData.logo, 'JPEG', 15, 8, 20, 20);
                    } catch (logoError) {
                        console.warn('Logo embedding failed:', logoError);
                    }
                }
                
                // Company info in white
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text(companyInfo.name, 45, 18);
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(companyInfo.registration, 45, 25);
                doc.text(brandingData.tagline, 45, 30);
                
                // Reset text color
                doc.setTextColor(0, 0, 0);
                
                // Quote content
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('PROFESSIONAL QUOTE PREVIEW', 20, 50);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text('Quote #: PREVIEW-' + Date.now(), 20, 65);
                doc.text('Date: ' + new Date().toLocaleDateString(), 20, 75);
                doc.text('Project: Office Renovation with Custom Branding', 20, 85);
                
                // Items
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('QUOTE ITEMS', 20, 105);
                
                var items = [
                    { name: 'Wall Painting (Interior)', price: 1200.00 },
                    { name: 'Electrical Installation', price: 850.00 },
                    { name: 'AC System Installation', price: 3500.00 }
                ];
                
                var yPos = 120;
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                
                for (var i = 0; i < items.length; i++) {
                    doc.text(items[i].name, 20, yPos);
                    doc.text('RM ' + items[i].price.toFixed(2), 150, yPos);
                    yPos += 10;
                }
                
                // Total with brand color
                yPos += 10;
                doc.setFillColor(hexToRgb(brandingData.primaryColor).r, hexToRgb(brandingData.primaryColor).g, hexToRgb(brandingData.primaryColor).b);
                doc.rect(20, yPos - 5, 170, 20, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('TOTAL AMOUNT: RM 5,550.00', 25, yPos + 7);
                
                // Footer
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text('Thank you for choosing ' + companyInfo.name, 20, yPos + 35);
                doc.text('Contact: ' + companyInfo.phone + ' • ' + companyInfo.email, 20, yPos + 45);
                
                // Download
                doc.save('REFIT_Branded_Quote_Preview.pdf');
                showSuccessMessage('📄 Branded PDF preview downloaded!');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showSuccessMessage('❌ Error generating PDF preview');
            }
        }

        function hexToRgb(hex) {
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 244, g: 114, b: 182 }; // fallback to pink
        }

        // Enhanced Create Quote Flow Functions
        function openCreateQuote() {
            currentQuoteData = {
                title: '',
                categories: [],
                items: [],
                totalAmount: 0
            };
            
            document.getElementById('job-title-input').value = '';
            document.getElementById('job-title-modal').classList.add('show');
            showSuccessMessage('📝 Starting enhanced quote creation');
        }

        function closeCreateQuote() {
            document.getElementById('job-title-modal').classList.remove('show');
            document.getElementById('category-selection-modal').classList.remove('show');
            document.getElementById('item-selection-modal').classList.remove('show');
            
            currentQuoteData = {
                title: '',
                categories: [],
                items: [],
                totalAmount: 0
            };
            currentCategory = '';
        }

        function proceedToCategory() {
            var title = document.getElementById('job-title-input').value.trim();
            
            if (!title) {
                showSuccessMessage('⚠️ Please enter a job title');
                return;
            }
            
            currentQuoteData.title = title;
            document.getElementById('selected-job-title').textContent = title;
            
            document.getElementById('job-title-modal').classList.remove('show');
            
            renderCategories();
            updateQuoteSummaryDisplay();
            
            document.getElementById('category-selection-modal').classList.add('show');
            showSuccessMessage('✅ Job title saved: ' + title);
        }

        function backToJobTitle() {
            document.getElementById('category-selection-modal').classList.remove('show');
            document.getElementById('job-title-modal').classList.add('show');
        }

        function renderCategories() {
            var container = document.getElementById('category-grid');
            if (!container) return;
            
            var html = '';
            
            for (var categoryKey in categories) {
                var category = categories[categoryKey];
                var hasItems = currentQuoteData.items.some(function(item) { 
                    return item.category === categoryKey; 
                });
                
                html += '<div class="category-item' + (hasItems ? ' selected' : '') + '" onclick="selectCategoryForItems(\'' + categoryKey + '\')" data-category="' + categoryKey + '">' +
                    '<div class="icon">' + category.icon + '</div>' +
                    '<div class="name">' + category.name + '</div>' +
                    (hasItems ? '<div style="font-size: 10px; color: rgba(255,255,255,0.8); margin-top: 4px;">✓ Items Added</div>' : '') +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function selectCategoryForItems(categoryKey) {
            currentCategory = categoryKey;
            
            document.getElementById('category-job-title').textContent = currentQuoteData.title;
            document.getElementById('selected-category-display').textContent = categories[categoryKey].name;
            
            document.getElementById('category-selection-modal').classList.remove('show');
            
            renderPresetItems();
            
            document.getElementById('item-selection-modal').classList.add('show');
            showSuccessMessage('✅ Selecting items for: ' + categories[categoryKey].name);
        }

        function backToCategories() {
            document.getElementById('item-selection-modal').classList.remove('show');
            
            renderCategories();
            updateQuoteSummaryDisplay();
            
            document.getElementById('category-selection-modal').classList.add('show');
            showSuccessMessage('⬅️ Back to category selection');
        }

        function updateQuoteSummaryDisplay() {
            var summaryContainer = document.getElementById('current-quote-summary');
            var itemsCountElement = document.getElementById('total-items-count');
            var previewElement = document.getElementById('quote-items-preview');
            var totalElement = document.getElementById('running-total');
            var finalizeBtn = document.getElementById('finalize-quote-btn');
            
            if (currentQuoteData.items.length === 0) {
                summaryContainer.style.display = 'none';
                finalizeBtn.disabled = true;
                finalizeBtn.style.opacity = '0.5';
                return;
            }
            
            summaryContainer.style.display = 'block';
            finalizeBtn.disabled = false;
            finalizeBtn.style.opacity = '1';
            
            itemsCountElement.textContent = currentQuoteData.items.length;
            
            var categoryGroups = {};
            var totalAmount = 0;
            
            for (var i = 0; i < currentQuoteData.items.length; i++) {
                var item = currentQuoteData.items[i];
                var itemCategory = item.category || 'common';
                totalAmount += item.total;
                
                if (!categoryGroups[itemCategory]) {
                    categoryGroups[itemCategory] = [];
                }
                categoryGroups[itemCategory].push(item);
            }
            
            var html = '';
            for (var catKey in categoryGroups) {
                var catItems = categoryGroups[catKey];
                var catTotal = catItems.reduce(function(sum, item) { return sum + item.total; }, 0);
                
                html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--bg-card); border-radius: 8px; margin-bottom: 6px; border-left: 4px solid var(--accent-primary);">' +
                    '<div>' +
                    '<div style="font-weight: 600; color: var(--text-primary); font-size: 13px;">' + categories[catKey].icon + ' ' + categories[catKey].name + '</div>' +
                    '<div style="font-size: 11px; color: var(--text-muted);">' + catItems.length + ' items</div>' +
                    '</div>' +
                    '<div style="font-weight: 700; color: var(--accent-primary); font-size: 14px;">RM ' + catTotal.toFixed(2) + '</div>' +
                    '</div>';
            }
            
            previewElement.innerHTML = html;
            totalElement.textContent = 'RM ' + totalAmount.toFixed(2);
            currentQuoteData.totalAmount = totalAmount;
            
            var uniqueCategories = Object.keys(categoryGroups);
            currentQuoteData.categories = uniqueCategories;
        }

        function finalizeQuote() {
            if (currentQuoteData.items.length === 0) {
                showSuccessMessage('⚠️ Please add at least one item to the quote');
                return;
            }
            
            var quote = {
                id: Date.now(),
                title: currentQuoteData.title,
                categories: [...currentQuoteData.categories],
                items: [...currentQuoteData.items],
                totalAmount: currentQuoteData.totalAmount,
                branding: Object.assign({}, brandingData),
                createdAt: new Date().toISOString()
            };
            
            jobQuotes.push(quote);
            currentQuoteId = quote.id;
            
            saveDataToStorage();
            closeCreateQuote();
            showQuoteDetail(quote.id);
            
            showSuccessMessage('✅ Multi-category quote with branding created!');
        }

        function renderPresetItems() {
            var container = document.getElementById('preset-items-list');
            if (!container) return;
            
            var categoryItems = presetWorkItems[currentCategory] || [];
            var html = '';
            
            // Show custom items for this category first
            var customItems = currentQuoteData.items.filter(function(item) { 
                return item.isCustom && item.category === currentCategory; 
            });
            
            if (customItems.length > 0) {
                html += '<div style="margin-bottom: 20px;">' +
                    '<div style="font-weight: 700; color: var(--accent-warm); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">' +
                    '<span style="font-size: 20px;">🛠️</span>' +
                    '<span>Custom Items (' + customItems.length + ')</span>' +
                    '</div>';
                
                for (var i = 0; i < customItems.length; i++) {
                    var item = customItems[i];
                    html += '<div class="preset-item selected" onclick="togglePresetItem(\'' + item.id + '\')" data-item-id="' + item.id + '">' +
                        '<div class="header">' +
                        '<div class="name">🛠️ ' + item.name + '</div>' +
                        '<div class="price">RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                        '</div>' +
                        '<div class="description">' + item.description + '</div>' +
                        '<div class="unit">Per ' + item.unit + ' • Custom Item</div>' +
                        '</div>';
                }
                html += '</div>';
            }
            
            if (categoryItems.length === 0) {
                if (customItems.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);">' +
                        '<div style="font-size: 48px; margin-bottom: 16px;">📦</div>' +
                        '<p style="font-weight: 600;">No preset items available</p>' +
                        '<p style="font-size: 14px; margin-top: 8px;">Create custom items for this category</p>' +
                        '</div>';
                } else {
                    container.innerHTML = html;
                }
                updateSelectedItemsSummary();
                return;
            }
            
            if (categoryItems.length > 0) {
                html += '<div style="margin-bottom: 12px;">' +
                    '<div style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">' +
                    '<span style="font-size: 20px;">' + categories[currentCategory].icon + '</span>' +
                    '<span>Preset Items (' + categoryItems.length + ')</span>' +
                    '</div>';
            }
            
            for (var i = 0; i < categoryItems.length; i++) {
                var item = categoryItems[i];
                var isSelected = currentQuoteData.items.some(function(selectedItem) {
                    return selectedItem.id === item.id && selectedItem.category === currentCategory && !selectedItem.isCustom;
                });
                
                html += '<div class="preset-item' + (isSelected ? ' selected' : '') + '" onclick="togglePresetItem(\'' + item.id + '\')" data-item-id="' + item.id + '">' +
                    '<div class="header">' +
                    '<div class="name">' + item.name + '</div>' +
                    '<div class="price">RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                    '</div>' +
                    '<div class="description">' + item.description + '</div>' +
                    '<div class="unit">Per ' + item.unit + '</div>' +
                    '</div>';
            }
            
            if (categoryItems.length > 0) {
                html += '</div>';
            }
            
            container.innerHTML = html;
            updateSelectedItemsSummary();
        }

        function togglePresetItem(itemId) {
            var existingIndex = currentQuoteData.items.findIndex(function(selectedItem) {
                return selectedItem.id === itemId && selectedItem.category === currentCategory;
            });
            
            if (existingIndex !== -1) {
                var removedItem = currentQuoteData.items[existingIndex];
                currentQuoteData.items.splice(existingIndex, 1);
                showSuccessMessage('➖ Removed: ' + removedItem.name);
                renderPresetItems();
                return;
            }
            
            var categoryItems = presetWorkItems[currentCategory] || [];
            var item = categoryItems.find(function(item) { return item.id === itemId; });
            
            if (!item) return;
            
            var selectedItem = {
                id: item.id,
                name: item.name,
                description: item.description,
                price: item.price,
                unit: item.unit,
                quantity: 1,
                total: item.price,
                category: currentCategory,
                isCustom: false
            };
            
            currentQuoteData.items.push(selectedItem);
            showSuccessMessage('✅ Added: ' + item.name);
            
            renderPresetItems();
        }

        function updateSelectedItemsSummary() {
            var summaryContainer = document.getElementById('selected-items-summary');
            var countElement = document.getElementById('selected-count');
            var listElement = document.getElementById('selected-items-list');
            var totalElement = document.getElementById('category-total-amount');
            
            var categoryItems = currentQuoteData.items.filter(function(item) {
                return item.category === currentCategory;
            });
            
            if (categoryItems.length === 0) {
                summaryContainer.style.display = 'none';
                return;
            }
            
            summaryContainer.style.display = 'block';
            countElement.textContent = categoryItems.length;
            
            var categoryTotal = 0;
            var html = '';
            
            for (var i = 0; i < categoryItems.length; i++) {
                var item = categoryItems[i];
                categoryTotal += item.total;
                
                html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--bg-card); border-radius: 8px; margin-bottom: 8px; border-left: 4px solid var(--accent-primary);">' +
                    '<div>' +
                    '<div style="font-weight: 600; color: var(--text-primary); font-size: 14px;">' + 
                    (item.isCustom ? '🛠️ ' : '') + item.name + 
                    (item.isCustom ? ' (Custom)' : '') + '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted);">1 ' + item.unit + '</div>' +
                    '</div>' +
                    '<div style="font-weight: 700; color: var(--accent-primary);">RM ' + item.total.toFixed(2) + '</div>' +
                    '</div>';
            }
            
            listElement.innerHTML = html;
            totalElement.textContent = 'RM ' + categoryTotal.toFixed(2);
        }

        function finishItemSelection() {
            backToCategories();
            showSuccessMessage('✅ Items added to quote. Select another category or finalize quote.');
        }

        // Custom Item Creation Functions
        function openCustomItemForm() {
            document.getElementById('custom-item-form').reset();
            document.getElementById('custom-item-modal').classList.add('show');
            showSuccessMessage('➕ Creating custom item for: ' + categories[currentCategory].name);
        }

        function closeCustomItemForm() {
            document.getElementById('custom-item-modal').classList.remove('show');
        }

        function handleCustomItemSubmit(e) {
            e.preventDefault();
            
            var name = document.getElementById('custom-item-name').value.trim();
            var description = document.getElementById('custom-item-description').value.trim();
            var price = parseFloat(document.getElementById('custom-item-price').value);
            var unit = document.getElementById('custom-item-unit').value;
            
            if (!name || !price || price <= 0) {
                showSuccessMessage('⚠️ Please fill in item name and valid price');
                return;
            }
            
            var customItem = {
                id: 'custom-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                name: name,
                description: description || 'Custom item for ' + currentQuoteData.title,
                price: price,
                unit: unit,
                quantity: 1,
                total: price,
                category: currentCategory,
                isCustom: true
            };
            
            currentQuoteData.items.push(customItem);
            
            closeCustomItemForm();
            renderPresetItems();
            updateSelectedItemsSummary();
            
            showSuccessMessage('✅ Custom item added: ' + name);
        }

        // Quote Detail and Management Functions
        function showQuoteDetail(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            currentQuoteId = quoteId;
            renderQuoteDetail(quote);
            showView('quote-detail');
        }

        function renderQuoteDetail(quote) {
            var container = document.getElementById('quote-detail-content');
            if (!container) return;
            
            var html = '';
            
            var categoriesText = quote.categories ? quote.categories.map(function(cat) { 
                return categories[cat] ? categories[cat].name : cat; 
            }).join(', ') : (quote.category ? categories[quote.category].name : 'Multiple');
            
            html += '<div class="quote-detail-header">' +
                '<div class="quote-title">' + quote.title + '</div>' +
                '<div class="quote-meta">📅 Created: ' + formatDate(quote.createdAt) + ' • 🏷️ Categories: ' + categoriesText + '</div>' +
                '<div class="quote-total">' +
                '<div class="label">Total Quote Amount</div>' +
                '<div class="amount">RM ' + quote.totalAmount.toFixed(2) + '</div>' +
                '</div>' +
                '</div>';
            
            html += '<div class="quote-items">' +
                '<div class="items-header">' +
                '<span>📋</span> Quote Items (' + quote.items.length + ')' +
                '</div>';
            
            var itemsByCategory = {};
            for (var i = 0; i < quote.items.length; i++) {
                var item = quote.items[i];
                var itemCategory = item.category || quote.category || 'common';
                if (!itemsByCategory[itemCategory]) {
                    itemsByCategory[itemCategory] = [];
                }
                itemsByCategory[itemCategory].push(item);
            }
            
            for (var catKey in itemsByCategory) {
                var catItems = itemsByCategory[catKey];
                var catTotal = catItems.reduce(function(sum, item) { return sum + item.total; }, 0);
                
                html += '<div style="margin-bottom: 20px; border-left: 4px solid ' + (categories[catKey] ? categories[catKey].color : 'var(--accent-primary)') + '; padding-left: 16px;">' +
                    '<div style="font-weight: 700; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">' +
                    '<span style="font-size: 20px;">' + (categories[catKey] ? categories[catKey].icon : '📋') + '</span>' +
                    '<span>' + (categories[catKey] ? categories[catKey].name : catKey) + ' (' + catItems.length + ' items)</span>' +
                    '<span style="margin-left: auto; color: var(--accent-primary);">RM ' + catTotal.toFixed(2) + '</span>' +
                    '</div>';
                
                for (var j = 0; j < catItems.length; j++) {
                    var item = catItems[j];
                    var itemIcon = item.isCustom ? '🛠️' : (categories[catKey] ? categories[catKey].icon : '📋');
                    var itemLabel = item.isCustom ? ' (Custom)' : '';
                    
                    html += '<div class="quote-item">' +
                        '<div class="item-name">' +
                        '<span>' + itemIcon + '</span>' +
                        item.name + itemLabel +
                        '</div>' +
                        '<div class="item-details">' + item.description + '</div>' +
                        '<div class="item-pricing">' +
                        '<span class="quantity">Quantity: ' + item.quantity + ' ' + item.unit + '</span>' +
                        '<span class="price">RM ' + item.total.toFixed(2) + '</span>' +
                        '</div>' +
                        '</div>';
                }
                
                html += '</div>';
            }
            
            html += '</div>';
            
            html += '<div class="card">' +
                '<div class="pdf-actions">' +
                '<button class="form-btn btn-success" onclick="openPdfShare()">' +
                '<span>📤</span> Share Quote' +
                '</button>' +
                '<button class="form-btn btn-info" onclick="editQuote(' + quote.id + ')">' +
                '<span>✏️</span> Edit Quote' +
                '</button>' +
                '<button class="form-btn btn-danger" onclick="deleteQuote(' + quote.id + ')">' +
                '<span>🗑️</span> Delete Quote' +
                '</button>' +
                '<button class="form-btn btn-secondary" onclick="showView(\'quotes\')">' +
                '<span>←</span> Back to Quotes' +
                '</button>' +
                '</div>' +
                '</div>';
            
            container.innerHTML = html;
        }

        function editQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            currentQuoteData = {
                title: quote.title,
                categories: quote.categories || [],
                items: [...quote.items],
                totalAmount: quote.totalAmount
            };
            
            jobQuotes = jobQuotes.filter(function(q) { return q.id !== quoteId; });
            
            document.getElementById('job-title-input').value = quote.title;
            document.getElementById('selected-job-title').textContent = quote.title;
            
            renderCategories();
            updateQuoteSummaryDisplay();
            
            document.getElementById('category-selection-modal').classList.add('show');
            showSuccessMessage('✏️ Editing quote: ' + quote.title);
        }

        function deleteQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            if (confirm('Delete quote: "' + quote.title + '"?\n\nThis action cannot be undone.')) {
                jobQuotes = jobQuotes.filter(function(q) { return q.id !== quoteId; });
                saveDataToStorage();
                updateStats();
                renderViews();
                showView('quotes');
                showSuccessMessage('🗑️ Quote deleted successfully');
            }
        }

        // PDF Generation with Enhanced Branding
        function openPdfShare() {
            document.getElementById('pdf-share-modal').classList.add('show');
            showSuccessMessage('📄 PDF sharing options opened');
        }

        function closePdfShare() {
            document.getElementById('pdf-share-modal').classList.remove('show');
        }

        function generateAndSharePDF() {
            if (!currentQuoteId) return;
            
            var quote = jobQuotes.find(function(q) { return q.id === currentQuoteId; });
            if (!quote) return;
            
            showSuccessMessage('📄 Generating enhanced branded PDF...');
            
            var { jsPDF } = window.jspdf;
            var doc = new jsPDF();
            
            try {
                var quoteBranding = quote.branding || brandingData;
                
                // Enhanced header with custom branding
                var primaryRgb = hexToRgb(quoteBranding.primaryColor);
                doc.setFillColor(primaryRgb.r, primaryRgb.g, primaryRgb.b);
                doc.rect(0, 0, 210, 40, 'F');
                
                // Logo
                if (quoteBranding.logo) {
                    try {
                        doc.addImage(quoteBranding.logo, 'JPEG', 15, 8, 25, 25);
                    } catch (logoError) {
                        console.warn('Logo embedding failed:', logoError);
                    }
                }
                
                // Company info in white
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text(companyInfo.name, 50, 20);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text('Registration: ' + companyInfo.registration, 50, 28);
                doc.text(quoteBranding.tagline, 50, 35);
                
                // Reset text color
                doc.setTextColor(0, 0, 0);
                
                // Quote details
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('PROFESSIONAL QUOTE', 20, 55);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text('Quote #: ' + quote.id, 20, 70);
                doc.text('Date: ' + formatDate(quote.createdAt), 20, 80);
                doc.text('Project: ' + quote.title, 20, 90);
                
                var categoriesText = quote.categories ? quote.categories.map(function(cat) { 
                    return categories[cat] ? categories[cat].name : cat; 
                }).join(', ') : 'Multiple Categories';
                doc.text('Categories: ' + categoriesText, 20, 100);
                
                // Items table
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('QUOTE ITEMS', 20, 120);
                
                var yPosition = 135;
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('No.', 20, yPosition);
                doc.text('Description', 35, yPosition);
                doc.text('Category', 110, yPosition);
                doc.text('Qty', 140, yPosition);
                doc.text('Unit', 155, yPosition);
                doc.text('Amount (RM)', 175, yPosition);
                
                doc.setFont(undefined, 'normal');
                for (var i = 0; i < quote.items.length; i++) {
                    var item = quote.items[i];
                    yPosition += 12;
                    
                    doc.text((i + 1).toString(), 20, yPosition);
                    var itemName = item.name + (item.isCustom ? ' (Custom)' : '');
                    doc.text(itemName.substring(0, 25), 35, yPosition);
                    
                    var itemCategory = item.category || 'common';
                    var catName = categories[itemCategory] ? categories[itemCategory].name : itemCategory;
                    doc.text(catName.substring(0, 10), 110, yPosition);
                    
                    doc.text(item.quantity.toString(), 140, yPosition);
                    doc.text(item.unit.substring(0, 8), 155, yPosition);
                    doc.text(item.total.toFixed(2), 175, yPosition);
                    
                    if (item.description && yPosition < 240) {
                        yPosition += 8;
                        doc.setFontSize(8);
                        doc.text(item.description.substring(0, 60), 35, yPosition);
                        doc.setFontSize(10);
                    }
                    
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 30;
                    }
                }
                
                // Total with brand color
                yPosition += 15;
                doc.setFillColor(primaryRgb.r, primaryRgb.g, primaryRgb.b);
                doc.rect(20, yPosition - 5, 170, 20, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('TOTAL AMOUNT: RM ' + quote.totalAmount.toFixed(2), 25, yPosition + 7);
                
                // Footer
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text('Thank you for choosing ' + companyInfo.name, 20, yPosition + 35);
                doc.text('Contact: ' + companyInfo.phone + ' • ' + companyInfo.email, 20, yPosition + 45);
                
                var pdfBlob = doc.output('blob');
                var fileName = 'REFIT_Enhanced_Quote_' + quote.id + '_' + quote.title.replace(/[^a-z0-9]/gi, '_') + '.pdf';
                
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [new File([pdfBlob], fileName, { type: 'application/pdf' })] })) {
                    var file = new File([pdfBlob], fileName, { type: 'application/pdf' });
                    
                    navigator.share({
                        title: 'Enhanced Quote - ' + quote.title,
                        text: 'Professional quote with custom branding from REFIT MAINTENANCE SERVICES',
                        files: [file]
                    }).then(function() {
                        showSuccessMessage('📤 Enhanced quote shared successfully!');
                        closePdfShare();
                    }).catch(function(error) {
                        console.log('Share failed:', error);
                        downloadPDF();
                    });
                } else {
                    downloadPDF();
                }
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showSuccessMessage('❌ Error generating PDF. Please try again.');
            }
        }

        function downloadPDF() {
            if (!currentQuoteId) return;
            
            var quote = jobQuotes.find(function(q) { return q.id === currentQuoteId; });
            if (!quote) return;
            
            showSuccessMessage('💾 Downloading enhanced PDF...');
            
            var { jsPDF } = window.jspdf;
            var doc = new jsPDF();
            
            try {
                var quoteBranding = quote.branding || brandingData;
                
                // Same PDF generation code as generateAndSharePDF
                var primaryRgb = hexToRgb(quoteBranding.primaryColor);
                doc.setFillColor(primaryRgb.r, primaryRgb.g, primaryRgb.b);
                doc.rect(0, 0, 210, 40, 'F');
                
                if (quoteBranding.logo) {
                    try {
                        doc.addImage(quoteBranding.logo, 'JPEG', 15, 8, 25, 25);
                    } catch (logoError) {
                        console.warn('Logo embedding failed:', logoError);
                    }
                }
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text(companyInfo.name, 50, 20);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text('Registration: ' + companyInfo.registration, 50, 28);
                doc.text(quoteBranding.tagline, 50, 35);
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('PROFESSIONAL QUOTE', 20, 55);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text('Quote #: ' + quote.id, 20, 70);
                doc.text('Date: ' + formatDate(quote.createdAt), 20, 80);
                doc.text('Project: ' + quote.title, 20, 90);
                
                var categoriesText = quote.categories ? quote.categories.map(function(cat) { 
                    return categories[cat] ? categories[cat].name : cat; 
                }).join(', ') : 'Multiple Categories';
                doc.text('Categories: ' + categoriesText, 20, 100);
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('QUOTE ITEMS', 20, 120);
                
                var yPosition = 135;
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('No.', 20, yPosition);
                doc.text('Description', 35, yPosition);
                doc.text('Category', 110, yPosition);
                doc.text('Qty', 140, yPosition);
                doc.text('Unit', 155, yPosition);
                doc.text('Amount (RM)', 175, yPosition);
                
                doc.setFont(undefined, 'normal');
                for (var i = 0; i < quote.items.length; i++) {
                    var item = quote.items[i];
                    yPosition += 12;
                    
                    doc.text((i + 1).toString(), 20, yPosition);
                    var itemName = item.name + (item.isCustom ? ' (Custom)' : '');
                    doc.text(itemName.substring(0, 25), 35, yPosition);
                    
                    var itemCategory = item.category || 'common';
                    var catName = categories[itemCategory] ? categories[itemCategory].name : itemCategory;
                    doc.text(catName.substring(0, 10), 110, yPosition);
                    
                    doc.text(item.quantity.toString(), 140, yPosition);
                    doc.text(item.unit.substring(0, 8), 155, yPosition);
                    doc.text(item.total.toFixed(2), 175, yPosition);
                    
                    if (item.description && yPosition < 240) {
                        yPosition += 8;
                        doc.setFontSize(8);
                        doc.text(item.description.substring(0, 60), 35, yPosition);
                        doc.setFontSize(10);
                    }
                    
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 30;
                    }
                }
                
                yPosition += 15;
                doc.setFillColor(primaryRgb.r, primaryRgb.g, primaryRgb.b);
                doc.rect(20, yPosition - 5, 170, 20, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('TOTAL AMOUNT: RM ' + quote.totalAmount.toFixed(2), 25, yPosition + 7);
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text('Thank you for choosing ' + companyInfo.name, 20, yPosition + 35);
                doc.text('Contact: ' + companyInfo.phone + ' • ' + companyInfo.email, 20, yPosition + 45);
                
                var fileName = 'REFIT_Enhanced_Quote_' + quote.id + '_' + quote.title.replace(/[^a-z0-9]/gi, '_') + '.pdf';
                doc.save(fileName);
                
                showSuccessMessage('💾 Enhanced PDF downloaded successfully!');
                closePdfShare();
                
            } catch (error) {
                console.error('PDF download error:', error);
                showSuccessMessage('❌ Error downloading PDF. Please try again.');
            }
        }

        // View and Navigation Functions
        function showView(viewName) {
            currentView = viewName;
            
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) {
                views[i].classList.add('hidden');
            }
            
            var targetView = document.getElementById(viewName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            var navItems = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navItems.length; i++) {
                navItems[i].classList.remove('active');
            }
            
            var activeNav = document.querySelector('.nav-item[onclick*="' + viewName + '"]');
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            renderViews();
        }

        function renderViews() {
            switch(currentView) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'quotes':
                    renderQuotes();
                    break;
                case 'quote-detail':
                    break;
            }
        }

        function renderDashboard() {
            var recentQuotes = jobQuotes.slice(-3).reverse();
            var container = document.getElementById('recent-quotes');
            if (!container) return;
            
            if (recentQuotes.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 30px 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 32px; margin-bottom: 8px;">💰</div>' +
                    '<p style="font-weight: 600;">No job quotes yet</p>' +
                    '<p style="font-size: 12px; margin-top: 4px;">Create your first job quote</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < recentQuotes.length; i++) {
                var quote = recentQuotes[i];
                
                var quoteCategories = quote.categories || (quote.category ? [quote.category] : ['common']);
                var categoryBadges = '';
                
                for (var j = 0; j < Math.min(quoteCategories.length, 2); j++) {
                    var cat = quoteCategories[j];
                    if (categories[cat]) {
                        categoryBadges += '<span class="category-badge category-' + cat + '">' + 
                            categories[cat].icon + ' ' + categories[cat].name + '</span>';
                    }
                }
                
                if (quoteCategories.length > 2) {
                    categoryBadges += '<span class="category-badge" style="background: var(--text-muted);">+' + 
                        (quoteCategories.length - 2) + '</span>';
                }
                
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;" onclick="showQuoteDetail(' + quote.id + ')">' +
                    '<div style="font-weight: 700; font-size: 15px; color: var(--text-primary); margin-bottom: 8px;">' + quote.title + '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">📋 ' + quote.items.length + ' items • 📅 ' + formatDate(quote.createdAt) + '</div>' +
                    '<div style="margin-bottom: 8px;">' + categoryBadges + '</div>' +
                    '<div style="display: flex; justify-content: space-between; align-items: center;">' +
                    '<span style="color: var(--text-muted); font-size: 12px;">Quote #' + quote.id + '</span>' +
                    '<span style="font-weight: 700; color: var(--accent-primary); font-size: 16px;">RM ' + quote.totalAmount.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>';
            }
            container.innerHTML = html;
        }

        function renderQuotes() {
            var container = document.getElementById('quotes-list');
            if (!container) return;
            
            if (jobQuotes.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">💰</div>' +
                    '<p style="font-weight: 600;">No job quotes found</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create your first job quote</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var i = jobQuotes.length - 1; i >= 0; i--) {
                var quote = jobQuotes[i];
                
                var quoteCategories = quote.categories || (quote.category ? [quote.category] : ['common']);
                var categoryBadges = '';
                
                for (var j = 0; j < Math.min(quoteCategories.length, 3); j++) {
                    var cat = quoteCategories[j];
                    if (categories[cat]) {
                        categoryBadges += '<span class="category-badge category-' + cat + '">' + 
                            categories[cat].icon + ' ' + categories[cat].name + '</span>';
                    }
                }
                
                if (quoteCategories.length > 3) {
                    categoryBadges += '<span class="category-badge" style="background: var(--text-muted);">+' + 
                        (quoteCategories.length - 3) + ' more</span>';
                }
                
                html += '<div class="item-card">' +
                    '<div class="item-header">' +
                    '<div class="item-info">' +
                    '<h3>' + quote.title + '</h3>' +
                    '<div style="font-size: 14px; color: var(--text-secondary); margin: 8px 0;">📋 ' + quote.items.length + ' items • 📅 ' + formatDate(quote.createdAt) + '</div>' +
                    '<div style="margin: 8px 0;">' + categoryBadges + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="item-actions">' +
                    '<button class="icon-btn quote-btn" onclick="showQuoteDetail(' + quote.id + ')" title="View Quote">👁️</button>' +
                    '<button class="icon-btn share-btn" onclick="currentQuoteId=' + quote.id + '; openPdfShare()" title="Share Quote">📤</button>' +
                    '<button class="icon-btn edit-btn" onclick="editQuote(' + quote.id + ')" title="Edit Quote">✏️</button>' +
                    '<button class="icon-btn delete-btn" onclick="deleteQuote(' + quote.id + ')" title="Delete Quote">🗑️</button>' +
                    '</div>' +
                    '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">' +
                    '<span style="font-size: 12px; color: var(--text-muted);">Quote #' + quote.id + '</span>' +
                    '<span style="font-size: 18px; color: var(--accent-primary); font-weight: 700;">RM ' + quote.totalAmount.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>';
            }
            container.innerHTML = html;
        }

        // Company Info Management
        function openCompanyInfo() {
            document.getElementById('company-name-input').value = companyInfo.name;
            document.getElementById('company-reg-input').value = companyInfo.registration;
            document.getElementById('company-phone-input').value = companyInfo.phone;
            document.getElementById('company-email-input').value = companyInfo.email;
            document.getElementById('company-address-input').value = companyInfo.address;
            
            document.getElementById('company-info-modal').classList.add('show');
            showSuccessMessage('🏢 Company info opened');
        }

        function closeCompanyInfo() {
            document.getElementById('company-info-modal').classList.remove('show');
        }

        function saveCompanyInfo() {
            companyInfo.name = document.getElementById('company-name-input').value.trim() || companyInfo.name;
            companyInfo.registration = document.getElementById('company-reg-input').value.trim() || companyInfo.registration;
            companyInfo.phone = document.getElementById('company-phone-input').value.trim() || companyInfo.phone;
            companyInfo.email = document.getElementById('company-email-input').value.trim() || companyInfo.email;
            companyInfo.address = document.getElementById('company-address-input').value.trim() || companyInfo.address;
            
            updateHeaderDisplay();
            saveDataToStorage();
            closeCompanyInfo();
            showSuccessMessage('✅ Company details saved!');
        }

        // Utility Functions
        function updateStats() {
            var totalQuotes = jobQuotes.length;
            var totalItems = 0;
            var totalRevenue = 0;
            var todayRevenue = 0;
            var today = new Date().toISOString().split('T')[0];
            
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                totalItems += quote.items.length;
                totalRevenue += quote.totalAmount;
                if (quote.createdAt.split('T')[0] === today) {
                    todayRevenue += quote.totalAmount;
                }
            }
            
            updateElementText('total-quotes-count', totalQuotes);
            updateElementText('total-items-count', totalItems);
            updateElementText('today-revenue', 'RM ' + Math.round(todayRevenue));
            updateElementText('total-revenue', 'RM ' + Math.round(totalRevenue));
        }

        function updateElementText(elementId, text) {
            var element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            var date = new Date(dateString);
            return date.toLocaleDateString('en-MY', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showSuccessMessage(message) {
            var messageElement = document.getElementById('success-message');
            if (!messageElement) return;
            
            messageElement.textContent = message;
            messageElement.classList.add('show');
            
            setTimeout(function() {
                messageElement.classList.remove('show');
            }, 3000);
        }

        function exportData() {
            var allData = {
                jobQuotes: jobQuotes,
                categories: categories,
                presetWorkItems: presetWorkItems,
                companyInfo: companyInfo,
                brandingData: brandingData,
                customLogo: customLogo,
                themePreference: currentTheme,
                exportDate: new Date().toISOString(),
                version: 'Enhanced Branding Suite 2.0'
            };
            
            var dataStr = JSON.stringify(allData, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            var link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'REFIT_Enhanced_Branding_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showSuccessMessage('🎨📤 Enhanced branding data exported successfully! 💕');
        }

        // Setup and initialization functions
        function setupEventListeners() {
            var jobTitleInput = document.getElementById('job-title-input');
            if (jobTitleInput) {
                jobTitleInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        proceedToCategory();
                    }
                });
            }
            
            var customItemForm = document.getElementById('custom-item-form');
            if (customItemForm) {
                customItemForm.addEventListener('submit', handleCustomItemSubmit);
            }
            
            // Enhanced custom item form listeners
            var customItemName = document.getElementById('custom-item-name');
            if (customItemName) {
                customItemName.addEventListener('input', calculateCustomItemTotal);
            }
            
            var customItemUnitPrice = document.getElementById('custom-item-unit-price');
            if (customItemUnitPrice) {
                customItemUnitPrice.addEventListener('input', calculateCustomItemTotal);
            }
            
            var customItemQuantity = document.getElementById('custom-item-quantity');
            if (customItemQuantity) {
                customItemQuantity.addEventListener('input', calculateCustomItemTotal);
            }
        }

        function setupMobileOptimizations() {
            setInterval(updateStatusBar, 60000);
            
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        function updateStatusBar() {
            var now = new Date();
            var timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                hour12: false 
            });
            var timeElement = document.getElementById('status-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadThemePreference();
            loadDataFromStorage();
            setupEventListeners();
            setupMobileOptimizations();
            updateStatusBar();
            updateStats();
            renderViews();
            
            showSuccessMessage('🎨✨ REFIT Enhanced Branding Suite Ready! Complete professional customization! 💕');
            console.log('🔧 REFIT MAINTENANCE SERVICES - Enhanced Branding System');
            console.log('🎨 Complete Branding Insert Suite with Professional Features');
            console.log('📄 Custom Branded PDF Generation');
            console.log('👁️ Professional Quote Preview System');
            console.log('🌈 8 Color Themes with Custom Logo Support');
        }

        console.log('🎨💕 REFIT ENHANCED BRANDING SUITE - Complete Professional System!');
        console.log('📝 Enhanced Quote Creation: Title → Multi-Category → Items → Branding');
        console.log('🎨 Complete Branding Insert: Logo + Colors + Tagline + Templates');
        console.log('🌈 8 Professional Color Themes: Pink, Blue, Green, Purple, Orange, Red, Teal, Indigo');
        console.log('📄 Custom Branded PDFs: Professional headers with logo and brand colors');
        console.log('👁️ Live Branding Preview: See exactly how quotes will look');
        console.log('💾 Branding Templates: Save and reuse professional branding setups');
        console.log('📤 Enhanced Sharing: Mobile-optimized branded PDF sharing');
        console.log('🛠️ Custom Items: Create items on-the-fly during quote creation');
        console.log('🏢 Company Branding: Full company info integration with branding');
        console.log('📦 Export Package: Complete branding and data export system');
        console.log('🌸💕 Beautiful Enhanced UI: Professional gradients, animations, and pink aesthetics!');
    </script>
</body>
</html>
