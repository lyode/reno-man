<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="REFIT MAINTENANCE SERVICES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2d3748">
    <meta name="msapplication-navbutton-color" content="#2d3748">
    
    <title>REFIT MAINTENANCE SERVICES - Categorized Management System</title>
    
    <!-- Enhanced PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, select, textarea, button {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        :root {
            /* Light Theme - Warm & Eye-Friendly */
            --bg-primary: #f7f5f3;
            --bg-secondary: #edeae6;
            --bg-card: #ffffff;
            --bg-card-hover: #f9f7f5;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --accent-primary: #38a169;
            --accent-secondary: #68d391;
            --accent-warm: #d69e2e;
            --accent-soft: #9f7aea;
            --border-color: #e2e8f0;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.1);
            --shadow-strong: rgba(0, 0, 0, 0.15);
            --overlay: rgba(45, 55, 72, 0.8);
            --success: #38a169;
            --warning: #d69e2e;
            --error: #e53e3e;
            --info: #3182ce;
            
            /* Category Colors */
            --cat-electrical: #3182ce;
            --cat-plumbing: #0987a0;
            --cat-hvac: #805ad5;
            --cat-cleaning: #38a169;
            --cat-parts: #d69e2e;
            --cat-labor: #e53e3e;
            --cat-equipment: #718096;
            --cat-common: #9f7aea;
        }
        
        [data-theme="dark"] {
            /* Dark Theme - Reduced Blue Light */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #3a3a3a;
            --bg-card-hover: #454545;
            --text-primary: #e8e8e8;
            --text-secondary: #c7c7c7;
            --text-muted: #9a9a9a;
            --accent-primary: #4fd69c;
            --accent-secondary: #68d391;
            --accent-warm: #f6d55c;
            --accent-soft: #b794f6;
            --border-color: #4a4a4a;
            --shadow-light: rgba(255, 255, 255, 0.05);
            --shadow-medium: rgba(255, 255, 255, 0.1);
            --shadow-strong: rgba(255, 255, 255, 0.15);
            --overlay: rgba(0, 0, 0, 0.9);
            --success: #4fd69c;
            --warning: #f6d55c;
            --error: #fc8181;
            --info: #63b3ed;
            
            /* Category Colors - Dark Mode */
            --cat-electrical: #63b3ed;
            --cat-plumbing: #4fd1c7;
            --cat-hvac: #b794f6;
            --cat-cleaning: #68d391;
            --cat-parts: #f6d55c;
            --cat-labor: #fc8181;
            --cat-equipment: #a0aec0;
            --cat-common: #d6bcfa;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        /* Mobile Layout Container */
        .mobile-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 2px 10px var(--shadow-medium);
            border-bottom: 1px solid var(--border-color);
        }
        
        .status-bar .time {
            color: var(--text-primary);
        }
        
        .status-bar .indicators {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }
        
        .theme-toggle {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        
        .theme-toggle:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 4px 20px var(--shadow-medium);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            width: 54px;
            height: 54px;
            background: var(--accent-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 6px 16px var(--shadow-medium);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--accent-secondary);
        }
        
        .app-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--shadow-strong);
        }
        
        .app-logo:active {
            transform: scale(0.95);
        }
        
        /* Professional SVG Logo Styles */
        .logo-svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 4px var(--shadow-light));
        }
        
        /* Logo Selection Modal Styles */
        .logo-selector {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            backdrop-filter: blur(10px);
        }
        
        .logo-selector.show {
            display: flex;
        }
        
        .logo-selector-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px var(--shadow-strong);
            border: 1px solid var(--border-color);
        }
        
        .logo-selector-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .logo-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .logo-option {
            aspect-ratio: 1;
            background: var(--bg-secondary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 3px solid transparent;
            position: relative;
        }
        
        .logo-option:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px var(--shadow-medium);
            background: var(--accent-primary);
        }
        
        .logo-option.selected {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
        }
        
        .logo-option.selected .logo-svg,
        .logo-option:hover .logo-svg {
            filter: brightness(0) invert(1) drop-shadow(0 2px 4px rgba(255, 255, 255, 0.3));
        }
        
        .app-title h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        
        .app-title p {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.2;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-right .stats {
            text-align: right;
        }
        
        .header-right p {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .settings-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .settings-btn:active {
            transform: scale(0.9);
            background: var(--accent-secondary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 130px 20px 140px;
            -webkit-overflow-scrolling: touch;
            position: relative;
            height: calc(100vh - 44px);
            scroll-behavior: smooth;
        }
        
        .main-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        /* Category System */
        .category-badge {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            display: inline-block;
            margin-right: 6px;
        }
        
        .category-electrical { background: var(--cat-electrical); }
        .category-plumbing { background: var(--cat-plumbing); }
        .category-hvac { background: var(--cat-hvac); }
        .category-cleaning { background: var(--cat-cleaning); }
        .category-parts { background: var(--cat-parts); }
        .category-labor { background: var(--cat-labor); }
        .category-equipment { background: var(--cat-equipment); }
        .category-common { background: var(--cat-common); }
        
        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }
        
        .category-filter {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid transparent;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .category-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .category-filter.active {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
        }
        
        .category-filter.electrical { border-color: var(--cat-electrical); }
        .category-filter.electrical.active { background: var(--cat-electrical); }
        .category-filter.plumbing { border-color: var(--cat-plumbing); }
        .category-filter.plumbing.active { background: var(--cat-plumbing); }
        .category-filter.hvac { border-color: var(--cat-hvac); }
        .category-filter.hvac.active { background: var(--cat-hvac); }
        .category-filter.cleaning { border-color: var(--cat-cleaning); }
        .category-filter.cleaning.active { background: var(--cat-cleaning); }
        .category-filter.parts { border-color: var(--cat-parts); }
        .category-filter.parts.active { background: var(--cat-parts); }
        .category-filter.labor { border-color: var(--cat-labor); }
        .category-filter.labor.active { background: var(--cat-labor); }
        .category-filter.equipment { border-color: var(--cat-equipment); }
        .category-filter.equipment.active { background: var(--cat-equipment); }
        .category-filter.common { border-color: var(--cat-common); }
        .category-filter.common.active { background: var(--cat-common); }
        
        .category-count {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            margin-left: 4px;
        }
        
        /* Category Sections */
        .category-section {
            margin-bottom: 24px;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .category-section.electrical {
            border-color: var(--cat-electrical);
            box-shadow: 0 4px 20px rgba(49, 130, 206, 0.1);
        }
        
        .category-section.plumbing {
            border-color: var(--cat-plumbing);
            box-shadow: 0 4px 20px rgba(9, 135, 160, 0.1);
        }
        
        .category-section.hvac {
            border-color: var(--cat-hvac);
            box-shadow: 0 4px 20px rgba(128, 90, 213, 0.1);
        }
        
        .category-section.cleaning {
            border-color: var(--cat-cleaning);
            box-shadow: 0 4px 20px rgba(56, 161, 105, 0.1);
        }
        
        .category-section.parts {
            border-color: var(--cat-parts);
            box-shadow: 0 4px 20px rgba(214, 158, 46, 0.1);
        }
        
        .category-section.labor {
            border-color: var(--cat-labor);
            box-shadow: 0 4px 20px rgba(229, 62, 62, 0.1);
        }
        
        .category-section.equipment {
            border-color: var(--cat-equipment);
            box-shadow: 0 4px 20px rgba(113, 128, 150, 0.1);
        }
        
        .category-section.common {
            border-color: var(--cat-common);
            box-shadow: 0 4px 20px rgba(159, 122, 234, 0.1);
        }
        
        .category-header {
            padding: 16px 20px;
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .category-icon.electrical { background: var(--cat-electrical); }
        .category-icon.plumbing { background: var(--cat-plumbing); }
        .category-icon.hvac { background: var(--cat-hvac); }
        .category-icon.cleaning { background: var(--cat-cleaning); }
        .category-icon.parts { background: var(--cat-parts); }
        .category-icon.labor { background: var(--cat-labor); }
        .category-icon.equipment { background: var(--cat-equipment); }
        .category-icon.common { background: var(--cat-common); }
        
        .category-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .category-body {
            background: var(--bg-card);
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-medium);
            transform: translateY(-2px);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: var(--accent-primary);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 52px;
            text-decoration: none;
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }
        
        .btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary { background: var(--accent-primary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--error); }
        .btn-warning { background: var(--warning); }
        .btn-info { background: var(--info); }
        .btn-soft { background: var(--accent-soft); }
        .btn-warm { background: var(--accent-warm); }
        .btn-secondary { background: var(--text-secondary); }
        
        /* Action Buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .action-btn {
            padding: 24px 20px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-height: 120px;
            box-shadow: 0 6px 20px var(--shadow-light);
        }
        
        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px var(--shadow-medium);
        }
        
        .action-btn:active {
            transform: scale(0.96);
        }
        
        .action-btn.primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        .action-btn.success { background: linear-gradient(135deg, var(--success), #48bb78); }
        .action-btn.warm { background: linear-gradient(135deg, var(--accent-warm), #f6e05e); }
        .action-btn.soft { background: linear-gradient(135deg, var(--accent-soft), #b794f6); }
        .action-btn.info { background: linear-gradient(135deg, var(--info), #63b3ed); }
        .action-btn.secondary { background: linear-gradient(135deg, var(--text-secondary), #718096); }
        
        .action-btn .icon {
            font-size: 32px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        /* Form Elements */
        .input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .input::placeholder {
            color: var(--text-muted);
        }
        
        .input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1);
        }
        
        /* Search Input */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-muted);
            pointer-events: none;
        }
        
        .search-container input {
            padding-left: 56px;
        }
        
        /* Item Cards */
        .item-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px var(--shadow-medium);
            background: var(--bg-card-hover);
        }
        
        .item-card:active {
            transform: scale(0.98);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .item-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
            color: var(--text-primary);
        }
        
        /* Icon Buttons */
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .icon-btn:active {
            transform: scale(0.9);
        }
        
        .icon-btn.edit-btn { background: var(--accent-primary); color: white; }
        .icon-btn.delete-btn { background: var(--error); color: white; }
        .icon-btn.pdf-btn { background: var(--info); color: white; }
        .icon-btn.quote-btn { background: var(--accent-warm); color: white; }
        
        .item-actions {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }
        
        /* Preset Items Styles */
        .preset-items-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            margin: 20px 0;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .preset-items-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .preset-items-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .preset-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .preset-item:hover {
            background: var(--bg-card-hover);
            transform: scale(1.02);
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .preset-item-info {
            flex: 1;
        }
        
        .preset-item-name {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 15px;
            margin-bottom: 4px;
        }
        
        .preset-item-details {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .preset-item-price {
            font-weight: 700;
            color: var(--accent-primary);
            font-size: 15px;
        }
        
        .preset-item-add {
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 12px;
            box-shadow: 0 2px 6px var(--shadow-light);
        }
        
        .preset-item-add:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px var(--shadow-medium);
        }
        
        .preset-item-add:active {
            transform: scale(0.95);
        }
        
        /* Quote Items List */
        .quote-items-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            margin: 20px 0;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .quote-items-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .quote-items-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quote-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px var(--shadow-light);
            position: relative;
        }
        
        .quote-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .quote-item-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 16px;
        }
        
        .quote-item-actions {
            display: flex;
            gap: 8px;
        }
        
        .quote-item-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .quote-item-btn:active {
            transform: scale(0.9);
        }
        
        .quote-item-edit {
            background: var(--accent-primary);
            color: white;
        }
        
        .quote-item-delete {
            background: var(--error);
            color: white;
        }
        
        .quote-item-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .quote-item-detail {
            text-align: center;
        }
        
        .quote-item-detail-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        
        .quote-item-detail-value {
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .quote-total-section {
            background: var(--accent-primary);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 6px 20px var(--shadow-medium);
        }
        
        .quote-total-label {
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 6px;
        }
        
        .quote-total-value {
            font-size: 28px;
            font-weight: 800;
            color: #ffffff;
        }
        
        .empty-quote-items {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }
        
        .empty-quote-items-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.6;
        }
        
        /* Quick Add Section */
        .quick-add-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            margin: 20px 0;
            border: 2px solid var(--accent-warm);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .quick-add-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .quick-add-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quick-add-form {
            display: grid;
            gap: 12px;
        }
        
        .quick-add-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 12px;
            align-items: end;
        }
        
        .quick-add-input {
            padding: 14px 16px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .quick-add-input::placeholder {
            color: var(--text-muted);
        }
        
        .quick-add-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1);
        }
        
        .quick-add-btn {
            padding: 14px 16px;
            border-radius: 12px;
            border: none;
            background: var(--accent-primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .quick-add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .quick-add-btn:active {
            transform: scale(0.95);
        }
        
        .quick-add-total {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-top: 16px;
            border: 1px solid var(--border-color);
        }
        
        .quick-add-total-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        
        .quick-add-total-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px 32px;
            z-index: 100;
            box-shadow: 0 -4px 20px var(--shadow-medium);
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border-radius: 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 60px;
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: rgba(56, 161, 105, 0.1);
            box-shadow: 0 2px 8px var(--shadow-light);
            transform: scale(1.05);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item .icon {
            font-size: 24px;
        }
        
        .home-indicator {
            height: 4px;
            background: var(--accent-primary);
            border-radius: 2px;
            width: 140px;
            margin: 12px auto 0;
            opacity: 0.6;
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: flex-end;
            z-index: 200;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            color: var(--text-primary);
            animation: slideUp 0.3s ease;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            border: 1px solid var(--border-color);
            box-shadow: 0 -8px 40px var(--shadow-strong);
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
        }
        
        .close-btn:hover {
            background: var(--error);
            color: white;
            transform: scale(1.1);
        }
        
        .close-btn:active {
            transform: scale(0.9);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Form Elements in Modals */
        .form-input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .form-input::placeholder {
            color: var(--text-muted);
        }
        
        .form-input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1);
        }
        
        .form-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .form-btn {
            padding: 18px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 56px;
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }
        
        .form-btn:active {
            transform: scale(0.96);
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .view {
            padding-top: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .add-btn {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
            box-shadow: 0 8px 24px var(--shadow-medium);
        }
        
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px var(--shadow-strong);
        }
        
        .add-btn:active {
            transform: scale(0.9);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 8px 32px var(--shadow-medium);
            z-index: 250;
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        .success-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* PDF Loading */
        .pdf-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            backdrop-filter: blur(10px);
        }
        
        .pdf-loading.show {
            display: flex;
        }
        
        .pdf-loading-content {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px var(--shadow-strong);
            max-width: 300px;
            margin: 0 20px;
            border: 1px solid var(--border-color);
        }
        
        .pdf-loading-icon {
            font-size: 48px;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
            color: var(--accent-primary);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }
        
        .pdf-loading-text {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .pdf-loading-subtext {
            font-size: 14px;
            color: var(--text-muted);
        }
        
        /* Blue Light Filter */
        .blue-light-filter {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 214, 102, 0.05);
            pointer-events: none;
            z-index: 1;
            transition: opacity 0.3s ease;
        }
        
        [data-theme="dark"] .blue-light-filter {
            background: rgba(255, 214, 102, 0.02);
        }
        
        /* Eye Comfort Enhancements */
        .comfort-mode {
            font-smooth: always;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Focus indicators for accessibility */
        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --shadow-light: rgba(0, 0, 0, 0.2);
                --shadow-medium: rgba(0, 0, 0, 0.3);
                --shadow-strong: rgba(0, 0, 0, 0.4);
                --border-color: #666;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Mobile Optimizations */
        @media screen and (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .form-actions {
                grid-template-columns: 1fr;
            }
            
            .quick-add-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .item-actions {
                position: static;
                margin-top: 12px;
                justify-content: flex-end;
            }
            
            .item-card {
                padding-right: 20px;
            }
            
            .logo-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .category-filters {
                flex-direction: column;
                gap: 12px;
            }
            
            .category-filter {
                justify-content: center;
            }
        }
        
        /* Safe area adjustments */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }
        
        /* Print styles */
        @media print {
            .status-bar,
            .bottom-nav,
            .modal,
            .logo-selector {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body class="comfort-mode" data-theme="light">
    <!-- Blue Light Filter -->
    <div class="blue-light-filter" id="blue-light-filter"></div>
    
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="status-time">9:41</div>
            <div class="indicators">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙 Dark</button>
                <span>📶</span>
                <span>📱</span>
                <span>🔋</span>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="app-logo" onclick="openLogoSelector()" id="main-logo">
                        <!-- Professional Maintenance Tool Icon (Default) -->
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <!-- Wrench -->
                            <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <!-- Screwdriver -->
                            <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <!-- Center gear -->
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="50" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="app-title">
                        <h1>REFIT MAINTENANCE SERVICES</h1>
                        <p>Registration No: 201803348973<br>(002894203-V)</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="stats">
                    <p id="current-date">Today</p>
                    <p id="daily-revenue">RM 0.00</p>
                </div>
                <button class="settings-btn" onclick="exportData()" title="Export Data">
                    📤
                </button>
            </div>
        </div>

        <!-- Logo Selector Modal -->
        <div id="logo-selector" class="logo-selector">
            <div class="logo-selector-content">
                <h3 class="logo-selector-title">🎨 Choose Your Logo</h3>
                <div class="logo-options">
                    <!-- Option 1: Professional Tools -->
                    <div class="logo-option selected" onclick="selectLogo(0)" data-logo="0">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="50" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    
                    <!-- Option 2: Gear & Wrench -->
                    <div class="logo-option" onclick="selectLogo(1)" data-logo="1">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="25" fill="none" stroke="currentColor" stroke-width="4"/>
                            <path d="M50 25L55 35L45 35Z M75 50L65 45L65 55Z M50 75L45 65L55 65Z M25 50L35 55L35 45Z" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="50" cy="50" r="8" fill="currentColor"/>
                            <path d="M15 15L25 25M20 30L35 45C40 50 50 50 55 45L70 30" stroke="rgba(255,255,255,0.6)" stroke-width="3" fill="none"/>
                        </svg>
                    </div>
                    
                    <!-- Option 3: House Tools -->
                    <div class="logo-option" onclick="selectLogo(2)" data-logo="2">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M50 15L20 40L25 45L50 25L75 45L80 40Z" fill="currentColor"/>
                            <rect x="30" y="40" width="40" height="45" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <rect x="42" y="65" width="16" height="20" fill="currentColor"/>
                            <rect x="35" y="50" width="8" height="8" fill="rgba(255,255,255,0.6)"/>
                            <rect x="57" y="50" width="8" height="8" fill="rgba(255,255,255,0.6)"/>
                            <path d="M15 70L25 60L30 65L20 75Z" fill="rgba(255,214,102,0.8)"/>
                            <path d="M75 70L85 60L90 65L80 75Z" fill="rgba(255,214,102,0.8)"/>
                        </svg>
                    </div>
                    
                    <!-- Option 4: Modern Tech -->
                    <div class="logo-option" onclick="selectLogo(3)" data-logo="3">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="20" y="20" width="60" height="60" rx="15" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="35" cy="35" r="5" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="65" cy="35" r="5" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="35" cy="65" r="5" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="65" cy="65" r="5" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.9)"/>
                            <path d="M35 50L45 50M55 50L65 50M50 35L50 45M50 55L50 65" stroke="rgba(255,255,255,0.6)" stroke-width="2"/>
                        </svg>
                    </div>
                    
                    <!-- Option 5: Service Badge -->
                    <div class="logo-option" onclick="selectLogo(4)" data-logo="4">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="35" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="3"/>
                            <circle cx="50" cy="50" r="25" fill="rgba(255,255,255,0.9)"/>
                            <text x="50" y="45" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="currentColor">REFIT</text>
                            <text x="50" y="60" text-anchor="middle" font-family="Arial" font-size="8" font-weight="bold" fill="currentColor">SERVICE</text>
                            <path d="M30 30L35 25L40 30M60 30L65 25L70 30M30 70L35 75L40 70M60 70L65 75L70 70" stroke="rgba(255,255,255,0.6)" stroke-width="2" fill="none"/>
                        </svg>
                    </div>
                    
                    <!-- Option 6: Lightning Bolt -->
                    <div class="logo-option" onclick="selectLogo(5)" data-logo="5">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M35 15L60 45L45 45L65 85L40 55L55 55L35 15Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="25" cy="25" r="8" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="75" cy="25" r="8" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="25" cy="75" r="8" fill="rgba(255,255,255,0.8)"/>
                            <circle cx="75" cy="75" r="8" fill="rgba(255,255,255,0.8)"/>
                        </svg>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <button onclick="closeLogoSelector()" class="btn btn-secondary">Cancel</button>
                    <button onclick="applySelectedLogo()" class="btn btn-primary">Apply Logo</button>
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div id="success-message" class="success-message">
            ✅ Data saved successfully!
        </div>

        <!-- PDF Loading Modal -->
        <div id="pdf-loading" class="pdf-loading">
            <div class="pdf-loading-content">
                <div class="pdf-loading-icon">📄</div>
                <div class="pdf-loading-text">Generating Professional Quote PDF</div>
                <div class="pdf-loading-subtext">Creating detailed job quote...</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="total-quotes-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Quote Items</div>
                        <div class="stat-value" id="total-items-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-value" id="today-revenue">RM 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="total-revenue">RM 0</div>
                    </div>
                </div>

                <!-- Performance Card -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">📊 Category Overview</h3>
                        <span style="font-size: 24px;">📈</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; font-size: 14px;">
                        <div style="text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--accent-primary);" id="average-quote">RM 0</div>
                            <div style="color: var(--text-muted); font-weight: 600;">Average Quote</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--accent-warm);" id="total-categories">0</div>
                            <div style="color: var(--text-muted); font-weight: 600;">Active Categories</div>
                        </div>
                    </div>
                </div>

                <!-- Category Statistics -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">📊 Category Breakdown</h3>
                    <div id="category-stats-grid"></div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">Quick Actions</h3>
                    <div class="actions-grid">
                        <button class="action-btn primary" onclick="openSimpleJobForm()">
                            <span class="icon">➕</span>
                            <span style="font-weight: 700;">Create Job Quote</span>
                        </button>
                        <button class="action-btn success" onclick="showView('quotes')">
                            <span class="icon">💰</span>
                            <span style="font-weight: 700;">View All Quotes</span>
                        </button>
                        <button class="action-btn warm" onclick="openPresetManager()">
                            <span class="icon">📋</span>
                            <span style="font-weight: 700;">Manage Presets</span>
                        </button>
                        <button class="action-btn info" onclick="exportData()">
                            <span class="icon">📤</span>
                            <span style="font-weight: 700;">Export Data</span>
                        </button>
                    </div>
                </div>

                <!-- Recent Quotes -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">Recent Job Quotes</h3>
                        <button style="background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; font-weight: 600;" onclick="showView('quotes')">View All</button>
                    </div>
                    <div id="recent-quotes"></div>
                </div>
            </div>

            <!-- Quotes View -->
            <div id="quotes-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Job Quotes</h2>
                    <button class="add-btn" onclick="openSimpleJobForm()">
                        <span>➕</span>
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="input" placeholder="Search quotes..." id="quote-search">
                </div>

                <!-- Category Filters -->
                <div class="category-filters">
                    <div class="category-filter active" onclick="filterQuotesByCategory('all')" data-category="all">
                        <span>📋</span>
                        <span>All Quotes</span>
                        <span class="category-count" id="filter-count-all">0</span>
                    </div>
                    <div class="category-filter electrical" onclick="filterQuotesByCategory('electrical')" data-category="electrical">
                        <span>⚡</span>
                        <span>Electrical</span>
                        <span class="category-count" id="filter-count-electrical">0</span>
                    </div>
                    <div class="category-filter plumbing" onclick="filterQuotesByCategory('plumbing')" data-category="plumbing">
                        <span>🔧</span>
                        <span>Plumbing</span>
                        <span class="category-count" id="filter-count-plumbing">0</span>
                    </div>
                    <div class="category-filter hvac" onclick="filterQuotesByCategory('hvac')" data-category="hvac">
                        <span>❄️</span>
                        <span>HVAC</span>
                        <span class="category-count" id="filter-count-hvac">0</span>
                    </div>
                    <div class="category-filter cleaning" onclick="filterQuotesByCategory('cleaning')" data-category="cleaning">
                        <span>🧽</span>
                        <span>Cleaning</span>
                        <span class="category-count" id="filter-count-cleaning">0</span>
                    </div>
                    <div class="category-filter parts" onclick="filterQuotesByCategory('parts')" data-category="parts">
                        <span>🔩</span>
                        <span>Parts</span>
                        <span class="category-count" id="filter-count-parts">0</span>
                    </div>
                    <div class="category-filter labor" onclick="filterQuotesByCategory('labor')" data-category="labor">
                        <span>👷</span>
                        <span>Labor</span>
                        <span class="category-count" id="filter-count-labor">0</span>
                    </div>
                    <div class="category-filter equipment" onclick="filterQuotesByCategory('equipment')" data-category="equipment">
                        <span>🛠️</span>
                        <span>Equipment</span>
                        <span class="category-count" id="filter-count-equipment">0</span>
                    </div>
                </div>

                <div id="quotes-list"></div>
            </div>

            <!-- Presets View -->
            <div id="presets-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Preset Items</h2>
                    <button class="add-btn" onclick="openPresetItemForm()">
                        <span>➕</span>
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="input" placeholder="Search preset items..." id="preset-search">
                </div>

                <!-- Category Filters for Presets -->
                <div class="category-filters">
                    <div class="category-filter active" onclick="filterPresetsByCategory('all')" data-category="all">
                        <span>📋</span>
                        <span>All Items</span>
                        <span class="category-count" id="preset-filter-count-all">0</span>
                    </div>
                    <div class="category-filter electrical" onclick="filterPresetsByCategory('electrical')" data-category="electrical">
                        <span>⚡</span>
                        <span>Electrical</span>
                        <span class="category-count" id="preset-filter-count-electrical">0</span>
                    </div>
                    <div class="category-filter plumbing" onclick="filterPresetsByCategory('plumbing')" data-category="plumbing">
                        <span>🔧</span>
                        <span>Plumbing</span>
                        <span class="category-count" id="preset-filter-count-plumbing">0</span>
                    </div>
                    <div class="category-filter hvac" onclick="filterPresetsByCategory('hvac')" data-category="hvac">
                        <span>❄️</span>
                        <span>HVAC</span>
                        <span class="category-count" id="preset-filter-count-hvac">0</span>
                    </div>
                    <div class="category-filter cleaning" onclick="filterPresetsByCategory('cleaning')" data-category="cleaning">
                        <span>🧽</span>
                        <span>Cleaning</span>
                        <span class="category-count" id="preset-filter-count-cleaning">0</span>
                    </div>
                    <div class="category-filter parts" onclick="filterPresetsByCategory('parts')" data-category="parts">
                        <span>🔩</span>
                        <span>Parts</span>
                        <span class="category-count" id="preset-filter-count-parts">0</span>
                    </div>
                    <div class="category-filter labor" onclick="filterPresetsByCategory('labor')" data-category="labor">
                        <span>👷</span>
                        <span>Labor</span>
                        <span class="category-count" id="preset-filter-count-labor">0</span>
                    </div>
                    <div class="category-filter equipment" onclick="filterPresetsByCategory('equipment')" data-category="equipment">
                        <span>🛠️</span>
                        <span>Equipment</span>
                        <span class="category-count" id="preset-filter-count-equipment">0</span>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-weight: 700; color: var(--text-primary);">📊 Preset Statistics</h3>
                        <span style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 600; color: var(--text-primary);" id="preset-count">0 items</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 14px;">
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Categories</div>
                            <div style="font-weight: 700; color: var(--accent-primary);" id="category-count">0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Avg Price</div>
                            <div style="font-weight: 700; color: var(--accent-warm);" id="avg-preset-price">RM 0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Usage</div>
                            <div style="font-weight: 700; color: var(--text-primary);" id="preset-usage-count">0</div>
                        </div>
                    </div>
                </div>

                <div id="presets-list"></div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="icon">🏠</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="showView('quotes')">
                    <span class="icon">💰</span>
                    <span>Quotes</span>
                </div>
                <div class="nav-item" onclick="showView('presets')">
                    <span class="icon">📋</span>
                    <span>Presets</span>
                </div>
            </div>
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- Simple Job Form Modal -->
    <div id="simple-job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="simple-job-modal-title">💰 Create Job Quote</h3>
                <button class="close-btn" onclick="closeSimpleJobForm()">✕</button>
            </div>
            <div class="modal-body">
                <!-- Job Title Section -->
                <div class="card" style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                        📝 Job Details
                    </h4>
                    <input type="text" class="form-input" placeholder="Job Title/Description *" id="simple-job-title" required style="margin-bottom: 0;">
                </div>

                <!-- Preset Items Section with Categories -->
                <div class="preset-items-section">
                    <div class="preset-items-header">
                        <h4 class="preset-items-title">
                            📋 Quick Add Items
                        </h4>
                        <button type="button" onclick="openPresetItemForm()" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">
                            ➕ New Preset
                        </button>
                    </div>
                    
                    <!-- Category Selector for Presets -->
                    <div style="margin-bottom: 16px;">
                        <select id="preset-category-selector" class="form-input" style="margin-bottom: 0; padding: 12px 16px; font-size: 14px;" onchange="filterPresetItemsInModal()">
                            <option value="all">All Categories</option>
                            <option value="electrical">⚡ Electrical</option>
                            <option value="plumbing">🔧 Plumbing</option>
                            <option value="hvac">❄️ HVAC</option>
                            <option value="cleaning">🧽 Cleaning</option>
                            <option value="parts">🔩 Parts & Materials</option>
                            <option value="labor">👷 Labor</option>
                            <option value="equipment">🛠️ Equipment</option>
                            <option value="common">🏷️ Common Items</option>
                        </select>
                    </div>
                    
                    <div id="preset-items-list"></div>
                </div>

                <!-- Manual Add Section -->
                <div class="quick-add-section">
                    <div class="quick-add-header">
                        <h4 class="quick-add-title">
                            ✏️ Manual Entry
                        </h4>
                    </div>
                    
                    <div class="quick-add-form">
                        <div class="quick-add-row">
                            <input type="text" class="quick-add-input" placeholder="Item Description *" id="manual-description">
                            <input type="number" class="quick-add-input" placeholder="Qty" id="manual-quantity" min="1" step="1" value="1">
                            <input type="number" class="quick-add-input" placeholder="Price (RM)" id="manual-price" step="0.01">
                            <button type="button" class="quick-add-btn" onclick="addManualItem()">
                                ➕ Add
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <select class="quick-add-input" id="manual-unit">
                                <option value="pcs">Pieces (pcs)</option>
                                <option value="hours">Hours</option>
                                <option value="sqft">Square Feet</option>
                                <option value="sqm">Square Meters</option>
                                <option value="meters">Meters</option>
                                <option value="kg">Kilograms</option>
                                <option value="liters">Liters</option>
                                <option value="set">Set</option>
                                <option value="lot">Lot</option>
                                <option value="service">Service</option>
                            </select>
                            
                            <select class="quick-add-input" id="manual-category">
                                <option value="common">🏷️ Common Items</option>
                                <option value="electrical">⚡ Electrical</option>
                                <option value="plumbing">🔧 Plumbing</option>
                                <option value="hvac">❄️ HVAC</option>
                                <option value="cleaning">🧽 Cleaning</option>
                                <option value="parts">🔩 Parts & Materials</option>
                                <option value="labor">👷 Labor</option>
                                <option value="equipment">🛠️ Equipment</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="quick-add-total">
                        <div class="quick-add-total-label">Current Item Total</div>
                        <div class="quick-add-total-value" id="manual-total">RM 0.00</div>
                    </div>
                </div>

                <!-- Quote Items List with Categories -->
                <div id="quote-items-list"></div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="form-btn btn-primary" onclick="saveSimpleJob()">
                        ✅ Save Job Quote
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="closeSimpleJobForm()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Preset Item Form Modal -->
    <div id="preset-item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preset-item-modal-title">➕ Add Preset Item</h3>
                <button class="close-btn" onclick="closePresetItemForm()">✕</button>
            </div>
            <div class="modal-body">
                <form id="preset-item-form">
                    <input type="text" class="form-input" placeholder="Item Name *" id="preset-item-name" required>
                    <textarea class="form-input" placeholder="Description" id="preset-item-description" rows="2" style="resize: none;"></textarea>
                    <input type="number" class="form-input" placeholder="Default Price (RM) *" id="preset-item-price" step="0.01" required>
                    <select class="form-input" id="preset-item-unit">
                        <option value="pcs">Pieces (pcs)</option>
                        <option value="hours">Hours</option>
                        <option value="sqft">Square Feet</option>
                        <option value="sqm">Square Meters</option>
                        <option value="meters">Meters</option>
                        <option value="kg">Kilograms</option>
                        <option value="liters">Liters</option>
                        <option value="set">Set</option>
                        <option value="lot">Lot</option>
                        <option value="service">Service</option>
                    </select>
                    <select class="form-input" id="preset-item-category">
                        <option value="common">🏷️ Common Items</option>
                        <option value="electrical">⚡ Electrical</option>
                        <option value="plumbing">🔧 Plumbing</option>
                        <option value="hvac">❄️ HVAC</option>
                        <option value="cleaning">🧽 Cleaning</option>
                        <option value="parts">🔩 Parts & Materials</option>
                        <option value="labor">👷 Labor</option>
                        <option value="equipment">🛠️ Equipment</option>
                    </select>
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn btn-primary">Save Preset</button>
                        <button type="button" class="form-btn btn-secondary" onclick="closePresetItemForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quote View Modal -->
    <div id="quote-view-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💰 Job Quote Details</h3>
                <button class="close-btn" onclick="closeQuoteView()">✕</button>
            </div>
            <div class="modal-body" id="quote-view-content">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // REFIT MAINTENANCE SERVICES - CATEGORIZED MANAGEMENT SYSTEM
        // Registration No: 201803348973 (002894203-V)
        // Enhanced with Complete Category Organization & Segregation
        // ========================================
        
        // App State Variables
        var currentView = 'dashboard';
        var jobQuotes = [];
        var presetWorkItems = [];
        var currentQuoteItems = [];
        var editingJob = null;
        var editingPreset = null;
        var selectedLogoIndex = 0;
        var currentTheme = 'light';
        var currentQuoteFilter = 'all';
        var currentPresetFilter = 'all';

        // Category Configuration
        var categories = {
            electrical: {
                name: 'Electrical',
                icon: '⚡',
                color: 'var(--cat-electrical)',
                description: 'Electrical systems, wiring, and components'
            },
            plumbing: {
                name: 'Plumbing',
                icon: '🔧',
                color: 'var(--cat-plumbing)',
                description: 'Water systems, pipes, and fixtures'
            },
            hvac: {
                name: 'HVAC',
                icon: '❄️',
                color: 'var(--cat-hvac)',
                description: 'Heating, ventilation, and air conditioning'
            },
            cleaning: {
                name: 'Cleaning',
                icon: '🧽',
                color: 'var(--cat-cleaning)',
                description: 'Cleaning services and maintenance'
            },
            parts: {
                name: 'Parts & Materials',
                icon: '🔩',
                color: 'var(--cat-parts)',
                description: 'Replacement parts and materials'
            },
            labor: {
                name: 'Labor',
                icon: '👷',
                color: 'var(--cat-labor)',
                description: 'Labor charges and work hours'
            },
            equipment: {
                name: 'Equipment',
                icon: '🛠️',
                color: 'var(--cat-equipment)',
                description: 'Tools and equipment'
            },
            common: {
                name: 'Common Items',
                icon: '🏷️',
                color: 'var(--cat-common)',
                description: 'Frequently used items'
            }
        };

        // Logo SVG Templates (Eye-friendly colors)
        var logoTemplates = [
            // Professional Tools
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                <circle cx="50" cy="50" r="3" fill="currentColor"/>
            </svg>`,
            
            // Gear & Wrench
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="25" fill="none" stroke="currentColor" stroke-width="4"/>
                <path d="M50 25L55 35L45 35Z M75 50L65 45L65 55Z M50 75L45 65L55 65Z M25 50L35 55L35 45Z" fill="rgba(255,255,255,0.8)"/>
                <circle cx="50" cy="50" r="8" fill="currentColor"/>
                <path d="M15 15L25 25M20 30L35 45C40 50 50 50 55 45L70 30" stroke="rgba(255,255,255,0.6)" stroke-width="3" fill="none"/>
            </svg>`,
            
            // House Tools
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 15L20 40L25 45L50 25L75 45L80 40Z" fill="currentColor"/>
                <rect x="30" y="40" width="40" height="45" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                <rect x="42" y="65" width="16" height="20" fill="currentColor"/>
                <rect x="35" y="50" width="8" height="8" fill="rgba(255,255,255,0.6)"/>
                <rect x="57" y="50" width="8" height="8" fill="rgba(255,255,255,0.6)"/>
                <path d="M15 70L25 60L30 65L20 75Z" fill="rgba(255,214,102,0.8)"/>
                <path d="M75 70L85 60L90 65L80 75Z" fill="rgba(255,214,102,0.8)"/>
            </svg>`,
            
            // Modern Tech
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <rect x="20" y="20" width="60" height="60" rx="15" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <circle cx="35" cy="35" r="5" fill="rgba(255,255,255,0.8)"/>
                <circle cx="65" cy="35" r="5" fill="rgba(255,255,255,0.8)"/>
                <circle cx="35" cy="65" r="5" fill="rgba(255,255,255,0.8)"/>
                <circle cx="65" cy="65" r="5" fill="rgba(255,255,255,0.8)"/>
                <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.9)"/>
                <path d="M35 50L45 50M55 50L65 50M50 35L50 45M50 55L50 65" stroke="rgba(255,255,255,0.6)" stroke-width="2"/>
            </svg>`,
            
            // Service Badge
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="35" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="3"/>
                <circle cx="50" cy="50" r="25" fill="rgba(255,255,255,0.9)"/>
                <text x="50" y="45" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="currentColor">REFIT</text>
                <text x="50" y="60" text-anchor="middle" font-family="Arial" font-size="8" font-weight="bold" fill="currentColor">SERVICE</text>
                <path d="M30 30L35 25L40 30M60 30L65 25L70 30M30 70L35 75L40 70M60 70L65 75L70 70" stroke="rgba(255,255,255,0.6)" stroke-width="2" fill="none"/>
            </svg>`,
            
            // Lightning Bolt
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M35 15L60 45L45 45L65 85L40 55L55 55L35 15Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <circle cx="25" cy="25" r="8" fill="rgba(255,255,255,0.8)"/>
                <circle cx="75" cy="25" r="8" fill="rgba(255,255,255,0.8)"/>
                <circle cx="25" cy="75" r="8" fill="rgba(255,255,255,0.8)"/>
                <circle cx="75" cy="75" r="8" fill="rgba(255,255,255,0.8)"/>
            </svg>`
        ];

        // Company Settings
        var companySettings = {
            name: 'REFIT MAINTENANCE SERVICES',
            registration: '201803348973 (002894203-V)',
            tagline: 'Professional Maintenance Solutions',
            phone: '+60 3-7967 8888',
            email: 'info@refitmaintenance.my',
            website: 'www.refitmaintenance.my',
            address: 'No. 15, Jalan Teknologi 3/6, Kota Damansara, 47810 Petaling Jaya, Selangor, Malaysia'
        };

        // Storage Keys
        var STORAGE_KEYS = {
            JOB_QUOTES: 'refit_simple_job_quotes',
            PRESET_WORK_ITEMS: 'refit_simple_preset_items',
            SELECTED_LOGO: 'refit_selected_logo',
            THEME_PREFERENCE: 'refit_theme_preference'
        };

        // Enhanced Default Preset Work Items with Better Organization
        var defaultPresetWorkItems = [
            // Electrical Items
            { id: 'electrical-inspection', name: 'Electrical Safety Inspection', description: 'Complete electrical system safety check and certification', price: 150.00, unit: 'service', category: 'electrical' },
            { id: 'led-bulb-basic', name: 'LED Light Bulb (Basic)', description: 'Standard LED bulb replacement 9-12W', price: 15.00, unit: 'pcs', category: 'electrical' },
            { id: 'led-bulb-premium', name: 'LED Light Bulb (Premium)', description: 'High-efficiency LED bulb 15-20W', price: 25.00, unit: 'pcs', category: 'electrical' },
            { id: 'switch-socket-basic', name: 'Switch/Socket Installation', description: 'Install standard electrical switch or socket', price: 45.00, unit: 'pcs', category: 'electrical' },
            { id: 'switch-socket-premium', name: 'Smart Switch Installation', description: 'Install smart switch with app control', price: 85.00, unit: 'pcs', category: 'electrical' },
            { id: 'circuit-breaker', name: 'Circuit Breaker Replacement', description: 'Replace faulty circuit breaker', price: 95.00, unit: 'pcs', category: 'electrical' },
            { id: 'electrical-wiring', name: 'Electrical Wiring', description: 'New electrical wiring installation', price: 12.00, unit: 'meters', category: 'electrical' },
            
            // Plumbing Items
            { id: 'pipe-repair-minor', name: 'Minor Pipe Leak Repair', description: 'Fix small water pipe leaks', price: 65.00, unit: 'service', category: 'plumbing' },
            { id: 'pipe-repair-major', name: 'Major Pipe Repair', description: 'Fix major pipe damage or replacement', price: 150.00, unit: 'service', category: 'plumbing' },
            { id: 'faucet-replacement-basic', name: 'Basic Faucet Replacement', description: 'Replace standard faucet', price: 95.00, unit: 'pcs', category: 'plumbing' },
            { id: 'faucet-replacement-premium', name: 'Premium Faucet Installation', description: 'Install high-end faucet with advanced features', price: 180.00, unit: 'pcs', category: 'plumbing' },
            { id: 'toilet-repair', name: 'Toilet Repair Service', description: 'Fix toilet flush system and components', price: 85.00, unit: 'service', category: 'plumbing' },
            { id: 'drain-cleaning-basic', name: 'Basic Drain Cleaning', description: 'Clear minor blocked drains', price: 55.00, unit: 'service', category: 'plumbing' },
            { id: 'drain-cleaning-heavy', name: 'Heavy Drain Cleaning', description: 'Clear severely blocked drains with equipment', price: 120.00, unit: 'service', category: 'plumbing' },
            { id: 'water-heater-service', name: 'Water Heater Servicing', description: 'Complete water heater maintenance', price: 100.00, unit: 'service', category: 'plumbing' },
            
            // HVAC Items
            { id: 'aircon-service-basic', name: 'Basic AC Servicing', description: 'Standard AC cleaning and maintenance', price: 80.00, unit: 'pcs', category: 'hvac' },
            { id: 'aircon-service-premium', name: 'Premium AC Servicing', description: 'Complete AC deep cleaning and tune-up', price: 120.00, unit: 'pcs', category: 'hvac' },
            { id: 'aircon-gas-topup', name: 'AC Gas Top-up', description: 'Refill AC refrigerant gas R410A', price: 150.00, unit: 'service', category: 'hvac' },
            { id: 'aircon-installation', name: 'AC Unit Installation', description: 'Install new air conditioning unit', price: 300.00, unit: 'pcs', category: 'hvac' },
            { id: 'fan-install-ceiling', name: 'Ceiling Fan Installation', description: 'Install ceiling fan with remote', price: 95.00, unit: 'pcs', category: 'hvac' },
            { id: 'fan-install-exhaust', name: 'Exhaust Fan Installation', description: 'Install bathroom/kitchen exhaust fan', price: 75.00, unit: 'pcs', category: 'hvac' },
            { id: 'vent-cleaning', name: 'Ventilation Cleaning', description: 'Clean air vents and ductwork', price: 45.00, unit: 'sqm', category: 'hvac' },
            { id: 'filter-replacement', name: 'HVAC Filter Replacement', description: 'Replace HVAC system filters', price: 35.00, unit: 'pcs', category: 'hvac' },
            
            // Cleaning Services
            { id: 'office-cleaning-basic', name: 'Basic Office Cleaning', description: 'Standard office cleaning service', price: 25.00, unit: 'sqm', category: 'cleaning' },
            { id: 'office-cleaning-deep', name: 'Deep Office Cleaning', description: 'Comprehensive deep cleaning service', price: 40.00, unit: 'sqm', category: 'cleaning' },
            { id: 'carpet-cleaning-standard', name: 'Standard Carpet Cleaning', description: 'Steam clean carpets', price: 35.00, unit: 'sqm', category: 'cleaning' },
            { id: 'carpet-cleaning-stain', name: 'Stain Removal Carpet Cleaning', description: 'Deep stain removal and cleaning', price: 50.00, unit: 'sqm', category: 'cleaning' },
            { id: 'window-cleaning-interior', name: 'Interior Window Cleaning', description: 'Clean windows inside only', price: 8.00, unit: 'sqm', category: 'cleaning' },
            { id: 'window-cleaning-full', name: 'Full Window Cleaning', description: 'Clean windows inside and outside', price: 15.00, unit: 'sqm', category: 'cleaning' },
            { id: 'floor-waxing', name: 'Floor Waxing Service', description: 'Professional floor waxing and polishing', price: 18.00, unit: 'sqm', category: 'cleaning' },
            
            // Labor Categories
            { id: 'technician-hour-standard', name: 'Standard Technician Labor', description: 'Skilled technician work (regular hours)', price: 45.00, unit: 'hours', category: 'labor' },
            { id: 'technician-hour-overtime', name: 'Overtime Technician Labor', description: 'Skilled technician work (after hours)', price: 65.00, unit: 'hours', category: 'labor' },
            { id: 'specialist-hour', name: 'Specialist Technician', description: 'Highly skilled specialist work', price: 75.00, unit: 'hours', category: 'labor' },
            { id: 'helper-hour-standard', name: 'Helper Labor', description: 'General helper work', price: 25.00, unit: 'hours', category: 'labor' },
            { id: 'emergency-callout', name: 'Emergency Call-out Fee', description: 'After-hours emergency service fee', price: 180.00, unit: 'service', category: 'labor' },
            { id: 'transportation-fee', name: 'Transportation Fee', description: 'Travel charges for site visits', price: 30.00, unit: 'service', category: 'labor' },
            
            // Parts & Materials
            { id: 'electrical-cable-standard', name: 'Standard Electrical Cable', description: 'Standard wiring cable 2.5mm²', price: 8.50, unit: 'meters', category: 'parts' },
            { id: 'electrical-cable-heavy', name: 'Heavy Duty Cable', description: 'Heavy duty electrical cable 4.0mm²', price: 15.00, unit: 'meters', category: 'parts' },
            { id: 'pvc-pipe-half', name: 'PVC Pipe 1/2 inch', description: 'Water pipe material 1/2 inch diameter', price: 8.00, unit: 'meters', category: 'parts' },
            { id: 'pvc-pipe-full', name: 'PVC Pipe 1 inch', description: 'Water pipe material 1 inch diameter', price: 12.00, unit: 'meters', category: 'parts' },
            { id: 'door-lock-basic', name: 'Basic Door Lock', description: 'Standard security door lock', price: 65.00, unit: 'pcs', category: 'parts' },
            { id: 'door-lock-premium', name: 'Premium Door Lock', description: 'High-security door lock with multiple keys', price: 120.00, unit: 'pcs', category: 'parts' },
            { id: 'pipe-fittings', name: 'Pipe Fittings Set', description: 'Assorted pipe fittings and connectors', price: 25.00, unit: 'set', category: 'parts' },
            { id: 'electrical-box', name: 'Electrical Junction Box', description: 'Waterproof electrical junction box', price: 18.00, unit: 'pcs', category: 'parts' },
            
            // Equipment
            { id: 'power-drill-rental', name: 'Power Drill Rental', description: 'Professional power drill rental per day', price: 35.00, unit: 'hours', category: 'equipment' },
            { id: 'ladder-rental', name: 'Extension Ladder Rental', description: 'Extension ladder rental per day', price: 25.00, unit: 'hours', category: 'equipment' },
            { id: 'cleaning-machine', name: 'Cleaning Machine Usage', description: 'Professional cleaning machine operation', price: 50.00, unit: 'hours', category: 'equipment' },
            { id: 'generator-rental', name: 'Generator Rental', description: 'Portable generator rental', price: 80.00, unit: 'hours', category: 'equipment' },
            
            // Common Items
            { id: 'service-call', name: 'Standard Service Call', description: 'Basic service call and assessment', price: 75.00, unit: 'service', category: 'common' },
            { id: 'consultation', name: 'Technical Consultation', description: 'Professional technical consultation', price: 100.00, unit: 'service', category: 'common' },
            { id: 'material-delivery', name: 'Material Delivery', description: 'Delivery of materials to site', price: 40.00, unit: 'service', category: 'common' },
            { id: 'warranty-service', name: 'Warranty Service', description: 'Warranty-covered service work', price: 0.00, unit: 'service', category: 'common' }
        ];

        // Theme Management Functions
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            // Update meta theme color
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#2d3748' : '#1a1a1a';
            }
            
            localStorage.setItem(STORAGE_KEYS.THEME_PREFERENCE, currentTheme);
            showSuccessMessage(currentTheme === 'light' ? '☀️ Light mode activated' : '🌙 Dark mode activated - Easy on the eyes!');
        }

        function loadThemePreference() {
            var savedTheme = localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE);
            
            // Auto-detect system preference if no saved theme
            if (!savedTheme) {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    savedTheme = 'dark';
                } else {
                    savedTheme = 'light';
                }
            }
            
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            // Update meta theme color
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#2d3748' : '#1a1a1a';
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadThemePreference();
            loadDataFromStorage();
            setupEventListeners();
            setupMobileOptimizations();
            updateStatusBar();
            updateCurrentDate();
            updateStats();
            renderViews();
            loadSelectedLogo();
            updateCategoryFilters();
            
            showSuccessMessage('📋 REFIT MAINTENANCE - Complete Category System Ready!');
            console.log('🔧 REFIT MAINTENANCE SERVICES - Categorized Management System');
            console.log('📊 Advanced Category Organization & Filtering');
            console.log('👁️ Eye-Friendly Design for Extended Use');
        }

        // Category Management Functions
        function getCategoryIcon(category) {
            return categories[category] ? categories[category].icon : '🏷️';
        }

        function getCategoryName(category) {
            return categories[category] ? categories[category].name : 'Unknown';
        }

        function getCategoryColor(category) {
            return categories[category] ? categories[category].color : 'var(--cat-common)';
        }

        function filterQuotesByCategory(category) {
            currentQuoteFilter = category;
            
            // Update filter buttons
            var filters = document.querySelectorAll('.category-filter[data-category]');
            for (var i = 0; i < filters.length; i++) {
                filters[i].classList.remove('active');
            }
            
            var activeFilter = document.querySelector('.category-filter[data-category="' + category + '"]');
            if (activeFilter) {
                activeFilter.classList.add('active');
            }
            
            renderQuotes();
            showSuccessMessage('📋 Filtered by ' + (category === 'all' ? 'All Categories' : getCategoryName(category)));
        }

        function filterPresetsByCategory(category) {
            currentPresetFilter = category;
            
            // Update filter buttons
            var filters = document.querySelectorAll('#presets-view .category-filter[data-category]');
            for (var i = 0; i < filters.length; i++) {
                filters[i].classList.remove('active');
            }
            
            var activeFilter = document.querySelector('#presets-view .category-filter[data-category="' + category + '"]');
            if (activeFilter) {
                activeFilter.classList.add('active');
            }
            
            renderPresets();
            showSuccessMessage('📋 Filtered by ' + (category === 'all' ? 'All Categories' : getCategoryName(category)));
        }

        function filterPresetItemsInModal() {
            var selectedCategory = document.getElementById('preset-category-selector').value;
            renderPresetItems(selectedCategory);
        }

        function updateCategoryFilters() {
            updateQuoteCategoryFilters();
            updatePresetCategoryFilters();
        }

        function updateQuoteCategoryFilters() {
            var categoryCounts = { all: jobQuotes.length };
            
            // Initialize category counts
            for (var catKey in categories) {
                categoryCounts[catKey] = 0;
            }
            
            // Count quotes by category
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                var quoteCategories = {};
                
                for (var j = 0; j < quote.items.length; j++) {
                    var item = quote.items[j];
                    var itemCategory = item.category || 'common';
                    quoteCategories[itemCategory] = true;
                }
                
                for (var cat in quoteCategories) {
                    if (categoryCounts[cat] !== undefined) {
                        categoryCounts[cat]++;
                    }
                }
            }
            
            // Update filter counts
            for (var catKey in categoryCounts) {
                var countElement = document.getElementById('filter-count-' + catKey);
                if (countElement) {
                    countElement.textContent = categoryCounts[catKey];
                }
            }
        }

        function updatePresetCategoryFilters() {
            var categoryCounts = { all: presetWorkItems.length };
            
            // Initialize category counts
            for (var catKey in categories) {
                categoryCounts[catKey] = 0;
            }
            
            // Count presets by category
            for (var i = 0; i < presetWorkItems.length; i++) {
                var preset = presetWorkItems[i];
                var category = preset.category || 'common';
                if (categoryCounts[category] !== undefined) {
                    categoryCounts[category]++;
                }
            }
            
            // Update filter counts
            for (var catKey in categoryCounts) {
                var countElement = document.getElementById('preset-filter-count-' + catKey);
                if (countElement) {
                    countElement.textContent = categoryCounts[catKey];
                }
            }
        }

        // Logo Management Functions
        function openLogoSelector() {
            document.getElementById('logo-selector').classList.add('show');
            loadCurrentSelection();
            showSuccessMessage('🎨 Choose your professional logo design');
        }

        function closeLogoSelector() {
            document.getElementById('logo-selector').classList.remove('show');
        }

        function selectLogo(index) {
            // Remove previous selections
            var options = document.querySelectorAll('.logo-option');
            for (var i = 0; i < options.length; i++) {
                options[i].classList.remove('selected');
            }
            
            // Add selection to clicked option
            var selectedOption = document.querySelector('.logo-option[data-logo="' + index + '"]');
            if (selectedOption) {
                selectedOption.classList.add('selected');
                selectedLogoIndex = index;
            }
        }

        function loadCurrentSelection() {
            var savedLogo = localStorage.getItem(STORAGE_KEYS.SELECTED_LOGO);
            if (savedLogo !== null) {
                selectedLogoIndex = parseInt(savedLogo);
            }
            
            // Update UI selection
            var options = document.querySelectorAll('.logo-option');
            for (var i = 0; i < options.length; i++) {
                options[i].classList.remove('selected');
            }
            
            var currentOption = document.querySelector('.logo-option[data-logo="' + selectedLogoIndex + '"]');
            if (currentOption) {
                currentOption.classList.add('selected');
            }
        }

        function applySelectedLogo() {
            var logoContainer = document.getElementById('main-logo');
            if (logoContainer && logoTemplates[selectedLogoIndex]) {
                logoContainer.innerHTML = logoTemplates[selectedLogoIndex];
                
                // Save selection
                localStorage.setItem(STORAGE_KEYS.SELECTED_LOGO, selectedLogoIndex.toString());
                
                closeLogoSelector();
                showSuccessMessage('✅ Professional logo applied successfully!');
            }
        }

        function loadSelectedLogo() {
            var savedLogo = localStorage.getItem(STORAGE_KEYS.SELECTED_LOGO);
            if (savedLogo !== null) {
                selectedLogoIndex = parseInt(savedLogo);
                var logoContainer = document.getElementById('main-logo');
                if (logoContainer && logoTemplates[selectedLogoIndex]) {
                    logoContainer.innerHTML = logoTemplates[selectedLogoIndex];
                }
            }
        }

        // Data Management Functions
        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.JOB_QUOTES, JSON.stringify(jobQuotes));
                localStorage.setItem(STORAGE_KEYS.PRESET_WORK_ITEMS, JSON.stringify(presetWorkItems));
                localStorage.setItem(STORAGE_KEYS.SELECTED_LOGO, selectedLogoIndex.toString());
                localStorage.setItem(STORAGE_KEYS.THEME_PREFERENCE, currentTheme);
            } catch (e) {
                console.warn('Storage error:', e);
                showSuccessMessage('⚠️ Storage full! Please export data.');
            }
        }

        function loadDataFromStorage() {
            try {
                var savedQuotes = localStorage.getItem(STORAGE_KEYS.JOB_QUOTES);
                if (savedQuotes) {
                    jobQuotes = JSON.parse(savedQuotes);
                }

                var savedPresets = localStorage.getItem(STORAGE_KEYS.PRESET_WORK_ITEMS);
                if (savedPresets) {
                    presetWorkItems = JSON.parse(savedPresets);
                } else {
                    presetWorkItems = [...defaultPresetWorkItems];
                    saveDataToStorage();
                }

                var savedLogo = localStorage.getItem(STORAGE_KEYS.SELECTED_LOGO);
                if (savedLogo !== null) {
                    selectedLogoIndex = parseInt(savedLogo);
                }
            } catch (e) {
                console.warn('Load error:', e);
                presetWorkItems = [...defaultPresetWorkItems];
                selectedLogoIndex = 0;
            }
        }

        // Simple Job Form Functions
        function openSimpleJobForm() {
            currentQuoteItems = [];
            editingJob = null;
            document.getElementById('simple-job-modal-title').textContent = '💰 Create Job Quote';
            document.getElementById('simple-job-title').value = '';
            document.getElementById('preset-category-selector').value = 'all';
            renderPresetItems('all');
            updateQuoteItemsDisplay();
            document.getElementById('simple-job-modal').classList.add('show');
            showSuccessMessage('💰 Simple Job Quote form opened!');
        }

        function closeSimpleJobForm() {
            document.getElementById('simple-job-modal').classList.remove('show');
            currentQuoteItems = [];
            updateQuoteItemsDisplay();
        }

        function renderPresetItems(filterCategory) {
            filterCategory = filterCategory || 'all';
            var container = document.getElementById('preset-items-list');
            if (!container) return;
            
            var filteredItems = presetWorkItems.filter(function(item) {
                return filterCategory === 'all' || item.category === filterCategory;
            });
            
            if (filteredItems.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 32px; margin-bottom: 8px;">📋</div>' +
                    '<p>No preset items in this category</p>' +
                    '<p style="font-size: 12px; margin-top: 4px;">Try selecting a different category</p>' +
                    '</div>';
                return;
            }
            
            // Group items by category for better organization
            var groupedItems = {};
            for (var i = 0; i < filteredItems.length; i++) {
                var item = filteredItems[i];
                var category = item.category || 'common';
                if (!groupedItems[category]) {
                    groupedItems[category] = [];
                }
                groupedItems[category].push(item);
            }
            
            var html = '';
            
            if (filterCategory === 'all') {
                // Show all categories grouped
                for (var category in groupedItems) {
                    var categoryItems = groupedItems[category];
                    if (categoryItems.length === 0) continue;
                    
                    html += '<div style="margin-bottom: 20px;">' +
                        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; padding: 8px 12px; background: var(--bg-secondary); border-radius: 8px;">' +
                        '<span style="font-size: 18px;">' + getCategoryIcon(category) + '</span>' +
                        '<span style="font-weight: 700; color: var(--text-primary);">' + getCategoryName(category) + '</span>' +
                        '<span class="category-badge category-' + category + '">' + categoryItems.length + '</span>' +
                        '</div>';
                    
                    for (var j = 0; j < categoryItems.length; j++) {
                        var item = categoryItems[j];
                        html += renderPresetItemCard(item);
                    }
                    
                    html += '</div>';
                }
            } else {
                // Show items in selected category only
                for (var i = 0; i < filteredItems.length; i++) {
                    var item = filteredItems[i];
                    html += renderPresetItemCard(item);
                }
            }
            
            container.innerHTML = html;
        }

        function renderPresetItemCard(item) {
            return '<div class="preset-item" onclick="selectPresetItem(\'' + item.id + '\')">' +
                '<div class="preset-item-info">' +
                '<div class="preset-item-name">' +
                '<span class="category-badge category-' + item.category + '">' + getCategoryIcon(item.category) + '</span>' +
                item.name + '</div>' +
                '<div class="preset-item-details">' + item.description + ' • ' + item.unit + '</div>' +
                '</div>' +
                '<div style="display: flex; align-items: center;">' +
                '<div class="preset-item-price">RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                '<button class="preset-item-add" onclick="event.stopPropagation(); addPresetToQuote(\'' + item.id + '\')">' +
                '➕ Add' +
                '</button>' +
                '</div>' +
                '</div>';
        }

        function selectPresetItem(itemId) {
            var item = presetWorkItems.find(function(item) { return item.id === itemId; });
            if (!item) return;
            
            document.getElementById('manual-description').value = item.name;
            document.getElementById('manual-quantity').value = '1';
            document.getElementById('manual-price').value = item.price;
            document.getElementById('manual-unit').value = item.unit;
            document.getElementById('manual-category').value = item.category;
            
            updateManualTotal();
            showSuccessMessage('✅ "' + item.name + '" selected for manual entry');
        }

        function addPresetToQuote(itemId) {
            var item = presetWorkItems.find(function(item) { return item.id === itemId; });
            if (!item) return;
            
            var quoteItem = {
                id: Date.now(),
                description: item.name,
                quantity: 1,
                price: item.price,
                unit: item.unit,
                category: item.category,
                total: item.price,
                isPreset: true,
                presetId: item.id
            };
            
            currentQuoteItems.push(quoteItem);
            updateQuoteItemsDisplay();
            showSuccessMessage('✅ "' + item.name + '" added to quote!');
        }

        function updateManualTotal() {
            var quantity = parseFloat(document.getElementById('manual-quantity').value) || 0;
            var price = parseFloat(document.getElementById('manual-price').value) || 0;
            var total = quantity * price;
            
            var totalElement = document.getElementById('manual-total');
            if (totalElement) {
                totalElement.textContent = 'RM ' + total.toFixed(2);
            }
        }

        function addManualItem() {
            var description = document.getElementById('manual-description').value.trim();
            var quantity = parseFloat(document.getElementById('manual-quantity').value);
            var price = parseFloat(document.getElementById('manual-price').value);
            var unit = document.getElementById('manual-unit').value;
            var category = document.getElementById('manual-category').value;
            
            if (!description || !quantity || !price) {
                showSuccessMessage('⚠️ Please fill in all required fields!');
                return;
            }
            
            var quoteItem = {
                id: Date.now(),
                description: description,
                quantity: quantity,
                price: price,
                unit: unit,
                category: category,
                total: quantity * price,
                isPreset: false
            };
            
            currentQuoteItems.push(quoteItem);
            
            // Clear form
            document.getElementById('manual-description').value = '';
            document.getElementById('manual-quantity').value = '1';
            document.getElementById('manual-price').value = '';
            document.getElementById('manual-unit').value = 'pcs';
            document.getElementById('manual-category').value = 'common';
            
            updateManualTotal();
            updateQuoteItemsDisplay();
            showSuccessMessage('✅ Quote item added manually!');
        }

        function updateQuoteItemsDisplay() {
            var container = document.getElementById('quote-items-list');
            if (!container) return;
            
            if (currentQuoteItems.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            // Group items by category
            var groupedItems = {};
            var total = 0;
            
            for (var i = 0; i < currentQuoteItems.length; i++) {
                var item = currentQuoteItems[i];
                var category = item.category || 'common';
                total += item.total;
                
                if (!groupedItems[category]) {
                    groupedItems[category] = [];
                }
                groupedItems[category].push({ item: item, index: i });
            }
            
            var html = '<div class="quote-items-container">' +
                '<div class="quote-items-header">' +
                '<div class="quote-items-title">💰 Quote Items (' + currentQuoteItems.length + ')</div>' +
                '<button type="button" onclick="clearAllQuoteItems()" style="background: var(--error); color: white; border: none; border-radius: 8px; padding: 4px 8px; font-size: 12px; cursor: pointer;">Clear All</button>' +
                '</div>';
            
            // Render items grouped by category
            for (var category in groupedItems) {
                var categoryItems = groupedItems[category];
                var categoryTotal = 0;
                
                for (var j = 0; j < categoryItems.length; j++) {
                    categoryTotal += categoryItems[j].item.total;
                }
                
                html += '<div class="category-section ' + category + '" style="margin-bottom: 16px;">' +
                    '<div class="category-header">' +
                    '<div class="category-title">' +
                    '<div class="category-icon ' + category + '">' + getCategoryIcon(category) + '</div>' +
                    '<span>' + getCategoryName(category) + '</span>' +
                    '</div>' +
                    '<div class="category-stats">' +
                    '<span>' + categoryItems.length + ' items</span>' +
                    '<span style="font-weight: 700; color: var(--accent-primary);">RM ' + categoryTotal.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>' +
                    '<div class="category-body">';
                
                for (var j = 0; j < categoryItems.length; j++) {
                    var itemData = categoryItems[j];
                    var item = itemData.item;
                    var index = itemData.index;
                    
                    html += '<div class="quote-item">' +
                        '<div class="quote-item-header">' +
                        '<div class="quote-item-title">' +
                        '<span class="category-badge category-' + category + '">' + getCategoryIcon(category) + '</span>' +
                        item.description + (item.isPreset ? ' 🏷️' : '') + '</div>' +
                        '<div class="quote-item-actions">' +
                        '<button class="quote-item-btn quote-item-edit" onclick="editQuoteItem(' + index + ')" title="Edit">✏️</button>' +
                        '<button class="quote-item-btn quote-item-delete" onclick="deleteQuoteItem(' + index + ')" title="Delete">🗑️</button>' +
                        '</div>' +
                        '</div>' +
                        '<div class="quote-item-details">' +
                        '<div class="quote-item-detail">' +
                        '<div class="quote-item-detail-label">Quantity</div>' +
                        '<div class="quote-item-detail-value">' + item.quantity + ' ' + item.unit + '</div>' +
                        '</div>' +
                        '<div class="quote-item-detail">' +
                        '<div class="quote-item-detail-label">Unit Price</div>' +
                        '<div class="quote-item-detail-value">RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                        '</div>' +
                        '<div class="quote-item-detail">' +
                        '<div class="quote-item-detail-label">Total</div>' +
                        '<div class="quote-item-detail-value">RM ' + item.total.toFixed(2) + '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>';
                }
                
                html += '</div></div>';
            }
            
            if (total > 0) {
                html += '<div class="quote-total-section">' +
                    '<div class="quote-total-label">Total Quote Amount</div>' +
                    '<div class="quote-total-value">RM ' + total.toFixed(2) + '</div>' +
                    '</div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function editQuoteItem(index) {
            var item = currentQuoteItems[index];
            if (!item) return;
            
            document.getElementById('manual-description').value = item.description;
            document.getElementById('manual-quantity').value = item.quantity;
            document.getElementById('manual-price').value = item.price;
            document.getElementById('manual-unit').value = item.unit;
            document.getElementById('manual-category').value = item.category || 'common';
            
            deleteQuoteItem(index);
            updateManualTotal();
            showSuccessMessage('📝 Item loaded for editing');
        }

        function deleteQuoteItem(index) {
            if (index >= 0 && index < currentQuoteItems.length) {
                var item = currentQuoteItems[index];
                currentQuoteItems.splice(index, 1);
                updateQuoteItemsDisplay();
                showSuccessMessage('🗑️ "' + item.description + '" removed');
            }
        }

        function clearAllQuoteItems() {
            if (currentQuoteItems.length === 0) {
                showSuccessMessage('ℹ️ No items to clear');
                return;
            }
            
            if (confirm('Clear all quote items?\nThis action cannot be undone.')) {
                currentQuoteItems = [];
                updateQuoteItemsDisplay();
                showSuccessMessage('🗑️ All quote items cleared');
            }
        }

        function saveSimpleJob() {
            var title = document.getElementById('simple-job-title').value.trim();
            
            if (!title) {
                showSuccessMessage('⚠️ Please enter a job title!');
                return;
            }
            
            if (currentQuoteItems.length === 0) {
                showSuccessMessage('⚠️ Please add at least one quote item!');
                return;
            }
            
            var totalAmount = 0;
            for (var i = 0; i < currentQuoteItems.length; i++) {
                totalAmount += currentQuoteItems[i].total;
            }
            
            var jobData = {
                id: editingJob ? editingJob.id : Date.now(),
                title: title,
                items: [...currentQuoteItems],
                totalAmount: totalAmount,
                createdAt: editingJob ? editingJob.createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (editingJob) {
                var index = jobQuotes.findIndex(function(job) { return job.id === editingJob.id; });
                if (index !== -1) {
                    jobQuotes[index] = jobData;
                }
                showSuccessMessage('✏️ Job quote updated successfully!');
            } else {
                jobQuotes.push(jobData);
                showSuccessMessage('✅ Job quote created successfully!');
            }
            
            closeSimpleJobForm();
            saveDataToStorage();
            updateStats();
            renderViews();
            updateCategoryFilters();
            showView('quotes');
        }

        // Preset Management Functions
        function openPresetManager() {
            showView('presets');
        }

        function openPresetItemForm() {
            editingPreset = null;
            document.getElementById('preset-item-modal-title').textContent = '➕ Add Preset Item';
            document.getElementById('preset-item-form').reset();
            document.getElementById('preset-item-modal').classList.add('show');
        }

        function closePresetItemForm() {
            document.getElementById('preset-item-modal').classList.remove('show');
            editingPreset = null;
        }

        function handlePresetItemSubmit(e) {
            e.preventDefault();
            
            var name = document.getElementById('preset-item-name').value.trim();
            var price = parseFloat(document.getElementById('preset-item-price').value);
            
            if (!name || !price) {
                showSuccessMessage('⚠️ Please fill in all required fields!');
                return;
            }

            var itemData = {
                id: editingPreset ? editingPreset.id : (name.toLowerCase().replace(/[^a-z0-9]/g, '-') + '-' + Date.now()),
                name: name,
                description: document.getElementById('preset-item-description').value.trim(),
                price: price,
                unit: document.getElementById('preset-item-unit').value,
                category: document.getElementById('preset-item-category').value,
                createdAt: editingPreset ? editingPreset.createdAt : new Date().toISOString()
            };

            if (editingPreset) {
                var index = presetWorkItems.findIndex(function(item) { return item.id === editingPreset.id; });
                if (index !== -1) {
                    presetWorkItems[index] = itemData;
                }
                showSuccessMessage('✏️ Preset item updated successfully');
            } else {
                presetWorkItems.push(itemData);
                showSuccessMessage('✅ Preset item added successfully');
            }

            closePresetItemForm();
            saveDataToStorage();
            updateStats();
            renderViews();
            updateCategoryFilters();
            renderPresetItems(document.getElementById('preset-category-selector').value);
        }

        function editPresetItem(id) {
            var item = presetWorkItems.find(function(item) { return item.id === id; });
            if (!item) return;

            editingPreset = item;
            document.getElementById('preset-item-modal-title').textContent = '✏️ Edit Preset Item';
            document.getElementById('preset-item-name').value = item.name;
            document.getElementById('preset-item-description').value = item.description || '';
            document.getElementById('preset-item-price').value = item.price;
            document.getElementById('preset-item-unit').value = item.unit;
            document.getElementById('preset-item-category').value = item.category;
            document.getElementById('preset-item-modal').classList.add('show');
        }

        function deletePresetItem(id) {
            var item = presetWorkItems.find(function(item) { return item.id === id; });
            if (!item) return;

            if (confirm('Delete preset item: "' + item.name + '"?\nThis action cannot be undone.')) {
                presetWorkItems = presetWorkItems.filter(function(item) { return item.id !== id; });
                saveDataToStorage();
                updateStats();
                renderViews();
                updateCategoryFilters();
                renderPresetItems(document.getElementById('preset-category-selector').value);
                showSuccessMessage('🗑️ Preset item deleted successfully');
            }
        }

        // Quote Management Functions
        function renderQuotes(searchTerm) {
            searchTerm = searchTerm || '';
            
            var filteredQuotes = jobQuotes.filter(function(quote) {
                var matchesSearch = quote.title.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1;
                var matchesCategory = currentQuoteFilter === 'all' || quoteHasCategory(quote, currentQuoteFilter);
                return matchesSearch && matchesCategory;
            });

            var container = document.getElementById('quotes-list');
            if (!container) return;
            
            if (filteredQuotes.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">💰</div>' +
                    '<p style="font-weight: 600;">No job quotes found</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create your first job quote or try different filters</p>' +
                    '</div>';
                return;
            }
            
            var quotesHTML = '';
            
            for (var i = 0; i < filteredQuotes.length; i++) {
                var quote = filteredQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                
                quotesHTML += '<div class="item-card">' +
                    '<div class="item-header">' +
                    '<div class="item-info">' +
                    '<h3>' + quote.title + '</h3>' +
                    '<div style="font-size: 14px; color: var(--text-secondary); margin: 8px 0;">' +
                    '📋 ' + quote.items.length + ' items • 📅 ' + formatDate(quote.createdAt) +
                    '</div>' +
                    '<div style="margin: 8px 0;">' + renderCategoryBadges(quoteCategories) + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="item-actions">' +
                    '<button class="icon-btn quote-btn" onclick="viewQuote(' + quote.id + ')" title="View Quote">👁️</button>' +
                    '<button class="icon-btn pdf-btn" onclick="generateQuotePDF(' + quote.id + ')" title="Generate PDF">📄</button>' +
                    '<button class="icon-btn edit-btn" onclick="editQuote(' + quote.id + ')" title="Edit Quote">✏️</button>' +
                    '<button class="icon-btn delete-btn" onclick="deleteQuote(' + quote.id + ')" title="Delete Quote">🗑️</button>' +
                    '</div>' +
                    '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">' +
                    '<span style="font-size: 12px; color: var(--text-muted);">Items: ' + quote.items.length + '</span>' +
                    '<span style="font-size: 18px; color: var(--accent-primary); font-weight: 700;">RM ' + quote.totalAmount.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = quotesHTML;
        }

        function quoteHasCategory(quote, category) {
            for (var i = 0; i < quote.items.length; i++) {
                var item = quote.items[i];
                if ((item.category || 'common') === category) {
                    return true;
                }
            }
            return false;
        }

        function getQuoteCategories(quote) {
            var categories = {};
            for (var i = 0; i < quote.items.length; i++) {
                var item = quote.items[i];
                var category = item.category || 'common';
                categories[category] = true;
            }
            return Object.keys(categories);
        }

        function renderCategoryBadges(categoryList) {
            var html = '';
            for (var i = 0; i < categoryList.length && i < 3; i++) {
                var category = categoryList[i];
                html += '<span class="category-badge category-' + category + '">' + getCategoryIcon(category) + ' ' + getCategoryName(category) + '</span>';
            }
            if (categoryList.length > 3) {
                html += '<span class="category-badge" style="background: var(--text-muted);">+' + (categoryList.length - 3) + ' more</span>';
            }
            return html;
        }

        function viewQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            var quoteCategories = getQuoteCategories(quote);
            
            var quoteHTML = '<div class="card" style="margin-bottom: 20px;">' +
                '<div style="font-size: 18px; font-weight: 700; color: var(--accent-primary); margin-bottom: 8px;">💰 Job Quote #' + quote.id + '</div>' +
                '<div style="color: var(--text-secondary); font-size: 14px; font-weight: 600; margin-bottom: 12px;">' + quote.title + '</div>' +
                '<div>' + renderCategoryBadges(quoteCategories) + '</div>' +
                '</div>' +
                
                '<div class="card" style="margin-bottom: 20px;">' +
                '<h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">📋 Quote Details</h4>' +
                '<div style="display: grid; gap: 12px; font-size: 14px;">' +
                '<div><strong>Total Items:</strong> ' + quote.items.length + '</div>' +
                '<div><strong>Categories:</strong> ' + quoteCategories.length + '</div>' +
                '<div><strong>Created:</strong> ' + formatDate(quote.createdAt) + '</div>' +
                '<div><strong>Last Updated:</strong> ' + formatDate(quote.updatedAt) + '</div>' +
                '</div>' +
                '</div>';
            
            if (quote.items.length > 0) {
                // Group items by category for display
                var groupedItems = {};
                for (var i = 0; i < quote.items.length; i++) {
                    var item = quote.items[i];
                    var category = item.category || 'common';
                    if (!groupedItems[category]) {
                        groupedItems[category] = [];
                    }
                    groupedItems[category].push(item);
                }
                
                quoteHTML += '<div class="card" style="margin-bottom: 20px;">' +
                    '<h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">💼 Quote Items by Category</h4>';
                
                for (var category in groupedItems) {
                    var categoryItems = groupedItems[category];
                    var categoryTotal = 0;
                    
                    for (var j = 0; j < categoryItems.length; j++) {
                        categoryTotal += categoryItems[j].total;
                    }
                    
                    quoteHTML += '<div class="category-section ' + category + '" style="margin-bottom: 16px;">' +
                        '<div class="category-header">' +
                        '<div class="category-title">' +
                        '<div class="category-icon ' + category + '">' + getCategoryIcon(category) + '</div>' +
                        '<span>' + getCategoryName(category) + '</span>' +
                        '</div>' +
                        '<div class="category-stats">' +
                        '<span>' + categoryItems.length + ' items</span>' +
                        '<span style="font-weight: 700; color: var(--accent-primary);">RM ' + categoryTotal.toFixed(2) + '</span>' +
                        '</div>' +
                        '</div>' +
                        '<div class="category-body">';
                    
                    for (var j = 0; j < categoryItems.length; j++) {
                        var item = categoryItems[j];
                        
                        quoteHTML += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color);">' +
                            '<div style="font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">' +
                            '<span class="category-badge category-' + category + '">' + getCategoryIcon(category) + '</span>' +
                            item.description + (item.isPreset ? ' 🏷️' : '') + '</div>' +
                            '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 13px; color: var(--text-secondary);">' +
                            '<div><strong>Qty:</strong> ' + item.quantity + ' ' + item.unit + '</div>' +
                            '<div><strong>Price:</strong> RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                            '<div><strong>Total:</strong> RM ' + item.total.toFixed(2) + '</div>' +
                            '</div>' +
                            '</div>';
                    }
                    
                    quoteHTML += '</div></div>';
                }
                
                quoteHTML += '<div class="quote-total-section">' +
                    '<div class="quote-total-label">Total Quote Amount</div>' +
                    '<div class="quote-total-value">RM ' + quote.totalAmount.toFixed(2) + '</div>' +
                    '</div>' +
                    '</div>';
            }
            
            quoteHTML += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 20px;">' +
                '<button onclick="generateQuotePDF(' + quote.id + ')" class="btn btn-success" style="font-size: 14px;">📄 Generate PDF</button>' +
                '<button onclick="editQuote(' + quote.id + ')" class="btn btn-primary" style="font-size: 14px;">✏️ Edit Quote</button>' +
                '</div>';
            
            document.getElementById('quote-view-content').innerHTML = quoteHTML;
            document.getElementById('quote-view-modal').classList.add('show');
        }

        function closeQuoteView() {
            document.getElementById('quote-view-modal').classList.remove('show');
        }

        function editQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            editingJob = quote;
            currentQuoteItems = [...quote.items];
            
            document.getElementById('simple-job-modal-title').textContent = '✏️ Edit Job Quote';
            document.getElementById('simple-job-title').value = quote.title;
            document.getElementById('preset-category-selector').value = 'all';
            
            renderPresetItems('all');
            updateQuoteItemsDisplay();
            document.getElementById('simple-job-modal').classList.add('show');
            showSuccessMessage('✏️ Editing: ' + quote.title);
        }

        function deleteQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;

            if (confirm('Delete job quote: "' + quote.title + '"?\nThis action cannot be undone.')) {
                jobQuotes = jobQuotes.filter(function(q) { return q.id !== quoteId; });
                saveDataToStorage();
                updateStats();
                renderViews();
                updateCategoryFilters();
                showSuccessMessage('🗑️ Job quote deleted successfully');
            }
        }

        // Preset List Rendering
        function renderPresets(searchTerm) {
            searchTerm = searchTerm || '';
            
            var filteredPresets = presetWorkItems.filter(function(preset) {
                var matchesSearch = preset.name.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1 ||
                       (preset.description && preset.description.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1);
                var matchesCategory = currentPresetFilter === 'all' || preset.category === currentPresetFilter;
                return matchesSearch && matchesCategory;
            });

            var container = document.getElementById('presets-list');
            if (!container) return;
            
            if (filteredPresets.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">📋</div>' +
                    '<p style="font-weight: 600;">No preset items found</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create preset items or try different filters</p>' +
                    '</div>';
                return;
            }
            
            // Group presets by category
            var groupedPresets = {};
            for (var i = 0; i < filteredPresets.length; i++) {
                var preset = filteredPresets[i];
                var category = preset.category || 'common';
                if (!groupedPresets[category]) {
                    groupedPresets[category] = [];
                }
                groupedPresets[category].push(preset);
            }
            
            var presetsHTML = '';
            
            if (currentPresetFilter === 'all') {
                // Show all categories grouped
                for (var category in groupedPresets) {
                    var categoryPresets = groupedPresets[category];
                    if (categoryPresets.length === 0) continue;
                    
                    var categoryTotal = 0;
                    for (var j = 0; j < categoryPresets.length; j++) {
                        categoryTotal += categoryPresets[j].price;
                    }
                    var categoryAverage = categoryTotal / categoryPresets.length;
                    
                    presetsHTML += '<div class="category-section ' + category + '">' +
                        '<div class="category-header">' +
                        '<div class="category-title">' +
                        '<div class="category-icon ' + category + '">' + getCategoryIcon(category) + '</div>' +
                        '<span>' + getCategoryName(category) + '</span>' +
                        '</div>' +
                        '<div class="category-stats">' +
                        '<span>' + categoryPresets.length + ' items</span>' +
                        '<span>Avg: RM ' + categoryAverage.toFixed(0) + '</span>' +
                        '</div>' +
                        '</div>' +
                        '<div class="category-body">';
                    
                    for (var j = 0; j < categoryPresets.length; j++) {
                        presetsHTML += renderPresetCard(categoryPresets[j]);
                    }
                    
                    presetsHTML += '</div></div>';
                }
            } else {
                // Show filtered category only
                for (var i = 0; i < filteredPresets.length; i++) {
                    presetsHTML += renderPresetCard(filteredPresets[i]);
                }
            }
            
            container.innerHTML = presetsHTML;
        }

        function renderPresetCard(preset) {
            var usageCount = 0;
            
            // Count usage in quotes
            for (var j = 0; j < jobQuotes.length; j++) {
                for (var k = 0; k < jobQuotes[j].items.length; k++) {
                    if (jobQuotes[j].items[k].presetId === preset.id) {
                        usageCount++;
                    }
                }
            }
            
            return '<div class="item-card">' +
                '<div class="item-header">' +
                '<div class="item-info">' +
                '<h3>' +
                '<span class="category-badge category-' + preset.category + '">' + getCategoryIcon(preset.category) + '</span>' +
                preset.name + '</h3>' +
                '<div style="font-size: 14px; color: var(--text-secondary); margin: 8px 0;">' +
                preset.description + '</div>' +
                '<div style="font-size: 12px; color: var(--text-muted);">' +
                '📏 ' + preset.unit + ' • ' +
                '📈 Used ' + usageCount + ' times' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="item-actions">' +
                '<button class="icon-btn edit-btn" onclick="editPresetItem(\'' + preset.id + '\')" title="Edit Preset">✏️</button>' +
                '<button class="icon-btn delete-btn" onclick="deletePresetItem(\'' + preset.id + '\')" title="Delete Preset">🗑️</button>' +
                '</div>' +
                '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">' +
                '<span style="font-size: 12px; color: var(--text-muted);">Usage: ' + usageCount + '</span>' +
                '<span style="font-size: 18px; color: var(--accent-primary); font-weight: 700;">RM ' + parseFloat(preset.price).toFixed(2) + '</span>' +
                '</div>' +
                '</div>';
        }

        // PDF Generation with Categories
        function generateQuotePDF(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            document.getElementById('pdf-loading').classList.add('show');
            
            setTimeout(function() {
                try {
                    var pdf = new jsPDF();
                    var pageWidth = pdf.internal.pageSize.width;
                    var margin = 20;
                    var currentY = margin;
                    
                    // Company Header
                    pdf.setFontSize(20);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(companySettings.name, margin, currentY);
                    currentY += 8;
                    
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text('Registration No: ' + companySettings.registration, margin, currentY);
                    currentY += 5;
                    pdf.text(companySettings.tagline, margin, currentY);
                    currentY += 5;
                    pdf.text(companySettings.address, margin, currentY);
                    currentY += 5;
                    pdf.text('Phone: ' + companySettings.phone + ' | Email: ' + companySettings.email, margin, currentY);
                    currentY += 15;
                    
                    // Quote Title
                    pdf.setFontSize(16);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('JOB QUOTE #' + quote.id, margin, currentY);
                    currentY += 10;
                    
                    // Job Title
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('Job: ' + quote.title, margin, currentY);
                    currentY += 8;
                    
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text('Created: ' + formatDate(quote.createdAt), margin, currentY);
                    currentY += 15;
                    
                    // Quote Items by Category
                    if (quote.items.length > 0) {
                        // Group items by category
                        var groupedItems = {};
                        for (var i = 0; i < quote.items.length; i++) {
                            var item = quote.items[i];
                            var category = item.category || 'common';
                            if (!groupedItems[category]) {
                                groupedItems[category] = [];
                            }
                            groupedItems[category].push(item);
                        }
                        
                        pdf.setFontSize(12);
                        pdf.setFont('helvetica', 'bold');
                        pdf.text('Quote Items by Category:', margin, currentY);
                        currentY += 10;
                        
                        for (var category in groupedItems) {
                            var categoryItems = groupedItems[category];
                            var categoryTotal = 0;
                            
                            // Category header
                            pdf.setFontSize(11);
                            pdf.setFont('helvetica', 'bold');
                            pdf.text(getCategoryName(category) + ' (' + categoryItems.length + ' items)', margin, currentY);
                            currentY += 6;
                            
                            // Table headers
                            pdf.setFontSize(8);
                            pdf.setFont('helvetica', 'normal');
                            pdf.text('Description', margin + 5, currentY);
                            pdf.text('Qty', margin + 80, currentY);
                            pdf.text('Unit', margin + 100, currentY);
                            pdf.text('Price', margin + 120, currentY);
                            pdf.text('Total', margin + 150, currentY);
                            currentY += 4;
                            
                            pdf.line(margin, currentY, pageWidth - margin, currentY);
                            currentY += 3;
                            
                            for (var j = 0; j < categoryItems.length; j++) {
                                var item = categoryItems[j];
                                categoryTotal += item.total;
                                
                                pdf.text(item.description.substring(0, 25), margin + 5, currentY);
                                pdf.text(item.quantity.toString(), margin + 80, currentY);
                                pdf.text(item.unit, margin + 100, currentY);
                                pdf.text('RM ' + parseFloat(item.price).toFixed(2), margin + 120, currentY);
                                pdf.text('RM ' + item.total.toFixed(2), margin + 150, currentY);
                                currentY += 5;
                            }
                            
                            // Category subtotal
                            pdf.setFont('helvetica', 'bold');
                            pdf.text('Category Total: RM ' + categoryTotal.toFixed(2), margin + 120, currentY);
                            currentY += 8;
                            pdf.setFont('helvetica', 'normal');
                        }
                        
                        currentY += 5;
                        pdf.line(margin, currentY, pageWidth - margin, currentY);
                        currentY += 8;
                        
                        // Grand Total
                        pdf.setFontSize(12);
                        pdf.setFont('helvetica', 'bold');
                        pdf.text('TOTAL AMOUNT: RM ' + quote.totalAmount.toFixed(2), margin + 100, currentY);
                    }
                    
                    // Footer
                    currentY = pdf.internal.pageSize.height - 30;
                    pdf.setFontSize(8);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text('Generated on: ' + new Date().toLocaleString(), margin, currentY);
                    pdf.text('Quote valid for 30 days from date of issue', margin, currentY + 5);
                    
                    var filename = 'JobQuote_' + quote.id + '_' + quote.title.replace(/[^a-zA-Z0-9]/g, '_') + '.pdf';
                    pdf.save(filename);
                    
                    showSuccessMessage('📄 Categorized PDF quote generated successfully!');
                } catch (error) {
                    console.error('PDF generation error:', error);
                    showSuccessMessage('⚠️ Error generating PDF. Please try again.');
                } finally {
                    document.getElementById('pdf-loading').classList.remove('show');
                }
            }, 1500);
        }

        // Export Data Function
        function exportData() {
            var allData = {
                companySettings: companySettings,
                jobQuotes: jobQuotes,
                presetWorkItems: presetWorkItems,
                selectedLogo: selectedLogoIndex,
                themePreference: currentTheme,
                categories: categories,
                exportDate: new Date().toISOString(),
                version: '4.0'
            };
            
            var dataStr = JSON.stringify(allData, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            var link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'REFIT_Categorized_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showSuccessMessage('📤 Categorized data exported successfully!');
        }

        // Event Listeners
        function setupEventListeners() {
            // Search functionality
            var quoteSearch = document.getElementById('quote-search');
            if (quoteSearch) {
                quoteSearch.addEventListener('input', function(e) {
                    renderQuotes(e.target.value);
                });
            }

            var presetSearch = document.getElementById('preset-search');
            if (presetSearch) {
                presetSearch.addEventListener('input', function(e) {
                    renderPresets(e.target.value);
                });
            }

            // Forms
            var presetItemForm = document.getElementById('preset-item-form');
            if (presetItemForm) {
                presetItemForm.addEventListener('submit', handlePresetItemSubmit);
            }

            // Manual item calculations
            var quantityInput = document.getElementById('manual-quantity');
            var priceInput = document.getElementById('manual-price');
            
            if (quantityInput) {
                quantityInput.addEventListener('input', updateManualTotal);
            }
            
            if (priceInput) {
                priceInput.addEventListener('input', updateManualTotal);
            }

            // System theme detection
            if (window.matchMedia) {
                var mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', function(e) {
                    if (!localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) {
                        currentTheme = e.matches ? 'dark' : 'light';
                        document.body.setAttribute('data-theme', currentTheme);
                        updateThemeToggle();
                    }
                });
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'n':
                            e.preventDefault();
                            openSimpleJobForm();
                            break;
                        case 'p':
                            e.preventDefault();
                            openPresetItemForm();
                            break;
                        case 'e':
                            e.preventDefault();
                            exportData();
                            break;
                        case 'l':
                            e.preventDefault();
                            openLogoSelector();
                            break;
                        case 'd':
                            e.preventDefault();
                            toggleTheme();
                            break;
                        case 'f':
                            e.preventDefault();
                            if (currentView === 'quotes') {
                                filterQuotesByCategory('all');
                            } else if (currentView === 'presets') {
                                filterPresetsByCategory('all');
                            }
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    var modals = document.querySelectorAll('.modal.show, .logo-selector.show');
                    for (var i = 0; i < modals.length; i++) {
                        modals[i].classList.remove('show');
                    }
                }
            });
        }

        function updateThemeToggle() {
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
        }

        // Utility Functions
        function showView(viewName) {
            currentView = viewName;
            
            // Hide all views
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) {
                views[i].classList.add('hidden');
            }
            
            // Show selected view
            var targetView = document.getElementById(viewName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            // Update navigation
            var navItems = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navItems.length; i++) {
                navItems[i].classList.remove('active');
            }
            
            var activeNav = document.querySelector('.nav-item[onclick*="' + viewName + '"]');
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            // Reset filters when changing views
            if (viewName === 'quotes') {
                currentQuoteFilter = 'all';
            } else if (viewName === 'presets') {
                currentPresetFilter = 'all';
            }
            
            // Render view content
            renderViews();
        }

        function renderViews() {
            switch(currentView) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'quotes':
                    renderQuotes();
                    updateQuoteCategoryFilters();
                    break;
                case 'presets':
                    renderPresets();
                    updatePresetCategoryFilters();
                    break;
            }
        }

        function renderDashboard() {
            // Render recent quotes
            var recentQuotes = jobQuotes.slice(-3).reverse();
            var container = document.getElementById('recent-quotes');
            if (!container) return;
            
            if (recentQuotes.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 30px 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 32px; margin-bottom: 8px;">💰</div>' +
                    '<p style="font-weight: 600;">No job quotes yet</p>' +
                    '<p style="font-size: 12px; margin-top: 4px;">Create your first job quote</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < recentQuotes.length; i++) {
                var quote = recentQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;" onclick="viewQuote(' + quote.id + ')" onmouseover="this.style.transform=\'scale(1.02)\'" onmouseout="this.style.transform=\'scale(1)\'">' +
                    '<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">' +
                    '<div style="font-weight: 700; font-size: 15px; color: var(--text-primary);">' + quote.title + '</div>' +
                    '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">📋 ' + quote.items.length + ' items • 📅 ' + formatDate(quote.createdAt) + '</div>' +
                    '<div style="margin-bottom: 8px;">' + renderCategoryBadges(quoteCategories) + '</div>' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px;">' +
                    '<span style="color: var(--text-muted);">Quote #' + quote.id + '</span>' +
                    '<span style="font-weight: 700; color: var(--accent-primary); font-size: 16px;">RM ' + quote.totalAmount.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
            
            // Render category statistics
            renderCategoryStatistics();
        }

        function renderCategoryStatistics() {
            var container = document.getElementById('category-stats-grid');
            if (!container) return;
            
            var categoryStats = {};
            var totalItems = 0;
            
            // Initialize category stats
            for (var catKey in categories) {
                categoryStats[catKey] = {
                    count: 0,
                    revenue: 0,
                    items: 0
                };
            }
            
            // Calculate statistics
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                for (var j = 0; j < quote.items.length; j++) {
                    var item = quote.items[j];
                    var category = item.category || 'common';
                    totalItems++;
                    
                    if (categoryStats[category]) {
                        categoryStats[category].items++;
                        categoryStats[category].revenue += item.total;
                    }
                }
            }
            
            // Count quotes per category
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                for (var j = 0; j < quoteCategories.length; j++) {
                    var category = quoteCategories[j];
                    if (categoryStats[category]) {
                        categoryStats[category].count++;
                    }
                }
            }
            
            var html = '';
            for (var catKey in categoryStats) {
                var stats = categoryStats[catKey];
                var percentage = totalItems > 0 ? Math.round((stats.items / totalItems) * 100) : 0;
                
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; border: 1px solid var(--border-color); transition: all 0.2s ease;" onmouseover="this.style.transform=\'scale(1.05)\'" onmouseout="this.style.transform=\'scale(1)\'">' +
                    '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">' +
                    '<div class="category-icon ' + catKey + '">' + getCategoryIcon(catKey) + '</div>' +
                    '<span style="font-weight: 700; font-size: 14px; color: var(--text-primary);">' + getCategoryName(catKey) + '</span>' +
                    '</div>' +
                    '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 12px;">' +
                    '<div style="text-align: center;">' +
                    '<div style="color: var(--text-muted);">Quotes</div>' +
                    '<div style="font-weight: 700; color: var(--accent-primary);">' + stats.count + '</div>' +
                    '</div>' +
                    '<div style="text-align: center;">' +
                    '<div style="color: var(--text-muted);">Revenue</div>' +
                    '<div style="font-weight: 700; color: var(--accent-warm);">RM ' + Math.round(stats.revenue) + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div style="margin-top: 8px; text-align: center;">' +
                    '<div style="color: var(--text-muted); font-size: 11px;">' + percentage + '% of items</div>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function updateStats() {
            // Calculate statistics
            var totalQuotes = jobQuotes.length;
            var totalItems = 0;
            var totalRevenue = 0;
            var todayRevenue = 0;
            var presetUsage = 0;
            var totalPresetItems = 0;
            var activeCategories = {};
            
            var today = new Date().toISOString().split('T')[0];
            
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                totalItems += quote.items.length;
                totalRevenue += quote.totalAmount;
                
                // Today's revenue (quotes created today)
                if (quote.createdAt.split('T')[0] === today) {
                    todayRevenue += quote.totalAmount;
                }
                
                // Count preset usage and categories
                for (var j = 0; j < quote.items.length; j++) {
                    var item = quote.items[j];
                    totalPresetItems++;
                    if (item.isPreset) {
                        presetUsage++;
                    }
                    var category = item.category || 'common';
                    activeCategories[category] = true;
                }
            }
            
            var presetUsagePercent = totalPresetItems > 0 ? Math.round((presetUsage / totalPresetItems) * 100) : 0;
            var averageQuote = totalQuotes > 0 ? totalRevenue / totalQuotes : 0;
            var totalActiveCategories = Object.keys(activeCategories).length;
            
            // Calculate preset statistics
            var categories = {};
            var totalPresetPrice = 0;
            for (var i = 0; i < presetWorkItems.length; i++) {
                categories[presetWorkItems[i].category] = true;
                totalPresetPrice += presetWorkItems[i].price;
            }
            var categoryCount = Object.keys(categories).length;
            var avgPresetPrice = presetWorkItems.length > 0 ? totalPresetPrice / presetWorkItems.length : 0;
            
            // Update DOM elements
            updateElementText('total-quotes-count', totalQuotes);
            updateElementText('total-items-count', totalItems);
            updateElementText('today-revenue', 'RM ' + Math.round(todayRevenue));
            updateElementText('total-revenue', 'RM ' + Math.round(totalRevenue));
            updateElementText('average-quote', 'RM ' + Math.round(averageQuote));
            updateElementText('total-categories', totalActiveCategories);
            updateElementText('daily-revenue', 'RM ' + todayRevenue.toFixed(2));
            
            // Preset statistics
            updateElementText('preset-count', presetWorkItems.length + ' items');
            updateElementText('category-count', categoryCount);
            updateElementText('avg-preset-price', 'RM ' + Math.round(avgPresetPrice));
            updateElementText('preset-usage-count', presetUsage);
        }

        function updateElementText(elementId, text) {
            var element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            var date = new Date(dateString);
            return date.toLocaleDateString('en-MY', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function updateStatusBar() {
            var now = new Date();
            var timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            
            var timeElement = document.getElementById('status-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        function updateCurrentDate() {
            var today = new Date();
            var dateString = today.toLocaleDateString('en-MY', { 
                weekday: 'long',
                month: 'long', 
                day: 'numeric' 
            });
            
            var dateElement = document.getElementById('current-date');
            if (dateElement) {
                dateElement.textContent = dateString;
            }
        }

        function setupMobileOptimizations() {
            // Update status bar every minute
            setInterval(updateStatusBar, 60000);
            
            // Prevent zoom on double tap
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            // Touch gesture support
            setupTouchGestures();
        }

        function showSuccessMessage(message) {
            var messageElement = document.getElementById('success-message');
            if (!messageElement) return;
            
            messageElement.textContent = message;
            messageElement.classList.add('show');
            
            setTimeout(function() {
                messageElement.classList.remove('show');
            }, 3000);
        }

        // Touch Gesture Enhancements
        function setupTouchGestures() {
            var startX, startY, distX, distY;
            var threshold = 150;
            var restraint = 100;
            var allowedTime = 300;
            var elapsedTime;
            var startTime;
            
            document.addEventListener('touchstart', function(e) {
                var touchobj = e.changedTouches[0];
                startX = touchobj.pageX;
                startY = touchobj.pageY;
                startTime = new Date().getTime();
            }, false);
            
            document.addEventListener('touchend', function(e) {
                var touchobj = e.changedTouches[0];
                distX = touchobj.pageX - startX;
                distY = touchobj.pageY - startY;
                elapsedTime = new Date().getTime() - startTime;
                
                if (elapsedTime <= allowedTime) {
                    if (Math.abs(distX) >= threshold && Math.abs(distY) <= restraint) {
                        if (distX > 0) {
                            handleSwipeRight();
                        } else {
                            handleSwipeLeft();
                        }
                    }
                }
            }, false);
        }

        function handleSwipeLeft() {
            var views = ['dashboard', 'quotes', 'presets'];
            var currentIndex = views.indexOf(currentView);
            var nextIndex = (currentIndex + 1) % views.length;
            showView(views[nextIndex]);
        }

        function handleSwipeRight() {
            var views = ['dashboard', 'quotes', 'presets'];
            var currentIndex = views.indexOf(currentView);
            var prevIndex = currentIndex === 0 ? views.length - 1 : currentIndex - 1;
            showView(views[prevIndex]);
        }

        // Auto-save functionality with visual feedback
        var autoSaveInterval;

        function startAutoSave() {
            autoSaveInterval = setInterval(function() {
                saveDataToStorage();
                
                // Show subtle save indicator
                var header = document.querySelector('.header');
                if (header) {
                    header.style.boxShadow = '0 4px 20px var(--success)';
                    setTimeout(function() {
                        header.style.boxShadow = '0 4px 20px var(--shadow-medium)';
                    }, 500);
                }
            }, 60000); // Auto-save every minute
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
        }

        // Initialize all features when app loads
        window.addEventListener('load', function() {
            startAutoSave();
            
            console.log('📋 REFIT MAINTENANCE SERVICES - Complete Categorized System Loaded');
            console.log('🏷️ Advanced Category Organization & Filtering');
            console.log('👁️ Eye-Friendly Design for Extended Use');
            console.log('📱 Mobile-Optimized with Touch Gestures');
            console.log('💾 Auto-save & Data Protection Enabled');
        });

        // Cleanup when page unloads
        window.addEventListener('beforeunload', function() {
            stopAutoSave();
            saveDataToStorage(); // Final save
        });

        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e.error);
            showSuccessMessage('⚠️ Minor issue detected. App continues working normally.');
        });

        console.log('🎯 REFIT MAINTENANCE SERVICES - Complete Categorized Management System Ready');
        console.log('📊 Professional Category Organization');
        console.log('🔧 Advanced Filtering & Segregation');
        console.log('👁️ Eye-Comfort Optimized Interface');
        console.log('📱 Touch-Friendly Mobile Experience');
    </script>
</body>
</html>
