<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="REFIT MAINTENANCE SERVICES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2d3748">
    <meta name="msapplication-navbutton-color" content="#2d3748">
    
    <title>REFIT MAINTENANCE SERVICES - Enhanced Management System</title>
    
    <!-- Enhanced PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, select, textarea, button {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        :root {
            /* Light Theme - Warm & Eye-Friendly */
            --bg-primary: #f7f5f3;
            --bg-secondary: #edeae6;
            --bg-card: #ffffff;
            --bg-card-hover: #f9f7f5;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --accent-primary: #38a169;
            --accent-secondary: #68d391;
            --accent-warm: #d69e2e;
            --accent-soft: #9f7aea;
            --border-color: #e2e8f0;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.1);
            --shadow-strong: rgba(0, 0, 0, 0.15);
            --overlay: rgba(45, 55, 72, 0.8);
            --success: #38a169;
            --warning: #d69e2e;
            --error: #e53e3e;
            --info: #3182ce;
            
            /* Enhanced Category Colors */
            --cat-electrical: #3182ce;
            --cat-plumbing: #0987a0;
            --cat-hvac: #805ad5;
            --cat-cleaning: #38a169;
            --cat-parts: #d69e2e;
            --cat-labor: #e53e3e;
            --cat-equipment: #718096;
            --cat-common: #9f7aea;
            --cat-preliminary: #e53e3e;
            --cat-wall: #d69e2e;
            --cat-floor: #b794f6;
            --cat-ceiling: #63b3ed;
            --cat-roofing: #4c51bf;
            --cat-wetwork: #0987a0;
            --cat-me-work: #f56565;
            --cat-exhaust: #4a5568;
            --cat-lights-fan: #f6d55c;
            --cat-ac: #38b2ac;
            --cat-paint: #ed8936;
            --cat-curtain: #9f7aea;
            --cat-builtin: #667eea;
            --cat-loose: #68d391;
            --cat-sanitary: #4299e1;
            --cat-appliances: #fc8181;
        }
        
        [data-theme="dark"] {
            /* Dark Theme - Reduced Blue Light */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #3a3a3a;
            --bg-card-hover: #454545;
            --text-primary: #e8e8e8;
            --text-secondary: #c7c7c7;
            --text-muted: #9a9a9a;
            --accent-primary: #4fd69c;
            --accent-secondary: #68d391;
            --accent-warm: #f6d55c;
            --accent-soft: #b794f6;
            --border-color: #4a4a4a;
            --shadow-light: rgba(255, 255, 255, 0.05);
            --shadow-medium: rgba(255, 255, 255, 0.1);
            --shadow-strong: rgba(255, 255, 255, 0.15);
            --overlay: rgba(0, 0, 0, 0.9);
            --success: #4fd69c;
            --warning: #f6d55c;
            --error: #fc8181;
            --info: #63b3ed;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        /* Mobile Layout Container */
        .mobile-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 2px 10px var(--shadow-medium);
            border-bottom: 1px solid var(--border-color);
        }
        
        .status-bar .time {
            color: var(--text-primary);
        }
        
        .status-bar .indicators {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }
        
        .theme-toggle {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        
        .theme-toggle:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 4px 20px var(--shadow-medium);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            width: 54px;
            height: 54px;
            background: var(--accent-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 6px 16px var(--shadow-medium);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--accent-secondary);
        }
        
        .app-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--shadow-strong);
        }
        
        .app-logo:active {
            transform: scale(0.95);
        }
        
        .logo-svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 4px var(--shadow-light));
        }
        
        .user-logo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 14px;
        }
        
        .app-title h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        
        .app-title p {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.2;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-right .stats {
            text-align: right;
            margin-right: 8px;
        }
        
        .header-right p {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            box-shadow: 0 2px 8px var(--shadow-light);
            position: relative;
        }
        
        .header-btn:active {
            transform: scale(0.9);
        }
        
        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .header-btn.user-info {
            background: var(--accent-soft);
        }
        
        .header-btn.icon-upload {
            background: var(--accent-warm);
        }
        
        .header-btn.export {
            background: var(--info);
        }
        
        /* Tooltip for header buttons */
        .header-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: var(--bg-card);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 1000;
        }
        
        .header-btn:hover::after {
            opacity: 1;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 130px 20px 140px;
            -webkit-overflow-scrolling: touch;
            position: relative;
            height: calc(100vh - 44px);
            scroll-behavior: smooth;
        }
        
        .main-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        /* Category System */
        .category-badge {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            display: inline-block;
            margin-right: 6px;
        }
        
        /* Enhanced Category Classes */
        .category-electrical { background: var(--cat-electrical); }
        .category-plumbing { background: var(--cat-plumbing); }
        .category-hvac { background: var(--cat-hvac); }
        .category-cleaning { background: var(--cat-cleaning); }
        .category-parts { background: var(--cat-parts); }
        .category-labor { background: var(--cat-labor); }
        .category-equipment { background: var(--cat-equipment); }
        .category-common { background: var(--cat-common); }
        .category-preliminary { background: var(--cat-preliminary); }
        .category-wall { background: var(--cat-wall); }
        .category-floor { background: var(--cat-floor); }
        .category-ceiling { background: var(--cat-ceiling); }
        .category-roofing { background: var(--cat-roofing); }
        .category-wetwork { background: var(--cat-wetwork); }
        .category-me-work { background: var(--cat-me-work); }
        .category-exhaust { background: var(--cat-exhaust); }
        .category-lights-fan { background: var(--cat-lights-fan); }
        .category-ac { background: var(--cat-ac); }
        .category-paint { background: var(--cat-paint); }
        .category-curtain { background: var(--cat-curtain); }
        .category-builtin { background: var(--cat-builtin); }
        .category-loose { background: var(--cat-loose); }
        .category-sanitary { background: var(--cat-sanitary); }
        .category-appliances { background: var(--cat-appliances); }
        
        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .category-filter {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid transparent;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .category-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .category-filter.active {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
        }
        
        /* Individual category filter styles */
        .category-filter.electrical { border-color: var(--cat-electrical); }
        .category-filter.electrical.active { background: var(--cat-electrical); }
        .category-filter.plumbing { border-color: var(--cat-plumbing); }
        .category-filter.plumbing.active { background: var(--cat-plumbing); }
        .category-filter.hvac { border-color: var(--cat-hvac); }
        .category-filter.hvac.active { background: var(--cat-hvac); }
        .category-filter.cleaning { border-color: var(--cat-cleaning); }
        .category-filter.cleaning.active { background: var(--cat-cleaning); }
        .category-filter.parts { border-color: var(--cat-parts); }
        .category-filter.parts.active { background: var(--cat-parts); }
        .category-filter.labor { border-color: var(--cat-labor); }
        .category-filter.labor.active { background: var(--cat-labor); }
        .category-filter.equipment { border-color: var(--cat-equipment); }
        .category-filter.equipment.active { background: var(--cat-equipment); }
        .category-filter.common { border-color: var(--cat-common); }
        .category-filter.common.active { background: var(--cat-common); }
        .category-filter.preliminary { border-color: var(--cat-preliminary); }
        .category-filter.preliminary.active { background: var(--cat-preliminary); }
        .category-filter.wall { border-color: var(--cat-wall); }
        .category-filter.wall.active { background: var(--cat-wall); }
        .category-filter.floor { border-color: var(--cat-floor); }
        .category-filter.floor.active { background: var(--cat-floor); }
        .category-filter.ceiling { border-color: var(--cat-ceiling); }
        .category-filter.ceiling.active { background: var(--cat-ceiling); }
        .category-filter.roofing { border-color: var(--cat-roofing); }
        .category-filter.roofing.active { background: var(--cat-roofing); }
        .category-filter.wetwork { border-color: var(--cat-wetwork); }
        .category-filter.wetwork.active { background: var(--cat-wetwork); }
        .category-filter.me-work { border-color: var(--cat-me-work); }
        .category-filter.me-work.active { background: var(--cat-me-work); }
        .category-filter.exhaust { border-color: var(--cat-exhaust); }
        .category-filter.exhaust.active { background: var(--cat-exhaust); }
        .category-filter.lights-fan { border-color: var(--cat-lights-fan); }
        .category-filter.lights-fan.active { background: var(--cat-lights-fan); }
        .category-filter.ac { border-color: var(--cat-ac); }
        .category-filter.ac.active { background: var(--cat-ac); }
        .category-filter.paint { border-color: var(--cat-paint); }
        .category-filter.paint.active { background: var(--cat-paint); }
        .category-filter.curtain { border-color: var(--cat-curtain); }
        .category-filter.curtain.active { background: var(--cat-curtain); }
        .category-filter.builtin { border-color: var(--cat-builtin); }
        .category-filter.builtin.active { background: var(--cat-builtin); }
        .category-filter.loose { border-color: var(--cat-loose); }
        .category-filter.loose.active { background: var(--cat-loose); }
        .category-filter.sanitary { border-color: var(--cat-sanitary); }
        .category-filter.sanitary.active { background: var(--cat-sanitary); }
        .category-filter.appliances { border-color: var(--cat-appliances); }
        .category-filter.appliances.active { background: var(--cat-appliances); }
        
        .category-count {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            margin-left: 4px;
        }
        
        /* Category Sections */
        .category-section {
            margin-bottom: 24px;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .category-header {
            padding: 16px 20px;
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .category-icon.electrical { background: var(--cat-electrical); }
        .category-icon.plumbing { background: var(--cat-plumbing); }
        .category-icon.hvac { background: var(--cat-hvac); }
        .category-icon.cleaning { background: var(--cat-cleaning); }
        .category-icon.parts { background: var(--cat-parts); }
        .category-icon.labor { background: var(--cat-labor); }
        .category-icon.equipment { background: var(--cat-equipment); }
        .category-icon.common { background: var(--cat-common); }
        .category-icon.preliminary { background: var(--cat-preliminary); }
        .category-icon.wall { background: var(--cat-wall); }
        .category-icon.floor { background: var(--cat-floor); }
        .category-icon.ceiling { background: var(--cat-ceiling); }
        .category-icon.roofing { background: var(--cat-roofing); }
        .category-icon.wetwork { background: var(--cat-wetwork); }
        .category-icon.me-work { background: var(--cat-me-work); }
        .category-icon.exhaust { background: var(--cat-exhaust); }
        .category-icon.lights-fan { background: var(--cat-lights-fan); }
        .category-icon.ac { background: var(--cat-ac); }
        .category-icon.paint { background: var(--cat-paint); }
        .category-icon.curtain { background: var(--cat-curtain); }
        .category-icon.builtin { background: var(--cat-builtin); }
        .category-icon.loose { background: var(--cat-loose); }
        .category-icon.sanitary { background: var(--cat-sanitary); }
        .category-icon.appliances { background: var(--cat-appliances); }
        
        /* Custom Icon Display */
        .custom-icon {
            width: 24px;
            height: 24px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .category-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .category-body {
            background: var(--bg-card);
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-medium);
            transform: translateY(-2px);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: var(--accent-primary);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 52px;
            text-decoration: none;
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }
        
        .btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary { background: var(--accent-primary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--error); }
        .btn-warning { background: var(--warning); }
        .btn-info { background: var(--info); }
        .btn-soft { background: var(--accent-soft); }
        .btn-warm { background: var(--accent-warm); }
        .btn-secondary { background: var(--text-secondary); }
        
        /* Action Buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .action-btn {
            padding: 24px 20px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-height: 120px;
            box-shadow: 0 6px 20px var(--shadow-light);
        }
        
        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px var(--shadow-medium);
        }
        
        .action-btn:active {
            transform: scale(0.96);
        }
        
        .action-btn.primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        .action-btn.success { background: linear-gradient(135deg, var(--success), #48bb78); }
        .action-btn.warm { background: linear-gradient(135deg, var(--accent-warm), #f6e05e); }
        .action-btn.soft { background: linear-gradient(135deg, var(--accent-soft), #b794f6); }
        .action-btn.info { background: linear-gradient(135deg, var(--info), #63b3ed); }
        .action-btn.secondary { background: linear-gradient(135deg, var(--text-secondary), #718096); }
        
        .action-btn .icon {
            font-size: 32px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        /* Form Elements */
        .input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .input::placeholder {
            color: var(--text-muted);
        }
        
        .input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1);
        }
        
        /* File Upload Styles */
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            overflow: hidden;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .file-upload:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            left: -9999px;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }
        
        .upload-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin-top: 8px;
            border: 1px solid var(--border-color);
        }
        
        /* Search Input */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-muted);
            pointer-events: none;
        }
        
        .search-container input {
            padding-left: 56px;
        }
        
        /* Item Cards */
        .item-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px var(--shadow-medium);
            background: var(--bg-card-hover);
        }
        
        .item-card:active {
            transform: scale(0.98);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .item-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
            color: var(--text-primary);
        }
        
        /* Icon Buttons */
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .icon-btn:active {
            transform: scale(0.9);
        }
        
        .icon-btn.edit-btn { background: var(--accent-primary); color: white; }
        .icon-btn.delete-btn { background: var(--error); color: white; }
        .icon-btn.pdf-btn { background: var(--info); color: white; }
        .icon-btn.quote-btn { background: var(--accent-warm); color: white; }
        
        .item-actions {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px 32px;
            z-index: 100;
            box-shadow: 0 -4px 20px var(--shadow-medium);
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border-radius: 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 60px;
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: rgba(56, 161, 105, 0.1);
            box-shadow: 0 2px 8px var(--shadow-light);
            transform: scale(1.05);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item .icon {
            font-size: 24px;
        }
        
        .home-indicator {
            height: 4px;
            background: var(--accent-primary);
            border-radius: 2px;
            width: 140px;
            margin: 12px auto 0;
            opacity: 0.6;
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: flex-end;
            z-index: 200;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            color: var(--text-primary);
            animation: slideUp 0.3s ease;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            border: 1px solid var(--border-color);
            box-shadow: 0 -8px 40px var(--shadow-strong);
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
        }
        
        .close-btn:hover {
            background: var(--error);
            color: white;
            transform: scale(1.1);
        }
        
        .close-btn:active {
            transform: scale(0.9);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Form Elements in Modals */
        .form-input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .form-input::placeholder {
            color: var(--text-muted);
        }
        
        .form-input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1);
        }
        
        .form-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .form-btn {
            padding: 18px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 56px;
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }
        
        .form-btn:active {
            transform: scale(0.96);
        }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 8px 32px var(--shadow-medium);
            z-index: 250;
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        .success-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .view {
            padding-top: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .add-btn {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
            box-shadow: 0 8px 24px var(--shadow-medium);
        }
        
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px var(--shadow-strong);
        }
        
        .add-btn:active {
            transform: scale(0.9);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        /* Mobile Optimizations */
        @media screen and (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .form-actions {
                grid-template-columns: 1fr;
            }
            
            .item-actions {
                position: static;
                margin-top: 12px;
                justify-content: flex-end;
            }
            
            .item-card {
                padding-right: 20px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .category-filters {
                max-height: 150px;
            }
            
            .header-right {
                gap: 6px;
            }
            
            .header-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            /* Step indicators mobile optimization */
            .step-indicator-container {
                flex-direction: column;
                gap: 8px;
                margin-bottom: 16px;
            }
            
            .step-indicator-line {
                width: 2px;
                height: 20px;
            }
            
            /* Simplified preset cards for mobile */
            .simple-preset-card {
                padding: 12px;
                margin-bottom: 6px;
            }
            
            .simple-preset-card .preset-title {
                font-size: 14px;
            }
            
            .simple-preset-card .preset-description {
                font-size: 12px;
            }
            
            .simple-preset-card .preset-price {
                font-size: 14px;
            }
        }
        
        /* Safe area adjustments */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }
        
        /* Print styles */
        @media print {
            .status-bar,
            .bottom-nav,
            .modal {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body class="comfort-mode" data-theme="light">
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="status-time">9:41</div>
            <div class="indicators">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙 Dark</button>
                <span>📶</span>
                <span>📱</span>
                <span>🔋</span>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="app-logo" onclick="openUserInfo()" id="main-logo">
                        <!-- Default Professional Maintenance Tool Icon -->
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="50" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="app-title">
                        <h1 id="company-name">REFIT MAINTENANCE SERVICES</h1>
                        <p id="company-registration">Registration No: 201803348973<br>(002894203-V)</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="stats">
                    <p id="current-date">Today</p>
                    <p id="daily-revenue">RM 0.00</p>
                </div>
                <button class="header-btn user-info" onclick="openUserInfo()" data-tooltip="👤 User Info & Logo">
                    👤
                </button>
                <button class="header-btn icon-upload" onclick="openIconUpload()" data-tooltip="🎨 Upload Category Icons">
                    🎨
                </button>
                <button class="header-btn export" onclick="exportData()" data-tooltip="📤 Export Data">
                    📤
                </button>
            </div>
        </div>

        <!-- User Info Modal -->
        <div id="user-info-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>👤 User Info & Company Settings</h3>
                    <button class="close-btn" onclick="closeUserInfo()">✕</button>
                </div>
                <div class="modal-body">
                    <div class="card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">🏢 Company Information</h4>
                        <input type="text" class="form-input" placeholder="Company Name" id="user-company-name">
                        <input type="text" class="form-input" placeholder="Registration Number" id="user-registration">
                        <input type="text" class="form-input" placeholder="Phone Number" id="user-phone">
                        <input type="text" class="form-input" placeholder="Email Address" id="user-email">
                        <textarea class="form-input" placeholder="Company Address" id="user-address" rows="3" style="resize: none;"></textarea>
                        <input type="text" class="form-input" placeholder="Website" id="user-website">
                    </div>

                    <div class="card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">🖼️ Company Logo Upload</h4>
                        <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px;">Upload your company logo (PNG, JPG, GIF - Max 2MB)</p>
                        
                        <div class="file-upload">
                            <input type="file" id="logo-upload" accept="image/*" onchange="handleLogoUpload(event)">
                            <label for="logo-upload" class="file-upload-label">
                                <span>📁</span>
                                <span>Choose Logo Image</span>
                            </label>
                        </div>
                        
                        <div id="logo-preview" style="margin-top: 12px; text-align: center;"></div>
                        
                        <div style="margin-top: 12px;">
                            <button type="button" onclick="removeCustomLogo()" class="btn btn-danger" style="width: 100%; font-size: 14px;">
                                🗑️ Remove Custom Logo
                            </button>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" onclick="saveUserInfo()" class="form-btn btn-primary">
                            ✅ Save Info
                        </button>
                        <button type="button" onclick="closeUserInfo()" class="form-btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Icon Upload Modal -->
        <div id="icon-upload-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🎨 Upload Category Icons</h3>
                    <button class="close-btn" onclick="closeIconUpload()">✕</button>
                </div>
                <div class="modal-body">
                    <div class="card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">📂 Custom Category Icons</h4>
                        <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 16px;">Upload custom icons for categories (PNG, JPG, SVG - Max 1MB each)</p>
                        
                        <div id="category-icon-list">
                            <!-- Category icon upload items will be populated here -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" onclick="resetAllIcons()" class="form-btn btn-danger">
                            🔄 Reset All Icons
                        </button>
                        <button type="button" onclick="closeIconUpload()" class="form-btn btn-secondary">
                            Done
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="total-quotes-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Quote Items</div>
                        <div class="stat-value" id="total-items-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-value" id="today-revenue">RM 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="total-revenue">RM 0</div>
                    </div>
                </div>

                <!-- Performance Card -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">📊 Category Overview</h3>
                        <span style="font-size: 24px;">📈</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; font-size: 14px;">
                        <div style="text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--accent-primary);" id="average-quote">RM 0</div>
                            <div style="color: var(--text-muted); font-weight: 600;">Average Quote</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--accent-warm);" id="total-categories">0</div>
                            <div style="color: var(--text-muted); font-weight: 600;">Active Categories</div>
                        </div>
                    </div>
                </div>

                <!-- Category Statistics -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">📊 Category Breakdown</h3>
                    <div id="category-stats-grid"></div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">Quick Actions</h3>
                    <div class="actions-grid">
                        <button class="action-btn primary" onclick="openSimpleJobForm()">
                            <span class="icon">➕</span>
                            <span style="font-weight: 700;">Create Job Quote</span>
                        </button>
                        <button class="action-btn success" onclick="showView('quotes')">
                            <span class="icon">💰</span>
                            <span style="font-weight: 700;">View All Quotes</span>
                        </button>
                        <button class="action-btn warm" onclick="openPresetManager()">
                            <span class="icon">📋</span>
                            <span style="font-weight: 700;">Manage Presets</span>
                        </button>
                        <button class="action-btn info" onclick="exportData()">
                            <span class="icon">📤</span>
                            <span style="font-weight: 700;">Export Data</span>
                        </button>
                    </div>
                </div>

                <!-- Recent Quotes -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">Recent Job Quotes</h3>
                        <button style="background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; font-weight: 600;" onclick="showView('quotes')">View All</button>
                    </div>
                    <div id="recent-quotes"></div>
                </div>
            </div>

            <!-- Quotes View -->
            <div id="quotes-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Job Quotes</h2>
                    <button class="add-btn" onclick="openSimpleJobForm()">
                        <span>➕</span>
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="input" placeholder="Search quotes..." id="quote-search">
                </div>

                <!-- Enhanced Category Filters -->
                <div class="category-filters">
                    <div class="category-filter active" onclick="filterQuotesByCategory('all')" data-category="all">
                        <span>📋</span>
                        <span>All Quotes</span>
                        <span class="category-count" id="filter-count-all">0</span>
                    </div>
                    <!-- New Categories -->
                    <div class="category-filter preliminary" onclick="filterQuotesByCategory('preliminary')" data-category="preliminary">
                        <span id="icon-preliminary">🏗️</span>
                        <span>Preliminary</span>
                        <span class="category-count" id="filter-count-preliminary">0</span>
                    </div>
                    <div class="category-filter wall" onclick="filterQuotesByCategory('wall')" data-category="wall">
                        <span id="icon-wall">🧱</span>
                        <span>Wall Work</span>
                        <span class="category-count" id="filter-count-wall">0</span>
                    </div>
                    <div class="category-filter floor" onclick="filterQuotesByCategory('floor')" data-category="floor">
                        <span id="icon-floor">🏢</span>
                        <span>Floor Work</span>
                        <span class="category-count" id="filter-count-floor">0</span>
                    </div>
                    <div class="category-filter ceiling" onclick="filterQuotesByCategory('ceiling')" data-category="ceiling">
                        <span id="icon-ceiling">🏠</span>
                        <span>Ceiling Work</span>
                        <span class="category-count" id="filter-count-ceiling">0</span>
                    </div>
                    <div class="category-filter roofing" onclick="filterQuotesByCategory('roofing')" data-category="roofing">
                        <span id="icon-roofing">🏘️</span>
                        <span>Roofing</span>
                        <span class="category-count" id="filter-count-roofing">0</span>
                    </div>
                    <div class="category-filter wetwork" onclick="filterQuotesByCategory('wetwork')" data-category="wetwork">
                        <span id="icon-wetwork">💧</span>
                        <span>Wet Work</span>
                        <span class="category-count" id="filter-count-wetwork">0</span>
                    </div>
                    <!-- M&E Categories -->
                    <div class="category-filter me-work" onclick="filterQuotesByCategory('me-work')" data-category="me-work">
                        <span id="icon-me-work">⚙️</span>
                        <span>M&E Work</span>
                        <span class="category-count" id="filter-count-me-work">0</span>
                    </div>
                    <div class="category-filter exhaust" onclick="filterQuotesByCategory('exhaust')" data-category="exhaust">
                        <span id="icon-exhaust">🌪️</span>
                        <span>Exhaust</span>
                        <span class="category-count" id="filter-count-exhaust">0</span>
                    </div>
                    <div class="category-filter lights-fan" onclick="filterQuotesByCategory('lights-fan')" data-category="lights-fan">
                        <span id="icon-lights-fan">💡</span>
                        <span>Lights & Fan</span>
                        <span class="category-count" id="filter-count-lights-fan">0</span>
                    </div>
                    <div class="category-filter ac" onclick="filterQuotesByCategory('ac')" data-category="ac">
                        <span id="icon-ac">❄️</span>
                        <span>AC Systems</span>
                        <span class="category-count" id="filter-count-ac">0</span>
                    </div>
                    <!-- Finishing Categories -->
                    <div class="category-filter paint" onclick="filterQuotesByCategory('paint')" data-category="paint">
                        <span id="icon-paint">🎨</span>
                        <span>Paint Works</span>
                        <span class="category-count" id="filter-count-paint">0</span>
                    </div>
                    <div class="category-filter curtain" onclick="filterQuotesByCategory('curtain')" data-category="curtain">
                        <span id="icon-curtain">🪟</span>
                        <span>Curtain & Blind</span>
                        <span class="category-count" id="filter-count-curtain">0</span>
                    </div>
                    <!-- Furniture Categories -->
                    <div class="category-filter builtin" onclick="filterQuotesByCategory('builtin')" data-category="builtin">
                        <span id="icon-builtin">🔨</span>
                        <span>Built-in Furniture</span>
                        <span class="category-count" id="filter-count-builtin">0</span>
                    </div>
                    <div class="category-filter loose" onclick="filterQuotesByCategory('loose')" data-category="loose">
                        <span id="icon-loose">🪑</span>
                        <span>Loose Furniture</span>
                        <span class="category-count" id="filter-count-loose">0</span>
                    </div>
                    <!-- Services Categories -->
                    <div class="category-filter sanitary" onclick="filterQuotesByCategory('sanitary')" data-category="sanitary">
                        <span id="icon-sanitary">🚿</span>
                        <span>Sanitary & Water Pump</span>
                        <span class="category-count" id="filter-count-sanitary">0</span>
                    </div>
                    <div class="category-filter appliances" onclick="filterQuotesByCategory('appliances')" data-category="appliances">
                        <span id="icon-appliances">📺</span>
                        <span>Electrical Appliances</span>
                        <span class="category-count" id="filter-count-appliances">0</span>
                    </div>
                    <!-- Legacy Categories -->
                    <div class="category-filter electrical" onclick="filterQuotesByCategory('electrical')" data-category="electrical">
                        <span id="icon-electrical">⚡</span>
                        <span>Electrical</span>
                        <span class="category-count" id="filter-count-electrical">0</span>
                    </div>
                    <div class="category-filter plumbing" onclick="filterQuotesByCategory('plumbing')" data-category="plumbing">
                        <span id="icon-plumbing">🔧</span>
                        <span>Plumbing</span>
                        <span class="category-count" id="filter-count-plumbing">0</span>
                    </div>
                    <div class="category-filter hvac" onclick="filterQuotesByCategory('hvac')" data-category="hvac">
                        <span id="icon-hvac">🌡️</span>
                        <span>HVAC</span>
                        <span class="category-count" id="filter-count-hvac">0</span>
                    </div>
                    <div class="category-filter cleaning" onclick="filterQuotesByCategory('cleaning')" data-category="cleaning">
                        <span id="icon-cleaning">🧽</span>
                        <span>Cleaning</span>
                        <span class="category-count" id="filter-count-cleaning">0</span>
                    </div>
                    <div class="category-filter parts" onclick="filterQuotesByCategory('parts')" data-category="parts">
                        <span id="icon-parts">🔩</span>
                        <span>Parts</span>
                        <span class="category-count" id="filter-count-parts">0</span>
                    </div>
                    <div class="category-filter labor" onclick="filterQuotesByCategory('labor')" data-category="labor">
                        <span id="icon-labor">👷</span>
                        <span>Labor</span>
                        <span class="category-count" id="filter-count-labor">0</span>
                    </div>
                    <div class="category-filter equipment" onclick="filterQuotesByCategory('equipment')" data-category="equipment">
                        <span id="icon-equipment">🛠️</span>
                        <span>Equipment</span>
                        <span class="category-count" id="filter-count-equipment">0</span>
                    </div>
                    <div class="category-filter common" onclick="filterQuotesByCategory('common')" data-category="common">
                        <span id="icon-common">🏷️</span>
                        <span>Common</span>
                        <span class="category-count" id="filter-count-common">0</span>
                    </div>
                </div>

                <div id="quotes-list"></div>
            </div>

            <!-- Presets View -->
            <div id="presets-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Preset Items</h2>
                    <button class="add-btn" onclick="openPresetItemForm()">
                        <span>➕</span>
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="input" placeholder="Search preset items..." id="preset-search">
                </div>

                <!-- Enhanced Category Filters for Presets -->
                <div class="category-filters">
                    <div class="category-filter active" onclick="filterPresetsByCategory('all')" data-category="all">
                        <span>📋</span>
                        <span>All Items</span>
                        <span class="category-count" id="preset-filter-count-all">0</span>
                    </div>
                    <!-- Same categories as quotes -->
                    <div class="category-filter preliminary" onclick="filterPresetsByCategory('preliminary')" data-category="preliminary">
                        <span id="preset-icon-preliminary">🏗️</span>
                        <span>Preliminary</span>
                        <span class="category-count" id="preset-filter-count-preliminary">0</span>
                    </div>
                    <div class="category-filter wall" onclick="filterPresetsByCategory('wall')" data-category="wall">
                        <span id="preset-icon-wall">🧱</span>
                        <span>Wall Work</span>
                        <span class="category-count" id="preset-filter-count-wall">0</span>
                    </div>
                    <div class="category-filter floor" onclick="filterPresetsByCategory('floor')" data-category="floor">
                        <span id="preset-icon-floor">🏢</span>
                        <span>Floor Work</span>
                        <span class="category-count" id="preset-filter-count-floor">0</span>
                    </div>
                    <div class="category-filter ceiling" onclick="filterPresetsByCategory('ceiling')" data-category="ceiling">
                        <span id="preset-icon-ceiling">🏠</span>
                        <span>Ceiling Work</span>
                        <span class="category-count" id="preset-filter-count-ceiling">0</span>
                    </div>
                    <div class="category-filter roofing" onclick="filterPresetsByCategory('roofing')" data-category="roofing">
                        <span id="preset-icon-roofing">🏘️</span>
                        <span>Roofing</span>
                        <span class="category-count" id="preset-filter-count-roofing">0</span>
                    </div>
                    <div class="category-filter wetwork" onclick="filterPresetsByCategory('wetwork')" data-category="wetwork">
                        <span id="preset-icon-wetwork">💧</span>
                        <span>Wet Work</span>
                        <span class="category-count" id="preset-filter-count-wetwork">0</span>
                    </div>
                    <div class="category-filter me-work" onclick="filterPresetsByCategory('me-work')" data-category="me-work">
                        <span id="preset-icon-me-work">⚙️</span>
                        <span>M&E Work</span>
                        <span class="category-count" id="preset-filter-count-me-work">0</span>
                    </div>
                    <div class="category-filter exhaust" onclick="filterPresetsByCategory('exhaust')" data-category="exhaust">
                        <span id="preset-icon-exhaust">🌪️</span>
                        <span>Exhaust</span>
                        <span class="category-count" id="preset-filter-count-exhaust">0</span>
                    </div>
                    <div class="category-filter lights-fan" onclick="filterPresetsByCategory('lights-fan')" data-category="lights-fan">
                        <span id="preset-icon-lights-fan">💡</span>
                        <span>Lights & Fan</span>
                        <span class="category-count" id="preset-filter-count-lights-fan">0</span>
                    </div>
                    <div class="category-filter ac" onclick="filterPresetsByCategory('ac')" data-category="ac">
                        <span id="preset-icon-ac">❄️</span>
                        <span>AC Systems</span>
                        <span class="category-count" id="preset-filter-count-ac">0</span>
                    </div>
                    <div class="category-filter paint" onclick="filterPresetsByCategory('paint')" data-category="paint">
                        <span id="preset-icon-paint">🎨</span>
                        <span>Paint Works</span>
                        <span class="category-count" id="preset-filter-count-paint">0</span>
                    </div>
                    <div class="category-filter curtain" onclick="filterPresetsByCategory('curtain')" data-category="curtain">
                        <span id="preset-icon-curtain">🪟</span>
                        <span>Curtain & Blind</span>
                        <span class="category-count" id="preset-filter-count-curtain">0</span>
                    </div>
                    <div class="category-filter builtin" onclick="filterPresetsByCategory('builtin')" data-category="builtin">
                        <span id="preset-icon-builtin">🔨</span>
                        <span>Built-in Furniture</span>
                        <span class="category-count" id="preset-filter-count-builtin">0</span>
                    </div>
                    <div class="category-filter loose" onclick="filterPresetsByCategory('loose')" data-category="loose">
                        <span id="preset-icon-loose">🪑</span>
                        <span>Loose Furniture</span>
                        <span class="category-count" id="preset-filter-count-loose">0</span>
                    </div>
                    <div class="category-filter sanitary" onclick="filterPresetsByCategory('sanitary')" data-category="sanitary">
                        <span id="preset-icon-sanitary">🚿</span>
                        <span>Sanitary & Water Pump</span>
                        <span class="category-count" id="preset-filter-count-sanitary">0</span>
                    </div>
                    <div class="category-filter appliances" onclick="filterPresetsByCategory('appliances')" data-category="appliances">
                        <span id="preset-icon-appliances">📺</span>
                        <span>Electrical Appliances</span>
                        <span class="category-count" id="preset-filter-count-appliances">0</span>
                    </div>
                    <div class="category-filter electrical" onclick="filterPresetsByCategory('electrical')" data-category="electrical">
                        <span id="preset-icon-electrical">⚡</span>
                        <span>Electrical</span>
                        <span class="category-count" id="preset-filter-count-electrical">0</span>
                    </div>
                    <div class="category-filter plumbing" onclick="filterPresetsByCategory('plumbing')" data-category="plumbing">
                        <span id="preset-icon-plumbing">🔧</span>
                        <span>Plumbing</span>
                        <span class="category-count" id="preset-filter-count-plumbing">0</span>
                    </div>
                    <div class="category-filter hvac" onclick="filterPresetsByCategory('hvac')" data-category="hvac">
                        <span id="preset-icon-hvac">🌡️</span>
                        <span>HVAC</span>
                        <span class="category-count" id="preset-filter-count-hvac">0</span>
                    </div>
                    <div class="category-filter cleaning" onclick="filterPresetsByCategory('cleaning')" data-category="cleaning">
                        <span id="preset-icon-cleaning">🧽</span>
                        <span>Cleaning</span>
                        <span class="category-count" id="preset-filter-count-cleaning">0</span>
                    </div>
                    <div class="category-filter parts" onclick="filterPresetsByCategory('parts')" data-category="parts">
                        <span id="preset-icon-parts">🔩</span>
                        <span>Parts</span>
                        <span class="category-count" id="preset-filter-count-parts">0</span>
                    </div>
                    <div class="category-filter labor" onclick="filterPresetsByCategory('labor')" data-category="labor">
                        <span id="preset-icon-labor">👷</span>
                        <span>Labor</span>
                        <span class="category-count" id="preset-filter-count-labor">0</span>
                    </div>
                    <div class="category-filter equipment" onclick="filterPresetsByCategory('equipment')" data-category="equipment">
                        <span id="preset-icon-equipment">🛠️</span>
                        <span>Equipment</span>
                        <span class="category-count" id="preset-filter-count-equipment">0</span>
                    </div>
                    <div class="category-filter common" onclick="filterPresetsByCategory('common')" data-category="common">
                        <span id="preset-icon-common">🏷️</span>
                        <span>Common</span>
                        <span class="category-count" id="preset-filter-count-common">0</span>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-weight: 700; color: var(--text-primary);">📊 Preset Statistics</h3>
                        <span style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 600; color: var(--text-primary);" id="preset-count">0 items</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 14px;">
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Categories</div>
                            <div style="font-weight: 700; color: var(--accent-primary);" id="category-count">0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Avg Price</div>
                            <div style="font-weight: 700; color: var(--accent-warm);" id="avg-preset-price">RM 0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Usage</div>
                            <div style="font-weight: 700; color: var(--text-primary);" id="preset-usage-count">0</div>
                        </div>
                    </div>
                </div>

                <div id="presets-list"></div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="icon">🏠</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="showView('quotes')">
                    <span class="icon">💰</span>
                    <span>Quotes</span>
                </div>
                <div class="nav-item" onclick="showView('presets')">
                    <span class="icon">📋</span>
                    <span>Presets</span>
                </div>
            </div>
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- Simplified Job Quote Modal - 2 Step Process -->
    <div id="simple-job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="simple-job-modal-title">💰 Create Job Quote</h3>
                <button class="close-btn" onclick="closeSimpleJobForm()">✕</button>
            </div>
            <div class="modal-body">
                <!-- Step Indicator -->
                <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 24px; gap: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div id="step-1-indicator" style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">1</div>
                        <span style="font-weight: 600; color: var(--text-primary);">Job Title</span>
                    </div>
                    <div style="width: 40px; height: 2px; background: var(--border-color);"></div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div id="step-2-indicator" style="width: 32px; height: 32px; border-radius: 50%; background: var(--border-color); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">2</div>
                        <span style="font-weight: 600; color: var(--text-muted);">Add Items</span>
                    </div>
                </div>

                <!-- Step 1: Job Title -->
                <div id="step-1-content" style="display: block;">
                    <div style="background: var(--bg-card); border-radius: 20px; padding: 32px; margin: 20px 0; border: 2px solid var(--accent-primary); box-shadow: 0 8px 32px var(--shadow-light); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">📝</div>
                        <h3 style="font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">Step 1: Enter Job Title</h3>
                        <p style="color: var(--text-muted); margin-bottom: 24px; font-size: 16px;">What type of maintenance work is this quote for?</p>
                        
                        <input type="text" 
                               class="form-input" 
                               placeholder="e.g., Office Renovation, AC Installation, Plumbing Repair..." 
                               id="simple-job-title" 
                               required 
                               style="margin-bottom: 24px; font-size: 18px; padding: 20px 24px; text-align: center; font-weight: 600;">
                        
                        <button type="button" 
                                class="btn btn-primary" 
                                onclick="proceedToStep2()" 
                                style="font-size: 18px; padding: 20px 32px; min-height: 60px; width: 100%;">
                            Next: Add Items ➡️
                        </button>
                    </div>
                </div>

                <!-- Step 2: Add Items -->
                <div id="step-2-content" style="display: none;">
                    <div style="background: var(--bg-card); border-radius: 16px; padding: 24px; margin: 20px 0; border: 2px solid var(--accent-secondary); box-shadow: 0 8px 32px var(--shadow-light);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="font-size: 20px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 24px;">📋</span>
                                Step 2: Select Jobs to Do
                            </h3>
                            <button type="button" onclick="backToStep1()" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px;">
                                ⬅️ Back
                            </button>
                        </div>
                        
                        <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 16px;">Choose from preset job items or browse by category:</p>
                        
                        <!-- Category Filter for Step 2 -->
                        <div style="margin-bottom: 20px;">
                            <select id="preset-category-selector" class="form-input" style="margin-bottom: 0; padding: 16px 20px; font-size: 16px;" onchange="filterPresetItemsInModal()">
                                <option value="all">🔍 All Categories</option>
                                <optgroup label="🏗️ Construction">
                                    <option value="preliminary">🏗️ Preliminary Work</option>
                                    <option value="wall">🧱 Wall Work</option>
                                    <option value="floor">🏢 Floor Work</option>
                                    <option value="ceiling">🏠 Ceiling Work</option>
                                    <option value="roofing">🏘️ Roofing</option>
                                    <option value="wetwork">💧 Wet Work</option>
                                </optgroup>
                                <optgroup label="⚙️ M&E Systems">
                                    <option value="me-work">⚙️ M&E Work</option>
                                    <option value="exhaust">🌪️ Exhaust Systems</option>
                                    <option value="lights-fan">💡 Lights & Fan</option>
                                    <option value="ac">❄️ AC Systems</option>
                                </optgroup>
                                <optgroup label="🎨 Finishing">
                                    <option value="paint">🎨 Paint Works</option>
                                    <option value="curtain">🪟 Curtain & Blind</option>
                                </optgroup>
                                <optgroup label="🪑 Furniture">
                                    <option value="builtin">🔨 Built-in Furniture</option>
                                    <option value="loose">🪑 Loose Furniture</option>
                                </optgroup>
                                <optgroup label="🔧 Services">
                                    <option value="sanitary">🚿 Sanitary & Water Pump</option>
                                    <option value="appliances">📺 Electrical Appliances</option>
                                </optgroup>
                                <optgroup label="🔌 Legacy">
                                    <option value="electrical">⚡ Electrical</option>
                                    <option value="plumbing">🔧 Plumbing</option>
                                    <option value="hvac">🌡️ HVAC</option>
                                    <option value="cleaning">🧽 Cleaning</option>
                                    <option value="parts">🔩 Parts & Materials</option>
                                    <option value="labor">👷 Labor</option>
                                    <option value="equipment">🛠️ Equipment</option>
                                    <option value="common">🏷️ Common Items</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <!-- Preset Items List -->
                        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: 12px;">
                            <div id="preset-items-list"></div>
                        </div>
                    </div>

                    <!-- Selected Items Summary -->
                    <div id="quote-items-summary" style="display: none;">
                        <div style="background: var(--bg-secondary); border-radius: 16px; padding: 24px; margin: 20px 0; border: 2px solid var(--accent-primary); box-shadow: 0 8px 32px var(--shadow-light);">
                            <h4 style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">✅</span>
                                Selected Items (<span id="selected-items-count">0</span>)
                            </h4>
                            <div id="selected-items-list"></div>
                            <div style="background: var(--accent-primary); border-radius: 12px; padding: 20px; margin-top: 16px; text-align: center; box-shadow: 0 6px 20px var(--shadow-medium);">
                                <div style="font-size: 14px; font-weight: 600; color: rgba(255, 255, 255, 0.9); margin-bottom: 6px;">Total Quote Amount</div>
                                <div style="font-size: 32px; font-weight: 800; color: #ffffff;" id="total-quote-amount">RM 0.00</div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 Actions -->
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 16px; margin-top: 24px;">
                        <button type="button" class="form-btn btn-secondary" onclick="closeSimpleJobForm()">
                            Cancel
                        </button>
                        <button type="button" class="form-btn btn-primary" onclick="saveSimpleJob()" id="save-quote-btn" disabled>
                            ✅ Save Job Quote
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Preset Item Form Modal -->
    <div id="preset-item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preset-item-modal-title">➕ Add Preset Item</h3>
                <button class="close-btn" onclick="closePresetItemForm()">✕</button>
            </div>
            <div class="modal-body">
                <form id="preset-item-form">
                    <input type="text" class="form-input" placeholder="Item Name *" id="preset-item-name" required>
                    <textarea class="form-input" placeholder="Description" id="preset-item-description" rows="2" style="resize: none;"></textarea>
                    <input type="number" class="form-input" placeholder="Default Price (RM) *" id="preset-item-price" step="0.01" required>
                    <select class="form-input" id="preset-item-unit">
                        <option value="pcs">Pieces (pcs)</option>
                        <option value="hours">Hours</option>
                        <option value="sqft">Square Feet</option>
                        <option value="sqm">Square Meters</option>
                        <option value="meters">Meters</option>
                        <option value="kg">Kilograms</option>
                        <option value="liters">Liters</option>
                        <option value="set">Set</option>
                        <option value="lot">Lot</option>
                        <option value="service">Service</option>
                    </select>
                    <select class="form-input" id="preset-item-category">
                        <optgroup label="Construction">
                            <option value="preliminary">🏗️ Preliminary Work</option>
                            <option value="wall">🧱 Wall Work</option>
                            <option value="floor">🏢 Floor Work</option>
                            <option value="ceiling">🏠 Ceiling Work</option>
                            <option value="roofing">🏘️ Roofing</option>
                            <option value="wetwork">💧 Wet Work</option>
                        </optgroup>
                        <optgroup label="M&E Systems">
                            <option value="me-work">⚙️ M&E Work</option>
                            <option value="exhaust">🌪️ Exhaust Systems</option>
                            <option value="lights-fan">💡 Lights & Fan</option>
                            <option value="ac">❄️ AC Systems</option>
                        </optgroup>
                        <optgroup label="Finishing">
                            <option value="paint">🎨 Paint Works</option>
                            <option value="curtain">🪟 Curtain & Blind</option>
                        </optgroup>
                        <optgroup label="Furniture">
                            <option value="builtin">🔨 Built-in Furniture</option>
                            <option value="loose">🪑 Loose Furniture</option>
                        </optgroup>
                        <optgroup label="Services">
                            <option value="sanitary">🚿 Sanitary & Water Pump</option>
                            <option value="appliances">📺 Electrical Appliances</option>
                        </optgroup>
                        <optgroup label="Legacy">
                            <option value="electrical">⚡ Electrical</option>
                            <option value="plumbing">🔧 Plumbing</option>
                            <option value="hvac">🌡️ HVAC</option>
                            <option value="cleaning">🧽 Cleaning</option>
                            <option value="parts">🔩 Parts & Materials</option>
                            <option value="labor">👷 Labor</option>
                            <option value="equipment">🛠️ Equipment</option>
                            <option value="common" selected>🏷️ Common Items</option>
                        </optgroup>
                    </select>
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn btn-primary">Save Preset</button>
                        <button type="button" class="form-btn btn-secondary" onclick="closePresetItemForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quote View Modal -->
    <div id="quote-view-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💰 Job Quote Details</h3>
                <button class="close-btn" onclick="closeQuoteView()">✕</button>
            </div>
            <div class="modal-body" id="quote-view-content">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        ✅ Data saved successfully!
    </div>

    <script>
        // ========================================
        // REFIT MAINTENANCE SERVICES - ENHANCED MANAGEMENT SYSTEM
        // Registration No: 201803348973 (002894203-V)
        // Enhanced with Complete Category System & User Management
        // ========================================
        
        // App State Variables
        var currentView = 'dashboard';
        var jobQuotes = [];
        var presetWorkItems = [];
        var currentQuoteItems = [];
        var editingJob = null;
        var editingPreset = null;
        var selectedLogoIndex = 0;
        var currentTheme = 'light';
        var currentQuoteFilter = 'all';
        var currentPresetFilter = 'all';
        var customIcons = {};
        var userInfo = {};
        var customLogo = null;

        // Enhanced Category Configuration with All Requested Categories
        var categories = {
            // Construction Categories
            preliminary: {
                name: 'Preliminary Work',
                icon: '🏗️',
                color: 'var(--cat-preliminary)',
                description: 'Site preparation and preliminary construction work'
            },
            wall: {
                name: 'Wall Work',
                icon: '🧱',
                color: 'var(--cat-wall)',
                description: 'Wall construction, renovation and finishing'
            },
            floor: {
                name: 'Floor Work',
                icon: '🏢',
                color: 'var(--cat-floor)',
                description: 'Flooring installation and finishing'
            },
            ceiling: {
                name: 'Ceiling Work',
                icon: '🏠',
                color: 'var(--cat-ceiling)',
                description: 'Ceiling installation and finishing'
            },
            roofing: {
                name: 'Roofing',
                icon: '🏘️',
                color: 'var(--cat-roofing)',
                description: 'Roof installation and maintenance'
            },
            wetwork: {
                name: 'Wet Work',
                icon: '💧',
                color: 'var(--cat-wetwork)',
                description: 'Bathroom, kitchen and wet area work'
            },
            // M&E Categories
            'me-work': {
                name: 'M&E Work',
                icon: '⚙️',
                color: 'var(--cat-me-work)',
                description: 'Mechanical and electrical systems'
            },
            exhaust: {
                name: 'Exhaust Systems',
                icon: '🌪️',
                color: 'var(--cat-exhaust)',
                description: 'Ventilation and exhaust systems'
            },
            'lights-fan': {
                name: 'Lights & Fan',
                icon: '💡',
                color: 'var(--cat-lights-fan)',
                description: 'Lighting and fan installations'
            },
            ac: {
                name: 'AC Systems',
                icon: '❄️',
                color: 'var(--cat-ac)',
                description: 'Air conditioning systems'
            },
            // Finishing Categories
            paint: {
                name: 'Paint Works',
                icon: '🎨',
                color: 'var(--cat-paint)',
                description: 'Painting and finishing work'
            },
            curtain: {
                name: 'Curtain & Blind',
                icon: '🪟',
                color: 'var(--cat-curtain)',
                description: 'Window treatments and coverings'
            },
            // Furniture Categories
            builtin: {
                name: 'Built-in Furniture',
                icon: '🔨',
                color: 'var(--cat-builtin)',
                description: 'Custom built-in furniture and storage'
            },
            loose: {
                name: 'Loose Furniture',
                icon: '🪑',
                color: 'var(--cat-loose)',
                description: 'Movable furniture and furnishings'
            },
            // Service Categories
            sanitary: {
                name: 'Sanitary & Water Pump',
                icon: '🚿',
                color: 'var(--cat-sanitary)',
                description: 'Sanitary installations and water pump systems'
            },
            appliances: {
                name: 'Electrical Appliances',
                icon: '📺',
                color: 'var(--cat-appliances)',
                description: 'Electrical appliances and equipment'
            },
            // Legacy Categories (keeping for backward compatibility)
            electrical: {
                name: 'Electrical',
                icon: '⚡',
                color: 'var(--cat-electrical)',
                description: 'Electrical systems, wiring, and components'
            },
            plumbing: {
                name: 'Plumbing',
                icon: '🔧',
                color: 'var(--cat-plumbing)',
                description: 'Water systems, pipes, and fixtures'
            },
            hvac: {
                name: 'HVAC',
                icon: '🌡️',
                color: 'var(--cat-hvac)',
                description: 'Heating, ventilation, and air conditioning'
            },
            cleaning: {
                name: 'Cleaning',
                icon: '🧽',
                color: 'var(--cat-cleaning)',
                description: 'Cleaning services and maintenance'
            },
            parts: {
                name: 'Parts & Materials',
                icon: '🔩',
                color: 'var(--cat-parts)',
                description: 'Replacement parts and materials'
            },
            labor: {
                name: 'Labor',
                icon: '👷',
                color: 'var(--cat-labor)',
                description: 'Labor charges and work hours'
            },
            equipment: {
                name: 'Equipment',
                icon: '🛠️',
                color: 'var(--cat-equipment)',
                description: 'Tools and equipment'
            },
            common: {
                name: 'Common Items',
                icon: '🏷️',
                color: 'var(--cat-common)',
                description: 'Frequently used items'
            }
        };

        // Company Settings
        var companySettings = {
            name: 'REFIT MAINTENANCE SERVICES',
            registration: '201803348973 (002894203-V)',
            tagline: 'Professional Maintenance Solutions',
            phone: '+60 3-7967 8888',
            email: 'info@refitmaintenance.my',
            website: 'www.refitmaintenance.my',
            address: 'No. 15, Jalan Teknologi 3/6, Kota Damansara, 47810 Petaling Jaya, Selangor, Malaysia'
        };

        // Storage Keys
        var STORAGE_KEYS = {
            JOB_QUOTES: 'refit_enhanced_job_quotes',
            PRESET_WORK_ITEMS: 'refit_enhanced_preset_items',
            SELECTED_LOGO: 'refit_selected_logo',
            THEME_PREFERENCE: 'refit_theme_preference',
            CUSTOM_ICONS: 'refit_custom_icons',
            USER_INFO: 'refit_user_info',
            CUSTOM_LOGO: 'refit_custom_logo'
        };

        // Enhanced Default Preset Work Items with All New Categories
        var defaultPresetWorkItems = [
            // Preliminary Work
            { id: 'preliminary-survey', name: 'Site Survey & Assessment', description: 'Initial site evaluation and condition assessment', price: 250.00, unit: 'service', category: 'preliminary' },
            { id: 'preliminary-protection', name: 'Protective Covering', description: 'Floor and furniture protection during work', price: 120.00, unit: 'service', category: 'preliminary' },
            { id: 'preliminary-demolition', name: 'Selective Demolition', description: 'Careful removal of existing structures', price: 85.00, unit: 'sqm', category: 'preliminary' },
            { id: 'preliminary-cleanup', name: 'Site Cleanup', description: 'Construction debris removal and cleaning', price: 45.00, unit: 'hours', category: 'preliminary' },
            
            // Wall Work
            { id: 'wall-drywall-install', name: 'Drywall Installation', description: 'Standard drywall installation with finishing', price: 35.00, unit: 'sqm', category: 'wall' },
            { id: 'wall-partition', name: 'Partition Wall Construction', description: 'Metal stud partition wall with drywall', price: 65.00, unit: 'sqm', category: 'wall' },
            { id: 'wall-repair-patch', name: 'Wall Patching & Repair', description: 'Minor wall damage repair and patching', price: 25.00, unit: 'sqm', category: 'wall' },
            { id: 'wall-texture-finish', name: 'Wall Texture Finishing', description: 'Decorative wall texture application', price: 18.00, unit: 'sqm', category: 'wall' },
            
            // Floor Work
            { id: 'floor-vinyl-install', name: 'Vinyl Flooring Installation', description: 'Commercial grade vinyl flooring', price: 45.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-carpet-install', name: 'Carpet Installation', description: 'Commercial carpet with padding', price: 55.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-tile-install', name: 'Ceramic Tile Installation', description: 'Floor tile installation with grouting', price: 68.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-hardwood-install', name: 'Hardwood Flooring', description: 'Engineered hardwood flooring installation', price: 95.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-leveling', name: 'Floor Leveling', description: 'Floor surface preparation and leveling', price: 28.00, unit: 'sqm', category: 'floor' },
            
            // Ceiling Work
            { id: 'ceiling-suspended', name: 'Suspended Ceiling Installation', description: 'Mineral fiber suspended ceiling system', price: 42.00, unit: 'sqm', category: 'ceiling' },
            { id: 'ceiling-drywall', name: 'Drywall Ceiling', description: 'Drywall ceiling installation and finishing', price: 38.00, unit: 'sqm', category: 'ceiling' },
            { id: 'ceiling-repair', name: 'Ceiling Repair', description: 'Water damage and crack repair', price: 35.00, unit: 'sqm', category: 'ceiling' },
            { id: 'ceiling-insulation', name: 'Ceiling Insulation', description: 'Thermal insulation installation', price: 22.00, unit: 'sqm', category: 'ceiling' },
            
            // Roofing
            { id: 'roofing-shingle-repair', name: 'Shingle Roof Repair', description: 'Asphalt shingle replacement and repair', price: 85.00, unit: 'sqm', category: 'roofing' },
            { id: 'roofing-membrane', name: 'Roof Membrane Installation', description: 'Waterproof membrane application', price: 125.00, unit: 'sqm', category: 'roofing' },
            { id: 'roofing-gutter-clean', name: 'Gutter Cleaning & Maintenance', description: 'Gutter system cleaning and minor repairs', price: 8.00, unit: 'meters', category: 'roofing' },
            { id: 'roofing-inspection', name: 'Roof Inspection', description: 'Comprehensive roof condition assessment', price: 180.00, unit: 'service', category: 'roofing' },
            
            // Wet Work
            { id: 'wetwork-waterproofing', name: 'Waterproofing Application', description: 'Bathroom and wet area waterproofing', price: 75.00, unit: 'sqm', category: 'wetwork' },
            { id: 'wetwork-tile-wall', name: 'Wall Tile Installation', description: 'Ceramic wall tiles with waterproof backing', price: 85.00, unit: 'sqm', category: 'wetwork' },
            { id: 'wetwork-shower-install', name: 'Shower System Installation', description: 'Complete shower enclosure and fixtures', price: 650.00, unit: 'set', category: 'wetwork' },
            { id: 'wetwork-drainage', name: 'Drainage System', description: 'Floor drainage and waterproofing', price: 220.00, unit: 'pcs', category: 'wetwork' },
            
            // M&E Work
            { id: 'me-panel-install', name: 'Electrical Panel Installation', description: 'Main electrical distribution panel', price: 450.00, unit: 'pcs', category: 'me-work' },
            { id: 'me-conduit-run', name: 'Conduit Installation', description: 'Electrical conduit and cable management', price: 15.00, unit: 'meters', category: 'me-work' },
            { id: 'me-cable-pull', name: 'Cable Pulling', description: 'Electrical cable installation in conduits', price: 8.50, unit: 'meters', category: 'me-work' },
            { id: 'me-testing', name: 'Electrical Testing & Commissioning', description: 'System testing and certification', price: 350.00, unit: 'service', category: 'me-work' },
            
            // Exhaust Systems
            { id: 'exhaust-kitchen', name: 'Kitchen Exhaust Installation', description: 'Commercial kitchen exhaust system', price: 850.00, unit: 'set', category: 'exhaust' },
            { id: 'exhaust-bathroom', name: 'Bathroom Exhaust Fan', description: 'Silent bathroom exhaust fan with timer', price: 165.00, unit: 'pcs', category: 'exhaust' },
            { id: 'exhaust-ductwork', name: 'Exhaust Ductwork', description: 'Galvanized steel exhaust ductwork', price: 35.00, unit: 'meters', category: 'exhaust' },
            { id: 'exhaust-roof-cap', name: 'Roof Exhaust Cap', description: 'Weatherproof roof exhaust termination', price: 120.00, unit: 'pcs', category: 'exhaust' },
            
            // Lights & Fan
            { id: 'lights-led-panel', name: 'LED Panel Light', description: '40W LED panel light with driver', price: 85.00, unit: 'pcs', category: 'lights-fan' },
            { id: 'lights-downlight', name: 'LED Downlight', description: '12W recessed LED downlight', price: 45.00, unit: 'pcs', category: 'lights-fan' },
            { id: 'lights-track', name: 'Track Lighting System', description: 'Adjustable track lighting with LED spots', price: 180.00, unit: 'set', category: 'lights-fan' },
            { id: 'fan-ceiling-standard', name: 'Standard Ceiling Fan', description: '52" ceiling fan with remote control', price: 220.00, unit: 'pcs', category: 'lights-fan' },
            { id: 'fan-ceiling-premium', name: 'Premium Ceiling Fan', description: 'DC motor ceiling fan with LED lighting', price: 380.00, unit: 'pcs', category: 'lights-fan' },
            
            // AC Systems
            { id: 'ac-split-install', name: 'Split AC Installation', description: '1.5HP split unit air conditioner', price: 1200.00, unit: 'set', category: 'ac' },
            { id: 'ac-ducted-install', name: 'Ducted AC System', description: 'Central ducted air conditioning', price: 3500.00, unit: 'set', category: 'ac' },
            { id: 'ac-maintenance', name: 'AC Maintenance Service', description: 'Quarterly AC cleaning and maintenance', price: 120.00, unit: 'service', category: 'ac' },
            { id: 'ac-gas-refill', name: 'AC Gas Refill', description: 'R410A refrigerant gas top-up', price: 180.00, unit: 'service', category: 'ac' },
            
            // Paint Works
            { id: 'paint-interior-wall', name: 'Interior Wall Painting', description: 'Two coats premium interior paint', price: 12.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-exterior-wall', name: 'Exterior Wall Painting', description: 'Weather-resistant exterior paint', price: 18.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-ceiling', name: 'Ceiling Painting', description: 'Ceiling paint with primer', price: 15.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-texture', name: 'Texture Paint Application', description: 'Decorative texture paint finish', price: 25.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-primer', name: 'Surface Primer Application', description: 'Primer coat for new surfaces', price: 8.00, unit: 'sqm', category: 'paint' },
            
            // Curtain & Blind
            { id: 'curtain-fabric', name: 'Fabric Curtain Installation', description: 'Custom fabric curtains with hardware', price: 85.00, unit: 'sqm', category: 'curtain' },
            { id: 'curtain-blackout', name: 'Blackout Curtains', description: 'Light-blocking curtains for bedrooms', price: 95.00, unit: 'sqm', category: 'curtain' },
            { id: 'blind-vertical', name: 'Vertical Blind Installation', description: 'PVC vertical blinds for offices', price: 65.00, unit: 'sqm', category: 'curtain' },
            { id: 'blind-horizontal', name: 'Horizontal Blind', description: 'Aluminum horizontal mini blinds', price: 55.00, unit: 'sqm', category: 'curtain' },
            { id: 'blind-roller', name: 'Roller Blind', description: 'Motorized roller blind system', price: 150.00, unit: 'sqm', category: 'curtain' },
            
            // Built-in Furniture
            { id: 'builtin-wardrobe', name: 'Built-in Wardrobe', description: 'Custom melamine wardrobe with drawers', price: 450.00, unit: 'sqm', category: 'builtin' },
            { id: 'builtin-kitchen', name: 'Kitchen Cabinet', description: 'Modular kitchen cabinet system', price: 650.00, unit: 'sqm', category: 'builtin' },
            { id: 'builtin-bookshelf', name: 'Built-in Bookshelf', description: 'Custom timber bookshelf unit', price: 320.00, unit: 'sqm', category: 'builtin' },
            { id: 'builtin-desk', name: 'Built-in Study Desk', description: 'Wall-mounted study desk with storage', price: 280.00, unit: 'pcs', category: 'builtin' },
            { id: 'builtin-tv-console', name: 'TV Console Unit', description: 'Wall-mounted TV console with storage', price: 380.00, unit: 'pcs', category: 'builtin' },
            
            // Loose Furniture
            { id: 'loose-office-chair', name: 'Office Chair', description: 'Ergonomic mesh office chair', price: 250.00, unit: 'pcs', category: 'loose' },
            { id: 'loose-office-desk', name: 'Office Desk', description: 'Modern office desk with drawers', price: 450.00, unit: 'pcs', category: 'loose' },
            { id: 'loose-sofa-set', name: 'Sofa Set', description: '3-seater fabric sofa set', price: 1200.00, unit: 'set', category: 'loose' },
            { id: 'loose-dining-set', name: 'Dining Set', description: '6-seater dining table and chairs', price: 850.00, unit: 'set', category: 'loose' },
            { id: 'loose-storage', name: 'Storage Cabinet', description: 'Mobile storage cabinet with locks', price: 180.00, unit: 'pcs', category: 'loose' },
            
            // Sanitary & Water Pump
            { id: 'sanitary-toilet-suite', name: 'Toilet Suite Installation', description: 'Complete toilet suite with accessories', price: 350.00, unit: 'set', category: 'sanitary' },
            { id: 'sanitary-basin', name: 'Wash Basin Installation', description: 'Wall-hung basin with mixer tap', price: 280.00, unit: 'set', category: 'sanitary' },
            { id: 'sanitary-shower-set', name: 'Shower Set Installation', description: 'Rain shower set with thermostatic mixer', price: 420.00, unit: 'set', category: 'sanitary' },
            { id: 'sanitary-water-pump', name: 'Water Pump Installation', description: 'Domestic water pressure pump', price: 650.00, unit: 'set', category: 'sanitary' },
            { id: 'sanitary-pipe-work', name: 'Sanitary Pipe Work', description: 'PVC sanitary pipe installation', price: 25.00, unit: 'meters', category: 'sanitary' },
            
            // Electrical Appliances
            { id: 'appliances-water-heater', name: 'Electric Water Heater', description: '30L instant electric water heater', price: 380.00, unit: 'pcs', category: 'appliances' },
            { id: 'appliances-hood', name: 'Range Hood Installation', description: 'Kitchen range hood with ducting', price: 450.00, unit: 'pcs', category: 'appliances' },
            { id: 'appliances-oven', name: 'Built-in Oven', description: 'Electric built-in oven installation', price: 850.00, unit: 'pcs', category: 'appliances' },
            { id: 'appliances-hob', name: 'Induction Hob', description: '4-burner induction hob installation', price: 650.00, unit: 'pcs', category: 'appliances' },
            { id: 'appliances-refrigerator', name: 'Refrigerator Installation', description: 'Commercial refrigerator setup', price: 1200.00, unit: 'pcs', category: 'appliances' },
            
            // Legacy Categories (keeping existing items)
            { id: 'electrical-inspection', name: 'Electrical Safety Inspection', description: 'Complete electrical system safety check', price: 150.00, unit: 'service', category: 'electrical' },
            { id: 'electrical-outlet', name: 'Power Outlet Installation', description: 'Standard 13A power outlet', price: 45.00, unit: 'pcs', category: 'electrical' },
            { id: 'plumbing-pipe-repair', name: 'Pipe Repair Service', description: 'Water pipe leak repair', price: 65.00, unit: 'service', category: 'plumbing' },
            { id: 'hvac-filter-change', name: 'HVAC Filter Replacement', description: 'Air filter replacement service', price: 35.00, unit: 'pcs', category: 'hvac' },
            { id: 'cleaning-office', name: 'Office Cleaning Service', description: 'Standard office cleaning', price: 25.00, unit: 'sqm', category: 'cleaning' },
            { id: 'parts-electrical-wire', name: 'Electrical Wire', description: 'Standard electrical wiring cable', price: 8.50, unit: 'meters', category: 'parts' },
            { id: 'labor-technician', name: 'Technician Labor', description: 'Skilled technician work hour', price: 45.00, unit: 'hours', category: 'labor' },
            { id: 'equipment-drill-rental', name: 'Power Drill Rental', description: 'Professional power drill rental', price: 35.00, unit: 'hours', category: 'equipment' },
            { id: 'common-service-call', name: 'Service Call Fee', description: 'Basic service call charge', price: 75.00, unit: 'service', category: 'common' }
        ];

        // Theme Management Functions
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#2d3748' : '#1a1a1a';
            }
            
            saveDataToStorage();
            showSuccessMessage(currentTheme === 'light' ? '☀️ Light mode activated' : '🌙 Dark mode activated - Easy on the eyes!');
        }

        function loadThemePreference() {
            var savedTheme = JSON.parse(localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) || 'light';
            
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) {
                savedTheme = 'dark';
            }
            
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#2d3748' : '#1a1a1a';
            }
        }

        // User Info Management Functions
        function openUserInfo() {
            loadUserInfo();
            document.getElementById('user-info-modal').classList.add('show');
            showSuccessMessage('👤 User info panel opened');
        }

        function closeUserInfo() {
            document.getElementById('user-info-modal').classList.remove('show');
        }

        function loadUserInfo() {
            var savedUserInfo = localStorage.getItem(STORAGE_KEYS.USER_INFO);
            if (savedUserInfo) {
                userInfo = JSON.parse(savedUserInfo);
            }
            
            document.getElementById('user-company-name').value = userInfo.companyName || companySettings.name;
            document.getElementById('user-registration').value = userInfo.registration || companySettings.registration;
            document.getElementById('user-phone').value = userInfo.phone || companySettings.phone;
            document.getElementById('user-email').value = userInfo.email || companySettings.email;
            document.getElementById('user-address').value = userInfo.address || companySettings.address;
            document.getElementById('user-website').value = userInfo.website || companySettings.website;
            
            // Load custom logo preview
            var savedLogo = localStorage.getItem(STORAGE_KEYS.CUSTOM_LOGO);
            if (savedLogo) {
                customLogo = savedLogo;
                showLogoPreview(savedLogo);
            }
        }

        function saveUserInfo() {
            userInfo = {
                companyName: document.getElementById('user-company-name').value.trim(),
                registration: document.getElementById('user-registration').value.trim(),
                phone: document.getElementById('user-phone').value.trim(),
                email: document.getElementById('user-email').value.trim(),
                address: document.getElementById('user-address').value.trim(),
                website: document.getElementById('user-website').value.trim()
            };
            
            // Update company settings
            companySettings.name = userInfo.companyName || companySettings.name;
            companySettings.registration = userInfo.registration || companySettings.registration;
            companySettings.phone = userInfo.phone || companySettings.phone;
            companySettings.email = userInfo.email || companySettings.email;
            companySettings.address = userInfo.address || companySettings.address;
            companySettings.website = userInfo.website || companySettings.website;
            
            // Update header display
            document.getElementById('company-name').textContent = companySettings.name;
            document.getElementById('company-registration').innerHTML = 'Registration No: ' + companySettings.registration.split('(')[0] + '<br>(' + companySettings.registration.split('(')[1];
            
            localStorage.setItem(STORAGE_KEYS.USER_INFO, JSON.stringify(userInfo));
            saveDataToStorage();
            closeUserInfo();
            showSuccessMessage('✅ User information saved successfully!');
        }

        function handleLogoUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showSuccessMessage('⚠️ File too large! Please choose an image under 2MB');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('⚠️ Please select a valid image file');
                return;
            }
            
            var reader = new FileReader();
            reader.onload = function(e) {
                customLogo = e.target.result;
                localStorage.setItem(STORAGE_KEYS.CUSTOM_LOGO, customLogo);
                showLogoPreview(customLogo);
                applyCustomLogo();
                showSuccessMessage('✅ Custom logo uploaded successfully!');
            };
            reader.readAsDataURL(file);
        }

        function showLogoPreview(logoData) {
            var previewContainer = document.getElementById('logo-preview');
            if (previewContainer) {
                previewContainer.innerHTML = '<img src="' + logoData + '" class="upload-preview" alt="Logo Preview">';
            }
        }

        function removeCustomLogo() {
            if (confirm('Remove custom logo and revert to default?')) {
                customLogo = null;
                localStorage.removeItem(STORAGE_KEYS.CUSTOM_LOGO);
                document.getElementById('logo-preview').innerHTML = '';
                document.getElementById('logo-upload').value = '';
                
                // Revert to default logo
                var logoContainer = document.getElementById('main-logo');
                if (logoContainer) {
                    logoContainer.innerHTML = logoTemplates[selectedLogoIndex];
                }
                showSuccessMessage('🗑️ Custom logo removed - reverted to default');
            }
        }

        function applyCustomLogo() {
            if (customLogo) {
                var logoContainer = document.getElementById('main-logo');
                if (logoContainer) {
                    logoContainer.innerHTML = '<img src="' + customLogo + '" class="user-logo" alt="Custom Logo">';
                }
            }
        }

        // Icon Upload Management Functions
        function openIconUpload() {
            renderCategoryIconList();
            document.getElementById('icon-upload-modal').classList.add('show');
            showSuccessMessage('🎨 Category icon upload panel opened');
        }

        function closeIconUpload() {
            document.getElementById('icon-upload-modal').classList.remove('show');
        }

        function renderCategoryIconList() {
            var container = document.getElementById('category-icon-list');
            if (!container) return;
            
            var html = '';
            
            for (var categoryKey in categories) {
                var category = categories[categoryKey];
                var customIcon = customIcons[categoryKey];
                
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color);">' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">' +
                    '<div style="display: flex; align-items: center; gap: 12px;">' +
                    '<div class="category-icon ' + categoryKey + '" style="width: 32px; height: 32px;">' +
                    (customIcon ? '<img src="' + customIcon + '" class="custom-icon" alt="' + category.name + '">' : category.icon) +
                    '</div>' +
                    '<div>' +
                    '<div style="font-weight: 700; color: var(--text-primary); font-size: 14px;">' + category.name + '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted);">' + category.description + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 8px;">' +
                    '<div class="file-upload" style="margin: 0;">' +
                    '<input type="file" id="icon-' + categoryKey + '" accept="image/*" onchange="handleCategoryIconUpload(event, \'' + categoryKey + '\')" style="position: absolute; left: -9999px;">' +
                    '<label for="icon-' + categoryKey + '" style="display: flex; align-items: center; gap: 6px; padding: 8px 12px; color: var(--text-primary); font-weight: 600; font-size: 12px; cursor: pointer; border-radius: 8px; background: var(--accent-primary); color: white;">' +
                    '<span>📁</span><span>Upload</span>' +
                    '</label>' +
                    '</div>' +
                    (customIcon ? '<button onclick="removeCategoryIcon(\'' + categoryKey + '\')" style="padding: 8px 12px; border-radius: 8px; border: none; background: var(--error); color: white; font-size: 12px; cursor: pointer;">🗑️</button>' : '') +
                    '</div>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function handleCategoryIconUpload(event, categoryKey) {
            var file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 1024 * 1024) {
                showSuccessMessage('⚠️ File too large! Please choose an image under 1MB');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('⚠️ Please select a valid image file');
                return;
            }
            
            var reader = new FileReader();
            reader.onload = function(e) {
                customIcons[categoryKey] = e.target.result;
                localStorage.setItem(STORAGE_KEYS.CUSTOM_ICONS, JSON.stringify(customIcons));
                updateCategoryIconsDisplay();
                renderCategoryIconList();
                showSuccessMessage('✅ ' + categories[categoryKey].name + ' icon uploaded!');
            };
            reader.readAsDataURL(file);
        }

        function removeCategoryIcon(categoryKey) {
            if (confirm('Remove custom icon for ' + categories[categoryKey].name + '?')) {
                delete customIcons[categoryKey];
                localStorage.setItem(STORAGE_KEYS.CUSTOM_ICONS, JSON.stringify(customIcons));
                updateCategoryIconsDisplay();
                renderCategoryIconList();
                showSuccessMessage('🗑️ ' + categories[categoryKey].name + ' icon removed');
            }
        }

        function resetAllIcons() {
            if (confirm('Reset all category icons to default?\nThis will remove all custom uploaded icons.')) {
                customIcons = {};
                localStorage.removeItem(STORAGE_KEYS.CUSTOM_ICONS);
                updateCategoryIconsDisplay();
                renderCategoryIconList();
                showSuccessMessage('🔄 All category icons reset to default');
            }
        }

        function updateCategoryIconsDisplay() {
            // Update all category icon displays throughout the app
            for (var categoryKey in categories) {
                var category = categories[categoryKey];
                var customIcon = customIcons[categoryKey];
                var iconContent = customIcon ? '<img src="' + customIcon + '" class="custom-icon" alt="' + category.name + '">' : category.icon;
                
                // Update in filters
                var filterIcon = document.getElementById('icon-' + categoryKey);
                if (filterIcon) {
                    filterIcon.innerHTML = iconContent;
                }
                
                var presetFilterIcon = document.getElementById('preset-icon-' + categoryKey);
                if (presetFilterIcon) {
                    presetFilterIcon.innerHTML = iconContent;
                }
            }
        }

        function loadCustomIcons() {
            var savedIcons = localStorage.getItem(STORAGE_KEYS.CUSTOM_ICONS);
            if (savedIcons) {
                customIcons = JSON.parse(savedIcons);
                updateCategoryIconsDisplay();
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadThemePreference();
            loadDataFromStorage();
            loadCustomIcons();
            loadUserInfo();
            setupEventListeners();
            setupMobileOptimizations();
            updateStatusBar();
            updateCurrentDate();
            updateStats();
            renderViews();
            loadSelectedLogo();
            updateCategoryFilters();
            
            // Apply custom logo if exists
            if (customLogo) {
                applyCustomLogo();
            }
            
            showSuccessMessage('📋 REFIT ENHANCED - Complete Category & Icon System Ready!');
            console.log('🔧 REFIT MAINTENANCE SERVICES - Enhanced Management System');
            console.log('🎨 Custom Icon Upload & User Info Management');
            console.log('📊 Expanded Category System with 24 Categories');
            console.log('👁️ Eye-Friendly Design for Extended Use');
        }

        // Category Management Functions
        function getCategoryIcon(category) {
            var customIcon = customIcons[category];
            if (customIcon) {
                return '<img src="' + customIcon + '" class="custom-icon" alt="' + categories[category].name + '">';
            }
            return categories[category] ? categories[category].icon : '🏷️';
        }

        function getCategoryName(category) {
            return categories[category] ? categories[category].name : 'Unknown';
        }

        function getCategoryColor(category) {
            return categories[category] ? categories[category].color : 'var(--cat-common)';
        }

        function filterQuotesByCategory(category) {
            currentQuoteFilter = category;
            
            // Update filter buttons
            var filters = document.querySelectorAll('#quotes-view .category-filter[data-category]');
            for (var i = 0; i < filters.length; i++) {
                filters[i].classList.remove('active');
            }
            
            var activeFilter = document.querySelector('#quotes-view .category-filter[data-category="' + category + '"]');
            if (activeFilter) {
                activeFilter.classList.add('active');
            }
            
            renderQuotes();
            showSuccessMessage('📋 Filtered by ' + (category === 'all' ? 'All Categories' : getCategoryName(category)));
        }

        function filterPresetsByCategory(category) {
            currentPresetFilter = category;
            
            // Update filter buttons
            var filters = document.querySelectorAll('#presets-view .category-filter[data-category]');
            for (var i = 0; i < filters.length; i++) {
                filters[i].classList.remove('active');
            }
            
            var activeFilter = document.querySelector('#presets-view .category-filter[data-category="' + category + '"]');
            if (activeFilter) {
                activeFilter.classList.add('active');
            }
            
            renderPresets();
            showSuccessMessage('📋 Filtered by ' + (category === 'all' ? 'All Categories' : getCategoryName(category)));
        }

        function filterPresetItemsInModal() {
            var selectedCategory = document.getElementById('preset-category-selector').value;
            renderPresetItems(selectedCategory);
        }

        function updateCategoryFilters() {
            updateQuoteCategoryFilters();
            updatePresetCategoryFilters();
        }

        function updateQuoteCategoryFilters() {
            var categoryCounts = { all: jobQuotes.length };
            
            // Initialize category counts
            for (var catKey in categories) {
                categoryCounts[catKey] = 0;
            }
            
            // Count quotes by category
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                var quoteCategories = {};
                
                for (var j = 0; j < quote.items.length; j++) {
                    var item = quote.items[j];
                    var itemCategory = item.category || 'common';
                    quoteCategories[itemCategory] = true;
                }
                
                for (var cat in quoteCategories) {
                    if (categoryCounts[cat] !== undefined) {
                        categoryCounts[cat]++;
                    }
                }
            }
            
            // Update filter counts
            for (var catKey in categoryCounts) {
                var countElement = document.getElementById('filter-count-' + catKey);
                if (countElement) {
                    countElement.textContent = categoryCounts[catKey];
                }
            }
        }

        function updatePresetCategoryFilters() {
            var categoryCounts = { all: presetWorkItems.length };
            
            // Initialize category counts
            for (var catKey in categories) {
                categoryCounts[catKey] = 0;
            }
            
            // Count presets by category
            for (var i = 0; i < presetWorkItems.length; i++) {
                var preset = presetWorkItems[i];
                var category = preset.category || 'common';
                if (categoryCounts[category] !== undefined) {
                    categoryCounts[category]++;
                }
            }
            
            // Update filter counts
            for (var catKey in categoryCounts) {
                var countElement = document.getElementById('preset-filter-count-' + catKey);
                if (countElement) {
                    countElement.textContent = categoryCounts[catKey];
                }
            }
        }

        // Data Management Functions
        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.JOB_QUOTES, JSON.stringify(jobQuotes));
                localStorage.setItem(STORAGE_KEYS.PRESET_WORK_ITEMS, JSON.stringify(presetWorkItems));
                localStorage.setItem(STORAGE_KEYS.SELECTED_LOGO, selectedLogoIndex.toString());
                localStorage.setItem(STORAGE_KEYS.THEME_PREFERENCE, JSON.stringify(currentTheme));
                localStorage.setItem(STORAGE_KEYS.CUSTOM_ICONS, JSON.stringify(customIcons));
                localStorage.setItem(STORAGE_KEYS.USER_INFO, JSON.stringify(userInfo));
                if (customLogo) {
                    localStorage.setItem(STORAGE_KEYS.CUSTOM_LOGO, customLogo);
                }
            } catch (e) {
                console.warn('Storage error:', e);
                showSuccessMessage('⚠️ Storage full! Please export data.');
            }
        }

        function loadDataFromStorage() {
            try {
                var savedQuotes = localStorage.getItem(STORAGE_KEYS.JOB_QUOTES);
                if (savedQuotes) {
                    jobQuotes = JSON.parse(savedQuotes);
                }

                var savedPresets = localStorage.getItem(STORAGE_KEYS.PRESET_WORK_ITEMS);
                if (savedPresets) {
                    presetWorkItems = JSON.parse(savedPresets);
                } else {
                    presetWorkItems = [...defaultPresetWorkItems];
                    saveDataToStorage();
                }

                var savedLogo = localStorage.getItem(STORAGE_KEYS.SELECTED_LOGO);
                if (savedLogo !== null) {
                    selectedLogoIndex = parseInt(savedLogo);
                }

                var savedCustomLogo = localStorage.getItem(STORAGE_KEYS.CUSTOM_LOGO);
                if (savedCustomLogo) {
                    customLogo = savedCustomLogo;
                }

                var savedUserInfo = localStorage.getItem(STORAGE_KEYS.USER_INFO);
                if (savedUserInfo) {
                    userInfo = JSON.parse(savedUserInfo);
                    // Update company settings from user info
                    if (userInfo.companyName) companySettings.name = userInfo.companyName;
                    if (userInfo.registration) companySettings.registration = userInfo.registration;
                    if (userInfo.phone) companySettings.phone = userInfo.phone;
                    if (userInfo.email) companySettings.email = userInfo.email;
                    if (userInfo.address) companySettings.address = userInfo.address;
                    if (userInfo.website) companySettings.website = userInfo.website;
                }

            } catch (e) {
                console.warn('Load error:', e);
                presetWorkItems = [...defaultPresetWorkItems];
                selectedLogoIndex = 0;
            }
        }

        // Simple Job Form Functions - Simplified 2-Step Process
        function openSimpleJobForm() {
            currentQuoteItems = [];
            editingJob = null;
            document.getElementById('simple-job-modal-title').textContent = '💰 Create Job Quote';
            document.getElementById('simple-job-title').value = '';
            
            // Reset to Step 1
            showStep1();
            
            document.getElementById('simple-job-modal').classList.add('show');
            showSuccessMessage('💰 Simple 2-step quote creation opened!');
        }

        function closeSimpleJobForm() {
            document.getElementById('simple-job-modal').classList.remove('show');
            currentQuoteItems = [];
            showStep1(); // Reset to step 1 for next time
        }

        function showStep1() {
            // Show Step 1, Hide Step 2
            document.getElementById('step-1-content').style.display = 'block';
            document.getElementById('step-2-content').style.display = 'none';
            
            // Update step indicators
            document.getElementById('step-1-indicator').style.background = 'var(--accent-primary)';
            document.getElementById('step-1-indicator').style.color = 'white';
            document.getElementById('step-2-indicator').style.background = 'var(--border-color)';
            document.getElementById('step-2-indicator').style.color = 'var(--text-muted)';
        }

        function showStep2() {
            // Hide Step 1, Show Step 2
            document.getElementById('step-1-content').style.display = 'none';
            document.getElementById('step-2-content').style.display = 'block';
            
            // Update step indicators
            document.getElementById('step-1-indicator').style.background = 'var(--success)';
            document.getElementById('step-2-indicator').style.background = 'var(--accent-primary)';
            document.getElementById('step-2-indicator').style.color = 'white';
            
            // Load preset items
            document.getElementById('preset-category-selector').value = 'all';
            renderPresetItems('all');
            updateSelectedItemsSummary();
        }

        function proceedToStep2() {
            var jobTitle = document.getElementById('simple-job-title').value.trim();
            
            if (!jobTitle) {
                showSuccessMessage('⚠️ Please enter a job title first!');
                return;
            }
            
            showStep2();
            showSuccessMessage('✅ Step 1 complete! Now select items for: ' + jobTitle);
        }

        function backToStep1() {
            showStep1();
            showSuccessMessage('⬅️ Back to Step 1: Edit job title');
        }

        function renderPresetItems(filterCategory) {
            filterCategory = filterCategory || 'all';
            var container = document.getElementById('preset-items-list');
            if (!container) return;
            
            var filteredItems = presetWorkItems.filter(function(item) {
                return filterCategory === 'all' || item.category === filterCategory;
            });
            
            if (filteredItems.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 48px; margin-bottom: 16px;">📋</div>' +
                    '<h4 style="font-weight: 700; margin-bottom: 8px;">No items in this category</h4>' +
                    '<p style="font-size: 14px;">Try selecting a different category</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            
            // Group items by category if showing all
            if (filterCategory === 'all') {
                var groupedItems = {};
                for (var i = 0; i < filteredItems.length; i++) {
                    var item = filteredItems[i];
                    var category = item.category || 'common';
                    if (!groupedItems[category]) {
                        groupedItems[category] = [];
                    }
                    groupedItems[category].push(item);
                }
                
                // Show popular categories first
                var popularCategories = ['preliminary', 'electrical', 'plumbing', 'paint', 'cleaning'];
                var remainingCategories = [];
                
                for (var category in groupedItems) {
                    if (popularCategories.indexOf(category) === -1) {
                        remainingCategories.push(category);
                    }
                }
                
                var orderedCategories = popularCategories.concat(remainingCategories);
                
                for (var c = 0; c < orderedCategories.length; c++) {
                    var category = orderedCategories[c];
                    var categoryItems = groupedItems[category];
                    if (!categoryItems || categoryItems.length === 0) continue;
                    
                    html += '<div style="margin-bottom: 24px;">' +
                        '<div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding: 12px 16px; background: var(--bg-secondary); border-radius: 12px; border-left: 4px solid ' + getCategoryColor(category) + ';">' +
                        '<div style="font-size: 24px;">' + getCategoryIcon(category) + '</div>' +
                        '<div>' +
                        '<div style="font-weight: 700; color: var(--text-primary); font-size: 16px;">' + getCategoryName(category) + '</div>' +
                        '<div style="font-size: 12px; color: var(--text-muted);">' + categoryItems.length + ' items available</div>' +
                        '</div>' +
                        '</div>';
                    
                    for (var j = 0; j < categoryItems.length && j < 5; j++) { // Show max 5 items per category
                        html += renderSimplePresetCard(categoryItems[j]);
                    }
                    
                    if (categoryItems.length > 5) {
                        html += '<div style="text-align: center; margin: 12px 0;">' +
                            '<button onclick="document.getElementById(\'preset-category-selector\').value=\'' + category + '\'; filterPresetItemsInModal();" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 12px;">View all ' + categoryItems.length + ' items</button>' +
                            '</div>';
                    }
                    
                    html += '</div>';
                }
            } else {
                // Show all items in selected category
                for (var i = 0; i < filteredItems.length; i++) {
                    html += renderSimplePresetCard(filteredItems[i]);
                }
            }
            
            container.innerHTML = html;
        }

        function renderSimplePresetCard(item) {
            var isSelected = currentQuoteItems.some(function(quoteItem) {
                return quoteItem.presetId === item.id;
            });
            
            return '<div style="background: ' + (isSelected ? 'var(--accent-primary)' : 'var(--bg-card)') + '; border-radius: 12px; padding: 16px; margin-bottom: 8px; border: 2px solid ' + (isSelected ? 'var(--accent-primary)' : 'var(--border-color)') + '; cursor: pointer; transition: all 0.2s ease;" onclick="togglePresetItem(\'' + item.id + '\')">' +
                '<div style="display: flex; justify-content: space-between; align-items: center;">' +
                '<div style="flex: 1;">' +
                '<div style="font-weight: 700; margin-bottom: 4px; color: ' + (isSelected ? 'white' : 'var(--text-primary)') + '; font-size: 15px; display: flex; align-items: center; gap: 8px;">' +
                '<span style="font-size: 18px;">' + getCategoryIcon(item.category) + '</span>' +
                item.name + '</div>' +
                '<div style="font-size: 13px; color: ' + (isSelected ? 'rgba(255,255,255,0.8)' : 'var(--text-muted)') + '; margin-bottom: 4px;">' + item.description + '</div>' +
                '<div style="font-size: 12px; color: ' + (isSelected ? 'rgba(255,255,255,0.7)' : 'var(--text-muted)') + ';">Unit: ' + item.unit + ' • Category: ' + getCategoryName(item.category) + '</div>' +
                '</div>' +
                '<div style="display: flex; align-items: center; gap: 12px;">' +
                '<div style="text-align: right;">' +
                '<div style="font-weight: 700; color: ' + (isSelected ? 'white' : 'var(--accent-primary)') + '; font-size: 16px;">RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                '<div style="font-size: 10px; color: ' + (isSelected ? 'rgba(255,255,255,0.7)' : 'var(--text-muted)') + ';">per ' + item.unit + '</div>' +
                '</div>' +
                '<div style="width: 32px; height: 32px; border-radius: 50%; background: ' + (isSelected ? 'rgba(255,255,255,0.2)' : 'var(--accent-primary)') + '; color: ' + (isSelected ? 'white' : 'white') + '; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 700;">' +
                (isSelected ? '✓' : '+') +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>';
        }

        function togglePresetItem(itemId) {
            var item = presetWorkItems.find(function(item) { return item.id === itemId; });
            if (!item) return;
            
            // Check if item is already selected
            var existingIndex = currentQuoteItems.findIndex(function(quoteItem) {
                return quoteItem.presetId === itemId;
            });
            
            if (existingIndex !== -1) {
                // Remove item
                currentQuoteItems.splice(existingIndex, 1);
                showSuccessMessage('➖ Removed: ' + item.name);
            } else {
                // Add item
                var quoteItem = {
                    id: Date.now() + Math.random(),
                    description: item.name,
                    quantity: 1,
                    price: item.price,
                    unit: item.unit,
                    category: item.category,
                    total: item.price,
                    isPreset: true,
                    presetId: item.id
                };
                
                currentQuoteItems.push(quoteItem);
                showSuccessMessage('✅ Added: ' + item.name);
            }
            
            // Refresh the display
            renderPresetItems(document.getElementById('preset-category-selector').value);
            updateSelectedItemsSummary();
        }

        function updateSelectedItemsSummary() {
            var summaryContainer = document.getElementById('quote-items-summary');
            var countElement = document.getElementById('selected-items-count');
            var listElement = document.getElementById('selected-items-list');
            var totalElement = document.getElementById('total-quote-amount');
            var saveButton = document.getElementById('save-quote-btn');
            
            if (currentQuoteItems.length === 0) {
                summaryContainer.style.display = 'none';
                saveButton.disabled = true;
                saveButton.style.opacity = '0.5';
                return;
            }
            
            summaryContainer.style.display = 'block';
            saveButton.disabled = false;
            saveButton.style.opacity = '1';
            
            countElement.textContent = currentQuoteItems.length;
            
            var totalAmount = 0;
            var html = '';
            
            // Group by category
            var groupedItems = {};
            for (var i = 0; i < currentQuoteItems.length; i++) {
                var item = currentQuoteItems[i];
                var category = item.category || 'common';
                totalAmount += item.total;
                
                if (!groupedItems[category]) {
                    groupedItems[category] = [];
                }
                groupedItems[category].push(item);
            }
            
            for (var category in groupedItems) {
                var categoryItems = groupedItems[category];
                var categoryTotal = 0;
                
                for (var j = 0; j < categoryItems.length; j++) {
                    categoryTotal += categoryItems[j].total;
                }
                
                html += '<div style="background: var(--bg-card); border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 4px solid ' + getCategoryColor(category) + ';">' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">' +
                    '<div style="display: flex; align-items: center; gap: 8px; font-weight: 700; color: var(--text-primary);">' +
                    '<span style="font-size: 16px;">' + getCategoryIcon(category) + '</span>' +
                    '<span style="font-size: 14px;">' + getCategoryName(category) + '</span>' +
                    '</div>' +
                    '<span style="font-weight: 700; color: var(--accent-primary); font-size: 14px;">RM ' + categoryTotal.toFixed(2) + '</span>' +
                    '</div>';
                
                for (var j = 0; j < categoryItems.length; j++) {
                    var item = categoryItems[j];
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 4px 0; font-size: 12px; color: var(--text-secondary);">' +
                        '<span>' + item.description + ' (1 ' + item.unit + ')</span>' +
                        '<span style="font-weight: 600;">RM ' + item.total.toFixed(2) + '</span>' +
                        '</div>';
                }
                
                html += '</div>';
            }
            
            listElement.innerHTML = html;
            totalElement.textContent = 'RM ' + totalAmount.toFixed(2);
        }

        function filterPresetItemsInModal() {
            var selectedCategory = document.getElementById('preset-category-selector').value;
            renderPresetItems(selectedCategory);
        }

        // Continue with remaining functions...
        // Export, rendering, utility functions, etc.

        // Legacy logo functions (keeping for compatibility)
        var logoTemplates = [
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                <circle cx="50" cy="50" r="3" fill="currentColor"/>
            </svg>`
        ];

        function loadSelectedLogo() {
            if (customLogo) {
                applyCustomLogo();
            }
        }

        // Continue with the remaining comprehensive functions...
        // I'll continue implementing the rest of the system in a compact way
        // Export Data Function
        function exportData() {
            var allData = {
                companySettings: companySettings,
                userInfo: userInfo,
                jobQuotes: jobQuotes,
                presetWorkItems: presetWorkItems,
                selectedLogo: selectedLogoIndex,
                customLogo: customLogo,
                customIcons: customIcons,
                themePreference: currentTheme,
                categories: categories,
                exportDate: new Date().toISOString(),
                version: '5.0'
            };
            
            var dataStr = JSON.stringify(allData, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            var link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'REFIT_Enhanced_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showSuccessMessage('📤 Enhanced data exported successfully!');
        }

        // Utility and core functions
        function showView(viewName) {
            currentView = viewName;
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) {
                views[i].classList.add('hidden');
            }
            var targetView = document.getElementById(viewName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            var navItems = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navItems.length; i++) {
                navItems[i].classList.remove('active');
            }
            var activeNav = document.querySelector('.nav-item[onclick*="' + viewName + '"]');
            if (activeNav) {
                activeNav.classList.add('active');
            }
            renderViews();
        }

        function showSuccessMessage(message) {
            var messageElement = document.getElementById('success-message');
            if (!messageElement) return;
            messageElement.textContent = message;
            messageElement.classList.add('show');
            setTimeout(function() {
                messageElement.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            var totalQuotes = jobQuotes.length;
            var totalItems = 0;
            var totalRevenue = 0;
            var todayRevenue = 0;
            var today = new Date().toISOString().split('T')[0];
            
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                totalItems += quote.items.length;
                totalRevenue += quote.totalAmount;
                if (quote.createdAt.split('T')[0] === today) {
                    todayRevenue += quote.totalAmount;
                }
            }
            
            var averageQuote = totalQuotes > 0 ? totalRevenue / totalQuotes : 0;
            var activeCategories = {};
            for (var i = 0; i < jobQuotes.length; i++) {
                for (var j = 0; j < jobQuotes[i].items.length; j++) {
                    activeCategories[jobQuotes[i].items[j].category || 'common'] = true;
                }
            }
            
            updateElementText('total-quotes-count', totalQuotes);
            updateElementText('total-items-count', totalItems);
            updateElementText('today-revenue', 'RM ' + Math.round(todayRevenue));
            updateElementText('total-revenue', 'RM ' + Math.round(totalRevenue));
            updateElementText('average-quote', 'RM ' + Math.round(averageQuote));
            updateElementText('total-categories', Object.keys(activeCategories).length);
            updateElementText('daily-revenue', 'RM ' + todayRevenue.toFixed(2));
        }

        function updateElementText(elementId, text) {
            var element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }

        function renderViews() {
            switch(currentView) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'quotes':
                    renderQuotes();
                    updateQuoteCategoryFilters();
                    break;
                case 'presets':
                    renderPresets();
                    updatePresetCategoryFilters();
                    break;
            }
        }

        function renderDashboard() {
            var recentQuotes = jobQuotes.slice(-3).reverse();
            var container = document.getElementById('recent-quotes');
            if (!container) return;
            
            if (recentQuotes.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 30px 20px; color: var(--text-muted);"><div style="font-size: 32px; margin-bottom: 8px;">💰</div><p style="font-weight: 600;">No job quotes yet</p><p style="font-size: 12px; margin-top: 4px;">Create your first job quote</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < recentQuotes.length; i++) {
                var quote = recentQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;" onclick="viewQuote(' + quote.id + ')">' +
                    '<div style="font-weight: 700; font-size: 15px; color: var(--text-primary); margin-bottom: 8px;">' + quote.title + '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">📋 ' + quote.items.length + ' items • 📅 ' + formatDate(quote.createdAt) + '</div>' +
                    '<div style="margin-bottom: 8px;">' + renderCategoryBadges(quoteCategories) + '</div>' +
                    '<div style="display: flex; justify-content: space-between; align-items: center;"><span style="color: var(--text-muted); font-size: 12px;">Quote #' + quote.id + '</span><span style="font-weight: 700; color: var(--accent-primary); font-size: 16px;">RM ' + quote.totalAmount.toFixed(2) + '</span></div>' +
                    '</div>';
            }
            container.innerHTML = html;
        }

        function getQuoteCategories(quote) {
            var categories = {};
            for (var i = 0; i < quote.items.length; i++) {
                var item = quote.items[i];
                var category = item.category || 'common';
                categories[category] = true;
            }
            return Object.keys(categories);
        }

        function renderCategoryBadges(categoryList) {
            var html = '';
            for (var i = 0; i < categoryList.length && i < 3; i++) {
                var category = categoryList[i];
                html += '<span class="category-badge category-' + category + '">' + getCategoryIcon(category) + ' ' + getCategoryName(category) + '</span>';
            }
            if (categoryList.length > 3) {
                html += '<span class="category-badge" style="background: var(--text-muted);">+' + (categoryList.length - 3) + ' more</span>';
            }
            return html;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            var date = new Date(dateString);
            return date.toLocaleDateString('en-MY', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function renderQuotes() {
            var container = document.getElementById('quotes-list');
            if (!container) return;
            
            var filteredQuotes = jobQuotes.filter(function(quote) {
                var matchesCategory = currentQuoteFilter === 'all' || quoteHasCategory(quote, currentQuoteFilter);
                return matchesCategory;
            });
            
            if (filteredQuotes.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">💰</div><p style="font-weight: 600;">No job quotes found</p><p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create your first job quote or try different filters</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < filteredQuotes.length; i++) {
                var quote = filteredQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                html += '<div class="item-card"><div class="item-header"><div class="item-info"><h3>' + quote.title + '</h3><div style="font-size: 14px; color: var(--text-secondary); margin: 8px 0;">📋 ' + quote.items.length + ' items • 📅 ' + formatDate(quote.createdAt) + '</div><div style="margin: 8px 0;">' + renderCategoryBadges(quoteCategories) + '</div></div></div><div class="item-actions"><button class="icon-btn quote-btn" onclick="viewQuote(' + quote.id + ')" title="View Quote">👁️</button><button class="icon-btn edit-btn" onclick="editQuote(' + quote.id + ')" title="Edit Quote">✏️</button><button class="icon-btn delete-btn" onclick="deleteQuote(' + quote.id + ')" title="Delete Quote">🗑️</button></div><div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;"><span style="font-size: 12px; color: var(--text-muted);">Items: ' + quote.items.length + '</span><span style="font-size: 18px; color: var(--accent-primary); font-weight: 700;">RM ' + quote.totalAmount.toFixed(2) + '</span></div></div>';
            }
            container.innerHTML = html;
        }

        function quoteHasCategory(quote, category) {
            for (var i = 0; i < quote.items.length; i++) {
                var item = quote.items[i];
                if ((item.category || 'common') === category) {
                    return true;
                }
            }
            return false;
        }

        function renderPresets() {
            var container = document.getElementById('presets-list');
            if (!container) return;
            
            var filteredPresets = presetWorkItems.filter(function(preset) {
                var matchesCategory = currentPresetFilter === 'all' || preset.category === currentPresetFilter;
                return matchesCategory;
            });
            
            if (filteredPresets.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">📋</div><p style="font-weight: 600;">No preset items found</p><p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create preset items or try different filters</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < filteredPresets.length; i++) {
                var preset = filteredPresets[i];
                html += '<div class="item-card"><div class="item-header"><div class="item-info"><h3><span style="margin-right: 8px;">' + getCategoryIcon(preset.category) + '</span>' + preset.name + '</h3><div style="font-size: 14px; color: var(--text-secondary); margin: 8px 0;">' + preset.description + '</div><div style="font-size: 12px; color: var(--text-muted);">📏 ' + preset.unit + ' • ' + getCategoryName(preset.category) + '</div></div></div><div class="item-actions"><button class="icon-btn edit-btn" onclick="editPresetItem(\'' + preset.id + '\')" title="Edit Preset">✏️</button><button class="icon-btn delete-btn" onclick="deletePresetItem(\'' + preset.id + '\')" title="Delete Preset">🗑️</button></div><div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;"><span style="font-size: 12px; color: var(--text-muted);">Category: ' + getCategoryName(preset.category) + '</span><span style="font-size: 18px; color: var(--accent-primary); font-weight: 700;">RM ' + parseFloat(preset.price).toFixed(2) + '</span></div></div>';
            }
            container.innerHTML = html;
        }

        // Setup and initialization functions
        function setupEventListeners() {
            // Step 1 job title enter key support
            var jobTitleInput = document.getElementById('simple-job-title');
            if (jobTitleInput) {
                jobTitleInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        proceedToStep2();
                    }
                });
            }
            
            var presetItemForm = document.getElementById('preset-item-form');
            if (presetItemForm) {
                presetItemForm.addEventListener('submit', handlePresetItemSubmit);
            }
        }

        function setupMobileOptimizations() {
            setInterval(updateStatusBar, 60000);
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        function updateStatusBar() {
            var now = new Date();
            var timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
            var timeElement = document.getElementById('status-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        function updateCurrentDate() {
            var today = new Date();
            var dateString = today.toLocaleDateString('en-MY', { weekday: 'long', month: 'long', day: 'numeric' });
            var dateElement = document.getElementById('current-date');
            if (dateElement) {
                dateElement.textContent = dateString;
            }
        }

        // Preset Management Functions
        function openPresetManager() {
            showView('presets');
        }

        function openPresetItemForm() {
            editingPreset = null;
            document.getElementById('preset-item-modal-title').textContent = '➕ Add Preset Item';
            document.getElementById('preset-item-form').reset();
            document.getElementById('preset-item-modal').classList.add('show');
        }

        function closePresetItemForm() {
            document.getElementById('preset-item-modal').classList.remove('show');
            editingPreset = null;
        }

        function handlePresetItemSubmit(e) {
            e.preventDefault();
            var name = document.getElementById('preset-item-name').value.trim();
            var price = parseFloat(document.getElementById('preset-item-price').value);
            
            if (!name || !price) {
                showSuccessMessage('⚠️ Please fill in all required fields!');
                return;
            }

            var itemData = {
                id: editingPreset ? editingPreset.id : (name.toLowerCase().replace(/[^a-z0-9]/g, '-') + '-' + Date.now()),
                name: name,
                description: document.getElementById('preset-item-description').value.trim(),
                price: price,
                unit: document.getElementById('preset-item-unit').value,
                category: document.getElementById('preset-item-category').value,
                createdAt: editingPreset ? editingPreset.createdAt : new Date().toISOString()
            };

            if (editingPreset) {
                var index = presetWorkItems.findIndex(function(item) { return item.id === editingPreset.id; });
                if (index !== -1) {
                    presetWorkItems[index] = itemData;
                }
                showSuccessMessage('✏️ Preset item updated successfully');
            } else {
                presetWorkItems.push(itemData);
                showSuccessMessage('✅ Preset item added successfully');
            }

            closePresetItemForm();
            saveDataToStorage();
            updateStats();
            renderViews();
            updateCategoryFilters();
            renderPresetItems(document.getElementById('preset-category-selector').value);
        }

        function editPresetItem(id) {
            var item = presetWorkItems.find(function(item) { return item.id === id; });
            if (!item) return;

            editingPreset = item;
            document.getElementById('preset-item-modal-title').textContent = '✏️ Edit Preset Item';
            document.getElementById('preset-item-name').value = item.name;
            document.getElementById('preset-item-description').value = item.description || '';
            document.getElementById('preset-item-price').value = item.price;
            document.getElementById('preset-item-unit').value = item.unit;
            document.getElementById('preset-item-category').value = item.category;
            document.getElementById('preset-item-modal').classList.add('show');
        }

        function deletePresetItem(id) {
            var item = presetWorkItems.find(function(item) { return item.id === id; });
            if (!item) return;

            if (confirm('Delete preset item: "' + item.name + '"?\nThis action cannot be undone.')) {
                presetWorkItems = presetWorkItems.filter(function(item) { return item.id !== id; });
                saveDataToStorage();
                updateStats();
                renderViews();
                updateCategoryFilters();
                renderPresetItems(document.getElementById('preset-category-selector').value);
                showSuccessMessage('🗑️ Preset item deleted successfully');
            }
        }

        // Quote view and management
        function viewQuote(quoteId) {
            showSuccessMessage('💰 Quote viewer coming soon!');
        }

        function closeQuoteView() {
            document.getElementById('quote-view-modal').classList.remove('show');
        }

        function editQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            editingJob = quote;
            currentQuoteItems = [...quote.items];
            
            document.getElementById('simple-job-modal-title').textContent = '✏️ Edit Job Quote';
            document.getElementById('simple-job-title').value = quote.title;
            
            // Go directly to step 2 for editing
            showStep2();
            document.getElementById('simple-job-modal').classList.add('show');
            showSuccessMessage('✏️ Editing: ' + quote.title);
        }

        function deleteQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;

            if (confirm('Delete job quote: "' + quote.title + '"?\nThis action cannot be undone.')) {
                jobQuotes = jobQuotes.filter(function(q) { return q.id !== quoteId; });
                saveDataToStorage();
                updateStats();
                renderViews();
                updateCategoryFilters();
                showSuccessMessage('🗑️ Job quote deleted successfully');
            }
        }

        console.log('🎯 REFIT ENHANCED - Complete Management System Ready');
        console.log('🎨 Custom Icon Upload System');
        console.log('👤 User Info & Logo Management');
        console.log('🏗️ 24 Professional Categories');
        console.log('📱 Touch-Friendly Mobile Experience');
    </script>
</body>
</html>
