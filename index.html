<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal AI Voice Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 2rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease-in-out infinite;
            flex: 1;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .settings-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .main-chat {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        .assistant-status {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--color1), var(--color2));
        }

        .assistant-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }

        .assistant-info p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .voice-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn.mic {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .voice-btn.mic.listening {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            animation: pulse 1.5s infinite;
        }

        .voice-btn.speak {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 400px;
        }

        .message {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 85%;
            word-wrap: break-word;
            animation: messageSlide 0.3s ease-out;
            line-height: 1.5;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            background: linear-gradient(135deg, var(--color1), var(--color2));
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .thinking-indicator {
            display: none;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin: 10px 0;
            max-width: 200px;
            align-items: center;
            gap: 10px;
        }

        .thinking-dots {
            display: flex;
            gap: 4px;
        }

        .thinking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            animation: thinkingBounce 1.4s infinite ease-in-out;
        }

        .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes thinkingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .input-section {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .text-input {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            outline: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .text-input:focus {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .text-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .send-btn {
            padding: 18px 25px;
            background: linear-gradient(135deg, var(--color1), var(--color2));
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: translateY(-2px);
        }

        /* Settings Modal */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .settings-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            margin-bottom: 15px;
            color: #4ecdc4;
        }

        .personality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .personality-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .personality-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .personality-card.active {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.2);
        }

        .personality-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--avatar-color1), var(--avatar-color2));
        }

        .api-setup {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .api-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn.primary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        /* Personality-specific colors */
        .emma { --color1: #ff6b9d; --color2: #c44569; --avatar-color1: #ff6b9d; --avatar-color2: #c44569; }
        .alex { --color1: #4ecdc4; --color2: #44a08d; --avatar-color1: #4ecdc4; --avatar-color2: #44a08d; }
        .sophia { --color1: #a8e6cf; --color2: #7fcdcd; --avatar-color1: #a8e6cf; --avatar-color2: #7fcdcd; }
        .marcus { --color1: #667eea; --color2: #764ba2; --avatar-color1: #667eea; --avatar-color2: #764ba2; }
        .zara { --color1: #ffeaa7; --color2: #fdcb6e; --avatar-color1: #ffeaa7; --avatar-color2: #fdcb6e; }
        .david { --color1: #81ecec; --color2: #74b9ff; --avatar-color1: #81ecec; --avatar-color2: #74b9ff; }

        /* Default to Emma */
        :root {
            --color1: #ff6b9d;
            --color2: #c44569;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-chat {
                padding: 20px;
                min-height: calc(100vh - 120px);
            }
            
            .settings-content {
                margin: 20px;
                max-height: calc(100vh - 40px);
            }
            
            .personality-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎤 Personal AI Voice Assistant</h1>
            <button class="settings-btn" onclick="openSettings()">⚙️</button>
        </div>

        <div class="main-chat">
            <div class="assistant-status">
                <div class="avatar" id="currentAvatar">🌸</div>
                <div class="assistant-info">
                    <h3 id="currentName">Emma</h3>
                    <p id="currentRole">Your friendly AI companion</p>
                </div>
                <div class="voice-controls">
                    <button class="voice-btn mic" id="micBtn" onclick="toggleVoice()" title="Voice Input">🎤</button>
                    <button class="voice-btn speak" id="speakBtn" onclick="testVoice()" title="Test Voice">🔊</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    Hi! I'm your personal AI voice assistant. I'm here to help with your daily tasks, answer questions, and have meaningful conversations. How can I assist you today?
                </div>
            </div>

            <div class="thinking-indicator" id="thinkingIndicator">
                <span>💭</span>
                <div class="thinking-dots">
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                </div>
            </div>

            <div class="input-section">
                <input type="text" class="text-input" id="textInput" placeholder="Ask me anything or use voice input..." autocomplete="off">
                <button class="send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <button class="close-btn" onclick="closeSettings()">×</button>
            
            <div class="settings-section">
                <h3>🔑 AI Configuration</h3>
                <div class="api-setup">
                    <p style="font-size: 0.9rem; margin: 10px 0;">Connect your OpenAI API key for intelligent responses:</p>
                    <input type="password" class="api-input" id="apiKey" placeholder="sk-proj-your-api-key-here">
                    <button class="btn primary" onclick="saveApiKey()">Connect AI</button>
                    <button class="btn" onclick="testConnection()">Test Connection</button>
                </div>
            </div>

            <div class="settings-section">
                <h3>🎭 AI Personality</h3>
                <p style="font-size: 0.9rem; margin-bottom: 15px; opacity: 0.8;">Choose how your AI assistant behaves and responds:</p>
                
                <div class="personality-grid">
                    <div class="personality-card emma active" onclick="selectPersonality('emma')">
                        <div class="personality-avatar">🌸</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">Emma</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Friendly & Supportive</div>
                    </div>

                    <div class="personality-card alex" onclick="selectPersonality('alex')">
                        <div class="personality-avatar">🚀</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">Alex</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Smart & Efficient</div>
                    </div>

                    <div class="personality-card sophia" onclick="selectPersonality('sophia')">
                        <div class="personality-avatar">🧘</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">Sophia</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Calm & Wise</div>
                    </div>

                    <div class="personality-card marcus" onclick="selectPersonality('marcus')">
                        <div class="personality-avatar">💼</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">Marcus</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Professional & Direct</div>
                    </div>

                    <div class="personality-card zara" onclick="selectPersonality('zara')">
                        <div class="personality-avatar">✨</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">Zara</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Creative & Energetic</div>
                    </div>

                    <div class="personality-card david" onclick="selectPersonality('david')">
                        <div class="personality-avatar">🎯</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">David</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Motivational Coach</div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>🎛️ Voice Settings</h3>
                <label style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                    <input type="checkbox" id="voiceEnabled" checked onchange="toggleVoiceInput()">
                    <span>Enable voice input</span>
                </label>
                <label style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                    <input type="checkbox" id="ttsEnabled" checked onchange="toggleTextToSpeech()">
                    <span>Enable text-to-speech responses</span>
                </label>
            </div>
        </div>
    </div>

    <script>
        class PersonalAI {
            constructor() {
                this.currentPersonality = 'emma';
                this.settings = {
                    apiKey: localStorage.getItem('pai_api_key') || '',
                    voiceEnabled: true,
                    ttsEnabled: true
                };
                
                this.personalities = {
                    emma: {
                        name: 'Emma',
                        role: 'Your friendly AI companion',
                        avatar: '🌸',
                        systemPrompt: 'You are Emma, a warm, friendly, and encouraging AI assistant. You speak with enthusiasm and positivity. Be supportive and uplifting like a caring friend.',
                        voiceSettings: { rate: 0.9, pitch: 1.1, volume: 1.0 }
                    },
                    alex: {
                        name: 'Alex',
                        role: 'Your smart assistant',
                        avatar: '🚀',
                        systemPrompt: 'You are Alex, an intelligent and efficient AI assistant. You excel at problem-solving and providing practical solutions. Communicate clearly and directly.',
                        voiceSettings: { rate: 1.0, pitch: 1.0, volume: 1.0 }
                    },
                    sophia: {
                        name: 'Sophia',
                        role: 'Your mindful guide',
                        avatar: '🧘',
                        systemPrompt: 'You are Sophia, a calm and wise AI guide. You speak thoughtfully and offer peaceful perspectives. Promote mindfulness and inner peace.',
                        voiceSettings: { rate: 0.8, pitch: 0.9, volume: 1.0 }
                    },
                    marcus: {
                        name: 'Marcus',
                        role: 'Your professional advisor',
                        avatar: '💼',
                        systemPrompt: 'You are Marcus, a professional and results-focused AI advisor. Provide direct, actionable advice. Be professional but approachable.',
                        voiceSettings: { rate: 1.1, pitch: 0.9, volume: 1.0 }
                    },
                    zara: {
                        name: 'Zara',
                        role: 'Your creative spark',
                        avatar: '✨',
                        systemPrompt: 'You are Zara, a creative and energetic AI companion. Bring fresh ideas and artistic inspiration. Be enthusiastic and imaginative.',
                        voiceSettings: { rate: 1.1, pitch: 1.2, volume: 1.0 }
                    },
                    david: {
                        name: 'David',
                        role: 'Your motivational coach',
                        avatar: '🎯',
                        systemPrompt: 'You are David, a motivational life coach AI. Help users achieve goals and overcome challenges. Be encouraging yet honest.',
                        voiceSettings: { rate: 1.0, pitch: 0.95, volume: 1.0 }
                    }
                };
                
                this.conversationHistory = [];
                this.isListening = false;
                this.isSpeaking = false;
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                
                this.initializeVoiceRecognition();
                this.selectPersonality('emma');
                
                console.log('🎤 Personal AI Voice Assistant initialized');
            }
            
            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';
                    
                    this.recognition.onstart = () => {
                        this.isListening = true;
                        document.getElementById('micBtn').classList.add('listening');
                    };
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processMessage(transcript);
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.stopListening();
                    };
                    
                    this.recognition.onend = () => {
                        this.stopListening();
                    };
                }
            }
            
            selectPersonality(personalityId) {
                document.querySelectorAll('.personality-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                document.querySelector(`.personality-card.${personalityId}`).classList.add('active');
                
                this.currentPersonality = personalityId;
                const personality = this.personalities[personalityId];
                
                document.getElementById('currentAvatar').textContent = personality.avatar;
                document.getElementById('currentName').textContent = personality.name;
                document.getElementById('currentRole').textContent = personality.role;
                
                document.documentElement.className = personalityId;
                
                const introMessages = {
                    emma: "Hi! I'm Emma, your friendly AI companion. I'm here to help and support you. How are you doing today?",
                    alex: "Hello! I'm Alex, your smart assistant. I'm ready to help you solve problems and get things done efficiently.",
                    sophia: "Greetings. I'm Sophia, here to provide calm guidance and peaceful perspectives. How can I support you?",
                    marcus: "Good day. I'm Marcus, your professional advisor. Let's focus on achieving your goals. What can I help with?",
                    zara: "Hey there! I'm Zara, your creative spark! Ready to brainstorm and create something amazing together?",
                    david: "Hello! I'm David, your motivational coach. I'm here to help you unlock your potential. What are we working on?"
                };
                
                this.clearChat();
                this.addMessage(introMessages[personalityId], 'ai');
                
                console.log(`Switched to ${personality.name}`);
            }
            
            async processMessage(message) {
                this.addMessage(message, 'user');
                this.showThinking();
                
                try {
                    const response = await this.getAIResponse(message);
                    this.hideThinking();
                    this.addMessage(response, 'ai');
                    
                    if (this.settings.ttsEnabled) {
                        await this.speakWithPersonality(response);
                    }
                    
                    this.conversationHistory.push({ user: message, ai: response, personality: this.currentPersonality });
                    
                } catch (error) {
                    this.hideThinking();
                    const fallback = this.getFallbackResponse();
                    this.addMessage(fallback, 'ai');
                    
                    if (this.settings.ttsEnabled) {
                        await this.speakWithPersonality(fallback);
                    }
                }
            }
            
            async getAIResponse(message) {
                if (!this.settings.apiKey) {
                    return "I'd love to give you a thoughtful response, but I need my AI brain connected first. Please add your API key in settings!";
                }
                
                const personality = this.personalities[this.currentPersonality];
                
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.settings.apiKey}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [
                                {
                                    role: 'system',
                                    content: personality.systemPrompt
                                },
                                {
                                    role: 'user',
                                    content: message
                                }
                            ],
                            max_tokens: 200,
                            temperature: 0.9
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0].message.content.trim();
                    
                } catch (error) {
                    console.error('AI response error:', error);
                    throw error;
                }
            }
            
            getFallbackResponse() {
                const personality = this.personalities[this.currentPersonality];
                const fallbacks = {
                    emma: "I'm having a little trouble right now, but I'm still here for you! What's on your mind? 😊",
                    alex: "I'm experiencing technical difficulties. Let me try to help you anyway - what do you need?",
                    sophia: "I'm experiencing some turbulence, but I'm still present with you. What would you like to explore?",
                    marcus: "System experiencing issues. I'll do my best to assist with available resources.",
                    zara: "My creative circuits are a bit scrambled, but I'm still here to brainstorm with you!",
                    david: "I'm facing some challenges myself, but that doesn't stop us from tackling yours together!"
                };
                
                return fallbacks[this.currentPersonality];
            }
            
            async speakWithPersonality(text) {
                if (!this.synthesis || !this.settings.ttsEnabled) return;
                
                return new Promise((resolve) => {
                    this.synthesis.cancel();
                    this.isSpeaking = true;
                    
                    const personality = this.personalities[this.currentPersonality];
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    utterance.rate = personality.voiceSettings.rate;
                    utterance.pitch = personality.voiceSettings.pitch;
                    utterance.volume = personality.voiceSettings.volume;
                    
                    utterance.onend = () => {
                        this.isSpeaking = false;
                        resolve();
                    };
                    
                    utterance.onerror = () => {
                        this.isSpeaking = false;
                        resolve();
                    };
                    
                    this.synthesis.speak(utterance);
                });
            }
            
            addMessage(message, sender) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.textContent = message;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            clearChat() {
                document.getElementById('chatMessages').innerHTML = '';
            }
            
            showThinking() {
                document.getElementById('thinkingIndicator').style.display = 'flex';
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            hideThinking() {
                document.getElementById('thinkingIndicator').style.display = 'none';
            }
            
            toggleVoice() {
                if (this.isListening) {
                    this.stopListening();
                } else {
                    this.startListening();
                }
            }
            
            startListening() {
                if (this.recognition && !this.isListening && this.settings.voiceEnabled) {
                    try {
                        this.recognition.start();
                    } catch (error) {
                        console.error('Failed to start voice recognition:', error);
                    }
                }
            }
            
            stopListening() {
                this.isListening = false;
                document.getElementById('micBtn').classList.remove('listening');
            }
            
            testVoice() {
                const personality = this.personalities[this.currentPersonality];
                const testMessage = `Hi! This is ${personality.name}. This is how I sound when I speak to you.`;
                this.speakWithPersonality(testMessage);
            }
        }
        
        let assistant;
        
        document.addEventListener('DOMContentLoaded', () => {
            assistant = new PersonalAI();
            
            document.getElementById('textInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            if (assistant.settings.apiKey) {
                document.getElementById('apiKey').value = assistant.settings.apiKey;
            }
        });
        
        function selectPersonality(personalityId) {
            assistant.selectPersonality(personalityId);
        }
        
        function sendMessage() {
            const input = document.getElementById('textInput');
            const message = input.value.trim();
            
            if (message) {
                assistant.processMessage(message);
                input.value = '';
            }
        }
        
        function toggleVoice() {
            assistant.toggleVoice();
        }
        
        function testVoice() {
            assistant.testVoice();
        }
        
        function openSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (apiKey.startsWith('sk-')) {
                assistant.settings.apiKey = apiKey;
                localStorage.setItem('pai_api_key', apiKey);
                
                assistant.addMessage("Perfect! My AI brain is now connected and ready for intelligent conversations! 🎉", 'ai');
                closeSettings();
            } else {
                alert('Please enter a valid OpenAI API key (starts with sk-)');
            }
        }
        
        function testConnection() {
            if (!assistant.settings.apiKey) {
                alert('Please add your API key first');
                return;
            }
            
            assistant.processMessage('Hello, can you hear me?');
            closeSettings();
        }
        
        function toggleVoiceInput() {
            assistant.settings.voiceEnabled = document.getElementById('voiceEnabled').checked;
        }
        
        function toggleTextToSpeech() {
            assistant.settings.ttsEnabled = document.getElementById('ttsEnabled').checked;
        }
        
        // Close modal when clicking outside
        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('settingsModal')) {
                closeSettings();
            }
        });
    </script>
</body>
</html>