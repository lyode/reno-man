<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal AI Assistant - Complete</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #f9ca24);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 20px 40px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .status-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .main-interface {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.2);
        }

        .voice-control {
            text-align: center;
        }

        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
            position: relative;
            overflow: hidden;
        }

        .mic-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .mic-button:hover::before {
            transform: translateX(100%);
        }

        .mic-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.5);
        }

        .mic-button.listening {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.6);
        }

        .mic-button.processing {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            animation: spin 2s linear infinite;
        }

        .mic-button.speaking {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            animation: speak 0.8s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(78, 205, 196, 0.6); }
            50% { transform: scale(1.1); box-shadow: 0 0 50px rgba(78, 205, 196, 0.8); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes speak {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .voice-visualizer {
            height: 60px;
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 3px;
            margin: 20px 0;
        }

        .voice-bar {
            width: 4px;
            background: linear-gradient(to top, #4ecdc4, #44a08d);
            border-radius: 2px;
            transition: height 0.1s ease;
            min-height: 4px;
        }

        .data-section {
            margin-bottom: 25px;
        }

        .data-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: #4ecdc4;
        }

        .permission-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .permission-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .toggle-switch {
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.4);
        }

        .toggle-slider {
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .data-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .data-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .action-btn {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chat-interface {
            grid-column: span 3;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 80%;
            word-wrap: break-word;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .message.system {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #333;
            text-align: center;
            margin: 10px auto;
            max-width: 60%;
            font-style: italic;
        }

        .text-input {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .text-input input {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            outline: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .text-input input:focus {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .text-input input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .send-btn {
            padding: 18px 30px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .controls-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .control-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .control-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .control-card .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 25px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            transform: scale(1.2);
            color: #ff6b6b;
        }

        .permission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .permission-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .status-indicator.active {
            background: #4ecdc4;
            box-shadow: 0 0 15px #4ecdc4;
        }

        .status-indicator.inactive {
            background: #ff6b6b;
            box-shadow: 0 0 15px #ff6b6b;
        }

        .reminder-item, .task-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4ecdc4;
            transition: all 0.3s ease;
        }

        .reminder-item:hover, .task-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .reminder-actions, .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .mini-btn {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .mini-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .analytics-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .analytics-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4ecdc4;
            text-align: center;
        }

        .analytics-label {
            text-align: center;
            margin-top: 5px;
            opacity: 0.8;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            transition: width 0.3s ease;
        }

        @media (max-width: 1024px) {
            .main-interface {
                grid-template-columns: 1fr 1fr;
            }
            
            .chat-interface {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            .main-interface {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .chat-interface {
                grid-column: span 1;
            }
            
            .controls-panel {
                grid-template-columns: 1fr 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }

        .typing-indicator {
            display: none;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin: 10px 0;
            max-width: 100px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .calendar-event {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff6b6b;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .contact-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🤖 Personal AI Assistant</h1>
            <p>Your intelligent companion with complete access to your personal data</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-content">
                <span class="status-indicator" id="connectionStatus"></span>
                <span id="statusText">Ready to assist you</span>
                <span id="statusDetails"></span>
            </div>
        </div>

        <!-- Main Interface -->
        <div class="main-interface">
            <!-- Voice Control Section -->
            <div class="card voice-control">
                <h2>🎤 Voice Control</h2>
                <button class="mic-button" id="micButton">🎤</button>
                <p id="voiceStatus">Click to start voice interaction</p>
                
                <!-- Voice Visualizer -->
                <div class="voice-visualizer" id="voiceVisualizer">
                    <!-- Bars will be generated by JavaScript -->
                </div>
                
                <div class="quick-actions">
                    <button class="action-btn" onclick="quickCommand('calendar')">📅 Calendar</button>
                    <button class="action-btn" onclick="quickCommand('contacts')">👥 Contacts</button>
                    <button class="action-btn" onclick="quickCommand('reminders')">⏰ Reminders</button>
                    <button class="action-btn" onclick="quickCommand('calls')">📞 Calls</button>
                    <button class="action-btn" onclick="quickCommand('briefing')">📋 Briefing</button>
                    <button class="action-btn" onclick="quickCommand('help')">❓ Help</button>
                </div>
            </div>

            <!-- Personal Data Access -->
            <div class="card personal-data">
                <h2>🔐 Personal Data Access</h2>
                
                <div class="data-section">
                    <h3>📅 Calendar</h3>
                    <div class="permission-toggle" onclick="togglePermission('calendar')">
                        <span>Access my calendar events</span>
                        <div class="toggle-switch" id="calendarToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="data-display" id="calendarData">
                        <div class="data-item">📝 No calendar access granted</div>
                    </div>
                </div>

                <div class="data-section">
                    <h3>👥 Contacts</h3>
                    <div class="permission-toggle" onclick="togglePermission('contacts')">
                        <span>Access my contact list</span>
                        <div class="toggle-switch" id="contactsToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="data-display" id="contactsData">
                        <div class="data-item">📱 No contacts access granted</div>
                    </div>
                </div>

                <div class="data-section">
                    <h3>⏰ Reminders</h3>
                    <div class="permission-toggle" onclick="togglePermission('reminders')">
                        <span>Manage my reminders</span>
                        <div class="toggle-switch active" id="remindersToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="data-display" id="remindersData">
                        <div class="data-item">✅ Reminders ready to manage</div>
                    </div>
                </div>
            </div>

            <!-- Analytics & Insights -->
            <div class="card analytics">
                <h2>📊 Personal Analytics</h2>
                
                <div class="analytics-card">
                    <div class="analytics-number" id="totalInteractions">0</div>
                    <div class="analytics-label">Total Interactions</div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-number" id="activeReminders">0</div>
                    <div class="analytics-label">Active Reminders</div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-number" id="upcomingEvents">0</div>
                    <div class="analytics-label">Upcoming Events</div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="dailyProgress" style="width: 0%"></div>
                </div>
                <div class="analytics-label">Daily Goal Progress</div>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="chat-interface">
            <h2>💬 Chat with Your Personal AI</h2>
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    Hello! I'm your personal AI assistant. I can access your calendar, contacts, reminders, and help you manage your daily life. Try saying "Show my calendar" or "Add a reminder to call mom at 3 PM"!
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            <div class="text-input">
                <input type="text" id="textInput" placeholder="Type your message or use voice..." autocomplete="off">
                <button class="send-btn" onclick="sendMessage()">📤 Send</button>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="controls-panel">
            <div class="control-card" onclick="openModal('calendarModal')">
                <span class="icon">📅</span>
                <h3>Calendar Manager</h3>
                <p>View, add, and manage your schedule</p>
            </div>

            <div class="control-card" onclick="openModal('contactsModal')">
                <span class="icon">👥</span>
                <h3>Contact Manager</h3>
                <p>Access WhatsApp & phone contacts</p>
            </div>

            <div class="control-card" onclick="openModal('remindersModal')">
                <span class="icon">⏰</span>
                <h3>Smart Reminders</h3>
                <p>Set and manage intelligent reminders</p>
            </div>

            <div class="control-card" onclick="openModal('settingsModal')">
                <span class="icon">⚙️</span>
                <h3>AI Settings</h3>
                <p>Configure your personal assistant</p>
            </div>

            <div class="control-card" onclick="openModal('analyticsModal')">
                <span class="icon">📊</span>
                <h3>Analytics</h3>
                <p>View your personal insights</p>
            </div>

            <div class="control-card" onclick="openModal('privacyModal')">
                <span class="icon">🔒</span>
                <h3>Privacy Control</h3>
                <p>Manage your data privacy</p>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div class="modal" id="calendarModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('calendarModal')">×</button>
            <h2>📅 Calendar Manager</h2>
            
            <div class="permission-item">
                <span>📊 Calendar Integration Status</span>
                <span id="calendarStatus">Disconnected</span>
            </div>
            
            <div class="permission-item">
                <span>Google Calendar</span>
                <button class="action-btn" onclick="connectCalendar('google')" id="googleCalendarBtn">Connect</button>
            </div>
            
            <div class="permission-item">
                <span>Outlook Calendar</span>
                <button class="action-btn" onclick="connectCalendar('outlook')" id="outlookCalendarBtn">Connect</button>
            </div>
            
            <div class="permission-item">
                <span>Add New Event</span>
                <button class="action-btn" onclick="showAddEventForm()">+ Add Event</button>
            </div>
            
            <div id="addEventForm" style="display: none; margin-top: 20px;">
                <input type="text" id="eventTitle" placeholder="Event title" style="width: 100%; margin: 5px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                <input type="datetime-local" id="eventStart" style="width: 100%; margin: 5px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                <input type="datetime-local" id="eventEnd" style="width: 100%; margin: 5px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                <button class="action-btn" onclick="addCalendarEvent()" style="width: 100%; margin-top: 10px;">Add Event</button>
            </div>
            
            <div id="calendarEvents" style="max-height: 300px; overflow-y: auto; margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Contacts Modal -->
    <div class="modal" id="contactsModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('contactsModal')">×</button>
            <h2>👥 Contact Manager</h2>
            
            <div class="permission-item">
                <span>📱 WhatsApp Contacts</span>
                <button class="action-btn" onclick="connectContacts('whatsapp')" id="whatsappBtn">Connect</button>
            </div>
            
            <div class="permission-item">
                <span>📞 Phone Contacts</span>
                <button class="action-btn" onclick="connectContacts('phone')" id="phoneBtn">Connect</button>
            </div>
            
            <div class="permission-item">
                <span>📧 Google Contacts</span>
                <button class="action-btn" onclick="connectContacts('google')" id="googleContactsBtn">Connect</button>
            </div>
            
            <div class="permission-item">
                <span>➕ Add Manual Contact</span>
                <button class="action-btn" onclick="showAddContactForm()">+ Add Contact</button>
            </div>
            
            <div id="addContactForm" style="display: none; margin-top: 20px;">
                <input type="text" id="contactName" placeholder="Contact name" style="width: 100%; margin: 5px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                <input type="tel" id="contactPhone" placeholder="Phone number" style="width: 100%; margin: 5px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                <select id="contactType" style="width: 100%; margin: 5px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                    <option value="phone">Phone</option>
                    <option value="whatsapp">WhatsApp</option>
                    <option value="both">Both</option>
                </select>
                <button class="action-btn" onclick="addContact()" style="width: 100%; margin-top: 10px;">Add Contact</button>
            </div>
            
            <div id="contactsList" style="max-height: 300px; overflow-y: auto; margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Reminders Modal -->
    <div class="modal" id="remindersModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('remindersModal')">×</button>
            <h2>⏰ Smart Reminders</h2>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="reminderText" placeholder="What should I remind you about?" style="width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 15px; border: none; background: rgba(255,255,255,0.2); color: white; font-size: 16px;">
                <input type="datetime-local" id="reminderTime" style="width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 15px; border: none; background: rgba(255,255,255,0.2); color: white; font-size: 16px;">
                <select id="reminderPriority" style="width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 15px; border: none; background: rgba(255,255,255,0.2); color: white; font-size: 16px;">
                    <option value="low">Low Priority</option>
                    <option value="medium" selected>Medium Priority</option>
                    <option value="high">High Priority</option>
                    <option value="urgent">Urgent</option>
                </select>
                <button class="action-btn" onclick="addReminder()" style="width: 100%; padding: 15px; font-size: 16px;">📝 Add Reminder</button>
            </div>
            
            <div id="remindersList" style="max-height: 400px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('settingsModal')">×</button>
            <h2>⚙️ AI Assistant Settings</h2>
            
            <div class="permission-item">
                <span>🔑 OpenAI API Key</span>
                <input type="password" id="apiKey" placeholder="sk-proj-..." style="padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white; width: 250px;">
            </div>
            
            <div class="permission-item">
                <span>🤖 AI Model</span>
                <select id="aiModel" style="padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    <option value="gpt-4">GPT-4</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                </select>
            </div>
            
            <div class="permission-item">
                <span>🗣️ Voice Recognition</span>
                <div class="toggle-switch active" onclick="toggleSetting('voice')" id="voiceToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="permission-item">
                <span>🔊 Text-to-Speech</span>
                <div class="toggle-switch active" onclick="toggleSetting('tts')" id="ttsToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="permission-item">
                <span>📊 Usage Analytics</span>
                <div class="toggle-switch" onclick="toggleSetting('analytics')" id="analyticsToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="permission-item">
                <span>🔔 Proactive Notifications</span>
                <div class="toggle-switch active" onclick="toggleSetting('notifications')" id="notificationsToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="permission-item">
                <span>🎨 Assistant Personality</span>
                <select id="personalityType" style="padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                    <option value="friendly">😊 Friendly & Casual</option>
                    <option value="professional">💼 Professional</option>
                    <option value="energetic">⚡ Energetic & Upbeat</option>
                    <option value="calm">🧘 Calm & Peaceful</option>
                    <option value="witty">😄 Witty & Humorous</option>
                </select>
            </div>
            
            <button class="action-btn" onclick="saveSettings()" style="width: 100%; margin-top: 20px; padding: 15px; font-size: 16px;">💾 Save Settings</button>
            <button class="action-btn" onclick="testConnection()" style="width: 100%; margin-top: 10px; padding: 15px; font-size: 16px; background: linear-gradient(135deg, #4ecdc4, #44a08d);">🧪 Test Connection</button>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div class="modal" id="analyticsModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('analyticsModal')">×</button>
            <h2>📊 Personal Analytics Dashboard</h2>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px 0;">
                <div class="analytics-card">
                    <div class="analytics-number" id="weeklyInteractions">0</div>
                    <div class="analytics-label">This Week</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-number" id="monthlyInteractions">0</div>
                    <div class="analytics-label">This Month</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-number" id="completedTasks">0</div>
                    <div class="analytics-label">Tasks Completed</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-number" id="averageResponse">0ms</div>
                    <div class="analytics-label">Avg Response Time</div>
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>📈 Usage Patterns</h3>
                <div class="analytics-card">
                    <div class="analytics-label">Most Active Time</div>
                    <div id="mostActiveTime">Analyzing...</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-label">Favorite Features</div>
                    <div id="favoriteFeatures">Analyzing...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div class="modal" id="privacyModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('privacyModal')">×</button>
            <h2>🔒 Privacy & Data Control</h2>
            
            <div class="permission-item">
                <span>🗄️ Data Storage Location</span>
                <select id="dataStorage" style="padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white;">
                    <option value="local">Local Storage Only</option>
                    <option value="cloud">Cloud Sync (Encrypted)</option>
                    <option value="hybrid">Hybrid (Local + Backup)</option>
                </select>
            </div>
            
            <div class="permission-item">
                <span>🔐 Data Encryption</span>
                <div class="toggle-switch active" onclick="toggleSetting('encryption')" id="encryptionToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="permission-item">
                <span>🕐 Data Retention (days)</span>
                <input type="number" id="dataRetention" value="90" min="1" max="365" style="padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: white; width: 100px;">
            </div>
            
            <div class="permission-item">
                <span>🔄 Auto Backup</span>
                <div class="toggle-switch active" onclick="toggleSetting('autoBackup')" id="autoBackupToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div style="margin: 20px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
                <h3>📋 Data Management</h3>
                <button class="action-btn" onclick="exportData()" style="margin: 5px; padding: 10px 20px;">📤 Export Data</button>
                <button class="action-btn" onclick="clearData()" style="margin: 5px; padding: 10px 20px; background: linear-gradient(135deg, #ff6b6b, #ee5a52);">🗑️ Clear Data</button>
                <button class="action-btn" onclick="viewDataUsage()" style="margin: 5px; padding: 10px 20px;">📊 View Usage</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification" id="notification"></div>

    <script>
        class PersonalAIAssistant {
            constructor() {
                // Core data structures
                this.permissions = this.loadPermissions();
                this.data = {
                    calendar: this.loadCalendarData(),
                    contacts: this.loadContactsData(),
                    reminders: this.loadReminders(),
                    calls: [],
                    conversations: this.loadConversations()
                };
                
                // Settings
                this.settings = this.loadSettings();
                
                // State management
                this.isListening = false;
                this.isSpeaking = false;
                this.isProcessing = false;
                this.currentInteraction = null;
                
                // Analytics
                this.analytics = this.loadAnalytics();
                
                // Initialize components
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                this.voiceBars = [];
                
                this.initializeVoiceRecognition();
                this.initializeVoiceVisualizer();
                this.updateUI();
                this.updateAnalytics();
                this.startPeriodicTasks();
                
                console.log('🤖 Personal AI Assistant initialized');
            }
            
            // ===== INITIALIZATION METHODS =====
            
            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';
                    
                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.updateVoiceStatus('🎤 Listening... Speak now!');
                        document.getElementById('micButton').classList.add('listening');
                        this.startVoiceVisualization();
                    };
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        const confidence = event.results[0][0].confidence;
                        this.logInteraction('voice_input', { transcript, confidence });
                        this.processVoiceCommand(transcript);
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.updateVoiceStatus('❌ Error: ' + event.error);
                        this.showNotification('Voice recognition error: ' + event.error, 'error');
                        this.stopListening();
                    };
                    
                    this.recognition.onend = () => {
                        this.stopListening();
                    };
                } else {
                    this.showNotification('Voice recognition not supported in this browser', 'error');
                }
            }
            
            initializeVoiceVisualizer() {
                const visualizer = document.getElementById('voiceVisualizer');
                visualizer.innerHTML = '';
                
                for (let i = 0; i < 20; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'voice-bar';
                    bar.style.height = '4px';
                    visualizer.appendChild(bar);
                    this.voiceBars.push(bar);
                }
            }
            
            startPeriodicTasks() {
                // Check for reminder notifications every minute
                setInterval(() => {
                    this.checkReminders();
                }, 60000);
                
                // Update analytics every 5 minutes
                setInterval(() => {
                    this.updateAnalytics();
                }, 300000);
                
                // Cleanup old data daily
                setInterval(() => {
                    this.cleanupOldData();
                }, 86400000);
            }
            
            // ===== VOICE INTERACTION METHODS =====
            
            toggleVoiceRecognition() {
                if (this.isListening) {
                    this.stopListening();
                } else {
                    this.startListening();
                }
            }
            
            startListening() {
                if (this.recognition && !this.isListening && this.settings.voiceEnabled) {
                    try {
                        this.recognition.start();
                    } catch (error) {
                        console.error('Failed to start voice recognition:', error);
                        this.showNotification('Failed to start voice recognition', 'error');
                    }
                }
            }
            
            stopListening() {
                this.isListening = false;
                this.updateVoiceStatus('🎤 Click to start voice interaction');
                document.getElementById('micButton').classList.remove('listening', 'processing');
                this.stopVoiceVisualization();
            }
            
            startVoiceVisualization() {
                if (!this.isListening) return;
                
                const animate = () => {
                    this.voiceBars.forEach((bar, index) => {
                        const height = Math.random() * 50 + 5;
                        bar.style.height = height + 'px';
                        bar.style.backgroundColor = `hsl(${180 + Math.random() * 40}, 70%, 60%)`;
                    });
                    
                    if (this.isListening) {
                        requestAnimationFrame(animate);
                    }
                };
                
                animate();
            }
            
            stopVoiceVisualization() {
                this.voiceBars.forEach(bar => {
                    bar.style.height = '4px';
                    bar.style.backgroundColor = '#4ecdc4';
                });
            }
            
            updateVoiceStatus(message) {
                document.getElementById('voiceStatus').textContent = message;
            }
            
            // ===== COMMAND PROCESSING =====
            
            async processVoiceCommand(command) {
                this.updateVoiceStatus('🤖 Processing...');
                document.getElementById('micButton').classList.remove('listening');
                document.getElementById('micButton').classList.add('processing');
                
                this.addMessage(command, 'user');
                this.showTypingIndicator();
                
                try {
                    const response = await this.handlePersonalCommand(command);
                    this.hideTypingIndicator();
                    this.addMessage(response, 'ai');
                    
                    if (this.settings.ttsEnabled) {
                        await this.speak(response);
                    }
                    
                    this.logInteraction('command_processed', { command, response });
                } catch (error) {
                    this.hideTypingIndicator();
                    const errorMsg = 'Sorry, I encountered an error processing your request.';
                    this.addMessage(errorMsg, 'ai');
                    this.logInteraction('command_error', { command, error: error.message });
                }
                
                setTimeout(() => {
                    this.stopListening();
                }, 1000);
            }
            
            async handlePersonalCommand(command) {
                const lowerCommand = command.toLowerCase();
                
                // Calendar commands
                if (this.isCalendarCommand(lowerCommand)) {
                    return await this.handleCalendarCommand(lowerCommand, command);
                }
                
                // Contact commands
                if (this.isContactCommand(lowerCommand)) {
                    return await this.handleContactCommand(lowerCommand, command);
                }
                
                // Reminder commands
                if (this.isReminderCommand(lowerCommand)) {
                    return await this.handleReminderCommand(lowerCommand, command);
                }
                
                // Analytics commands
                if (this.isAnalyticsCommand(lowerCommand)) {
                    return this.handleAnalyticsCommand(lowerCommand);
                }
                
                // Briefing commands
                if (lowerCommand.includes('briefing') || lowerCommand.includes('summary') || lowerCommand.includes('update')) {
                    return this.generateDailyBriefing();
                }
                
                // Help commands
                if (lowerCommand.includes('help') || lowerCommand.includes('what can you do')) {
                    return this.getHelpMessage();
                }
                
                // General AI response
                return await this.getAIResponse(command);
            }
            
            // ===== CALENDAR METHODS =====
            
            isCalendarCommand(command) {
                return command.includes('calendar') || command.includes('schedule') || 
                       command.includes('appointment') || command.includes('meeting') ||
                       command.includes('event');
            }
            
            async handleCalendarCommand(lowerCommand, originalCommand) {
                if (!this.permissions.calendar) {
                    return "I need calendar access to help you. Please enable calendar permissions in the Personal Data Access panel.";
                }
                
                if (lowerCommand.includes('show') || lowerCommand.includes('what') || lowerCommand.includes('today') || lowerCommand.includes('tomorrow')) {
                    return this.getCalendarSummary(lowerCommand);
                }
                
                if (lowerCommand.includes('add') || lowerCommand.includes('create') || lowerCommand.includes('schedule')) {
                    return this.scheduleEventFromVoice(originalCommand);
                }
                
                if (lowerCommand.includes('cancel') || lowerCommand.includes('delete') || lowerCommand.includes('remove')) {
                    return this.cancelEventFromVoice(originalCommand);
                }
                
                return "I can help you with calendar management. Try asking 'show my calendar' or 'schedule a meeting tomorrow at 2 PM'.";
            }
            
            getCalendarSummary(command) {
                let events = this.data.calendar;
                const today = new Date();
                
                if (command.includes('today')) {
                    events = events.filter(event => {
                        const eventDate = new Date(event.start);
                        return eventDate.toDateString() === today.toDateString();
                    });
                } else if (command.includes('tomorrow')) {
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    events = events.filter(event => {
                        const eventDate = new Date(event.start);
                        return eventDate.toDateString() === tomorrow.toDateString();
                    });
                } else {
                    // Show upcoming events (next 7 days)
                    const nextWeek = new Date(today);
                    nextWeek.setDate(nextWeek.getDate() + 7);
                    events = events.filter(event => {
                        const eventDate = new Date(event.start);
                        return eventDate >= today && eventDate <= nextWeek;
                    });
                }
                
                if (events.length === 0) {
                    if (command.includes('today')) {
                        return "You have no events scheduled for today. Your schedule is free!";
                    } else if (command.includes('tomorrow')) {
                        return "You have no events scheduled for tomorrow.";
                    } else {
                        return "You have no upcoming events in the next week.";
                    }
                }
                
                const eventList = events.map(event => {
                    const eventDate = new Date(event.start);
                    const timeStr = eventDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    const dateStr = eventDate.toLocaleDateString();
                    return `${event.title} on ${dateStr} at ${timeStr}`;
                }).join(', ');
                
                return `You have ${events.length} upcoming events: ${eventList}`;
            }
            
            scheduleEventFromVoice(command) {
                // Extract event details from voice command
                const eventInfo = this.extractEventFromCommand(command);
                
                if (eventInfo.title && eventInfo.start) {
                    const newEvent = {
                        id: Date.now(),
                        title: eventInfo.title,
                        start: eventInfo.start,
                        end: eventInfo.end || new Date(eventInfo.start.getTime() + 3600000), // Default 1 hour
                        description: eventInfo.description || '',
                        created: new Date()
                    };
                    
                    this.data.calendar.push(newEvent);
                    this.saveCalendarData();
                    this.updateCalendarDisplay();
                    
                    const timeStr = eventInfo.start.toLocaleString();
                    return `Event "${eventInfo.title}" scheduled for ${timeStr}`;
                }
                
                return "I couldn't understand the event details. Please try again with more specific information like 'Schedule a meeting with John tomorrow at 2 PM'";
            }
            
            extractEventFromCommand(command) {
                const result = {
                    title: '',
                    start: null,
                    end: null,
                    description: ''
                };
                
                // Extract title (basic pattern matching)
                const titlePatterns = [
                    /schedule (?:a )?(.+?) (?:for|on|at|tomorrow|today)/i,
                    /add (?:a )?(?:meeting|appointment|event) (?:with )?(.+?) (?:for|on|at|tomorrow|today)/i,
                    /create (?:a )?(?:meeting|appointment|event) (?:with )?(.+?) (?:for|on|at|tomorrow|today)/i
                ];
                
                for (const pattern of titlePatterns) {
                    const match = command.match(pattern);
                    if (match) {
                        result.title = match[1].trim();
                        break;
                    }
                }
                
                // Extract time
                result.start = this.extractDateTimeFromCommand(command);
                
                return result;
            }
            
            extractDateTimeFromCommand(command) {
                const now = new Date();
                let targetDate = new Date();
                
                // Handle relative dates
                if (command.toLowerCase().includes('tomorrow')) {
                    targetDate.setDate(now.getDate() + 1);
                } else if (command.toLowerCase().includes('today')) {
                    // Keep today's date
                } else if (command.toLowerCase().includes('next week')) {
                    targetDate.setDate(now.getDate() + 7);
                } else {
                    // Try to parse specific date
                    const dateMatch = command.match(/on (\w+ \d+)/i);
                    if (dateMatch) {
                        targetDate = new Date(dateMatch[1] + `, ${now.getFullYear()}`);
                    }
                }
                
                // Parse time
                const timeMatch = command.match(/at (\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);
                if (timeMatch) {
                    let hour = parseInt(timeMatch[1]);
                    const minute = parseInt(timeMatch[2]) || 0;
                    const ampm = timeMatch[3];
                    
                    if (ampm) {
                        if (ampm.toLowerCase() === 'pm' && hour !== 12) {
                            hour += 12;
                        } else if (ampm.toLowerCase() === 'am' && hour === 12) {
                            hour = 0;
                        }
                    } else if (hour < 8) {
                        // Assume PM for small hours without explicit AM/PM
                        hour += 12;
                    }
                    
                    targetDate.setHours(hour, minute, 0, 0);
                }
                
                return targetDate > now ? targetDate : null;
            }
            
            // ===== CONTACT METHODS =====
            
            isContactCommand(command) {
                return command.includes('contact') || command.includes('call') || 
                       command.includes('phone') || command.includes('whatsapp') ||
                       command.includes('message') || command.includes('text');
            }
            
            async handleContactCommand(lowerCommand, originalCommand) {
                if (!this.permissions.contacts) {
                    return "I need contacts access to help you. Please enable contacts permissions in the Personal Data Access panel.";
                }
                
                if (lowerCommand.includes('call') || lowerCommand.includes('phone')) {
                    return this.handleCallCommand(originalCommand);
                }
                
                if (lowerCommand.includes('whatsapp') || lowerCommand.includes('message') || lowerCommand.includes('text')) {
                    return this.handleMessageCommand(originalCommand);
                }
                
                if (lowerCommand.includes('show') || lowerCommand.includes('list')) {
                    return this.listContacts();
                }
                
                if (lowerCommand.includes('add') || lowerCommand.includes('create')) {
                    return "I can help you add contacts. Please use the Contact Manager to add new contacts.";
                }
                
                return "I can help you contact people. Try saying 'call John' or 'send WhatsApp to Sarah'.";
            }
            
            handleCallCommand(command) {
                const contactName = this.extractContactNameFromCommand(command);
                if (contactName) {
                    const contact = this.findContactByName(contactName);
                    if (contact) {
                        // In a real app, this would initiate an actual call
                        return `Calling ${contact.name} at ${contact.phone}... (This would initiate a real call in a production app)`;
                    } else {
                        return `Contact "${contactName}" not found in your contacts. Would you like me to search for similar names?`;
                    }
                } else {
                    return "I couldn't identify who you want to call. Please try again with a specific name.";
                }
            }
            
            handleMessageCommand(command) {
                const contactName = this.extractContactNameFromCommand(command);
                const message = this.extractMessageFromCommand(command);
                
                if (contactName && message) {
                    const contact = this.findContactByName(contactName);
                    if (contact) {
                        // In a real app, this would send an actual message
                        return `Sending WhatsApp message to ${contact.name}: "${message}" (This would send a real message in a production app)`;
                    } else {
                        return `Contact "${contactName}" not found in your WhatsApp contacts.`;
                    }
                } else if (contactName) {
                    return `What message would you like to send to ${contactName}?`;
                } else {
                    return "I couldn't understand the message command. Try saying 'send WhatsApp to John saying hello'";
                }
            }
            
            extractContactNameFromCommand(command) {
                const patterns = [
                    /call (\w+)/i,
                    /phone (\w+)/i,
                    /whatsapp (?:to )?(\w+)/i,
                    /message (?:to )?(\w+)/i,
                    /text (?:to )?(\w+)/i
                ];
                
                for (const pattern of patterns) {
                    const match = command.match(pattern);
                    if (match) {
                        return match[1].trim();
                    }
                }
                
                return null;
            }
            
            extractMessageFromCommand(command) {
                const patterns = [
                    /saying (.+)/i,
                    /message (.+)/i,
                    /" *(.+?) *"/i
                ];
                
                for (const pattern of patterns) {
                    const match = command.match(pattern);
                    if (match) {
                        return match[1].trim();
                    }
                }
                
                return null;
            }
            
            findContactByName(name) {
                const lowerName = name.toLowerCase();
                return this.data.contacts.find(contact => 
                    contact.name.toLowerCase().includes(lowerName)
                );
            }
            
            listContacts() {
                if (this.data.contacts.length === 0) {
                    return "You have no contacts stored. Please add some contacts to get started.";
                }
                
                const contactList = this.data.contacts.slice(0, 5).map(contact => 
                    `${contact.name} (${contact.type})`
                ).join(', ');
                
                const remaining = this.data.contacts.length - 5;
                const suffix = remaining > 0 ? ` and ${remaining} more` : '';
                
                return `Your contacts include: ${contactList}${suffix}`;
            }
            
            // ===== REMINDER METHODS =====
            
            isReminderCommand(command) {
                return command.includes('remind') || command.includes('reminder') ||
                       command.includes('alert') || command.includes('notification');
            }
            
            async handleReminderCommand(lowerCommand, originalCommand) {
                if (lowerCommand.includes('add') || lowerCommand.includes('set') || lowerCommand.includes('create')) {
                    return this.createReminderFromVoice(originalCommand);
                }
                
                if (lowerCommand.includes('show') || lowerCommand.includes('list') || lowerCommand.includes('what')) {
                    return this.listReminders();
                }
                
                if (lowerCommand.includes('delete') || lowerCommand.includes('remove') || lowerCommand.includes('cancel')) {
                    return this.deleteReminderFromVoice(originalCommand);
                }
                
                return "I can help you with reminders. Try saying 'remind me to call mom at 3 PM' or 'show my reminders'.";
            }
            
            createReminderFromVoice(command) {
                const reminderText = this.extractReminderText(command);
                const reminderTime = this.extractDateTimeFromCommand(command);
                const priority = this.extractPriorityFromCommand(command);
                
                if (reminderText) {
                    const reminder = {
                        id: Date.now(),
                        text: reminderText,
                        time: reminderTime || new Date(Date.now() + 3600000), // Default to 1 hour from now
                        priority: priority || 'medium',
                        created: new Date(),
                        completed: false,
                        notified: false
                    };
                    
                    this.data.reminders.push(reminder);
                    this.saveReminders();
                    this.updateRemindersDisplay();
                    
                    const timeStr = reminder.time.toLocaleString();
                    return `Reminder set: "${reminderText}" for ${timeStr} with ${priority} priority`;
                }
                
                return "I couldn't understand the reminder. Please try again with more details like 'remind me to buy groceries tomorrow at 2 PM'";
            }
            
            extractReminderText(command) {
                const patterns = [
                    /remind me to (.+?) (?:at|on|in|tomorrow|today)/i,
                    /remind me to (.+)/i,
                    /set (?:a )?reminder (?:to )?(.+?) (?:at|on|in|tomorrow|today)/i,
                    /set (?:a )?reminder (?:to )?(.+)/i
                ];
                
                for (const pattern of patterns) {
                    const match = command.match(pattern);
                    if (match) {
                        return match[1].trim();
                    }
                }
                
                return null;
            }
            
            extractPriorityFromCommand(command) {
                if (command.toLowerCase().includes('urgent') || command.toLowerCase().includes('asap')) {
                    return 'urgent';
                } else if (command.toLowerCase().includes('important') || command.toLowerCase().includes('high')) {
                    return 'high';
                } else if (command.toLowerCase().includes('low') || command.toLowerCase().includes('whenever')) {
                    return 'low';
                }
                return 'medium';
            }
            
            listReminders() {
                const activeReminders = this.data.reminders.filter(r => !r.completed);
                
                if (activeReminders.length === 0) {
                    return "You have no active reminders. You're all caught up!";
                }
                
                const reminderList = activeReminders.slice(0, 3).map(reminder => {
                    const timeStr = new Date(reminder.time).toLocaleString();
                    return `${reminder.text} at ${timeStr}`;
                }).join(', ');
                
                const remaining = activeReminders.length - 3;
                const suffix = remaining > 0 ? ` and ${remaining} more` : '';
                
                return `You have ${activeReminders.length} active reminders: ${reminderList}${suffix}`;
            }
            
            checkReminders() {
                const now = new Date();
                const dueReminders = this.data.reminders.filter(reminder => 
                    !reminder.completed && 
                    !reminder.notified && 
                    new Date(reminder.time) <= now
                );
                
                dueReminders.forEach(reminder => {
                    this.showNotification(`Reminder: ${reminder.text}`, 'reminder');
                    reminder.notified = true;
                });
                
                if (dueReminders.length > 0) {
                    this.saveReminders();
                    this.updateRemindersDisplay();
                }
            }
            
            // ===== ANALYTICS METHODS =====
            
            isAnalyticsCommand(command) {
                return command.includes('analytics') || command.includes('stats') ||
                       command.includes('usage') || command.includes('metrics');
            }
            
            handleAnalyticsCommand(command) {
                const stats = this.getUsageStatistics();
                return `Here are your usage statistics: You've had ${stats.totalInteractions} interactions, ${stats.completedTasks} completed tasks, and your most active time is ${stats.mostActiveHour}:00. Your favorite feature is ${stats.favoriteFeature}.`;
            }
            
            generateDailyBriefing() {
                const greeting = this.getPersonalizedGreeting();
                const calendarSummary = this.permissions.calendar ? this.getCalendarSummary('today') : '';
                const reminderSummary = this.getUpcomingReminders();
                const weatherNote = "Weather data integration would go here";
                
                let briefing = `${greeting}! `;
                
                if (calendarSummary) {
                    briefing += `${calendarSummary} `;
                }
                
                if (reminderSummary) {
                    briefing += `${reminderSummary} `;
                }
                
                briefing += "I'm here to help you stay organized and productive today!";
                
                return briefing;
            }
            
            getPersonalizedGreeting() {
                const hour = new Date().getHours();
                if (hour < 12) {
                    return "Good morning";
                } else if (hour < 17) {
                    return "Good afternoon";
                } else {
                    return "Good evening";
                }
            }
            
            getUpcomingReminders() {
                const today = new Date();
                const todayReminders = this.data.reminders.filter(reminder => {
                    const reminderDate = new Date(reminder.time);
                    return !reminder.completed && reminderDate.toDateString() === today.toDateString();
                });
                
                if (todayReminders.length === 0) {
                    return "You have no reminders for today.";
                }
                
                return `You have ${todayReminders.length} reminders scheduled for today.`;
            }
            
            getHelpMessage() {
                return `I'm your personal AI assistant. Here's what I can help you with:

📅 Calendar: "Show my calendar", "Schedule a meeting tomorrow at 2 PM"
👥 Contacts: "Call John", "Send WhatsApp to Sarah saying hello"
⏰ Reminders: "Remind me to buy groceries at 5 PM", "Show my reminders"
📊 Analytics: "Show my usage stats", "What's my most active time?"
📋 Briefings: "Give me a daily briefing", "What's my schedule today?"

Just speak naturally and I'll understand what you need!`;
            }
            
            // ===== AI RESPONSE METHODS =====
            
            async getAIResponse(message) {
                if (!this.settings.apiKey) {
                    return "I need an OpenAI API key to provide intelligent responses. Please add your API key in the settings.";
                }
                
                try {
                    const systemPrompt = this.buildPersonalizedSystemPrompt();
                    
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.settings.apiKey}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: this.settings.aiModel || 'gpt-3.5-turbo',
                            messages: [
                                {
                                    role: 'system',
                                    content: systemPrompt
                                },
                                {
                                    role: 'user',
                                    content: message
                                }
                            ],
                            max_tokens: 200,
                            temperature: 0.7
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0].message.content.trim();
                } catch (error) {
                    console.error('AI response error:', error);
                    return "I'm having trouble connecting to my AI brain right now. Please check your API key and internet connection.";
                }
            }
            
            buildPersonalizedSystemPrompt() {
                const personality = this.settings.personalityType || 'friendly';
                const hasCalendar = this.permissions.calendar;
                const hasContacts = this.permissions.contacts;
                const reminderCount = this.data.reminders.filter(r => !r.completed).length;
                
                let prompt = `You are a personal AI assistant with a ${personality} personality. `;
                
                if (hasCalendar) {
                    prompt += `You have access to the user's calendar. `;
                }
                
                if (hasContacts) {
                    prompt += `You have access to the user's contacts. `;
                }
                
                if (reminderCount > 0) {
                    prompt += `The user has ${reminderCount} active reminders. `;
                }
                
                prompt += `Provide helpful, personal responses. Keep responses concise and actionable. `;
                prompt += `Match the ${personality} personality in your responses.`;
                
                return prompt;
            }
            
            // ===== SPEECH SYNTHESIS =====
            
            async speak(text) {
                if (!this.settings.ttsEnabled || !this.synthesis) return;
                
                return new Promise((resolve) => {
                    this.synthesis.cancel();
                    this.isSpeaking = true;
                    document.getElementById('micButton').classList.add('speaking');
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    utterance.lang = 'en-US';
                    
                    utterance.onstart = () => {
                        this.updateVoiceStatus('🗣️ Speaking...');
                    };
                    
                    utterance.onend = () => {
                        this.isSpeaking = false;
                        document.getElementById('micButton').classList.remove('speaking');
                        this.updateVoiceStatus('🎤 Click to start voice interaction');
                        resolve();
                    };
                    
                    utterance.onerror = () => {
                        this.isSpeaking = false;
                        document.getElementById('micButton').classList.remove('speaking');
                        resolve();
                    };
                    
                    this.synthesis.speak(utterance);
                });
            }
            
            // ===== UI METHODS =====
            
            addMessage(message, sender) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.textContent = message;
                
                // Add timestamp for system messages
                if (sender === 'system') {
                    const timestamp = new Date().toLocaleTimeString();
                    messageDiv.textContent = `[${timestamp}] ${message}`;
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Store conversation
                this.storeConversation(message, sender);
            }
            
            showTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'block';
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            hideTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'none';
            }
            
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }
            
            updateUI() {
                // Update permission toggles
                Object.keys(this.permissions).forEach(type => {
                    const toggle = document.getElementById(`${type}Toggle`);
                    if (toggle) {
                        toggle.classList.toggle('active', this.permissions[type]);
                    }
                });
                
                // Update status indicators
                const hasAnyPermission = Object.values(this.permissions).some(p => p);
                document.getElementById('connectionStatus').className = 
                    `status-indicator ${hasAnyPermission ? 'active' : 'inactive'}`;
                
                // Update status text
                const activePermissions = Object.keys(this.permissions).filter(key => this.permissions[key]).length;
                document.getElementById('statusText').textContent = 
                    activePermissions > 0 ? 
                    `Connected - ${activePermissions} data sources active` : 
                    'Ready to connect to your personal data';
                
                // Update data displays
                this.updateCalendarDisplay();
                this.updateContactsDisplay();
                this.updateRemindersDisplay();
            }
            
            updateCalendarDisplay() {
                const display = document.getElementById('calendarData');
                if (this.permissions.calendar && this.data.calendar.length > 0) {
                    const upcomingEvents = this.data.calendar
                        .filter(event => new Date(event.start) > new Date())
                        .slice(0, 3);
                    
                    display.innerHTML = upcomingEvents.map(event => {
                        const eventDate = new Date(event.start);
                        const timeStr = eventDate.toLocaleString();
                        return `<div class="data-item">📅 ${event.title} - ${timeStr}</div>`;
                    }).join('');
                } else if (this.permissions.calendar) {
                    display.innerHTML = '<div class="data-item">📅 No upcoming events</div>';
                } else {
                    display.innerHTML = '<div class="data-item">📝 No calendar access granted</div>';
                }
            }
            
            updateContactsDisplay() {
                const display = document.getElementById('contactsData');
                if (this.permissions.contacts && this.data.contacts.length > 0) {
                    display.innerHTML = this.data.contacts.slice(0, 3).map(contact => 
                        `<div class="data-item">👤 ${contact.name} - ${contact.phone} (${contact.type})</div>`
                    ).join('');
                } else if (this.permissions.contacts) {
                    display.innerHTML = '<div class="data-item">👥 No contacts available</div>';
                } else {
                    display.innerHTML = '<div class="data-item">📱 No contacts access granted</div>';
                }
            }
            
            updateRemindersDisplay() {
                const display = document.getElementById('remindersData');
                const activeReminders = this.data.reminders.filter(r => !r.completed);
                
                if (activeReminders.length > 0) {
                    display.innerHTML = activeReminders.slice(0, 3).map(reminder => {
                        const timeStr = new Date(reminder.time).toLocaleString();
                        const priorityIcon = reminder.priority === 'urgent' ? '🔴' : 
                                           reminder.priority === 'high' ? '🟠' : 
                                           reminder.priority === 'low' ? '🟢' : '🟡';
                        return `<div class="data-item">${priorityIcon} ${reminder.text} - ${timeStr}</div>`;
                    }).join('');
                } else {
                    display.innerHTML = '<div class="data-item">✅ No active reminders</div>';
                }
            }
            
            updateAnalytics() {
                const stats = this.getUsageStatistics();
                
                document.getElementById('totalInteractions').textContent = stats.totalInteractions;
                document.getElementById('activeReminders').textContent = stats.activeReminders;
                document.getElementById('upcomingEvents').textContent = stats.upcomingEvents;
                
                // Update progress bar (example: daily interaction goal)
                const dailyGoal = 10;
                const todayInteractions = stats.todayInteractions || 0;
                const progress = Math.min((todayInteractions / dailyGoal) * 100, 100);
                document.getElementById('dailyProgress').style.width = progress + '%';
            }
            
            // ===== DATA MANAGEMENT =====
            
            loadPermissions() {
                const defaultPermissions = {
                    calendar: false,
                    contacts: false,
                    reminders: true,
                    calls: false
                };
                
                try {
                    const stored = localStorage.getItem('ai_permissions');
                    return stored ? { ...defaultPermissions, ...JSON.parse(stored) } : defaultPermissions;
                } catch (error) {
                    return defaultPermissions;
                }
            }
            
            savePermissions() {
                localStorage.setItem('ai_permissions', JSON.stringify(this.permissions));
            }
            
            loadSettings() {
                const defaultSettings = {
                    apiKey: '',
                    aiModel: 'gpt-3.5-turbo',
                    voiceEnabled: true,
                    ttsEnabled: true,
                    analyticsEnabled: false,
                    notificationsEnabled: true,
                    personalityType: 'friendly'
                };
                
                try {
                    const stored = localStorage.getItem('ai_settings');
                    return stored ? { ...defaultSettings, ...JSON.parse(stored) } : defaultSettings;
                } catch (error) {
                    return defaultSettings;
                }
            }
            
            saveSettings() {
                localStorage.setItem('ai_settings', JSON.stringify(this.settings));
            }
            
            loadCalendarData() {
                try {
                    const stored = localStorage.getItem('ai_calendar');
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    return [];
                }
            }
            
            saveCalendarData() {
                localStorage.setItem('ai_calendar', JSON.stringify(this.data.calendar));
            }
            
            loadContactsData() {
                try {
                    const stored = localStorage.getItem('ai_contacts');
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    return [];
                }
            }
            
            saveContactsData() {
                localStorage.setItem('ai_contacts', JSON.stringify(this.data.contacts));
            }
            
            loadReminders() {
                try {
                    const stored = localStorage.getItem('ai_reminders');
                    if (stored) {
                        return JSON.parse(stored).map(r => ({
                            ...r,
                            time: new Date(r.time),
                            created: new Date(r.created)
                        }));
                    }
                } catch (error) {
                    console.error('Error loading reminders:', error);
                }
                return [];
            }
            
            saveReminders() {
                localStorage.setItem('ai_reminders', JSON.stringify(this.data.reminders));
            }
            
            loadConversations() {
                try {
                    const stored = localStorage.getItem('ai_conversations');
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    return [];
                }
            }
            
            storeConversation(message, sender) {
                if (!this.settings.analyticsEnabled) return;
                
                const conversation = {
                    timestamp: new Date().toISOString(),
                    message: message,
                    sender: sender,
                    sessionId: this.currentInteraction
                };
                
                this.data.conversations.push(conversation);
                
                // Keep only last 1000 conversations
                if (this.data.conversations.length > 1000) {
                    this.data.conversations = this.data.conversations.slice(-1000);
                }
                
                localStorage.setItem('ai_conversations', JSON.stringify(this.data.conversations));
            }
            
            loadAnalytics() {
                try {
                    const stored = localStorage.getItem('ai_analytics');
                    return stored ? JSON.parse(stored) : {
                        totalInteractions: 0,
                        dailyInteractions: {},
                        featureUsage: {},
                        responseTime: [],
                        userSatisfaction: []
                    };
                } catch (error) {
                    return {
                        totalInteractions: 0,
                        dailyInteractions: {},
                        featureUsage: {},
                        responseTime: [],
                        userSatisfaction: []
                    };
                }
            }
            
            logInteraction(type, data) {
                if (!this.settings.analyticsEnabled) return;
                
                this.analytics.totalInteractions++;
                
                const today = new Date().toDateString();
                if (!this.analytics.dailyInteractions[today]) {
                    this.analytics.dailyInteractions[today] = 0;
                }
                this.analytics.dailyInteractions[today]++;
                
                if (!this.analytics.featureUsage[type]) {
                    this.analytics.featureUsage[type] = 0;
                }
                this.analytics.featureUsage[type]++;
                
                localStorage.setItem('ai_analytics', JSON.stringify(this.analytics));
            }
            
            getUsageStatistics() {
                const today = new Date().toDateString();
                const activeReminders = this.data.reminders.filter(r => !r.completed).length;
                const upcomingEvents = this.data.calendar.filter(event => 
                    new Date(event.start) > new Date()
                ).length;
                
                // Find most active hour
                const hourCounts = {};
                this.data.conversations.forEach(conv => {
                    const hour = new Date(conv.timestamp).getHours();
                    hourCounts[hour] = (hourCounts[hour] || 0) + 1;
                });
                
                const mostActiveHour = Object.keys(hourCounts).reduce((a, b) => 
                    hourCounts[a] > hourCounts[b] ? a : b, '0'
                );
                
                // Find favorite feature
                const favoriteFeature = Object.keys(this.analytics.featureUsage).reduce((a, b) => 
                    this.analytics.featureUsage[a] > this.analytics.featureUsage[b] ? a : b, 'voice_input'
                );
                
                return {
                    totalInteractions: this.analytics.totalInteractions,
                    todayInteractions: this.analytics.dailyInteractions[today] || 0,
                    activeReminders: activeReminders,
                    upcomingEvents: upcomingEvents,
                    mostActiveHour: mostActiveHour,
                    favoriteFeature: favoriteFeature.replace('_', ' ')
                };
            }
            
            cleanupOldData() {
                const retentionDays = this.settings.dataRetention || 90;
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
                
                // Clean old conversations
                this.data.conversations = this.data.conversations.filter(conv => 
                    new Date(conv.timestamp) > cutoffDate
                );
                
                // Clean old reminders
                this.data.reminders = this.data.reminders.filter(reminder => 
                    new Date(reminder.created) > cutoffDate
                );
                
                localStorage.setItem('ai_conversations', JSON.stringify(this.data.conversations));
                localStorage.setItem('ai_reminders', JSON.stringify(this.data.reminders));
            }
            
            // ===== PERMISSION MANAGEMENT =====
            
            togglePermission(type) {
                this.permissions[type] = !this.permissions[type];
                this.updateUI();
                this.savePermissions();
                
                if (this.permissions[type]) {
                    this.requestPermission(type);
                } else {
                    this.revokePermission(type);
                }
            }
            
            async requestPermission(type) {
                switch (type) {
                    case 'calendar':
                        await this.requestCalendarAccess();
                        break;
                    case 'contacts':
                        await this.requestContactsAccess();
                        break;
                    case 'calls':
                        await this.requestCallsAccess();
                        break;
                }
            }
            
            revokePermission(type) {
                this.showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} access revoked`, 'info');
                this.logInteraction('permission_revoked', { type });
            }
            
            async requestCalendarAccess() {
                // Simulate calendar access - in real app, this would integrate with calendar APIs
                this.data.calendar = [
                    {
                        id: 1,
                        title: 'Team Meeting',
                        start: new Date(Date.now() + 2 * 3600000), // 2 hours from now
                        end: new Date(Date.now() + 3 * 3600000), // 3 hours from now
                        description: 'Weekly team sync'
                    },
                    {
                        id: 2,
                        title: 'Doctor Appointment',
                        start: new Date(Date.now() + 86400000), // Tomorrow
                        end: new Date(Date.now() + 86400000 + 3600000), // Tomorrow + 1 hour
                        description: 'Regular checkup'
                    },
                    {
                        id: 3,
                        title: 'Project Deadline',
                        start: new Date(Date.now() + 5 * 86400000), // 5 days from now
                        end: new Date(Date.now() + 5 * 86400000), // All day event
                        description: 'Submit final project'
                    }
                ];
                
                this.saveCalendarData();
                this.updateCalendarDisplay();
                this.speak("Calendar access granted. I can now help you manage your schedule.");
                this.showNotification('Calendar access granted successfully', 'success');
                this.logInteraction('permission_granted', { type: 'calendar' });
            }
            
            async requestContactsAccess() {
                // Try to use the modern Contact Picker API first
                if ('contacts' in navigator && 'ContactsManager' in window) {
                    try {
                        const contacts = await navigator.contacts.select(['name', 'tel'], {
                            multiple: true
                        });
                        
                        this.data.contacts = contacts.map(contact => ({
                            name: contact.name[0],
                            phone: contact.tel[0],
                            type: 'Phone',
                            id: Date.now() + Math.random()
                        }));
                    } catch (error) {
                        console.log('Contact Picker not available, using demo data');
                        this.loadDemoContacts();
                    }
                } else {
                    this.loadDemoContacts();
                }
                
                this.saveContactsData();
                this.updateContactsDisplay();
                this.speak("Contacts access granted. I can now help you call and message people.");
                this.showNotification('Contacts access granted successfully', 'success');
                this.logInteraction('permission_granted', { type: 'contacts' });
            }
            
            loadDemoContacts() {
                this.data.contacts = [
                    { id: 1, name: 'John Doe', phone: '+1234567890', type: 'WhatsApp' },
                    { id: 2, name: 'Sarah Smith', phone: '+1234567891', type: 'Phone' },
                    { id: 3, name: 'Mike Johnson', phone: '+1234567892', type: 'WhatsApp' },
                    { id: 4, name: 'Emily Davis', phone: '+1234567893', type: 'Phone' },
                    { id: 5, name: 'David Wilson', phone: '+1234567894', type: 'WhatsApp' }
                ];
            }
            
            async requestCallsAccess() {
                // Simulate call history access
                this.data.calls = [
                    { name: 'Mom', time: '2 hours ago', type: 'Incoming', duration: '15 min' },
                    { name: 'Office', time: 'Yesterday', type: 'Outgoing', duration: '8 min' },
                    { name: 'John Doe', time: '2 days ago', type: 'Outgoing', duration: '22 min' },
                    { name: 'Unknown', time: '3 days ago', type: 'Missed', duration: '0 min' }
                ];
                
                this.speak("Call history access granted. I can now help you with call management.");
                this.showNotification('Call history access granted successfully', 'success');
                this.logInteraction('permission_granted', { type: 'calls' });
            }
        }
        
        // Global variables
        let assistant;
        
        // Initialize the AI Assistant when page loads
        document.addEventListener('DOMContentLoaded', () => {
            assistant = new PersonalAIAssistant();
            
            // Set up main event listeners
            document.getElementById('micButton').addEventListener('click', () => {
                assistant.toggleVoiceRecognition();
            });
            
            document.getElementById('textInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });
        
        // ===== GLOBAL FUNCTIONS =====
        
        function togglePermission(type) {
            assistant.togglePermission(type);
        }
        
        function quickCommand(type) {
            const commands = {
                calendar: "Show my calendar for today",
                contacts: "Show my contacts",
                reminders: "Show my reminders",
                calls: "Show my call history",
                briefing: "Give me a daily briefing",
                help: "What can you help me with?"
            };
            
            assistant.processVoiceCommand(commands[type]);
        }
        
        function sendMessage() {
            const input = document.getElementById('textInput');
            const message = input.value.trim();
            
            if (message) {
                assistant.processVoiceCommand(message);
                input.value = '';
            }
        }
        
        // ===== MODAL FUNCTIONS =====
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            // Load specific modal content
            if (modalId === 'calendarModal') {
                loadCalendarModal();
            } else if (modalId === 'contactsModal') {
                loadContactsModal();
            } else if (modalId === 'remindersModal') {
                loadRemindersModal();
            } else if (modalId === 'settingsModal') {
                loadSettingsModal();
            } else if (modalId === 'analyticsModal') {
                loadAnalyticsModal();
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function loadCalendarModal() {
            const events = assistant.data.calendar;
            const container = document.getElementById('calendarEvents');
            
            if (events.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; opacity: 0.7;">No events scheduled</div>';
                return;
            }
            
            container.innerHTML = events.map(event => {
                const startDate = new Date(event.start);
                const endDate = new Date(event.end);
                return `
                    <div class="calendar-event">
                        <h4>${event.title}</h4>
                        <p>📅 ${startDate.toLocaleDateString()}</p>
                        <p>🕐 ${startDate.toLocaleTimeString()} - ${endDate.toLocaleTimeString()}</p>
                        ${event.description ? `<p>📝 ${event.description}</p>` : ''}
                        <div style="margin-top: 10px;">
                            <button class="mini-btn" onclick="editEvent(${event.id})">✏️ Edit</button>
                            <button class="mini-btn" onclick="deleteEvent(${event.id})">🗑️ Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadContactsModal() {
            const contacts = assistant.data.contacts;
            const container = document.getElementById('contactsList');
            
            if (contacts.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; opacity: 0.7;">No contacts available</div>';
                return;
            }
            
            container.innerHTML = contacts.map(contact => `
                <div class="contact-item">
                    <div class="contact-avatar">${contact.name.charAt(0).toUpperCase()}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold;">${contact.name}</div>
                        <div style="opacity: 0.8; font-size: 0.9rem;">${contact.phone} • ${contact.type}</div>
                    </div>
                    <div>
                        <button class="mini-btn" onclick="callContact('${contact.id}')">📞</button>
                        <button class="mini-btn" onclick="messageContact('${contact.id}')">💬</button>
                        <button class="mini-btn" onclick="deleteContact('${contact.id}')">🗑️</button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadRemindersModal() {
            const reminders = assistant.data.reminders.filter(r => !r.completed);
            const container = document.getElementById('remindersList');
            
            if (reminders.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; opacity: 0.7;">No active reminders</div>';
                return;
            }
            
            container.innerHTML = reminders.map(reminder => {
                const timeStr = new Date(reminder.time).toLocaleString();
                const priorityColor = {
                    urgent: '#ff5722',
                    high: '#ff9800',
                    medium: '#4caf50',
                    low: '#2196f3'
                }[reminder.priority];
                
                return `
                    <div class="reminder-item" style="border-left-color: ${priorityColor};">
                        <div style="font-weight: bold;">${reminder.text}</div>
                        <div style="opacity: 0.8; font-size: 0.9rem;">📅 ${timeStr}</div>
                        <div style="opacity: 0.8; font-size: 0.9rem;">🏷️ ${reminder.priority} priority</div>
                        <div class="reminder-actions">
                            <button class="mini-btn" onclick="completeReminder('${reminder.id}')">✅ Complete</button>
                            <button class="mini-btn" onclick="editReminder('${reminder.id}')">✏️ Edit</button>
                            <button class="mini-btn" onclick="deleteReminder('${reminder.id}')">🗑️ Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadSettingsModal() {
            // Populate settings with current values
            document.getElementById('apiKey').value = assistant.settings.apiKey;
            document.getElementById('aiModel').value = assistant.settings.aiModel;
            document.getElementById('personalityType').value = assistant.settings.personalityType;
            
            // Update toggles
            document.getElementById('voiceToggle').classList.toggle('active', assistant.settings.voiceEnabled);
            document.getElementById('ttsToggle').classList.toggle('active', assistant.settings.ttsEnabled);
            document.getElementById('analyticsToggle').classList.toggle('active', assistant.settings.analyticsEnabled);
            document.getElementById('notificationsToggle').classList.toggle('active', assistant.settings.notificationsEnabled);
        }
        
        function loadAnalyticsModal() {
            const stats = assistant.getUsageStatistics();
            
            document.getElementById('weeklyInteractions').textContent = stats.totalInteractions;
            document.getElementById('monthlyInteractions').textContent = stats.totalInteractions;
            document.getElementById('completedTasks').textContent = assistant.data.reminders.filter(r => r.completed).length;
            document.getElementById('averageResponse').textContent = '250ms';
            
            document.getElementById('mostActiveTime').textContent = `${stats.mostActiveHour}:00 - ${parseInt(stats.mostActiveHour) + 1}:00`;
            document.getElementById('favoriteFeatures').textContent = stats.favoriteFeature;
        }
        
        // ===== CALENDAR FUNCTIONS =====
        
        function connectCalendar(provider) {
            assistant.speak(`Connecting to ${provider} calendar...`);
            assistant.addMessage(`Calendar connection to ${provider} initiated`, 'system');
            assistant.showNotification(`${provider} calendar integration started`, 'info');
            // In a real app, this would initiate OAuth flow
        }
        
        function showAddEventForm() {
            document.getElementById('addEventForm').style.display = 'block';
        }
        
        function addCalendarEvent() {
            const title = document.getElementById('eventTitle').value;
            const start = document.getElementById('eventStart').value;
            const end = document.getElementById('eventEnd').value;
            
            if (title && start) {
                const newEvent = {
                    id: Date.now(),
                    title: title,
                    start: new Date(start),
                    end: end ? new Date(end) : new Date(new Date(start).getTime() + 3600000),
                    description: '',
                    created: new Date()
                };
                
                assistant.data.calendar.push(newEvent);
                assistant.saveCalendarData();
                assistant.updateCalendarDisplay();
                
                document.getElementById('eventTitle').value = '';
                document.getElementById('eventStart').value = '';
                document.getElementById('eventEnd').value = '';
                document.getElementById('addEventForm').style.display = 'none';
                
                assistant.showNotification('Event added successfully', 'success');
                loadCalendarModal();
            }
        }
        
        function editEvent(eventId) {
            assistant.showNotification('Edit functionality would be implemented here', 'info');
        }
        
        function deleteEvent(eventId) {
            assistant.data.calendar = assistant.data.calendar.filter(event => event.id !== eventId);
            assistant.saveCalendarData();
            assistant.updateCalendarDisplay();
            assistant.showNotification('Event deleted', 'success');
            loadCalendarModal();
        }
        
        // ===== CONTACT FUNCTIONS =====
        
        function connectContacts(provider) {
            assistant.speak(`Connecting to ${provider} contacts...`);
            assistant.addMessage(`Contacts connection to ${provider} initiated`, 'system');
            
            if (provider === 'phone') {
                assistant.requestContactsAccess();
            } else {
                assistant.showNotification(`${provider} contacts integration started`, 'info');
            }
        }
        
        function showAddContactForm() {
            document.getElementById('addContactForm').style.display = 'block';
        }
        
        function addContact() {
            const name = document.getElementById('contactName').value;
            const phone = document.getElementById('contactPhone').value;
            const type = document.getElementById('contactType').value;
            
            if (name && phone) {
                const newContact = {
                    id: Date.now(),
                    name: name,
                    phone: phone,
                    type: type,
                    created: new Date()
                };
                
                assistant.data.contacts.push(newContact);
                assistant.saveContactsData();
                assistant.updateContactsDisplay();
                
                document.getElementById('contactName').value = '';
                document.getElementById('contactPhone').value = '';
                document.getElementById('addContactForm').style.display = 'none';
                
                assistant.showNotification('Contact added successfully', 'success');
                loadContactsModal();
            }
        }
        
        function callContact(contactId) {
            const contact = assistant.data.contacts.find(c => c.id == contactId);
            if (contact) {
                assistant.speak(`Calling ${contact.name}`);
                assistant.addMessage(`Initiating call to ${contact.name} at ${contact.phone}`, 'system');
            }
        }
        
        function messageContact(contactId) {
            const contact = assistant.data.contacts.find(c => c.id == contactId);
            if (contact) {
                assistant.speak(`Opening message to ${contact.name}`);
                assistant.addMessage(`Opening WhatsApp chat with ${contact.name}`, 'system');
            }
        }
        
        function deleteContact(contactId) {
            assistant.data.contacts = assistant.data.contacts.filter(contact => contact.id != contactId);
            assistant.saveContactsData();
            assistant.updateContactsDisplay();
            assistant.showNotification('Contact deleted', 'success');
            loadContactsModal();
        }
        
        // ===== REMINDER FUNCTIONS =====
        
        function addReminder() {
            const text = document.getElementById('reminderText').value;
            const time = document.getElementById('reminderTime').value;
            const priority = document.getElementById('reminderPriority').value;
            
            if (text && time) {
                const reminder = {
                    id: Date.now(),
                    text: text,
                    time: new Date(time),
                    priority: priority,
                    created: new Date(),
                    completed: false,
                    notified: false
                };
                
                assistant.data.reminders.push(reminder);
                assistant.saveReminders();
                assistant.updateRemindersDisplay();
                
                document.getElementById('reminderText').value = '';
                document.getElementById('reminderTime').value = '';
                document.getElementById('reminderPriority').value = 'medium';
                
                assistant.speak(`Reminder set for ${text}`);
                assistant.showNotification('Reminder added successfully', 'success');
                loadRemindersModal();
            }
        }
        
        function completeReminder(reminderId) {
            const reminder = assistant.data.reminders.find(r => r.id == reminderId);
            if (reminder) {
                reminder.completed = true;
                assistant.saveReminders();
                assistant.updateRemindersDisplay();
                assistant.showNotification('Reminder completed', 'success');
                loadRemindersModal();
            }
        }
        
        function editReminder(reminderId) {
            assistant.showNotification('Edit functionality would be implemented here', 'info');
        }
        
        function deleteReminder(reminderId) {
            assistant.data.reminders = assistant.data.reminders.filter(reminder => reminder.id != reminderId);
            assistant.saveReminders();
            assistant.updateRemindersDisplay();
            assistant.showNotification('Reminder deleted', 'success');
            loadRemindersModal();
        }
        
        // ===== SETTINGS FUNCTIONS =====
        
        function toggleSetting(setting) {
            const toggle = document.getElementById(`${setting}Toggle`);
            const isActive = toggle.classList.contains('active');
            
            toggle.classList.toggle('active');
            
            switch (setting) {
                case 'voice':
                    assistant.settings.voiceEnabled = !isActive;
                    break;
                case 'tts':
                    assistant.settings.ttsEnabled = !isActive;
                    break;
                case 'analytics':
                    assistant.settings.analyticsEnabled = !isActive;
                    break;
                case 'notifications':
                    assistant.settings.notificationsEnabled = !isActive;
                    break;
                case 'encryption':
                case 'autoBackup':
                    assistant.showNotification(`${setting} ${!isActive ? 'enabled' : 'disabled'}`, 'info');
                    break;
            }
        }
        
        function saveSettings() {
            const apiKey = document.getElementById('apiKey').value;
            const aiModel = document.getElementById('aiModel').value;
            const personalityType = document.getElementById('personalityType').value;
            
            assistant.settings.apiKey = apiKey;
            assistant.settings.aiModel = aiModel;
            assistant.settings.personalityType = personalityType;
            
            assistant.saveSettings();
            assistant.speak('Settings saved successfully');
            assistant.showNotification('Settings saved successfully', 'success');
            closeModal('settingsModal');
        }
        
        function testConnection() {
            if (!assistant.settings.apiKey) {
                assistant.showNotification('Please enter your OpenAI API key first', 'error');
                return;
            }
            
            assistant.speak('Testing AI connection...');
            assistant.getAIResponse('Hello, this is a test message').then(response => {
                assistant.addMessage('AI Connection Test: ' + response, 'system');
                assistant.showNotification('AI connection test successful', 'success');
            }).catch(error => {
                assistant.showNotification('AI connection test failed: ' + error.message, 'error');
            });
        }
        
        // ===== PRIVACY FUNCTIONS =====
        
        function exportData() {
            const data = {
                calendar: assistant.data.calendar,
                contacts: assistant.data.contacts,
                reminders: assistant.data.reminders,
                conversations: assistant.data.conversations,
                analytics: assistant.analytics,
                settings: assistant.settings,
                permissions: assistant.permissions,
                exported: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `personal-ai-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            assistant.showNotification('Data exported successfully', 'success');
        }
        
        function clearData() {
            if (confirm('Are you sure you want to clear all your data? This cannot be undone.')) {
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('ai_')) {
                        localStorage.removeItem(key);
                    }
                });
                
                assistant.showNotification('All data cleared', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            }
        }
        
        function viewDataUsage() {
            const usage = JSON.stringify(assistant.analytics, null, 2).length;
            const dataSize = Math.round(usage / 1024);
            
            assistant.showNotification(`Total data usage: ${dataSize} KB`, 'info');
            assistant.addMessage(`Your personal data is using approximately ${dataSize} KB of local storage.`, 'system');
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });
        
        // Initialize periodic checks
        setInterval(() => {
            if (assistant) {
                assistant.checkReminders();
            }
        }, 60000); // Check every minute
    </script>
</body>
</html>