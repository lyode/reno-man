<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="REFIT MAINTENANCE SERVICES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FFB07A">
    <meta name="msapplication-navbutton-color" content="#FFB07A">
    
    <title>REFIT MAINTENANCE SERVICES - Enhanced Quote Builder</title>
    
    <!-- Enhanced PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, select, textarea, button {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        :root {
            /* Pastel Orange Theme - Light Mode */
            --bg-primary: #fef9f6;
            --bg-secondary: #fff1ea;
            --bg-card: #ffffff;
            --bg-card-hover: #fef7f2;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            
            /* Pastel Orange Button Colors */
            --accent-primary: #FFB07A;
            --accent-secondary: #FFA366;
            --accent-warm: #FF8C42;
            --accent-soft: #FFD4B3;
            --accent-light: #FFF2E6;
            --accent-dark: #E69660;
            
            --border-color: #e2e8f0;
            --shadow-light: rgba(255, 176, 122, 0.15);
            --shadow-medium: rgba(255, 176, 122, 0.25);
            --shadow-strong: rgba(255, 176, 122, 0.35);
            --overlay: rgba(45, 55, 72, 0.8);
            
            /* Status Colors with Orange Tints */
            --success: #FFB07A;
            --warning: #FF8C42;
            --error: #FF6B42;
            --info: #FFA366;
            
            /* Enhanced Category Colors - Pastel Orange Variations */
            --cat-electrical: #FFB07A;
            --cat-plumbing: #FFA366;
            --cat-hvac: #FF8C42;
            --cat-cleaning: #FFD4B3;
            --cat-parts: #E69660;
            --cat-labor: #FF6B42;
            --cat-equipment: #FFCC99;
            --cat-common: #FFE5CC;
            --cat-preliminary: #FF7F50;
            --cat-wall: #FFB366;
            --cat-floor: #FFC299;
            --cat-ceiling: #FFD1B3;
            --cat-roofing: #FF9966;
            --cat-wetwork: #FFE0CC;
            --cat-me-work: #FF8566;
            --cat-exhaust: #FFAD80;
            --cat-lights-fan: #FFC499;
            --cat-ac: #FFD699;
            --cat-paint: #FFE8D9;
            --cat-curtain: #FFB88A;
            --cat-builtin: #FFC7A3;
            --cat-loose: #FFD6B6;
            --cat-sanitary: #FFE5C9;
            --cat-appliances: #FFF4DC;
        }
        
        [data-theme="dark"] {
            /* Pastel Orange Theme - Dark Mode */
            --bg-primary: #1a1411;
            --bg-secondary: #2d241f;
            --bg-card: #3a2f29;
            --bg-card-hover: #453a33;
            --text-primary: #f7e6d7;
            --text-secondary: #e0c4a8;
            --text-muted: #c4a285;
            
            /* Pastel Orange Button Colors - Dark Mode */
            --accent-primary: #FFB07A;
            --accent-secondary: #FFA366;
            --accent-warm: #FF8C42;
            --accent-soft: #CC8A61;
            --accent-light: #B87A56;
            --accent-dark: #E69660;
            
            --border-color: #4a3a2f;
            --shadow-light: rgba(255, 176, 122, 0.1);
            --shadow-medium: rgba(255, 176, 122, 0.2);
            --shadow-strong: rgba(255, 176, 122, 0.3);
            --overlay: rgba(0, 0, 0, 0.9);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        /* Mobile Layout Container */
        .mobile-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 2px 10px var(--shadow-medium);
            border-bottom: 1px solid var(--border-color);
        }
        
        .status-bar .time {
            color: var(--text-primary);
        }
        
        .status-bar .indicators {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }
        
        .theme-toggle {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .theme-toggle:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 4px 20px var(--shadow-medium);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            width: 54px;
            height: 54px;
            background: var(--accent-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 6px 16px var(--shadow-medium);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--accent-secondary);
        }
        
        .app-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--shadow-strong);
            background: var(--accent-secondary);
        }
        
        .app-logo:active {
            transform: scale(0.95);
        }
        
        .logo-svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 4px var(--shadow-light));
        }
        
        .user-logo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 14px;
        }
        
        .app-title h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        
        .app-title p {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.2;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-right .stats {
            text-align: right;
        }
        
        .header-right p {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            box-shadow: 0 2px 8px var(--shadow-light);
            margin-left: 8px;
            position: relative;
        }
        
        .header-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .header-btn:active {
            transform: scale(0.9);
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-warm);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-secondary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 130px 20px 140px;
            -webkit-overflow-scrolling: touch;
            position: relative;
            height: calc(100vh - 44px);
            scroll-behavior: smooth;
        }
        
        .main-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        /* Enhanced Category Management */
        .category-manager {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .category-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow-medium);
            border-color: var(--accent-primary);
        }
        
        .category-card.selected {
            border-color: var(--accent-primary);
            background: var(--accent-light);
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .category-info {
            flex: 1;
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .category-actions {
            display: flex;
            gap: 8px;
        }
        
        .mini-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .mini-btn:hover {
            background: var(--accent-secondary);
            transform: scale(1.1);
        }
        
        .mini-btn.edit { background: var(--accent-primary); }
        .mini-btn.add { background: var(--accent-warm); }
        .mini-btn.select { background: var(--success); }
        
        /* Item List */
        .items-list {
            margin-top: 16px;
        }
        
        .item-row {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .item-row:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-light);
        }
        
        .item-row.selected {
            border-color: var(--accent-primary);
            background: var(--accent-light);
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .item-details {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .item-price {
            font-weight: 700;
            color: var(--accent-primary);
            margin: 0 16px;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .select-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-primary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 12px;
        }
        
        .select-checkbox.checked {
            background: var(--accent-primary);
            color: white;
        }
        
        /* Quote Cart */
        .quote-cart {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: var(--accent-primary);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 25px var(--shadow-strong);
            transition: all 0.2s ease;
            z-index: 80;
        }
        
        .quote-cart:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px var(--shadow-strong);
        }
        
        .quote-cart.hidden {
            display: none;
        }
        
        /* Buttons - All Pastel Orange */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 52px;
            text-decoration: none;
            box-shadow: 0 4px 12px var(--shadow-light);
            background: var(--accent-primary);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            background: var(--accent-secondary);
        }
        
        .btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary { background: var(--accent-primary); }
        .btn-success { background: var(--accent-primary); }
        .btn-danger { background: var(--accent-warm); }
        .btn-warning { background: var(--accent-secondary); }
        .btn-info { background: var(--accent-soft); color: var(--text-primary); }
        .btn-soft { background: var(--accent-soft); color: var(--text-primary); }
        .btn-warm { background: var(--accent-warm); }
        .btn-secondary { background: var(--accent-dark); }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-medium);
            transform: translateY(-2px);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: var(--accent-primary);
        }
        
        /* Action Buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .action-btn {
            padding: 24px 20px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-height: 120px;
            box-shadow: 0 6px 20px var(--shadow-light);
        }
        
        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px var(--shadow-medium);
        }
        
        .action-btn:active {
            transform: scale(0.96);
        }
        
        .action-btn.primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        .action-btn.success { background: linear-gradient(135deg, var(--accent-primary), var(--accent-warm)); }
        .action-btn.warm { background: linear-gradient(135deg, var(--accent-warm), var(--accent-secondary)); }
        .action-btn.soft { background: linear-gradient(135deg, var(--accent-soft), var(--accent-primary)); }
        .action-btn.info { background: linear-gradient(135deg, var(--accent-secondary), var(--accent-dark)); }
        .action-btn.secondary { background: linear-gradient(135deg, var(--accent-dark), var(--accent-primary)); }
        
        .action-btn .icon {
            font-size: 32px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        /* Form Elements */
        .input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .input::placeholder {
            color: var(--text-muted);
        }
        
        .input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 176, 122, 0.2);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px 32px;
            z-index: 100;
            box-shadow: 0 -4px 20px var(--shadow-medium);
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border-radius: 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 60px;
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: var(--accent-light);
            box-shadow: 0 2px 8px var(--shadow-light);
            transform: scale(1.05);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item .icon {
            font-size: 24px;
        }
        
        .home-indicator {
            height: 4px;
            background: var(--accent-primary);
            border-radius: 2px;
            width: 140px;
            margin: 12px auto 0;
            opacity: 0.6;
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: flex-end;
            z-index: 200;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            color: var(--text-primary);
            animation: slideUp 0.3s ease;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            border: 1px solid var(--border-color);
            box-shadow: 0 -8px 40px var(--shadow-strong);
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
        }
        
        .close-btn:hover {
            background: var(--accent-warm);
            color: white;
            transform: scale(1.1);
        }
        
        .close-btn:active {
            transform: scale(0.9);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Form Elements in Modals */
        .form-input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .form-input::placeholder {
            color: var(--text-muted);
        }
        
        .form-input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 176, 122, 0.2);
        }
        
        .form-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .form-btn {
            padding: 18px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 56px;
            box-shadow: 0 4px 12px var(--shadow-light);
            background: var(--accent-primary);
        }
        
        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            background: var(--accent-secondary);
        }
        
        .form-btn:active {
            transform: scale(0.96);
        }
        
        .form-btn.btn-primary { background: var(--accent-primary); }
        .form-btn.btn-secondary { background: var(--accent-dark); }
        .form-btn.btn-danger { background: var(--accent-warm); }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-primary);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 8px 32px var(--shadow-medium);
            z-index: 250;
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        .success-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Quote Review */
        .quote-review {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 8px 32px var(--shadow-light);
        }
        
        .quote-summary {
            background: var(--accent-primary);
            color: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .quote-total {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
        }
        
        .share-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .share-btn {
            padding: 16px 12px;
            border-radius: 12px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
        }
        
        .share-btn.whatsapp { background: #25D366; }
        .share-btn.email { background: #EA4335; }
        .share-btn.telegram { background: #0088CC; }
        .share-btn.copy { background: var(--accent-warm); }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .view {
            padding-top: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .add-btn {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
            box-shadow: 0 8px 24px var(--shadow-medium);
        }
        
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px var(--shadow-strong);
            background: var(--accent-secondary);
        }
        
        .add-btn:active {
            transform: scale(0.9);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        /* Mobile Optimizations */
        @media screen and (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .form-actions {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .share-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Safe area adjustments */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }
        
        /* Print styles */
        @media print {
            .status-bar,
            .bottom-nav,
            .modal {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body class="comfort-mode" data-theme="light">
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="status-time">9:41</div>
            <div class="indicators">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙 Dark</button>
                <span>📶</span>
                <span>📱</span>
                <span>🔋</span>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="app-logo" onclick="openLogoSelector()" id="main-logo">
                        <!-- Default Professional Maintenance Tool Icon -->
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="50" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="app-title">
                        <h1 id="company-name">REFIT MAINTENANCE SERVICES</h1>
                        <p id="company-registration">Registration No: 201803348973<br>(002894203-V)</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="stats">
                    <p id="current-date">Today</p>
                    <p id="daily-revenue">RM 0.00</p>
                </div>
                <button class="header-btn" onclick="openQuoteCart()" title="Quote Cart">
                    🛒
                    <span class="cart-badge" id="cart-badge">0</span>
                </button>
                <button class="header-btn" onclick="exportData()" title="Export Data">
                    📤
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="total-quotes-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Quote Items</div>
                        <div class="stat-value" id="total-items-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-value" id="today-revenue">RM 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="total-revenue">RM 0</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">🍑 Enhanced Quote Builder</h3>
                    <div class="actions-grid">
                        <button class="action-btn primary" onclick="showView('categories')">
                            <span class="icon">🏗️</span>
                            <span style="font-weight: 700;">Category Builder</span>
                        </button>
                        <button class="action-btn success" onclick="showView('quotes')">
                            <span class="icon">💰</span>
                            <span style="font-weight: 700;">Saved Quotes</span>
                        </button>
                        <button class="action-btn warm" onclick="openQuoteCart()">
                            <span class="icon">🛒</span>
                            <span style="font-weight: 700;">Quote Cart</span>
                        </button>
                        <button class="action-btn info" onclick="exportData()">
                            <span class="icon">📤</span>
                            <span style="font-weight: 700;">Export Data</span>
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">Recent Activity</h3>
                    <div id="recent-activity"></div>
                </div>
            </div>

            <!-- Categories View -->
            <div id="categories-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Category Builder</h2>
                    <button class="add-btn" onclick="openCategoryForm()">
                        <span>➕</span>
                    </button>
                </div>

                <div class="category-manager">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="font-weight: 700; color: var(--text-primary);">🏗️ Manage Categories & Items</h3>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-soft" onclick="selectAllCategories()">Select All</button>
                            <button class="btn btn-secondary" onclick="clearAllSelections()">Clear All</button>
                        </div>
                    </div>
                    
                    <div class="category-grid" id="categories-grid">
                        <!-- Categories will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Quotes View -->
            <div id="quotes-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Saved Quotes</h2>
                    <button class="add-btn" onclick="showView('categories')">
                        <span>🏗️</span>
                    </button>
                </div>

                <div id="quotes-list"></div>
            </div>
        </div>

        <!-- Quote Cart Floating Button -->
        <div class="quote-cart" id="quote-cart-btn" onclick="openQuoteCart()">
            🛒
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="icon">🏠</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="showView('categories')">
                    <span class="icon">🏗️</span>
                    <span>Builder</span>
                </div>
                <div class="nav-item" onclick="showView('quotes')">
                    <span class="icon">💰</span>
                    <span>Quotes</span>
                </div>
                <div class="nav-item" onclick="openQuoteCart()">
                    <span class="icon">🛒</span>
                    <span>Cart</span>
                </div>
            </div>
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- Category Form Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="category-modal-title">➕ Add Category</h3>
                <button class="close-btn" onclick="closeCategoryForm()">✕</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <input type="text" class="form-input" placeholder="Category Name *" id="category-name" required>
                    <textarea class="form-input" placeholder="Description" id="category-description" rows="2" style="resize: none;"></textarea>
                    <input type="text" class="form-input" placeholder="Icon (emoji or text)" id="category-icon" value="🏷️">
                    <input type="color" class="form-input" id="category-color" value="#FFB07A">
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn btn-primary">Save Category</button>
                        <button type="button" class="form-btn btn-secondary" onclick="closeCategoryForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Item Form Modal -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="item-modal-title">➕ Add Item</h3>
                <button class="close-btn" onclick="closeItemForm()">✕</button>
            </div>
            <div class="modal-body">
                <form id="item-form">
                    <input type="text" class="form-input" placeholder="Item Name *" id="item-name" required>
                    <textarea class="form-input" placeholder="Description" id="item-description" rows="2" style="resize: none;"></textarea>
                    <input type="number" class="form-input" placeholder="Price (RM) *" id="item-price" step="0.01" required>
                    <select class="form-input" id="item-unit">
                        <option value="pcs">Pieces (pcs)</option>
                        <option value="hours">Hours</option>
                        <option value="sqft">Square Feet</option>
                        <option value="sqm">Square Meters</option>
                        <option value="meters">Meters</option>
                        <option value="kg">Kilograms</option>
                        <option value="liters">Liters</option>
                        <option value="set">Set</option>
                        <option value="lot">Lot</option>
                        <option value="service">Service</option>
                    </select>
                    <input type="hidden" id="item-category-id">
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn btn-primary">Save Item</button>
                        <button type="button" class="form-btn btn-secondary" onclick="closeItemForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quote Cart Modal -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🛒 Quote Cart</h3>
                <button class="close-btn" onclick="closeQuoteCart()">✕</button>
            </div>
            <div class="modal-body">
                <div id="cart-items"></div>
                
                <div class="quote-summary" id="cart-summary">
                    <div class="quote-total" id="cart-total">RM 0.00</div>
                    <div>Total Quote Amount</div>
                </div>
                
                <div style="margin: 20px 0;">
                    <input type="text" class="form-input" placeholder="Quote Title/Project Name" id="quote-title">
                    <textarea class="form-input" placeholder="Additional Notes" id="quote-notes" rows="3" style="resize: none;"></textarea>
                </div>
                
                <div class="form-actions">
                    <button class="form-btn btn-primary" onclick="reviewQuote()">📋 Review Quote</button>
                    <button class="form-btn btn-danger" onclick="clearCart()">🗑️ Clear Cart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quote Review Modal -->
    <div id="review-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📋 Quote Review</h3>
                <button class="close-btn" onclick="closeQuoteReview()">✕</button>
            </div>
            <div class="modal-body">
                <div class="quote-review" id="quote-review-content">
                    <!-- Review content will be populated here -->
                </div>
                
                <div class="form-actions">
                    <button class="form-btn btn-primary" onclick="generatePDF()">📄 Generate PDF</button>
                    <button class="form-btn btn-success" onclick="saveQuote()">💾 Save Quote</button>
                </div>
                
                <div class="share-buttons">
                    <button class="share-btn whatsapp" onclick="shareWhatsApp()">
                        <span style="font-size: 20px;">📱</span>
                        <span>WhatsApp</span>
                    </button>
                    <button class="share-btn email" onclick="shareEmail()">
                        <span style="font-size: 20px;">📧</span>
                        <span>Email</span>
                    </button>
                    <button class="share-btn telegram" onclick="shareTelegram()">
                        <span style="font-size: 20px;">✈️</span>
                        <span>Telegram</span>
                    </button>
                    <button class="share-btn copy" onclick="copyQuote()">
                        <span style="font-size: 20px;">📋</span>
                        <span>Copy Text</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        ✅ Data saved successfully!
    </div>

    <script>
        // ========================================
        // REFIT MAINTENANCE SERVICES - ENHANCED QUOTE BUILDER
        // Registration No: 201803348973 (002894203-V)
        // Complete Category & Item Management System
        // ========================================
        
        // App State Variables
        var currentView = 'dashboard';
        var categories = [];
        var savedQuotes = [];
        var selectedItems = [];
        var editingCategory = null;
        var editingItem = null;
        var currentTheme = 'light';

        // Default Categories with Enhanced Structure
        var defaultCategories = [
            {
                id: 'preliminary',
                name: 'Preliminary Work',
                description: 'Site preparation and preliminary construction work',
                icon: '🏗️',
                color: '#FF7F50',
                items: [
                    { id: 'p1', name: 'Site Survey & Assessment', description: 'Initial site evaluation and condition assessment', price: 250.00, unit: 'service' },
                    { id: 'p2', name: 'Protective Covering', description: 'Floor and furniture protection during work', price: 120.00, unit: 'service' },
                    { id: 'p3', name: 'Selective Demolition', description: 'Careful removal of existing structures', price: 85.00, unit: 'sqm' },
                    { id: 'p4', name: 'Site Cleanup', description: 'Construction debris removal and cleaning', price: 45.00, unit: 'hours' }
                ]
            },
            {
                id: 'wall',
                name: 'Wall Work',
                description: 'Wall construction, renovation and finishing',
                icon: '🧱',
                color: '#FFB366',
                items: [
                    { id: 'w1', name: 'Drywall Installation', description: 'Standard drywall installation with finishing', price: 35.00, unit: 'sqm' },
                    { id: 'w2', name: 'Partition Wall Construction', description: 'Metal stud partition wall with drywall', price: 65.00, unit: 'sqm' },
                    { id: 'w3', name: 'Wall Patching & Repair', description: 'Minor wall damage repair and patching', price: 25.00, unit: 'sqm' },
                    { id: 'w4', name: 'Wall Texture Finishing', description: 'Decorative wall texture application', price: 18.00, unit: 'sqm' }
                ]
            },
            {
                id: 'floor',
                name: 'Floor Work',
                description: 'Flooring installation and finishing',
                icon: '🏢',
                color: '#FFC299',
                items: [
                    { id: 'f1', name: 'Vinyl Flooring Installation', description: 'Commercial grade vinyl flooring', price: 45.00, unit: 'sqm' },
                    { id: 'f2', name: 'Carpet Installation', description: 'Commercial carpet with padding', price: 55.00, unit: 'sqm' },
                    { id: 'f3', name: 'Ceramic Tile Installation', description: 'Floor tile installation with grouting', price: 68.00, unit: 'sqm' },
                    { id: 'f4', name: 'Hardwood Flooring', description: 'Engineered hardwood flooring installation', price: 95.00, unit: 'sqm' }
                ]
            },
            {
                id: 'ceiling',
                name: 'Ceiling Work',
                description: 'Ceiling installation and finishing',
                icon: '🏠',
                color: '#FFD1B3',
                items: [
                    { id: 'c1', name: 'Suspended Ceiling Installation', description: 'Mineral fiber suspended ceiling system', price: 42.00, unit: 'sqm' },
                    { id: 'c2', name: 'Drywall Ceiling', description: 'Drywall ceiling installation and finishing', price: 38.00, unit: 'sqm' },
                    { id: 'c3', name: 'Ceiling Repair', description: 'Water damage and crack repair', price: 35.00, unit: 'sqm' },
                    { id: 'c4', name: 'Ceiling Insulation', description: 'Thermal insulation installation', price: 22.00, unit: 'sqm' }
                ]
            },
            {
                id: 'electrical',
                name: 'Electrical Work',
                description: 'Electrical systems and installations',
                icon: '⚡',
                color: '#FFB07A',
                items: [
                    { id: 'e1', name: 'Power Outlet Installation', description: 'Standard 13A power outlet', price: 45.00, unit: 'pcs' },
                    { id: 'e2', name: 'Light Switch Installation', description: 'Standard wall light switch', price: 35.00, unit: 'pcs' },
                    { id: 'e3', name: 'LED Panel Light', description: '40W LED panel light with driver', price: 85.00, unit: 'pcs' },
                    { id: 'e4', name: 'Electrical Safety Inspection', description: 'Complete electrical system safety check', price: 150.00, unit: 'service' }
                ]
            },
            {
                id: 'plumbing',
                name: 'Plumbing Work',
                description: 'Water systems and pipe installations',
                icon: '🔧',
                color: '#FFA366',
                items: [
                    { id: 'pl1', name: 'Pipe Repair Service', description: 'Water pipe leak repair', price: 65.00, unit: 'service' },
                    { id: 'pl2', name: 'Faucet Installation', description: 'Kitchen or bathroom faucet installation', price: 85.00, unit: 'pcs' },
                    { id: 'pl3', name: 'Toilet Installation', description: 'Complete toilet installation', price: 150.00, unit: 'pcs' },
                    { id: 'pl4', name: 'Water Heater Installation', description: 'Electric water heater installation', price: 280.00, unit: 'pcs' }
                ]
            }
        ];

        // Storage Keys
        var STORAGE_KEYS = {
            CATEGORIES: 'refit_enhanced_categories',
            SAVED_QUOTES: 'refit_enhanced_saved_quotes',
            SELECTED_ITEMS: 'refit_enhanced_selected_items',
            THEME_PREFERENCE: 'refit_theme_preference'
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadThemePreference();
            loadDataFromStorage();
            setupEventListeners();
            setupMobileOptimizations();
            updateStatusBar();
            updateCurrentDate();
            updateStats();
            renderViews();
            updateCartBadge();
            
            showSuccessMessage('🍑 REFIT Enhanced Quote Builder Ready!');
            console.log('🏗️ REFIT MAINTENANCE SERVICES - Enhanced Quote Builder');
            console.log('🍑 Beautiful Pastel Orange Theme');
            console.log('📋 Complete Category & Item Management');
            console.log('🛒 Advanced Quote Cart System');
            console.log('📄 PDF Generation & Sharing');
        }

        // Theme Management
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#FFB07A' : '#1a1411';
            }
            
            saveDataToStorage();
            showSuccessMessage(currentTheme === 'light' ? '☀️ Light mode activated' : '🌙 Dark mode activated');
        }

        function loadThemePreference() {
            var savedTheme = localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE) || 'light';
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? '🌙 Dark' : '☀️ Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#FFB07A' : '#1a1411';
            }
        }

        // Data Management
        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(categories));
                localStorage.setItem(STORAGE_KEYS.SAVED_QUOTES, JSON.stringify(savedQuotes));
                localStorage.setItem(STORAGE_KEYS.SELECTED_ITEMS, JSON.stringify(selectedItems));
                localStorage.setItem(STORAGE_KEYS.THEME_PREFERENCE, currentTheme);
            } catch (e) {
                console.warn('Storage error:', e);
                showSuccessMessage('⚠️ Storage full! Please export data.');
            }
        }

        function loadDataFromStorage() {
            try {
                var savedCategories = localStorage.getItem(STORAGE_KEYS.CATEGORIES);
                if (savedCategories) {
                    categories = JSON.parse(savedCategories);
                } else {
                    categories = [...defaultCategories];
                    saveDataToStorage();
                }

                var savedQuotesData = localStorage.getItem(STORAGE_KEYS.SAVED_QUOTES);
                if (savedQuotesData) {
                    savedQuotes = JSON.parse(savedQuotesData);
                }

                var savedSelectedItems = localStorage.getItem(STORAGE_KEYS.SELECTED_ITEMS);
                if (savedSelectedItems) {
                    selectedItems = JSON.parse(savedSelectedItems);
                }
            } catch (e) {
                console.warn('Load error:', e);
                categories = [...defaultCategories];
                saveDataToStorage();
            }
        }

        // Category Management
        function openCategoryForm(categoryId = null) {
            editingCategory = categoryId;
            
            if (categoryId) {
                var category = categories.find(c => c.id === categoryId);
                if (category) {
                    document.getElementById('category-modal-title').textContent = '✏️ Edit Category';
                    document.getElementById('category-name').value = category.name;
                    document.getElementById('category-description').value = category.description || '';
                    document.getElementById('category-icon').value = category.icon;
                    document.getElementById('category-color').value = category.color;
                }
            } else {
                document.getElementById('category-modal-title').textContent = '➕ Add Category';
                document.getElementById('category-form').reset();
                document.getElementById('category-color').value = '#FFB07A';
                document.getElementById('category-icon').value = '🏷️';
            }
            
            document.getElementById('category-modal').classList.add('show');
        }

        function closeCategoryForm() {
            document.getElementById('category-modal').classList.remove('show');
            editingCategory = null;
        }

        function handleCategorySubmit(e) {
            e.preventDefault();
            
            var name = document.getElementById('category-name').value.trim();
            var description = document.getElementById('category-description').value.trim();
            var icon = document.getElementById('category-icon').value.trim();
            var color = document.getElementById('category-color').value;
            
            if (!name) {
                showSuccessMessage('⚠️ Please enter a category name!');
                return;
            }
            
            var categoryData = {
                id: editingCategory || generateId(),
                name: name,
                description: description,
                icon: icon || '🏷️',
                color: color,
                items: editingCategory ? categories.find(c => c.id === editingCategory).items : []
            };
            
            if (editingCategory) {
                var index = categories.findIndex(c => c.id === editingCategory);
                if (index !== -1) {
                    categories[index] = categoryData;
                }
                showSuccessMessage('🍑 Category updated successfully!');
            } else {
                categories.push(categoryData);
                showSuccessMessage('🍑 Category added successfully!');
            }
            
            closeCategoryForm();
            saveDataToStorage();
            renderViews();
        }

        function deleteCategory(categoryId) {
            var category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            if (confirm('Delete category "' + category.name + '" and all its items?\nThis action cannot be undone.')) {
                // Remove selected items from this category
                selectedItems = selectedItems.filter(item => item.categoryId !== categoryId);
                
                // Remove category
                categories = categories.filter(c => c.id !== categoryId);
                
                saveDataToStorage();
                renderViews();
                updateCartBadge();
                showSuccessMessage('🗑️ Category deleted successfully');
            }
        }

        // Item Management
        function openItemForm(categoryId, itemId = null) {
            editingItem = itemId;
            document.getElementById('item-category-id').value = categoryId;
            
            if (itemId) {
                var category = categories.find(c => c.id === categoryId);
                var item = category ? category.items.find(i => i.id === itemId) : null;
                
                if (item) {
                    document.getElementById('item-modal-title').textContent = '✏️ Edit Item';
                    document.getElementById('item-name').value = item.name;
                    document.getElementById('item-description').value = item.description || '';
                    document.getElementById('item-price').value = item.price;
                    document.getElementById('item-unit').value = item.unit;
                }
            } else {
                document.getElementById('item-modal-title').textContent = '➕ Add Item';
                document.getElementById('item-form').reset();
                document.getElementById('item-category-id').value = categoryId;
            }
            
            document.getElementById('item-modal').classList.add('show');
        }

        function closeItemForm() {
            document.getElementById('item-modal').classList.remove('show');
            editingItem = null;
        }

        function handleItemSubmit(e) {
            e.preventDefault();
            
            var categoryId = document.getElementById('item-category-id').value;
            var name = document.getElementById('item-name').value.trim();
            var description = document.getElementById('item-description').value.trim();
            var price = parseFloat(document.getElementById('item-price').value);
            var unit = document.getElementById('item-unit').value;
            
            if (!name || !price) {
                showSuccessMessage('⚠️ Please fill in all required fields!');
                return;
            }
            
            var category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            var itemData = {
                id: editingItem || generateId(),
                name: name,
                description: description,
                price: price,
                unit: unit
            };
            
            if (editingItem) {
                var index = category.items.findIndex(i => i.id === editingItem);
                if (index !== -1) {
                    category.items[index] = itemData;
                }
                showSuccessMessage('🍑 Item updated successfully!');
            } else {
                category.items.push(itemData);
                showSuccessMessage('🍑 Item added successfully!');
            }
            
            closeItemForm();
            saveDataToStorage();
            renderViews();
        }

        function deleteItem(categoryId, itemId) {
            var category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            var item = category.items.find(i => i.id === itemId);
            if (!item) return;
            
            if (confirm('Delete item "' + item.name + '"?\nThis action cannot be undone.')) {
                // Remove from selected items
                selectedItems = selectedItems.filter(si => !(si.categoryId === categoryId && si.itemId === itemId));
                
                // Remove from category
                category.items = category.items.filter(i => i.id !== itemId);
                
                saveDataToStorage();
                renderViews();
                updateCartBadge();
                showSuccessMessage('🗑️ Item deleted successfully');
            }
        }

        // Selection Management
        function toggleItemSelection(categoryId, itemId) {
            var existingIndex = selectedItems.findIndex(si => si.categoryId === categoryId && si.itemId === itemId);
            
            if (existingIndex !== -1) {
                selectedItems.splice(existingIndex, 1);
                showSuccessMessage('🍑 Item removed from cart');
            } else {
                var category = categories.find(c => c.id === categoryId);
                var item = category ? category.items.find(i => i.id === itemId) : null;
                
                if (item) {
                    selectedItems.push({
                        categoryId: categoryId,
                        itemId: itemId,
                        quantity: 1,
                        categoryName: category.name,
                        categoryIcon: category.icon,
                        itemName: item.name,
                        itemDescription: item.description,
                        itemPrice: item.price,
                        itemUnit: item.unit
                    });
                    showSuccessMessage('🍑 Item added to cart');
                }
            }
            
            saveDataToStorage();
            renderViews();
            updateCartBadge();
        }

        function selectAllCategories() {
            for (var category of categories) {
                for (var item of category.items) {
                    var existingIndex = selectedItems.findIndex(si => si.categoryId === category.id && si.itemId === item.id);
                    if (existingIndex === -1) {
                        selectedItems.push({
                            categoryId: category.id,
                            itemId: item.id,
                            quantity: 1,
                            categoryName: category.name,
                            categoryIcon: category.icon,
                            itemName: item.name,
                            itemDescription: item.description,
                            itemPrice: item.price,
                            itemUnit: item.unit
                        });
                    }
                }
            }
            
            saveDataToStorage();
            renderViews();
            updateCartBadge();
            showSuccessMessage('🍑 All items selected!');
        }

        function clearAllSelections() {
            selectedItems = [];
            saveDataToStorage();
            renderViews();
            updateCartBadge();
            showSuccessMessage('🗑️ All selections cleared');
        }

        // Quote Cart Management
        function openQuoteCart() {
            renderCartItems();
            document.getElementById('cart-modal').classList.add('show');
        }

        function closeQuoteCart() {
            document.getElementById('cart-modal').classList.remove('show');
        }

        function renderCartItems() {
            var container = document.getElementById('cart-items');
            var totalElement = document.getElementById('cart-total');
            
            if (selectedItems.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">🛒</div>' +
                    '<p style="font-weight: 600;">Cart is empty</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Select items from categories to build your quote</p>' +
                    '</div>';
                totalElement.textContent = 'RM 0.00';
                return;
            }
            
            var total = 0;
            var html = '';
            
            for (var i = 0; i < selectedItems.length; i++) {
                var item = selectedItems[i];
                var itemTotal = item.quantity * item.itemPrice;
                total += itemTotal;
                
                html += '<div class="item-row">' +
                    '<div class="item-info">' +
                    '<div class="item-name">' + item.categoryIcon + ' ' + item.itemName + '</div>' +
                    '<div class="item-details">' + item.categoryName + ' • ' + item.itemDescription + '</div>' +
                    '</div>' +
                    '<div style="display: flex; align-items: center; gap: 12px;">' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<button class="mini-btn" onclick="updateItemQuantity(' + i + ', -1)">-</button>' +
                    '<span style="font-weight: 700; min-width: 30px; text-align: center;">' + item.quantity + '</span>' +
                    '<button class="mini-btn" onclick="updateItemQuantity(' + i + ', 1)">+</button>' +
                    '</div>' +
                    '<div class="item-price">RM ' + itemTotal.toFixed(2) + '</div>' +
                    '<button class="mini-btn" style="background: var(--accent-warm);" onclick="removeFromCart(' + i + ')">🗑️</button>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
            totalElement.textContent = 'RM ' + total.toFixed(2);
        }

        function updateItemQuantity(index, change) {
            if (index >= 0 && index < selectedItems.length) {
                selectedItems[index].quantity = Math.max(1, selectedItems[index].quantity + change);
                saveDataToStorage();
                renderCartItems();
                updateCartBadge();
            }
        }

        function removeFromCart(index) {
            if (index >= 0 && index < selectedItems.length) {
                selectedItems.splice(index, 1);
                saveDataToStorage();
                renderCartItems();
                renderViews();
                updateCartBadge();
                showSuccessMessage('🗑️ Item removed from cart');
            }
        }

        function clearCart() {
            if (selectedItems.length === 0) return;
            
            if (confirm('Clear all items from cart?')) {
                selectedItems = [];
                saveDataToStorage();
                renderCartItems();
                renderViews();
                updateCartBadge();
                showSuccessMessage('🗑️ Cart cleared');
            }
        }

        function updateCartBadge() {
            var badge = document.getElementById('cart-badge');
            var cartBtn = document.getElementById('quote-cart-btn');
            
            if (badge) {
                badge.textContent = selectedItems.length;
                badge.style.display = selectedItems.length > 0 ? 'flex' : 'none';
            }
            
            if (cartBtn) {
                cartBtn.classList.toggle('hidden', selectedItems.length === 0);
            }
        }

        // Quote Review and Generation
        function reviewQuote() {
            if (selectedItems.length === 0) {
                showSuccessMessage('⚠️ Please add items to cart first!');
                return;
            }
            
            closeQuoteCart();
            renderQuoteReview();
            document.getElementById('review-modal').classList.add('show');
        }

        function closeQuoteReview() {
            document.getElementById('review-modal').classList.remove('show');
        }

        function renderQuoteReview() {
            var container = document.getElementById('quote-review-content');
            var total = 0;
            
            // Group items by category
            var groupedItems = {};
            for (var item of selectedItems) {
                if (!groupedItems[item.categoryId]) {
                    groupedItems[item.categoryId] = {
                        name: item.categoryName,
                        icon: item.categoryIcon,
                        items: []
                    };
                }
                groupedItems[item.categoryId].items.push(item);
                total += item.quantity * item.itemPrice;
            }
            
            var html = '<div style="background: var(--bg-secondary); border-radius: 16px; padding: 20px; margin-bottom: 20px;">' +
                '<h3 style="color: var(--text-primary); margin-bottom: 16px;">📋 Quote Summary</h3>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;">' +
                '<div><strong>Total Items:</strong> ' + selectedItems.length + '</div>' +
                '<div><strong>Categories:</strong> ' + Object.keys(groupedItems).length + '</div>' +
                '<div><strong>Quote Date:</strong> ' + new Date().toLocaleDateString() + '</div>' +
                '<div><strong>Total Amount:</strong> <span style="color: var(--accent-primary); font-weight: 700;">RM ' + total.toFixed(2) + '</span></div>' +
                '</div>' +
                '</div>';
            
            // Render items by category
            for (var categoryId in groupedItems) {
                var categoryGroup = groupedItems[categoryId];
                var categoryTotal = 0;
                
                for (var item of categoryGroup.items) {
                    categoryTotal += item.quantity * item.itemPrice;
                }
                
                html += '<div style="margin-bottom: 20px; border-radius: 12px; border: 2px solid var(--accent-primary); overflow: hidden;">' +
                    '<div style="background: var(--accent-primary); color: white; padding: 16px; display: flex; justify-content: space-between; align-items: center;">' +
                    '<div style="display: flex; align-items: center; gap: 12px; font-weight: 700;">' +
                    '<span style="font-size: 20px;">' + categoryGroup.icon + '</span>' +
                    '<span>' + categoryGroup.name + '</span>' +
                    '</div>' +
                    '<span style="font-weight: 700;">RM ' + categoryTotal.toFixed(2) + '</span>' +
                    '</div>' +
                    '<div style="background: var(--bg-card); padding: 16px;">';
                
                for (var item of categoryGroup.items) {
                    var itemTotal = item.quantity * item.itemPrice;
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color);">' +
                        '<div>' +
                        '<div style="font-weight: 700; color: var(--text-primary);">' + item.itemName + '</div>' +
                        '<div style="font-size: 12px; color: var(--text-muted);">' + item.itemDescription + '</div>' +
                        '</div>' +
                        '<div style="text-align: right;">' +
                        '<div style="font-size: 12px; color: var(--text-muted);">' + item.quantity + ' ' + item.itemUnit + ' × RM ' + item.itemPrice.toFixed(2) + '</div>' +
                        '<div style="font-weight: 700; color: var(--accent-primary);">RM ' + itemTotal.toFixed(2) + '</div>' +
                        '</div>' +
                        '</div>';
                }
                
                html += '</div></div>';
            }
            
            container.innerHTML = html;
        }

        function generatePDF() {
            showSuccessMessage('🍑 Generating professional PDF quote...');
            
            // Create PDF content
            var { jsPDF } = window.jspdf;
            var doc = new jsPDF();
            
            // Company Header
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text('REFIT MAINTENANCE SERVICES', 20, 25);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Registration No: 201803348973 (002894203-V)', 20, 35);
            doc.text('Professional Maintenance Solutions', 20, 42);
            
            // Quote Details
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('QUOTATION', 20, 60);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Date: ' + new Date().toLocaleDateString(), 20, 70);
            doc.text('Quote #: QT-' + Date.now(), 20, 78);
            
            var title = document.getElementById('quote-title').value.trim();
            if (title) {
                doc.text('Project: ' + title, 20, 86);
            }
            
            // Items
            var yPos = 100;
            var total = 0;
            
            doc.setFont(undefined, 'bold');
            doc.text('No.', 20, yPos);
            doc.text('Description', 35, yPos);
            doc.text('Qty', 120, yPos);
            doc.text('Unit', 140, yPos);
            doc.text('Price (RM)', 160, yPos);
            doc.text('Total (RM)', 185, yPos);
            
            yPos += 8;
            doc.line(20, yPos, 200, yPos);
            yPos += 5;
            
            doc.setFont(undefined, 'normal');
            
            for (var i = 0; i < selectedItems.length; i++) {
                var item = selectedItems[i];
                var itemTotal = item.quantity * item.itemPrice;
                total += itemTotal;
                
                doc.text((i + 1).toString(), 20, yPos);
                doc.text(item.itemName, 35, yPos);
                doc.text(item.quantity.toString(), 120, yPos);
                doc.text(item.itemUnit, 140, yPos);
                doc.text(item.itemPrice.toFixed(2), 160, yPos);
                doc.text(itemTotal.toFixed(2), 185, yPos);
                
                yPos += 6;
                
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
            }
            
            // Total
            yPos += 5;
            doc.line(20, yPos, 200, yPos);
            yPos += 8;
            
            doc.setFont(undefined, 'bold');
            doc.text('TOTAL: RM ' + total.toFixed(2), 160, yPos);
            
            // Footer
            yPos += 20;
            doc.setFontSize(8);
            doc.setFont(undefined, 'normal');
            doc.text('Terms & Conditions:', 20, yPos);
            doc.text('1. Prices are valid for 30 days from quote date', 20, yPos + 6);
            doc.text('2. Payment terms: 50% deposit, balance upon completion', 20, yPos + 12);
            doc.text('3. All work comes with 12 months warranty', 20, yPos + 18);
            
            // Save PDF
            var filename = 'REFIT_Quote_' + new Date().toISOString().split('T')[0] + '.pdf';
            doc.save(filename);
            
            showSuccessMessage('🍑 PDF generated successfully!');
        }

        function saveQuote() {
            var title = document.getElementById('quote-title').value.trim() || 'Quote #' + Date.now();
            var notes = document.getElementById('quote-notes').value.trim();
            
            var total = 0;
            for (var item of selectedItems) {
                total += item.quantity * item.itemPrice;
            }
            
            var quote = {
                id: Date.now(),
                title: title,
                notes: notes,
                items: [...selectedItems],
                total: total,
                createdAt: new Date().toISOString()
            };
            
            savedQuotes.push(quote);
            saveDataToStorage();
            
            // Clear cart and close modals
            selectedItems = [];
            saveDataToStorage();
            updateCartBadge();
            
            closeQuoteReview();
            renderViews();
            
            showSuccessMessage('💾 Quote saved successfully!');
        }

        // Share Functions
        function shareWhatsApp() {
            var quoteText = generateQuoteText();
            var url = 'https://wa.me/?text=' + encodeURIComponent(quoteText);
            window.open(url, '_blank');
        }

        function shareEmail() {
            var quoteText = generateQuoteText();
            var subject = 'Quotation from REFIT MAINTENANCE SERVICES';
            var url = 'mailto:?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(quoteText);
            window.open(url);
        }

        function shareTelegram() {
            var quoteText = generateQuoteText();
            var url = 'https://t.me/share/url?text=' + encodeURIComponent(quoteText);
            window.open(url, '_blank');
        }

        function copyQuote() {
            var quoteText = generateQuoteText();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(quoteText).then(function() {
                    showSuccessMessage('📋 Quote copied to clipboard!');
                });
            } else {
                // Fallback for older browsers
                var textArea = document.createElement('textarea');
                textArea.value = quoteText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showSuccessMessage('📋 Quote copied to clipboard!');
            }
        }

        function generateQuoteText() {
            var title = document.getElementById('quote-title').value.trim() || 'Quotation';
            var notes = document.getElementById('quote-notes').value.trim();
            
            var text = '🍑 REFIT MAINTENANCE SERVICES\n';
            text += 'Registration No: 201803348973 (002894203-V)\n';
            text += 'Professional Maintenance Solutions\n\n';
            text += '📋 ' + title.toUpperCase() + '\n';
            text += 'Date: ' + new Date().toLocaleDateString() + '\n';
            text += 'Quote #: QT-' + Date.now() + '\n\n';
            
            if (notes) {
                text += 'Notes: ' + notes + '\n\n';
            }
            
            text += '--- QUOTE DETAILS ---\n\n';
            
            var total = 0;
            for (var i = 0; i < selectedItems.length; i++) {
                var item = selectedItems[i];
                var itemTotal = item.quantity * item.itemPrice;
                total += itemTotal;
                
                text += (i + 1) + '. ' + item.itemName + '\n';
                text += '   Category: ' + item.categoryName + '\n';
                text += '   Quantity: ' + item.quantity + ' ' + item.itemUnit + '\n';
                text += '   Price: RM ' + item.itemPrice.toFixed(2) + '\n';
                text += '   Total: RM ' + itemTotal.toFixed(2) + '\n\n';
            }
            
            text += '--- SUMMARY ---\n';
            text += 'Total Items: ' + selectedItems.length + '\n';
            text += 'TOTAL AMOUNT: RM ' + total.toFixed(2) + '\n\n';
            
            text += '--- TERMS & CONDITIONS ---\n';
            text += '• Prices valid for 30 days\n';
            text += '• Payment: 50% deposit, balance on completion\n';
            text += '• 12 months warranty included\n\n';
            
            text += 'Thank you for choosing REFIT MAINTENANCE SERVICES! 🍑';
            
            return text;
        }

        // View Management
        function showView(viewName) {
            currentView = viewName;
            
            // Hide all views
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) {
                views[i].classList.add('hidden');
            }
            
            // Show selected view
            var targetView = document.getElementById(viewName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            // Update navigation
            var navItems = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navItems.length; i++) {
                navItems[i].classList.remove('active');
            }
            
            var activeNav = document.querySelector('.nav-item[onclick*="' + viewName + '"]');
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            renderViews();
        }

        function renderViews() {
            switch(currentView) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'categories':
                    renderCategories();
                    break;
                case 'quotes':
                    renderSavedQuotes();
                    break;
            }
        }

        function renderDashboard() {
            updateStats();
            renderRecentActivity();
        }

        function renderCategories() {
            var container = document.getElementById('categories-grid');
            if (!container) return;
            
            if (categories.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">🏗️</div>' +
                    '<p style="font-weight: 600;">No categories found</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create your first category to get started</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            
            for (var category of categories) {
                var selectedCount = selectedItems.filter(si => si.categoryId === category.id).length;
                var isSelected = selectedCount > 0;
                
                html += '<div class="category-card' + (isSelected ? ' selected' : '') + '">' +
                    '<div class="category-header">' +
                    '<div class="category-info">' +
                    '<div class="category-title">' +
                    '<div class="category-icon" style="background: ' + category.color + ';">' + category.icon + '</div>' +
                    '<span>' + category.name + '</span>' +
                    '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">' + category.description + '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted);">' + category.items.length + ' items • ' + selectedCount + ' selected</div>' +
                    '</div>' +
                    '<div class="category-actions">' +
                    '<button class="mini-btn edit" onclick="openCategoryForm(\'' + category.id + '\')" title="Edit Category">✏️</button>' +
                    '<button class="mini-btn add" onclick="openItemForm(\'' + category.id + '\')" title="Add Item">➕</button>' +
                    '<button class="mini-btn" style="background: var(--accent-warm);" onclick="deleteCategory(\'' + category.id + '\')" title="Delete Category">🗑️</button>' +
                    '</div>' +
                    '</div>';
                
                if (category.items.length > 0) {
                    html += '<div class="items-list">';
                    
                    for (var item of category.items) {
                        var isItemSelected = selectedItems.some(si => si.categoryId === category.id && si.itemId === item.id);
                        
                        html += '<div class="item-row' + (isItemSelected ? ' selected' : '') + '">' +
                            '<div class="select-checkbox' + (isItemSelected ? ' checked' : '') + '" onclick="toggleItemSelection(\'' + category.id + '\', \'' + item.id + '\')">' +
                            (isItemSelected ? '✓' : '') +
                            '</div>' +
                            '<div class="item-info">' +
                            '<div class="item-name">' + item.name + '</div>' +
                            '<div class="item-details">' + item.description + ' • ' + item.unit + '</div>' +
                            '</div>' +
                            '<div class="item-price">RM ' + item.price.toFixed(2) + '</div>' +
                            '<div class="item-actions">' +
                            '<button class="mini-btn edit" onclick="openItemForm(\'' + category.id + '\', \'' + item.id + '\')" title="Edit Item">✏️</button>' +
                            '<button class="mini-btn" style="background: var(--accent-warm);" onclick="deleteItem(\'' + category.id + '\', \'' + item.id + '\')" title="Delete Item">🗑️</button>' +
                            '</div>' +
                            '</div>';
                    }
                    
                    html += '</div>';
                } else {
                    html += '<div style="text-align: center; padding: 20px; color: var(--text-muted); font-size: 12px;">' +
                        'No items yet. Click ➕ to add items.' +
                        '</div>';
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderSavedQuotes() {
            var container = document.getElementById('quotes-list');
            if (!container) return;
            
            if (savedQuotes.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">💰</div>' +
                    '<p style="font-weight: 600;">No saved quotes</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create quotes from the category builder</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            var sortedQuotes = [...savedQuotes].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            for (var quote of sortedQuotes) {
                html += '<div class="card">' +
                    '<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">' +
                    '<div>' +
                    '<h3 style="font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">' + quote.title + '</h3>' +
                    '<div style="font-size: 12px; color: var(--text-muted);">' + quote.items.length + ' items • Created: ' + new Date(quote.createdAt).toLocaleDateString() + '</div>' +
                    '</div>' +
                    '<div style="text-align: right;">' +
                    '<div style="font-size: 20px; font-weight: 700; color: var(--accent-primary);">RM ' + quote.total.toFixed(2) + '</div>' +
                    '<button class="btn btn-primary" style="padding: 8px 16px; font-size: 12px; margin-top: 8px;" onclick="viewSavedQuote(' + quote.id + ')">View Quote</button>' +
                    '</div>' +
                    '</div>';
                
                if (quote.notes) {
                    html += '<div style="background: var(--bg-secondary); padding: 12px; border-radius: 8px; margin-bottom: 12px;">' +
                        '<div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Notes:</div>' +
                        '<div style="font-size: 14px; color: var(--text-primary);">' + quote.notes + '</div>' +
                        '</div>';
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderRecentActivity() {
            var container = document.getElementById('recent-activity');
            if (!container) return;
            
            var activities = [];
            
            // Add recent quotes
            for (var quote of savedQuotes.slice(-5)) {
                activities.push({
                    type: 'quote',
                    title: 'Quote Created',
                    description: quote.title + ' - RM ' + quote.total.toFixed(2),
                    time: new Date(quote.createdAt),
                    icon: '💰'
                });
            }
            
            // Sort by time
            activities.sort((a, b) => b.time - a.time);
            
            if (activities.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 24px; margin-bottom: 8px;">📋</div>' +
                    '<p>No recent activity</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var activity of activities.slice(0, 5)) {
                html += '<div style="display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border-color);">' +
                    '<div style="font-size: 20px;">' + activity.icon + '</div>' +
                    '<div>' +
                    '<div style="font-weight: 700; color: var(--text-primary); font-size: 14px;">' + activity.title + '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted);">' + activity.description + '</div>' +
                    '<div style="font-size: 10px; color: var(--text-muted);">' + activity.time.toLocaleDateString() + '</div>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function viewSavedQuote(quoteId) {
            var quote = savedQuotes.find(q => q.id === quoteId);
            if (!quote) return;
            
            // Load quote into cart for viewing
            selectedItems = [...quote.items];
            document.getElementById('quote-title').value = quote.title;
            document.getElementById('quote-notes').value = quote.notes || '';
            
            updateCartBadge();
            reviewQuote();
        }

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function updateStats() {
            var totalQuotes = savedQuotes.length;
            var totalItems = categories.reduce((sum, cat) => sum + cat.items.length, 0);
            var totalRevenue = savedQuotes.reduce((sum, quote) => sum + quote.total, 0);
            
            var today = new Date().toISOString().split('T')[0];
            var todayRevenue = savedQuotes
                .filter(quote => quote.createdAt.split('T')[0] === today)
                .reduce((sum, quote) => sum + quote.total, 0);
            
            updateElementText('total-quotes-count', totalQuotes);
            updateElementText('total-items-count', totalItems);
            updateElementText('today-revenue', 'RM ' + Math.round(todayRevenue));
            updateElementText('total-revenue', 'RM ' + Math.round(totalRevenue));
            updateElementText('daily-revenue', 'RM ' + todayRevenue.toFixed(2));
        }

        function updateElementText(elementId, text) {
            var element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }

        function updateStatusBar() {
            var now = new Date();
            var timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            
            var timeElement = document.getElementById('status-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        function updateCurrentDate() {
            var today = new Date();
            var dateString = today.toLocaleDateString('en-MY', { 
                weekday: 'long',
                month: 'long', 
                day: 'numeric' 
            });
            
            var dateElement = document.getElementById('current-date');
            if (dateElement) {
                dateElement.textContent = dateString;
            }
        }

        function setupMobileOptimizations() {
            // Update status bar every minute
            setInterval(updateStatusBar, 60000);
            
            // Prevent zoom on double tap
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        function showSuccessMessage(message) {
            var messageElement = document.getElementById('success-message');
            if (!messageElement) return;
            
            messageElement.textContent = message;
            messageElement.classList.add('show');
            
            setTimeout(function() {
                messageElement.classList.remove('show');
            }, 3000);
        }

        function exportData() {
            var allData = {
                categories: categories,
                savedQuotes: savedQuotes,
                selectedItems: selectedItems,
                themePreference: currentTheme,
                exportDate: new Date().toISOString(),
                version: '6.0-enhanced-builder'
            };
            
            var dataStr = JSON.stringify(allData, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            var link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'REFIT_Enhanced_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showSuccessMessage('🍑 Enhanced data exported successfully!');
        }

        // Event Listeners
        function setupEventListeners() {
            // Forms
            var categoryForm = document.getElementById('category-form');
            if (categoryForm) {
                categoryForm.addEventListener('submit', handleCategorySubmit);
            }
            
            var itemForm = document.getElementById('item-form');
            if (itemForm) {
                itemForm.addEventListener('submit', handleItemSubmit);
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'n':
                            e.preventDefault();
                            openCategoryForm();
                            break;
                        case 'e':
                            e.preventDefault();
                            exportData();
                            break;
                        case 'c':
                            e.preventDefault();
                            openQuoteCart();
                            break;
                        case 'd':
                            e.preventDefault();
                            toggleTheme();
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    var modals = document.querySelectorAll('.modal.show');
                    for (var i = 0; i < modals.length; i++) {
                        modals[i].classList.remove('show');
                    }
                }
            });
        }

        // Legacy functions for compatibility
        function openLogoSelector() {
            showSuccessMessage('🍑 Enhanced Quote Builder - Logo customization available in settings!');
        }

        console.log('🍑 REFIT ENHANCED QUOTE BUILDER - Complete System Ready!');
        console.log('🏗️ Category & Item Management');
        console.log('🛒 Advanced Quote Cart');
        console.log('📄 PDF Generation & Sharing');
        console.log('💾 Data Persistence & Export');
    </script>
</body>
</html>
